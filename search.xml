<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Mysql-常用语句</title>
    <url>/archives/1b257343.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Mysql-常用语句。</p><a id="more"></a><div class="note warning"><p>以下语句，注意要携带语句后的分号</p></div><div class="note primary"><p>连接数据库报错：<code>UnhandledPromiseRejectionWarning: Error: ER_NOT_SUPPORTED_AUTH_MODE: Client does not support</code>，mysql8.0加密方式原因。</p><ol><li>win键搜索，打开 MySQL 8.0 Command Line Client</li><li>键入密码：123456</li><li>修改加密规则：<code>ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;password&#39; PASSWORD EXPIRE NEVER;</code></li><li>更新用户密码：<code>ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED WITH mysql_native_password BY &#39;123456&#39;;</code></li><li>刷新权限：<code>FLUSH PRIVILEGES;</code></li></ol></div><h3 id="操作数据库"><a href="#操作数据库" class="headerlink" title="操作数据库"></a>操作数据库</h3><ul><li><code>mysql -u root -p</code> 发起连接数据库，如果是用win键搜索，【MySQL 8.0 Command Line Client】打开，则无需发起，直接可输入密码</li><li><code>SHOW DATABASES;</code> 显示所有数据库</li><li><code>SHOW CREATE DATABASE test;</code> 显示指定（名为test）数据库</li><li><code>CREATE DATABASE db;</code> 创建（名为db）的数据库（简单版），之后为了避免乱码，需要改变数据库编码方式，推荐使用严谨版</li><li><code>ALTER DATABASE db DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;</code> 改变数据库编码方式，一般用utf8，避免乱码</li><li><code>CREATE DATABASE IF NOT EXISTS db DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;</code> 有条件地创建（名为db）数据库（严谨版）</li><li><code>DROP DATABASE db;</code> 删除（名为db）数据库，一次只能删除一个数据库</li><li><code>USE db;</code> 使用（名为db）数据库</li></ul><h3 id="操作表"><a href="#操作表" class="headerlink" title="操作表"></a>操作表</h3><ul><li><code>SHOW TABLES;</code> 显示所有的表，前提是 <code>USE db;</code>，使用了当前的数据库</li><li><code>CREATE TABLE IF NOT EXISTS user(id INT, name VARCHAR(20), age INT);</code> 创建表（名为user），变量在前，数据类型在后，变量与变量之间用逗号隔开</li><li><code>CREATE TABLE user SELECT * FROM users;</code> 根据现有的表（名为users）来创建表（名为user）并插入指定条件的数据</li><li><code>DESC user;</code> 查看表（名为user）的结构</li><li><code>SELECT * FROM user;</code> 查询指定的表（名为user），<code>*</code> 代表所有</li><li><code>SELECT id FROM user;</code> 查看user表中的id列</li><li><code>ALTER TABLE user ADD phome INT;</code> 在表（名为user）中，增加一个列（phone），类型为int</li><li><code>ALTER TABLE user DROP phone;</code> 在表（名为user）中，删除一个列（phone）</li><li><code>RENAME TABLE user TO users;</code> 表名重命名（user -&gt; users）</li><li><code>ALTER TABLE user CHANGE phone phonenum INT;</code> 修改表（名为user）中的列名（phone -&gt; phonenum）</li><li><code>DROP TABLE IF EXISTS user;</code> 删除指定表（名为user）</li></ul><h3 id="操作表中数据"><a href="#操作表中数据" class="headerlink" title="操作表中数据"></a>操作表中数据</h3><ul><li><code>INSERT INTO user(id, name, age) VALUES (2, &quot;me&quot;, 10);</code> 向表（名为user）插入数据，前一个括号是列名，后一个括号是对列名的赋值</li><li><code>INSERT INTO user VALUES (1, &quot;DEVIN&quot;, 20);</code> 如果是对表（名为user）中所有列赋值，可以省略前一个括号，直接values</li><li><code>UPDATE user SET id=3 WHERE id=1;</code> 修改表（名为user）中 id=1的那一行数据，变更为 id=3</li><li><code>DELETE FROM user WHERE id=3;</code> 删除表（名为user）中 id=3的那一行数据</li></ul><h3 id="查询表中数据"><a href="#查询表中数据" class="headerlink" title="查询表中数据"></a>查询表中数据</h3><h4 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h4><ul><li><code>SELECT * FROM user WHERE id=2;</code> 查询表（名为user），条件为id=2</li><li><code>SELECT * FROM user WHERE id BETWEEN 0 AND 10;</code> 查询表（名为user），条件为 0&lt;=id&lt;=10</li></ul><h4 id="模糊查询"><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h4><p><code>%</code> 代表多个任意字符，<code>_</code> 代表任意一个字符</p><ul><li><code>SELECT * FROM user WHERE name like &quot;%un%&quot;;</code> 查询表（名为user），条件为 name 字段中含有“un”的一条数据</li></ul><h4 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h4><ul><li><code>SELECT * FROM user LIMIT 0,1;</code> 查询表（名为user），第0条到第1条数据，即第一条数据</li></ul><h4 id="去重查询"><a href="#去重查询" class="headerlink" title="去重查询"></a>去重查询</h4><ul><li><code>SELECT DISTINCT age from user;</code> 查询表（名为user），字段age的去重查询</li></ul><h4 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h4><ul><li><code>SELECT * FROM user INNER JOIN student ON user.id=student.id;</code> 内连接，查询两个表（user,student）的id交集部分数据</li></ul><h3 id="排序数据"><a href="#排序数据" class="headerlink" title="排序数据"></a>排序数据</h3><p>升序：<code>ASC</code>，降序：<code>DESC</code>，默认为 <code>ASC</code></p><ul><li><code>SELECT * FROM user ORDER BY age,name ASC;</code> 查询表（user）的所有数据，排序为age的升序，如果age相同，则按name的升序</li></ul><h3 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h3><ul><li><code>SELECT COUNT(id) FROM user;</code> 查询表（user）中有多少条数据</li><li><code>SELECT MAX(age) FROM user;</code> 取表（user）中，age的最大值</li><li><code>SELECT MIN(age) FROM user;</code> 取表（user）中，age的最小值</li><li><code>SELECT SUM(age) FROM user;</code> 取表（user）中，age的总和</li><li><code>SELECT AVG(age) FROM user;</code> 取表（user）中，age的平均值</li></ul><h3 id="操作键"><a href="#操作键" class="headerlink" title="操作键"></a>操作键</h3><ul><li><code>ALTER TABLE user ADD RPIMARY KEY (id)</code> 添加主键（primary key，主键只有一个）</li><li><code>ALTER TABLE user DROP RPIMARY KEY</code> 删除主键</li></ul><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Database</category>
        <category>Mysql</category>
      </categories>
      <tags>
        <tag>Database</tag>
        <tag>Mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>Docsify</title>
    <url>/archives/2eeac462.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Docsify的基本使用。</p><a id="more"></a><h2 id="官方及文档"><a href="#官方及文档" class="headerlink" title="官方及文档"></a>官方及文档</h2><ul><li>官方地址：<a href="https://docsify.js.org/#/" target="_blank" rel="noopener external nofollow noreferrer">https://docsify.js.org/#/</a></li><li>推荐教程：<a href="https://segmentfault.com/a/1190000017576714" target="_blank" rel="noopener external nofollow noreferrer">https://segmentfault.com/a/1190000017576714</a></li></ul><h2 id="Dosify特性"><a href="#Dosify特性" class="headerlink" title="Dosify特性"></a>Dosify特性</h2><ul><li>无需构建，写完文档直接发布</li><li>容易使用并且轻量（~19kb gzipped）</li><li>智能的全文搜索</li><li>提供多套主题</li><li>丰富的 API</li><li>支持 Emoji</li><li>兼容 IE10+</li><li>支持 PWA</li><li>支持 SSR</li></ul><h2 id="Docsify-本地运行"><a href="#Docsify-本地运行" class="headerlink" title="Docsify 本地运行"></a>Docsify 本地运行</h2><p>使用 <code>docsify-cli</code> 来进行本地开发。具体步骤如下：</p><ol><li><code>npm i docsify-cli -g</code> , 全局安装 doscify 脚手架工具</li><li><code>mkdir weblog</code> , 寻找本地磁盘，新建项目目录</li><li><code>cd weblog</code> , 进入项目目录文件中</li><li><code>docsify init ./docs</code> , 初始化一个项目，会生成一些文件</li><li><code>docsify serve ./</code> ， 本地启动服务，即可及时刷新预览</li></ol><h2 id="常用配置"><a href="#常用配置" class="headerlink" title="常用配置"></a>常用配置</h2><ol><li>编辑 <code>index.html</code> 中 <code>window.$docsify</code> 的 <code>coverpage</code> 参数，和创建 <code>_coverpage.md</code> 文件即可展示封面。</li><li>替换 <code>index.html</code> 中 的 <code>css</code> 样式，即可改变主题。</li><li>编辑 <code>index.html</code> 中 <code>window.$docsify</code> 的 <code>loadSidebar</code> 参数，和创建 <code>_sizebar.md</code> 文件即可自定义菜单栏。</li><li>github设置中，开启 <code>GitHub Pages</code> 功能并选择 <code>master branch / docs folder</code> 选项。</li></ol><h2 id="特殊的渲染语法"><a href="#特殊的渲染语法" class="headerlink" title="特殊的渲染语法"></a>特殊的渲染语法</h2><ol><li><p><code>!&gt; Time is money!</code>: 重要内容</p></li><li><p><code>?&gt; You are my friend</code>: 普通提示</p></li><li><p><code>[link](/demo &#39;:target=_blank&#39;)</code>: 设置超链接的打开方式（<code>_black/_self</code>）</p></li><li><p><code>[link](/demo &#39;:disaled&#39;)</code>: 超链接禁止点击</p></li><li><p><code>![image](url &#39;:size=50%&#39;)</code>: 图片显示大小（<code>&#39;:size=50x100&#39;/&#39;:size=100&#39;/&#39;:size=20%&#39;</code>）</p></li><li><p>隐藏/展开详情</p><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">details</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">summary</span>&gt;</span></span>展示文章<span class="xml"><span class="tag">&lt;/<span class="name">summary</span>&gt;</span></span></span><br><span class="line">这是隐藏的内容    </span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">details</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li></ol><!-- rebuild by neat -->]]></content>
      <categories>
        <category>文档</category>
        <category>Docsify</category>
      </categories>
      <tags>
        <tag>Docsify</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo特色语法</title>
    <url>/archives/5d6bbf47.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>这是一篇关于hexo一些进阶写法的样式文章。</p><a id="more"></a><h3 id="文本居中引用"><a href="#文本居中引用" class="headerlink" title="文本居中引用"></a>文本居中引用</h3><blockquote class="blockquote-center"><p>预测未来的最好方式是创造未来</p></blockquote><h3 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h3><h4 id="普通-markdown-写法"><a href="#普通-markdown-写法" class="headerlink" title="普通 markdown 写法"></a>普通 markdown 写法</h4><blockquote><p>I’am Devin.</p><p>I like coding.</p></blockquote><h4 id="hexo-写法"><a href="#hexo-写法" class="headerlink" title="hexo 写法"></a>hexo 写法</h4><blockquote><p>I’am Devin. I like coding.</p></blockquote><h4 id="hexo-作者引用"><a href="#hexo-作者引用" class="headerlink" title="hexo 作者引用"></a>hexo 作者引用</h4><blockquote><p>I’am Devin. I like coding.</p><footer><strong>—Devin</strong></footer></blockquote><h3 id="标记"><a href="#标记" class="headerlink" title="标记"></a>标记</h3><div class="note default"><p>default 提示块标签</p></div><div class="note primary"><p>primary 提示块标签</p></div><div class="note success"><p>success 提示块标签</p></div><div class="note info"><p>info 提示块标签</p></div><div class="note warning"><p>warning 提示块标签</p></div><div class="note danger"><p>danger 提示块标签</p></div><h4 id="不携带icon"><a href="#不携带icon" class="headerlink" title="不携带icon"></a>不携带icon</h4><div class="note warning no-icon"><p>warning 提示块标签</p></div><h3 id="标签"><a href="#标签" class="headerlink" title="标签"></a>标签</h3><span class="label default">默认</span> <span class="label primary">主要</span> <span class="label success">成功</span> <span class="label info">信息</span> <span class="label warning">警告</span> <span class="label danger">危险</span> <span class="label success">这是成功的信息</span><h3 id="按钮"><a href="#按钮" class="headerlink" title="按钮"></a>按钮</h3><a class="btn" href="https://20202030.cc/"><i class="fa fa-link fa-fw"></i>链接 </a><a class="btn" href="https://20202030.cc/" title="这是子俊的私人领域"><i class="fa fa-home fa-fw"></i>首页 </a><a class="btn" href="https://20202030.cc/" title="豆瓣电影"><i class="fa fa-film fa-fw"></i>观影 </a><a class="btn" href="https://20202030.cc/" title="豆瓣读书"><i class="fa fa-book fa-fw"></i>阅读</a><h3 id="选项卡"><a href="#选项卡" class="headerlink" title="选项卡"></a>选项卡</h3><div class="tabs" id="tab"><ul class="nav-tabs"><li class="tab active"><a href="#tab-1">A</a></li><li class="tab"><a href="#tab-2">B</a></li><li class="tab"><a href="#tab-3">C</a></li></ul><div class="tab-content"><div class="tab-pane active" id="tab-1"><p><strong>选项卡 A</strong></p></div><div class="tab-pane" id="tab-2"><p><strong>选项卡 B</strong></p></div><div class="tab-pane" id="tab-3"><p><strong>选项卡 C</strong> 名字为C</p></div></div></div><!-- rebuild by neat -->]]></content>
      <categories>
        <category>文档</category>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo踩坑</title>
    <url>/archives/7c55949b.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>主要记录hexo使用过程中的一些Bug，Hexo的踩坑之路。</p><a id="more"></a><h3 id="本地预览ok，部署有问题"><a href="#本地预览ok，部署有问题" class="headerlink" title="本地预览ok，部署有问题"></a>本地预览ok，部署有问题</h3><ul><li><p>Bug描述：</p><p>部署生产，标签文章打开出现 404，但是，本地预览 无此问题。</p></li></ul><ul><li><p>Bug解决：</p><p>出现的问题的原因是：git中设置了大小写不敏感。所以，可以修改 git 设置不忽略大小写。进入项目文件夹，进入 <code>git</code> 目录：<code>.deploy_git</code> , 修改 <code>.git</code> 文件中的配置文件 <code>config</code> , 修改 <code>ignorecase</code> 属性：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ignorecase = <span class="literal">false</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="404页面错误"><a href="#404页面错误" class="headerlink" title="404页面错误"></a>404页面错误</h3><ul><li><p>Bug描述：</p><p>生产环境，404显示不正确，渲染成了post页面，而不是需要的页面。</p></li><li><p>Bug解决：</p><p>在 <code>source</code> 目录下新建 <code>404.html</code> 文件，写入以下代码：</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>404<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"content-type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=utf-8;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge,chrome=1"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"robots"</span> <span class="attr">content</span>=<span class="string">"all"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"robots"</span> <span class="attr">content</span>=<span class="string">"index,follow"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"//qzonestyle.gtimg.cn/qzone/hybrid/app/404/search_children.js"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span> <span class="attr">homePageUrl</span>=<span class="string">"/"</span> <span class="attr">homePageName</span>=<span class="string">"返回"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在主题配置文件中修改 <code>menu</code> 属性：</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="attr">commonweal:</span> <span class="string">/404</span> <span class="string">||</span> <span class="string">heartbeat</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="图片插入"><a href="#图片插入" class="headerlink" title="图片插入"></a>图片插入</h3><p>没必要修改 站点的 <code>_config.yml</code> 配置文件的 <code>post_asset_folder</code> 属性，因为一旦设为 <code>true</code>，那么在 <code>hexo new post</code> 新文章时同时会创建标题目录</p><p>Bug描述：</p><ul><li>Typora 显示图片，但是开发中不显示</li></ul><p>Bug解决：</p><ol><li><p>点击 <code>win</code> 键搜索 <code>cmd</code>，右键以管理员身份运行 <code>cmd.exe</code>（避免后的的 <code>mklink</code> 操作无权限）</p></li><li><p><code>cd e:\ban-jing\source\_posts</code> 打开文章目录</p></li><li><p><code>mklink /d assets e:\ban-jing\source\assets</code> 建立符号链接，成功后会有提示</p></li><li><p>修改Typora图片设置</p><p><img data-src="../../assets/20200528193119.png" alt=""></p></li><li><p>拖动图片即可自动复制 <code>assets</code> 目录</p></li></ol><!-- rebuild by neat -->]]></content>
      <categories>
        <category>文档</category>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>踩坑</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript算法-最长重复子数组</title>
    <url>/archives/1ddc8c9a.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>给两个整数数组 <code>A</code> 和 <code>B</code> ，返回两个数组中公共的、长度最长的子数组的长度。</p><a id="more"></a><p><strong>题目：</strong></p><p>给两个整数数组 <code>A</code> 和 <code>B</code> ，返回两个数组中公共的、长度最长的子数组的长度。</p><p>说明：</p><ol><li><code>1 &lt;= len(A), len(B) &lt;= 1000</code></li><li><code>0 &lt;= A[i], B[i] &lt; 1000</code></li></ol><p>测试用例：</p><blockquote><p>e.g. 1<br>输入：<br>A: [1, 2, 3, 2, 1]<br>B: [3, 2, 1, 4, 7]<br>输出：3</p><p>e.g. 2<br>输入：<br>A: [0, 0, 0, 0, 0]<br>B: [0, 0, 0, 0, 0]<br>输出：5</p></blockquote><!-- rebuild by neat -->]]></content>
      <categories>
        <category>前端</category>
        <category>JavaScript</category>
        <category>算法</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript基础-会话通信</title>
    <url>/archives/c9577b.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录会话通信的方式，Session，Cookie，Token这三种的方式的详情。</p><a id="more"></a><h3 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h3><p>HTTP是一个无状态的协议。什么是无状态呢？就是说这一次的请求和上一次的请求时没有任何关联的，互不认识的，没有关系的。这种无状态的好处就是快速。坏处就是我们想要把 <code>www.20202030.cc/login.html</code> 和 <code>www.20202030.cc/index.html</code> 关联起来，必须使用某些手段和工具。Cookie/Session/Token就是这个手段和工具的产物。</p><h3 id="Cookie和Session"><a href="#Cookie和Session" class="headerlink" title="Cookie和Session"></a>Cookie和Session</h3><p>其客户端访问服务器的流程如下：</p><ol><li><p>首先，客户端会发送一个HTTP请求到服务器端</p></li><li><p>服务器端接收到客户端的请求后，建议一个Session，并发送一个HTTP响应到客户端，这个响应头，其中头部就包含 <code>Set-Cookie</code> 属性。这个头部就包含了SessionId。<code>Set-Cookie</code> 格式如下：<code>Set-Cookie: value[; expires=date][; domain=domain][;path=path][; secure][; httpOnly]</code>，e.g.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">// Response Headers</span><br><span class="line">Set-Cookie: laravel_session=OVpQTJJq1L53FDhHgCooiHUqD1EpM8l1ZhtWgDl5; expires=Wed, 10-Jun-2020 08:45:25 GMT; Max-Age=604800; path=/; httponly</span><br></pre></td></tr></table></figure></li><li><p>在客户端发起的第二次请求，假如服务器给了 <code>Set-Cookie</code>，浏览器会自动在请求头中添加Cookie。e.g.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">// Request Headers</span><br><span class="line">Cookie: laravel_session=OVpQTJJq1L53FDhHgCooiHUqD1EpM8l1ZhtWgDl5</span><br></pre></td></tr></table></figure></li><li><p>服务器接收请求，分解Cookie，验证信息，核对成功后返回response给客户端</p></li></ol><p><img data-src="../../assets/20200605112814.png" alt=""></p><div class="note warning no-icon"><ul><li>Cookie只是实现Session的其中一种方案。虽然是最常用的 ，但并不是唯一的方法。禁用Cookie后还有其他方法存储，比如放在url中</li><li>现在大多都是Session+Cookie，但是只是Session不用Cookie，或是只是Cookie，不用Session在理论上都可以保持会话状态。可是实际中因为多种原因，一般不会单独使用</li><li>用Session只需要在客户端保存一个id，实际上大量数据都是保存在服务端。如果全部用Cookie，数据量大的时候客户端是没有那么多空间的</li><li>如果只用Cookie不用Session，那么账户信息全部保留在客户端，一旦被劫持，全部信息都会泄露。并且客户端数据量变大，网络传输的数据量也会变大</li></ul><p><strong>简而言之，Session有用户信息档案表，里面包含了用户的认证信息和登录状态等信息，而Cookie就是用户的通行证。</strong></p></div><h3 id="Token"><a href="#Token" class="headerlink" title="Token"></a>Token</h3><p>Token 也称作令牌，由 <code>uid + time + sign [+ 固定参数]</code>组成。Token的认证方式类似于临时的证书签名，并且是一种服务器端无状态的认证方式，非常适合于REST API的场景。所谓的无状态就是服务端并不会保存身份认证相关的数据。用Token解决负载均衡多服务器的问题的跨域认证方案也称为：JWT（Json web Token）。</p><p>其组成为：</p><ul><li><code>uid：</code>用户唯一身份标识</li><li><code>time：</code>当前时间的时间戳</li><li><code>sign：</code>签名，使用 hash/encrypt 压缩成定长的十六进制字符串，以防止第三方恶意拼接</li><li>固定参数（可选）： 将一些常用的固定参数加入到token中是为了避免重复查库</li></ul><p>Token在客户端一般存放于LocalStorage，Cookie，或SessionStorage中。在服务器一般存在于数据库中。</p><p>Token的认证流程如下：</p><ol><li>用户登录，成功后服务器返回Token给客户端</li><li>客户端收到数据后保存在客户端</li><li>客户端再次访问服务器，将Token放入Headers中</li><li>服务器端采用Filter过滤器校验。校验成功则返回请求数据，校验失败则放回错误码</li></ol><p><img data-src="../../assets/20200605135955.png" alt=""></p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ol><li>Session存储于服务器，可以理解为一个状态列表，拥有一个唯一识别符号：SessionId，通常存放于Cookie中。服务器收到Cookie后解析出SessionId，再去Session列表中查找，才能找到相应的Session。Session对Cookie的依赖不是必然的，替代方案有url等。</li><li>Cookie类似一个令牌，装有SessionId，存储在客户端，浏览器通常会自动添加。</li><li>Token也类似一个令牌，无状态，用户信息都被加密到Token中，服务器收到Token后解密就可知道是哪个用户。需要开发者手动添加。</li><li>JWT只是一个跨域认证的方案。</li></ol><!-- rebuild by neat -->]]></content>
      <categories>
        <category>前端</category>
        <category>JavaScript</category>
        <category>基础</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>前端</tag>
        <tag>Cookie</tag>
        <tag>Session</tag>
        <tag>Token</tag>
      </tags>
  </entry>
  <entry>
    <title>Sourcetree使用</title>
    <url>/archives/f0db4be8.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Sourcetree的基本使用及常见踩坑问题。</p><a id="more"></a><h2 id="安装跳过注册安装"><a href="#安装跳过注册安装" class="headerlink" title="安装跳过注册安装"></a>安装跳过注册安装</h2><ol><li><p>安装SrouceTree，下载地址: <a href="https://www.sourcetreeapp.com/，执行到选择bitbucket的界面退出" target="_blank" rel="noopener external nofollow noreferrer">https://www.sourcetreeapp.com/，执行到选择bitbucket的界面退出</a></p></li><li><p>到 <code>C:\Users\{用户名}\AppData\Local\Atlassian\SourceTree\</code> 这个路径下创建 <code>accounts.json</code>,并写入以下代码</p><figure class="highlight"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">"$id"</span>: <span class="string">"1"</span>,</span><br><span class="line">    <span class="attr">"$type"</span>: <span class="string">"SourceTree.Api.Host.Identity.Model.IdentityAccount, SourceTree.Api.Host.Identity"</span>,</span><br><span class="line">    <span class="attr">"Authenticate"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"HostInstance"</span>: &#123;</span><br><span class="line">      <span class="attr">"$id"</span>: <span class="string">"2"</span>,</span><br><span class="line">      <span class="attr">"$type"</span>: <span class="string">"SourceTree.Host.Atlassianaccount.AtlassianAccountInstance, SourceTree.Host.AtlassianAccount"</span>,</span><br><span class="line">      <span class="attr">"Host"</span>: &#123;</span><br><span class="line">        <span class="attr">"$id"</span>: <span class="string">"3"</span>,</span><br><span class="line">        <span class="attr">"$type"</span>: <span class="string">"SourceTree.Host.Atlassianaccount.AtlassianAccountHost, SourceTree.Host.AtlassianAccount"</span>,</span><br><span class="line">        <span class="attr">"Id"</span>: <span class="string">"atlassian account"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"BaseUrl"</span>: <span class="string">"https://id.atlassian.com/"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"Credentials"</span>: &#123;</span><br><span class="line">      <span class="attr">"$id"</span>: <span class="string">"4"</span>,</span><br><span class="line">      <span class="attr">"$type"</span>: <span class="string">"SourceTree.Model.BasicAuthCredentials, SourceTree.Api.Account"</span>,</span><br><span class="line">      <span class="attr">"Username"</span>: <span class="string">""</span>,</span><br><span class="line">      <span class="attr">"Email"</span>: <span class="literal">null</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"IsDefault"</span>: <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">]Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure></li><li><p>打开 <code>SourceTree.exe_Url_iayhtc13zv3obzuz5vchezjs1az2q5ef</code> (该目录与版本有关，可能不一致)，进入 <code>user.config</code> 文件，增加以下代码</p><figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;setting name="AgreedToEULA" serializeAs="String"&gt;</span><br><span class="line">    &lt;value&gt;True&lt;/value&gt;</span><br><span class="line">&lt;/setting&gt;</span><br><span class="line">&lt;setting name="AgreedToEULAVersion" serializeAs="String"&gt;</span><br><span class="line">    &lt;value&gt;20160201&lt;/value&gt;</span><br><span class="line">&lt;/setting&gt;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure></li><li><p>重新点击 SourceTree.exe 安装，弹框选择最后一项 [我不想使用Mercuial] 即可</p></li></ol><h2 id="设置-SSH"><a href="#设置-SSH" class="headerlink" title="设置 SSH"></a>设置 SSH</h2><ol><li>[工具] -&gt; [选项] -&gt; [SSH客户端配置]<ol><li>[SSH客户端] 选择 [OpenSSH]</li><li>[SSH密钥] 选择本地的 <code>id_rsa</code> 私钥文件（Git章节有详细教程）</li></ol></li><li>添加公钥到服务器，以GitHub为例：<ol><li>[github] -&gt; [Settings] -&gt; [SSH and GPG keys] -&gt; [New SSH key] 添加 <code>~/.ssh/id_rsa.pub</code> 文件内容到里面</li></ol></li></ol><h2 id="账户验证"><a href="#账户验证" class="headerlink" title="账户验证"></a>账户验证</h2><ol><li><p>Basic 验证</p><p>填写对应的用户名和密码即可验证</p></li><li><p>OAuth 验证</p><p>[github] -&gt; [Settings] -&gt; [Developer settings] -&gt; [OAuth Apps] 应用的名称随便填，主页 URL 填写<code>http://localhost:8080</code>，跳转网址填写 <code>http://localhost:8080/oauth/redirect</code></p></li></ol><h2 id="解决gitflow无法正常使用"><a href="#解决gitflow无法正常使用" class="headerlink" title="解决gitflow无法正常使用"></a>解决gitflow无法正常使用</h2><ol><li><p>点击 设置 -&gt; 编辑配置文件</p></li><li><p>修改配置选项：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[gitflow <span class="string">"prefix"</span>]</span><br><span class="line">    feature = feature/</span><br><span class="line">    bugfix = bugfix/</span><br><span class="line">    release = release/</span><br><span class="line">    hotfix = hotfix/</span><br><span class="line">    support = support/</span><br><span class="line">    versiontag =</span><br></pre></td></tr></table></figure></li></ol><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Git</category>
        <category>Sourcetree</category>
      </categories>
      <tags>
        <tag>Sourcetree</tag>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript精华-常用工具方法集合</title>
    <url>/archives/7f02b3bf.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录工作总常用的一些工具方法集合，也适用于vue项目中的utlils目录下的方法整理。为方便使用，这里已模块化方式书写。</p><a id="more"></a><h3 id="判断常量"><a href="#判断常量" class="headerlink" title="判断常量"></a>判断常量</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// const.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>是否为测试环境</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;boolean&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> IS_DEV = [<span class="string">"development"</span>, <span class="string">"develop"</span>, <span class="string">"dev"</span>].includes(</span><br><span class="line">  process.env.NODE_ENV</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>是否为生产环境</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;boolean&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> IS_PROD = [<span class="string">"production"</span>, <span class="string">"prod"</span>].includes(process.env.NODE_ENV);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>是否在IOS中</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;boolean&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> IS_IOS = <span class="regexp">/(iphone|ipad|ipod|ios)/i</span>.test(</span><br><span class="line">  navigator.userAgent.toLowerCase()</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>是否在Android中</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;boolean&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> IS_ANDROID = <span class="regexp">/(android|linux)/i</span>.test(</span><br><span class="line">  navigator.userAgent.toLowerCase()</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>是否在微信中</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;boolean&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> IS_WX = <span class="regexp">/micromessenger/</span>.test(</span><br><span class="line">  <span class="built_in">window</span>.navigator.userAgent.toLowerCase()</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>是否在微信小程序中</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;boolean&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> IS_WX_MINI_PROGRAM = <span class="regexp">/miniprogram/</span>.test(</span><br><span class="line">  (<span class="built_in">window</span>.__wxjs_environment || navigator.userAgent).toLowerCase()</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="判断相关方法"><a href="#判断相关方法" class="headerlink" title="判断相关方法"></a>判断相关方法</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// judge-methods.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>判断对象是否为空</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>obj &#123;Object&#125; 判断对象参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;boolean&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isEmptyObj = <span class="function"><span class="params">obj</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">JSON</span>.stringify(obj) === <span class="string">"&#123;&#125;"</span> || obj === <span class="literal">null</span> || obj === <span class="literal">undefined</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>判断数组是否为空</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>arr &#123;Array&#125; 判断数组参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;boolean&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isEmptyArray = <span class="function"><span class="params">arr</span> =&gt;</span> !arr.length;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>检测空格、回车、换行、空白</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>str &#123;String&#125; 处理的字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;boolean&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isBlank = <span class="function"><span class="params">str</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> reg = <span class="regexp">/^\s*$/</span>;</span><br><span class="line">  <span class="keyword">return</span> reg.test(str);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>判断是否是超链接</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>str &#123;String&#125; 处理的字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;boolean&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isHttps = <span class="function"><span class="params">str</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> reg = <span class="regexp">/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&amp;=]*)?/</span>;</span><br><span class="line">  <span class="keyword">return</span> reg.test(str);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>判断是否是合法的省份证号</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>str &#123;String&#125; 处理的字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;boolean&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isIdCardNo = <span class="function"><span class="params">str</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> reg = <span class="regexp">/^([0-9])&#123;7,18&#125;([xX])?$/</span>;</span><br><span class="line">  <span class="keyword">return</span> reg.test(str);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>判断是否是合法的手机号</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>str &#123;String&#125; 处理的字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;boolean&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isMobile = <span class="function"><span class="params">str</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> reg = <span class="regexp">/^1\d&#123;10&#125;$/</span>;</span><br><span class="line">  <span class="keyword">return</span> reg.test(str);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>判断是否是合法的邮箱</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>str &#123;String&#125; 处理的字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;boolean&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isEmail = <span class="function"><span class="params">str</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> reg = <span class="regexp">/^(\w-*\.*)+@(\w-?)+(\.\w&#123;2,&#125;)+$/</span>;</span><br><span class="line">  <span class="keyword">return</span> reg.test(str);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>判断是否是合法的微信号</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>str &#123;String&#125; 处理的字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;boolean&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isWeChatNo = <span class="function"><span class="params">str</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> reg = <span class="regexp">/^[a-zA-Z]([-_a-zA-Z0-9]&#123;5,19&#125;)+$/</span>;</span><br><span class="line">  <span class="keyword">return</span> reg.test(str);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="设备相关方法"><a href="#设备相关方法" class="headerlink" title="设备相关方法"></a>设备相关方法</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// device-methods.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>判断设备</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getBrowser</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ua = <span class="built_in">window</span>.navigator.userAgent || <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">const</span> isAndroid = <span class="regexp">/android/i</span>.test(ua);</span><br><span class="line">  <span class="keyword">const</span> isIos = <span class="regexp">/iphone|ipad|ipod/i</span>.test(ua);</span><br><span class="line">  <span class="keyword">const</span> isWeChat = <span class="regexp">/micromessenger\/([\d.]+)/i</span>.test(ua);</span><br><span class="line">  <span class="keyword">const</span> isWeibo = <span class="regexp">/(weibo).*weibo__([\d.]+)/i</span>.test(ua);</span><br><span class="line">  <span class="keyword">const</span> isQQ = <span class="regexp">/qq\/([\d.]+)/i</span>.test(ua);</span><br><span class="line">  <span class="keyword">const</span> isQQBrowser = <span class="regexp">/(qqbrowser)\/([\d.]+)/i</span>.test(ua);</span><br><span class="line">  <span class="keyword">const</span> isQZone = <span class="regexp">/qzone\/.*_qz_([\d.]+)/i</span>.test(ua);</span><br><span class="line">  <span class="keyword">const</span> isOriginalChrome =</span><br><span class="line">    /chrome\/[\d.]+ Mobile Safari\/[\d.]+<span class="regexp">/i.test(ua) &amp;&amp; isAndroid;</span></span><br><span class="line"><span class="regexp">  const isSafari =</span></span><br><span class="line"><span class="regexp">    /</span>safari\/([\d.]+)$/i.test(ua) &amp;&amp;</span><br><span class="line">    isIos &amp;&amp;</span><br><span class="line">    ua.indexOf(<span class="string">"Crios"</span>) &lt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">    ua.indexOf(<span class="string">"Mozilla"</span>) === <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">const</span> isApp =</span><br><span class="line">    ua.indexOf(<span class="string">"platform=ios"</span>) &gt; <span class="number">-1</span> || ua.indexOf(<span class="string">"platform=android"</span>) &gt; <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    isAndroid,</span><br><span class="line">    isIos,</span><br><span class="line">    isWeChat,</span><br><span class="line">    isWeibo,</span><br><span class="line">    isQQ,</span><br><span class="line">    isQQBrowser,</span><br><span class="line">    isQZone,</span><br><span class="line">    isOriginalChrome,</span><br><span class="line">    isSafari,</span><br><span class="line">    isApp</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="字符串相关方法"><a href="#字符串相关方法" class="headerlink" title="字符串相关方法"></a>字符串相关方法</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// string-methods.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>字符串去除所有html标签</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>str &#123;string&#125; 需要处理的字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;*&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> removeHtmlTag = <span class="function"><span class="params">str</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> reg = <span class="regexp">/&lt;\/?.+?\/?&gt;/g</span>;</span><br><span class="line">  <span class="keyword">return</span> str.replace(reg, <span class="string">""</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>清除字符前后空格</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>str &#123;string&#125; 需要处理的字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;*&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> clearSpace = <span class="function"><span class="params">str</span> =&gt;</span> str.replace(<span class="regexp">/(^\s*)|(\s*)$/g</span>, <span class="string">""</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>移除所有空格</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>v &#123;string&#125; 需要处理的字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;*&#125;</span> </span>返回正确的字符串</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> removeAllSpace = <span class="function"><span class="params">v</span> =&gt;</span> v.replace(<span class="regexp">/\s+/g</span>, <span class="string">""</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>移除所有超链接</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>html &#123;string&#125; html字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;*&#125;</span> </span>返回移除超链接之后的字符串</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> removeAllHyperLink = <span class="function"><span class="params">html</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> reg = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="regexp">/&lt;a[^&gt;]*href=['"]([^"]*)['"].*?[^&gt;]*&gt;(.*?)&lt;\/a&gt;/gi</span>);</span><br><span class="line">  <span class="keyword">return</span> reg.test(html) ? html.replace(reg, <span class="string">""</span>) : html;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>替换文本中所有换行(\n)为&lt;br/&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>str &#123;string&#125; 需要处理的字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;*&#125;</span> </span>替换之后的字符串</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> replaceAllLineBreakWithBr = <span class="function"><span class="params">str</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> reg = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="regexp">/\\+n/g</span>);</span><br><span class="line">  <span class="keyword">return</span> reg.test(str) ? str.replace(reg, <span class="string">"&lt;br/&gt;"</span>) : str;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>清除内容中 \n | \\n</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>str &#123;string&#125; 需要处理的字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;*&#125;</span> </span>清除之后的字符串</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> removeAllLineBreak = <span class="function"><span class="params">str</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> reg = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="regexp">/\\+n/g</span>);</span><br><span class="line">  <span class="keyword">return</span> reg.test(str) ? str.replace(reg, <span class="string">""</span>) : str;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>去除字符串中&lt;br/&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>str &#123;string&#125; 需要处理的字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;*&#125;</span> </span>去除之后的字符串</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> removeBr = <span class="function"><span class="params">str</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> reg = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="regexp">/&lt;br\s*\\?\/?&gt;/gi</span>);</span><br><span class="line">  <span class="keyword">return</span> reg.test(str) ? str.replace(reg, <span class="string">""</span>) : str;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>获取文件后缀名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>filePath &#123;string&#125; file地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example </span>https://baidu.com/file/123.mp4</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;Object&#125;</span> </span>文件后缀 mp4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getFileType = <span class="function"><span class="params">filePath</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> startIndex = filePath.lastIndexOf(<span class="string">"."</span>);</span><br><span class="line">  <span class="keyword">if</span> (startIndex !== <span class="number">-1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> filePath.substring(startIndex + <span class="number">1</span>, filePath.length).toLowerCase();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>解析url参数，转换为参数对象模式</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>url &#123;string&#125; url地址 default: window.location.href</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example </span>?id=12345&amp;a=b</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;Object&#125;</span> </span>转换之后的对象 &#123;id:12345, a:b&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> parseQueryString = <span class="function"><span class="params">url</span> =&gt;</span> &#123;</span><br><span class="line">  url = !url ? <span class="built_in">window</span>.location.href : url;</span><br><span class="line">  <span class="keyword">if</span> (url.indexOf(<span class="string">"?"</span>) === <span class="number">-1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> search =</span><br><span class="line">    url[<span class="number">0</span>] === <span class="string">"?"</span> ? url.substr(<span class="number">1</span>) : url.substring(url.lastIndexOf(<span class="string">"?"</span>) + <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">if</span> (search === <span class="string">""</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  search = search.split(<span class="string">"&amp;"</span>);</span><br><span class="line">  <span class="keyword">let</span> query = &#123;&#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; search.length; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> pair = search[i].split(<span class="string">"="</span>);</span><br><span class="line">    query[<span class="built_in">decodeURIComponent</span>(pair[<span class="number">0</span>])] = <span class="built_in">decodeURIComponent</span>(pair[<span class="number">1</span>] || <span class="string">""</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> query;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="数值相关方法"><a href="#数值相关方法" class="headerlink" title="数值相关方法"></a>数值相关方法</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// number-methods.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; removeAllSpace &#125; <span class="keyword">from</span> <span class="string">"./string-methods"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>四舍五入</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>number &#123;number&#125; 处理的数字</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>digit &#123;number&#125; 需要保留的小数位数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;number&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getMathRound = <span class="function">(<span class="params">number = <span class="number">0</span>, digit = <span class="number">2</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> exponent = <span class="built_in">Math</span>.pow(<span class="number">10</span>, digit);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.round(number * exponent) / exponent;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>取两个数之间的随机数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>min &#123;number&#125; 范围最小值(包此值)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>max &#123;number&#125; 范围最大值(含此值)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;number&#125;</span> </span>随机数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example </span>(1,7) =&gt; 1/2/3/4/5/6/7</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> randomInt = <span class="function">(<span class="params">min, max</span>) =&gt;</span></span><br><span class="line">  <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * (max - min) + min);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>格式化手机号为 3-4-4结构</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>v &#123;string | number&#125; 输入连续字符或数字</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;string&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> formatPhoneNum = <span class="function"><span class="params">v</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> _v = removeAllSpace(v);</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">isNaN</span>(_v)) &#123;</span><br><span class="line">    <span class="keyword">return</span> _v;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (_v.length &gt;= <span class="number">3</span> &amp;&amp; _v.length &lt;= <span class="number">7</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> FIRST_PART = _v.substr(<span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line">      <span class="keyword">const</span> SECOND_PART = _v.substr(<span class="number">3</span>);</span><br><span class="line">      v = FIRST_PART + <span class="string">" "</span> + SECOND_PART;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (_v.length &gt; <span class="number">7</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> FIRST_PART = _v.substr(<span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line">      <span class="keyword">const</span> SECOND_PART = _v.substr(<span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">      <span class="keyword">const</span> THIRD_PART = _v.substr(<span class="number">7</span>);</span><br><span class="line">      v = FIRST_PART + <span class="string">" "</span> + SECOND_PART + <span class="string">" "</span> + THIRD_PART;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> v;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>强制保留n位小数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>value &#123;string | number&#125; 需要处理的数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>n &#123;number&#125; 需要保留的小数位数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;string | number&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> returnFloat = <span class="function">(<span class="params">value, n</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> v = <span class="built_in">Math</span>.round(<span class="built_in">parseFloat</span>(value) * <span class="number">100</span>) / <span class="number">100</span>;</span><br><span class="line">  <span class="keyword">let</span> xsd = v.toString().split(<span class="string">"."</span>);</span><br><span class="line">  <span class="keyword">if</span> (xsd.length === <span class="number">1</span>) &#123;</span><br><span class="line">    v = v.toString() + <span class="string">"."</span> + <span class="string">"0"</span>.repeat(n);</span><br><span class="line">    <span class="keyword">return</span> v;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (xsd.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (xsd[<span class="number">1</span>].length &lt; n) &#123;</span><br><span class="line">      v = v.toString() + <span class="string">"0"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> v;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>金钱“，”格式处理，保留n位小数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>s &#123;string | number&#125; 需要处理的数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>n &#123;number&#125; 需要保留的小数位数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;string&#125;</span> </span>5,000.00</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> formatMoney = <span class="function">(<span class="params">s, n</span>) =&gt;</span> &#123;</span><br><span class="line">  n = n &gt; <span class="number">0</span> &amp;&amp; n &lt;= <span class="number">20</span> ? n : <span class="number">2</span>;</span><br><span class="line">  s = <span class="built_in">parseFloat</span>((s + <span class="string">""</span>).replace(<span class="regexp">/[^\d.-]/g</span>, <span class="string">""</span>)).toFixed(n) + <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">let</span> l = s</span><br><span class="line">    .split(<span class="string">"."</span>)[<span class="number">0</span>]</span><br><span class="line">    .split(<span class="string">""</span>)</span><br><span class="line">    .reverse();</span><br><span class="line">  <span class="keyword">let</span> r = s.split(<span class="string">"."</span>)[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">let</span> t = <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; l.length; i++) &#123;</span><br><span class="line">    t += l[i] + ((i + <span class="number">1</span>) % <span class="number">3</span> === <span class="number">0</span> &amp;&amp; i + <span class="number">1</span> !== l.length ? <span class="string">","</span> : <span class="string">""</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    t</span><br><span class="line">      .split(<span class="string">""</span>)</span><br><span class="line">      .reverse()</span><br><span class="line">      .join(<span class="string">""</span>) +</span><br><span class="line">    <span class="string">"."</span> +</span><br><span class="line">    r</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>百分比格式处理，保留n位小数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>value &#123;string | number&#125; 需要处理的数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>n &#123;number&#125; 需要保留的小数位数, 默认保留2位小数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;string&#125;</span> </span>20.00%</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> fPercent = <span class="function">(<span class="params">value, n = <span class="number">2</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> number = (<span class="built_in">Number</span>(value) * <span class="number">100</span>).toFixed(n);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;number&#125;</span>%`</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="数组、对象相关方法"><a href="#数组、对象相关方法" class="headerlink" title="数组、对象相关方法"></a>数组、对象相关方法</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// object-methods.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>两个数组合并一个对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>arr1 &#123;array&#125; 被合并数组，在对象中以 键 存在</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>arr2 &#123;array&#125; 被合并数组，在对象中以 值 存在</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;object&#125;</span> </span>返回键值对的对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> arrContactObject = <span class="function">(<span class="params">arr1, arr2</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> obj = &#123;&#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr1.length; i++) &#123;</span><br><span class="line">    obj[arr1[i]] = arr2[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> obj;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>深拷贝，支持常见类型</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>values 复制之前的数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;&#123;&#125;</span></span>|Array|Date|*&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> deepClone = <span class="function"><span class="params">values</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> copy;</span><br><span class="line">  <span class="keyword">if</span> (values === <span class="literal">null</span> || <span class="keyword">typeof</span> values !== <span class="string">"object"</span>) <span class="keyword">return</span> values;</span><br><span class="line">  <span class="keyword">if</span> (values <span class="keyword">instanceof</span> <span class="built_in">Date</span>) &#123;</span><br><span class="line">    copy = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    copy.setTime(values.getTime());</span><br><span class="line">    <span class="keyword">return</span> copy;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (values <span class="keyword">instanceof</span> <span class="built_in">Array</span>) &#123;</span><br><span class="line">    copy = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = values.length; i &lt; len; i++) &#123;</span><br><span class="line">      copy[i] = deepClone(values[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> copy;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (values <span class="keyword">instanceof</span> <span class="built_in">Object</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(values));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Unable to copy values! Its type isn't supported."</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="图片相关方法"><a href="#图片相关方法" class="headerlink" title="图片相关方法"></a>图片相关方法</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// image-methods.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>将html转化为图片</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>element &#123;Object&#125; 需要转化的dom</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>scale &#123;Number&#125; 放大倍数，默认2倍，原因为保持转化后图片的清晰度</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>isSaveImg &#123;Boolean&#125; 是否保存图片</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>callback &#123;Function&#125; 转化后的成功回调，参数为图片的DOM,用于图片操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> generateCanvasImage = <span class="function">(<span class="params">element, scale = <span class="number">2</span>, isSaveImg = <span class="literal">false</span>, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> width = element.offsetwidth;</span><br><span class="line">  <span class="keyword">let</span> height = element.offsetheight;</span><br><span class="line">  <span class="keyword">let</span> canvas = <span class="built_in">document</span>.createElement(<span class="string">'canvas'</span>);</span><br><span class="line">  <span class="keyword">const</span> SCALE = scale;</span><br><span class="line">  canvas.width = width * SCALE;</span><br><span class="line">  canvas.height = height * SCALE;</span><br><span class="line">  canvas.getContext(<span class="string">'2d'</span>).scale(scale, scale);</span><br><span class="line">  <span class="keyword">const</span> opts = &#123;</span><br><span class="line">    scale,</span><br><span class="line">    canvas,</span><br><span class="line">    width,</span><br><span class="line">    height,</span><br><span class="line">    useCORS: <span class="literal">true</span></span><br><span class="line">  &#125;;</span><br><span class="line">  html2canvas(element, opts).then(<span class="function"><span class="params">canvasObj</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> context = canvasObj.getContext(<span class="string">'2d'</span>);</span><br><span class="line">    context.webkitImageSmoothingEnabled = <span class="literal">false</span>;</span><br><span class="line">    context.imageSmoothingEnabled = <span class="literal">false</span>;</span><br><span class="line">    isSaveImg &amp;&amp; Canvas2Image.saveAsPNG(canvasObj, canvasObj.width, canvasObj.height);</span><br><span class="line">    <span class="keyword">const</span> IMGDOM = Canvas2Image.convertToPNG(canvasObj, canvasObj.width, canvasObj.height);</span><br><span class="line">    callback &amp;&amp; callback(IMGDOM);</span><br><span class="line">    <span class="keyword">return</span> IMGDOM;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="时间相关方法"><a href="#时间相关方法" class="headerlink" title="时间相关方法"></a>时间相关方法</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// date-methods.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>倒计时计算年，天，时，分，秒</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>targetTime &#123;number | string&#125; 目标时间（将来的设定时间）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>startTime &#123;number | string&#125; 开始时间（一般为现在时间）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;&#123;years: *, days: *, hours: *, minutes: *, seconds: *&#125;</span></span>&#125; 返回对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> returnLeftTime = <span class="function">(<span class="params">targetTime, startTime</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">checkTime</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (i &lt; <span class="number">10</span>) &#123;</span><br><span class="line">      i = <span class="string">"0"</span> + i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">String</span>(i);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> currTime = startTime || <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line">  <span class="keyword">let</span> leftTime = <span class="built_in">Number</span>(targetTime) - <span class="built_in">Number</span>(currTime);</span><br><span class="line">  <span class="keyword">if</span> (leftTime &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> years = <span class="built_in">parseInt</span>(<span class="built_in">String</span>(leftTime / <span class="number">1000</span> / <span class="number">60</span> / <span class="number">60</span> / <span class="number">24</span> / <span class="number">365</span>), <span class="number">10</span>);</span><br><span class="line">    <span class="keyword">let</span> days = <span class="built_in">parseInt</span>(<span class="built_in">String</span>(leftTime / <span class="number">1000</span> / <span class="number">60</span> / <span class="number">60</span> / <span class="number">24</span>), <span class="number">10</span>);</span><br><span class="line">    <span class="keyword">let</span> hours = <span class="built_in">parseInt</span>(<span class="built_in">String</span>((leftTime / <span class="number">1000</span> / <span class="number">60</span> / <span class="number">60</span>) % <span class="number">24</span>), <span class="number">10</span>);</span><br><span class="line">    <span class="keyword">let</span> minutes = <span class="built_in">parseInt</span>(<span class="built_in">String</span>((leftTime / <span class="number">1000</span> / <span class="number">60</span>) % <span class="number">60</span>), <span class="number">10</span>);</span><br><span class="line">    <span class="keyword">let</span> seconds = <span class="built_in">parseInt</span>(<span class="built_in">String</span>((leftTime / <span class="number">1000</span>) % <span class="number">60</span>), <span class="number">10</span>);</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      years: checkTime(years),</span><br><span class="line">      days: checkTime(days),</span><br><span class="line">      hours: checkTime(hours),</span><br><span class="line">      minutes: checkTime(minutes),</span><br><span class="line">      seconds: checkTime(seconds)</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>获取当前日期的N个月/天前后的日期</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>months &#123;number&#125; N月，+N 表示N月之后; -N 表示N月之前</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>days &#123;number&#125; N日， +N 表示N天之后; -N 表示N天之前</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>isZero &#123;boolean&#125; 是否需要补零 true(默认) 需要;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>joinSign &#123;string&#125; 日期连接符号 ‘-’(默认)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;string&#125;</span> </span>输出需求格式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getFewMonthAgoOrAfterDate = (</span><br><span class="line">  months = <span class="number">0</span>,</span><br><span class="line">  days = <span class="number">0</span>,</span><br><span class="line">  isZero = <span class="literal">true</span>,</span><br><span class="line">  joinSign = <span class="string">"-"</span></span><br><span class="line">) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> dt = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">  dt.setMonth(dt.getMonth() + months, dt.getDate() + days);</span><br><span class="line">  <span class="keyword">let</span> Year = dt.getFullYear();</span><br><span class="line">  <span class="keyword">let</span> Month = dt.getMonth() + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">let</span> Day = dt.getDate();</span><br><span class="line">  <span class="keyword">if</span> (isZero) &#123;</span><br><span class="line">    Month = Month &lt; <span class="number">10</span> ? <span class="string">"0"</span> + Month : Month;</span><br><span class="line">    Day = Day &lt; <span class="number">10</span> ? <span class="string">"0"</span> + Day : Day;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;Year&#125;</span><span class="subst">$&#123;joinSign&#125;</span><span class="subst">$&#123;Month&#125;</span><span class="subst">$&#123;joinSign&#125;</span><span class="subst">$&#123;Day&#125;</span>`</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>是否为闰年</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;boolean&#125;</span> </span>输出需求格式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isLeapYear = <span class="function"><span class="params">year</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (year % <span class="number">4</span> === <span class="number">0</span> &amp;&amp; year % <span class="number">100</span> !== <span class="number">0</span>) || year % <span class="number">400</span> === <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="优化相关方法"><a href="#优化相关方法" class="headerlink" title="优化相关方法"></a>优化相关方法</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// optimize-methods.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>防抖</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>delay &#123;number&#125; 等待时间</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>fn &#123;Function&#125; 需执行函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> debounce = <span class="function">(<span class="params">delay, fn</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> timer;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    timer &amp;&amp; clearTimeout(timer);</span><br><span class="line">    timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      fn(...args);</span><br><span class="line">      timer = <span class="literal">null</span>;</span><br><span class="line">    &#125;, delay);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>节流</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>delay &#123;number&#125; 计划好的执行间隔</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>fn &#123;Function&#125; 需执行函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> throttled = <span class="function">(<span class="params">delay, fn</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> lastCall = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> NOW = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line">    <span class="keyword">if</span> (NOW - lastCall &lt; delay) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    lastCall = NOW;</span><br><span class="line">    <span class="keyword">return</span> fn(...args);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
      <categories>
        <category>前端</category>
        <category>JavaScript</category>
        <category>精华</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>前端</tag>
        <tag>工具</tag>
        <tag>精华</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript基础-Storage存储</title>
    <url>/archives/4fd295e0.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录前端的存储方式：Cookie、SessionStorage、LocalStorage的使用、区别、使用场景等。</p><a id="more"></a><h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><p><strong>为什么会有Cookie</strong></p><p>Web应用程序是使用HTTP协议进行数据传输的。HTTP协议是无状态的协议。一旦数据交互完毕，客户端与服务端的连接就会关闭，再次交换数据需要建立新的连接。这就意味着服务器无法从连接上跟踪会话。要跟踪该会话，必须引入一种机制。Cookie就是这样的一种机制，它可以弥补HTTP协议无状态的不足。在Session出现之前，基本上所有的网址都采用Cookie来跟踪会话。不同的是：Cookie通过在客户端记录信息确定用户身份，Session通过在服务器端记录信息确定用户身份。</p><p><strong>什么是Cookie</strong></p><p>Cookie是由服务端生成，发送给User-Agent（一般是浏览器），服务器告诉浏览器设置一下Cookie，浏览器自动会将Cookie以键值对的形式保存到某个目录下的文本文件中 ，下次请求同一网站也会自动发送该Cookie给服务器，即添加在请求头部（前提是浏览器设置为启动Cookie）。这就是Cookie的工作原理。简单说就是服务端给客户端颁发一个通行证，每人一个，无论谁访问都必须携带自己的通行证，这样服务器就能从通行证上确认客户身份。</p><p><strong>Cookie组成</strong></p><ol><li><code>Name/Value</code>：设置Cookie的名称及对应的值。一旦创建，名称便不能更改。</li><li><code>Expires/Max-age</code>：设置Cookie的生存期。如果 <code>Expires</code> 属性缺省，为会话性Cookie，仅保存在客户端内存中，浏览器关闭时失效，否则为持久性Cookie，直至有效期到期或者手动到期。</li><li><code>Domain</code>：设置访问该Cookie的域名。如果设置为 “.a.com”，那么以 “a.com”结尾的所有域名都可以访问该Cookie。</li><li><code>Path</code>：设置Cookie的使用路径。如果设置为 “/a” ，那么路由为 <code>/a</code> 及下级路由可以访问该Cookie，如果设置为 “/”，则本域名下的所有路由都可以访问该Cookie。</li><li><code>Secure</code>：设置Cookie是否只在HTTPS或者其他安全协议时，才会发送。默认为空（都会携带）。</li><li><code>HttpOnly</code>：设置Cookie能否通过JS去访问。默认为空（可以通过JS去访问）。</li></ol><p><strong>Cookie的特点</strong></p><ol><li>Cookie具有有效期<ul><li>可通过设置 <code>expires</code> 来设定Cookie的有效期，持久性Cookie，保存在硬盘中</li><li>如果不设置，默认是临时存储，即关闭浏览器就消失，临时性Cookie，保存在内存中</li></ul></li><li>Cookie满足同源策略<ul><li>必须满足条件之一：同域名（协议和端口可以不同）</li><li>必须满足跳转之二：均可访问到当前路径或父级路径的Cookie</li></ul></li><li>Cookie内存大小有限制<ul><li>不同浏览器的限制不同，一般是一个域名下最多20个Cookie，每个Cookie最大限制4K</li></ul></li><li>Cookie的安全性不高<ul><li>Cookie可以在本地被更改和获取，敏感数据不要放在Cookie里</li></ul></li></ol><p><strong>Cookie的使用</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.cookie = <span class="string">"myname=zi jun; expires=Thu, 18 Dec 2030 12:00:00 GMT; path=/"</span>; <span class="comment">// 创建cookie,修改cookie</span></span><br><span class="line"><span class="keyword">let</span> cookie = <span class="built_in">document</span>.cookie; <span class="comment">// 读取cookie</span></span><br><span class="line"><span class="built_in">document</span>.cookie = <span class="string">"username=; expires=Thu, 01 Jan 1970 00:00:00 GMT"</span>;</span><br></pre></td></tr></table></figure><h2 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h2><p><strong>什么是Session</strong></p><p>Session是另一种记录客户状态的机制，不同的是Cookie保存在客户端浏览器中，而Session保存在服务器上。客户端浏览器访问服务器的时候，服务器把客户端信息以某种形式记录在服务器上。这就是Session。客户端浏览器再次访问时只需要从该Session中查找该客户的状态就可以了。如果说Cookie机制是通过检查客户身上的“通行证”来确定客户身份的话，那么Session机制就是通过检查服务器上的“客户明细表”来确认客户身份。Session相当于程序在服务器上建立的一份客户档案，客户来访的时候只需要查询客户档案表就可以了。</p><p>SessionId是第一个请求之后响应，服务器写在响应头，Set-Cookie的头部的，这个头部包含了 SessionId。Cookie只是实现Session的其中一种方案。虽然是最常用的，但不是唯一的办法。比如禁用Cookie后还有其他方法存储，比如放在url中。</p><div class="note warning no-icon"><p>更多的关于Cookie、session、token详情，可见 <a href="/archives/c9577b.html">链接</a></p></div><h2 id="SessionStorage"><a href="#SessionStorage" class="headerlink" title="SessionStorage"></a>SessionStorage</h2><p>SessionStorage仅在当前会话下有效，关闭页面或浏览器后被清除。存放数据大小为一般为5MB,而且它仅在客户端（即浏览器）中保存，不参与和服务器的通信。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">sessionStorage.setItem(<span class="string">"key"</span>,<span class="string">"value"</span>); <span class="comment">// 以“key”为名称存储一个值“value”</span></span><br><span class="line">sessionStorage.getItem(<span class="string">"key"</span>); <span class="comment">// 获取名称为“key”的值</span></span><br><span class="line">sessionStorage.removeItem(<span class="string">"key"</span>); <span class="comment">// 删除名称为“key”的信息。</span></span><br><span class="line">sessionStorage.clear(); <span class="comment">// 清空sessionStorage中所有信息</span></span><br></pre></td></tr></table></figure><h2 id="LocalStorage"><a href="#LocalStorage" class="headerlink" title="LocalStorage"></a>LocalStorage</h2><p>LocalStorage生命周期是永久，这意味着除非用户显示在浏览器提供的UI上清除LocalStorage信息，否则这些信息将永远存在。存放数据大小为一般为5MB,而且它仅在客户端（即浏览器）中保存，不参与和服务器的通信。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">localStorage.setItem(<span class="string">"key"</span>,<span class="string">"value"</span>); <span class="comment">// 以“key”为名称存储一个值“value”</span></span><br><span class="line">localStorage.getItem(<span class="string">"key"</span>); <span class="comment">// 获取名称为“key”的值</span></span><br><span class="line">localStorage.removeItem(<span class="string">"key"</span>); <span class="comment">// 删除名称为“key”的信息。</span></span><br><span class="line">localStorage.clear(); <span class="comment">// 清空localStorage中所有信息</span></span><br></pre></td></tr></table></figure><h2 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h2><p><strong>共同点：</strong></p><p>都是保存在浏览器端、且同源的</p><p><strong>区别：</strong></p><ol><li>Cookie数据始终在同源的http请求中携带（即使不需要），即Cookie在浏览器和服务器间来回传递，而SessionStorage和LocalStorage不会自动把数据发送给服务器，仅在本地保存。Cookie数据还有路径（path）的概念，可以限制Cookie只属于某个路径下</li><li>存储大小限制也不同，Cookie数据不能超过4K，同时因为每次http请求都会携带Cookie、所以Cookie只适合保存很小的数据，如会话标识。SessionStorage和LocalStorage虽然也有存储大小的限制，但比Cookie大得多，可以达到5M或更大</li><li>数据有效期不同，SessionStorage：仅在当前浏览器窗口关闭之前有效；LocalStorage：始终有效，窗口或浏览器关闭也一直保存，因此用作持久数据；Cookie：只在设置的Cookie过期时间之前有效，即使窗口关闭或浏览器关闭</li><li>作用域不同，SessionStorage不在不同的浏览器窗口中共享，即使是同一个页面；Localstorage在所有同源窗口中都是共享的；Cookie也是在所有同源窗口中都是共享的</li><li>Web Storage支持事件通知机制，可以将数据更新的通知发送给监听者</li><li>Web Storage的api接口使用更方便</li></ol><!-- rebuild by neat -->]]></content>
      <categories>
        <category>前端</category>
        <category>JavaScript</category>
        <category>基础</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>前端</tag>
        <tag>Cookie</tag>
        <tag>SessionStorage</tag>
        <tag>LocalStorage</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript设计模式-单例模式</title>
    <url>/archives/1fbfc57.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录JavaScript的设计模式-单例模式。</p><a id="more"></a><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p><strong>单例模式(Singleton)：</strong>保证一个类仅有一个实例，并提供一个访问它的全局访问点。</p><p>单例模式的实现在于保证一个特定类只有一个实例，第二次使用同一个类创建新对象的时候，应该得到与第一次创建对象完全相同的对象。</p><p><code>JavaScript</code> 的单例应该视作初始化后不被修改的变量。如此看来，其实单例模式是 <code>Javascript</code> 里应用最广泛的设计模式，使用CDN引入的所有库文件的入口都是单例，比如大名鼎鼎的 <code>jQuery</code>。</p><h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>单例模式是一种常用的模式，有一些对象我们往往只需要一个，比如：线程池、全局缓存、浏览器中的window 对象等。</p><p>在 <code>JavaScript</code> 开发中，单例模式的用途同样广泛，比如 登录浮窗、购物车、ES6模块化、库文件（<code>jQuery</code>）、<code>webSocket</code>、vuex中的store 等。</p><h2 id="单例的实现"><a href="#单例的实现" class="headerlink" title="单例的实现"></a>单例的实现</h2><h3 id="最简单的对象字面量"><a href="#最简单的对象字面量" class="headerlink" title="最简单的对象字面量"></a>最简单的对象字面量</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> singleton = &#123;</span><br><span class="line">  a: <span class="string">"aaa"</span>  </span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> ton1 = singleton;</span><br><span class="line"><span class="keyword">let</span> ton2 = singleton;</span><br><span class="line"><span class="built_in">console</span>.log(ton1 === ton2); <span class="comment">// &gt; true</span></span><br></pre></td></tr></table></figure><p>十分简单，并且非常使用，不足之处在于没有什么封装性，所有的属性方法都是暴露的。对于一些需要使用私有变量的情况就显得心有余而力不足了。当然在对于 this 的问题上也是有一定弊端的。</p><h3 id="静态属性中的实例"><a href="#静态属性中的实例" class="headerlink" title="静态属性中的实例"></a>静态属性中的实例</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Universe</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> Universe.instance === <span class="string">"object"</span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> Universe.instance;</span><br><span class="line">    &#125;</span><br><span class="line">    Universe.instance = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> uni1 = <span class="keyword">new</span> Universe();</span><br><span class="line"><span class="keyword">let</span> uni2 = <span class="keyword">new</span> Universe();</span><br><span class="line"><span class="built_in">console</span>.log(uni1 === uni2); <span class="comment">// &gt; true</span></span><br></pre></td></tr></table></figure><p>在构造函数的静态属性中缓存该实例，缺点在于 instance 属性是公开可访问的属性，在外部代码中可能会修改该属性。</p><h3 id="闭包中的实例"><a href="#闭包中的实例" class="headerlink" title="闭包中的实例"></a>闭包中的实例</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Universe</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> instance = <span class="keyword">this</span>;</span><br><span class="line">    Universe = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> uni1 = <span class="keyword">new</span> Universe();</span><br><span class="line"><span class="keyword">let</span> uni2 = <span class="keyword">new</span> Universe();</span><br><span class="line"><span class="built_in">console</span>.log(uni1 === uni2); <span class="comment">// &gt; true</span></span><br></pre></td></tr></table></figure><p>当第一次调用构造函数时，它正常返回 this ，然后在以后调用时，它将会执行重写构造函数，这个构造函数通过闭包访问了私有 <code>instance</code> 变量，并且简单的返回了该 <code>instance</code>。</p><!-- rebuild by neat -->]]></content>
      <categories>
        <category>前端</category>
        <category>JavaScript</category>
        <category>设计模式</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>设计模式</tag>
      </tags>
  </entry>
  <entry>
    <title>CSS阴影Box-Shadow</title>
    <url>/archives/d371c450.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要详细记录 CSS3 的 box-shadow 大全。</p><a id="more"></a><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><p><code>box-shadow: inset offset-x offset-y blur-radius spread-radius color;</code></p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* offset-x | offset-y | color */</span></span><br><span class="line"><span class="selector-tag">box-shadow</span>: 10<span class="selector-tag">px</span> 5<span class="selector-tag">px</span> <span class="selector-tag">red</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* offset-x | offset-y | blur-radius | color */</span></span><br><span class="line"><span class="selector-tag">box-shadow</span>: 10<span class="selector-tag">px</span> 5<span class="selector-tag">px</span> 5<span class="selector-tag">px</span> <span class="selector-tag">red</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* offset-x | offset-y | blur-radius | spread-radius | color */</span></span><br><span class="line"><span class="selector-tag">box-shadow</span>: 10<span class="selector-tag">px</span> 5<span class="selector-tag">px</span> 5<span class="selector-tag">px</span> 2<span class="selector-tag">px</span> <span class="selector-tag">red</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* inset | offset-x | offet-y | color */</span></span><br><span class="line"><span class="selector-tag">box-shadow</span>: <span class="selector-tag">inset</span> 10<span class="selector-tag">px</span> 5<span class="selector-tag">px</span> <span class="selector-tag">red</span>;</span><br></pre></td></tr></table></figure><ul><li><code>inset</code>：默认阴影在外边框。使用 <code>inset</code> 后，阴影在边框内。</li><li><code>offset-x/offset-y</code>：<code>offset-x</code> 设置水平偏移量，如果是负值则阴影位于元素左边。<code>offset-y</code> 设置垂直偏移量，如果是负值则阴影位于元素上面。如果两者都是0，那么阴影位于元素后面，这是如果设置了 <code>blur-redius</code> 或 <code>spread-radius</code> 则有模糊效果。</li><li><code>blur-radius</code>：模糊距离。值越大，阴影就越大越淡。不能为负值。默认为0，此时阴影边缘锐利。</li><li><code>spread-radius</code>：阴影尺寸。取正值，阴影扩大，取负值，阴影收缩。默认为0，此时阴影与元素同样大。</li><li><code>color</code>：阴影颜色。</li></ul><h3 id="图解"><a href="#图解" class="headerlink" title="图解"></a>图解</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">150px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">150px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">120px</span> <span class="number">80px</span> <span class="number">40px</span> <span class="number">20px</span> <span class="number">#0ff</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img data-src="../../assets/20200528175403.png" alt=""></p><h3 id="常规效果"><a href="#常规效果" class="headerlink" title="常规效果"></a>常规效果</h3><h4 id="顶部阴影"><a href="#顶部阴影" class="headerlink" title="顶部阴影"></a>顶部阴影</h4><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">150px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">150px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> -<span class="number">5px</span> <span class="number">5px</span> <span class="number">0</span> <span class="number">#0ff</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img data-src="../../assets/20200529100521-1590718067131.png" alt=""></p><h4 id="底部阴影"><a href="#底部阴影" class="headerlink" title="底部阴影"></a>底部阴影</h4><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">150px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">150px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">5px</span> <span class="number">5px</span> <span class="number">0</span> <span class="number">#0ff</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img data-src="../../assets/20200529100914.png" alt=""></p><!-- rebuild by neat -->]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>CSS</tag>
        <tag>Box-Shadow</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript进阶-ApplyCall</title>
    <url>/archives/495da9ad.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录JavaScript中的 <code>call()</code> 、<code>apply()</code>、<code>bind()</code> 方法。</p><a id="more"></a><p>每个函数都包含两个非继承而来的方法： <code>call()</code> 和 <code>apply()</code> 方法。他们的作用都是在特定的作用域中调用函数，等于设置函数体内 <code>this</code> 对象的值，以扩充函数赖以运行的作用域。</p><p><strong>换句话说，<code>call()</code> 和 <code>apply()</code> 还有 <code>bind()</code> 都是用来重新定义 <code>this</code> 这个对象的。</strong></p><p>在解析他们之前，先看两个例子：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// e.g.1</span></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">"zi jun"</span>, age = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">var</span> myInfo = &#123;</span><br><span class="line">    name: <span class="string">"Devin"</span>,</span><br><span class="line">    realAge: <span class="keyword">this</span>.age,</span><br><span class="line">    sayHello: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"我的名字："</span> + <span class="keyword">this</span>.name + <span class="string">", 年龄："</span> + <span class="keyword">this</span>.age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(myInfo.realAge); <span class="comment">// &gt; 20</span></span><br><span class="line"><span class="built_in">console</span>.log(myInfo.sayHello()); <span class="comment">// &gt; 我的名字：Devin, 年龄：undefined</span></span><br></pre></td></tr></table></figure><p>当调用 <code>console.log(myInfo.realAge)</code>,即执行 <code>console.log(this.age)</code>, <code>this</code> 指向顶级 <code>Window</code> 对象。<code>window.age</code> 为 <code>20</code>；函数作为对象的一个方法时，并且作为对象的一个方法被调用时，函数中的 <code>this</code> 指向这个上一级对象。即 <code>sayHello()</code> 中的的 <code>this</code> 指向 <code>myInfo</code> 这个对象。<code>this.age</code> 即为 <code>myInfo.age</code>,值为 <code>undefined</code>。</p><div class="note warning no-icon"><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// e.g.1-1</span></span><br><span class="line"><span class="keyword">let</span> name = <span class="string">"zi jun"</span>, age = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">var</span> myInfo = &#123;</span><br><span class="line">    name: <span class="string">"Devin"</span>,</span><br><span class="line">    realAge: <span class="keyword">this</span>.age,</span><br><span class="line">    sayHello: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> age = <span class="number">28</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"我的名字："</span> + <span class="keyword">this</span>.name + <span class="string">", 年龄："</span> + <span class="keyword">this</span>.age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(myInfo.realAge); <span class="comment">// &gt; undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(myInfo.sayHello()); <span class="comment">// &gt; 我的名字：Devin, 年龄：20</span></span><br></pre></td></tr></table></figure><p>注意如果是用 <code>let</code> 声明的，那么即不是定义在 <code>window</code> 上的属性，那么 <code>window.age</code> 为 <code>undefined</code>。箭头函数中的 <code>this</code> 不是调用的时候决定的，而是在定义的时候处在的对象就是它的 <code>this</code>。换句话说，箭头函数的 <code>this</code> 看外层是否有函数，如果有，外层函数的 <code>this</code> 就是内部箭头函数的 <code>this</code>,如果没有，则 <code>this</code> 指向 <code>window</code>。</p></div><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// e.g.2</span></span><br><span class="line"><span class="keyword">var</span> fav = <span class="string">"子俊"</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">shows</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.fav;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(shows()); <span class="comment">// &gt; "子俊"</span></span><br></pre></td></tr></table></figure><p>两者 <code>this</code> 的差别：e.g.1 中 <code>this</code> 指向 <code>myInfo</code>,e.g.2 中的 <code>this</code> 指向 <code>window</code>。</p><h3 id="共同点"><a href="#共同点" class="headerlink" title="共同点"></a>共同点</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// e.g.3</span></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">"zi jun"</span>, age = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">var</span> myInfo = &#123;</span><br><span class="line">    name: <span class="string">"Devin"</span>,</span><br><span class="line">    realAge: <span class="keyword">this</span>.age,</span><br><span class="line">    sayHello: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"我的名字："</span> + <span class="keyword">this</span>.name + <span class="string">", 年龄："</span> + <span class="keyword">this</span>.age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> you = &#123;</span><br><span class="line">  	name: <span class="string">"子俊"</span>,</span><br><span class="line">    age: <span class="number">100</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(myInfo.realAge.call(you)); <span class="comment">// Uncaught TypeError: myInfo.realAge.call is not a function</span></span><br><span class="line"><span class="built_in">console</span>.log(myInfo.sayHello.call(you)); <span class="comment">// &gt; 我的名字：子俊， 年龄：100</span></span><br><span class="line"><span class="built_in">console</span>.log(myInfo.sayHello.apply(you)); <span class="comment">// &gt; 我的名字：子俊， 年龄：100</span></span><br><span class="line"><span class="built_in">console</span>.log(myInfo.sayHello.bind(you)()); <span class="comment">// &gt; 我的名字：子俊， 年龄：100</span></span><br></pre></td></tr></table></figure><p>从上面代码可以看出共性：</p><ul><li><code>call()/apply()/bind()</code> 只能作用域函数</li><li><code>call()/apply()/bind()</code> 这三个函数的第一个参数都是 <code>this</code> 的指向对象</li></ul><h3 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// e.g.4</span></span><br><span class="line"><span class="keyword">var</span> myInfo = &#123;</span><br><span class="line">    sayHello: <span class="function"><span class="keyword">function</span>(<span class="params">from, destination</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"我的名字："</span> + <span class="keyword">this</span>.name + <span class="string">", 年龄："</span> + <span class="keyword">this</span>.age + <span class="string">", 来自："</span> + <span class="keyword">from</span> + <span class="string">", 去往："</span> + destination;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> you = &#123;</span><br><span class="line">    name: <span class="string">"子俊"</span>,</span><br><span class="line">    age: <span class="number">100</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(myInfo.sayHello.call(you, <span class="string">"北京"</span>, <span class="string">"上海"</span>)); <span class="comment">// &gt; 我的名字：子俊, 年龄：100, 来自：北京, 去往：上海</span></span><br><span class="line"><span class="built_in">console</span>.log(myInfo.sayHello.apply(you, [<span class="string">"北京"</span>, <span class="string">"上海"</span>])); <span class="comment">// &gt; 我的名字：子俊, 年龄：100, 来自：北京, 去往：上海</span></span><br><span class="line"><span class="built_in">console</span>.log(myInfo.sayHello.bind(you, <span class="string">"北京"</span>, <span class="string">"上海"</span>)()); <span class="comment">// &gt; 我的名字：子俊, 年龄：100, 来自：北京, 去往：上海</span></span><br></pre></td></tr></table></figure><p>从上面代码可以看出差别：</p><ul><li><code>call()</code> 的参数从第二个开始：参数是直接方进入的，用 <code>,</code> 隔开</li><li><code>apply()</code> 的参数从第二个开始：参数是以数组的形式传入</li><li><code>bind()</code> 的参数从第二个开始：参数是直接方进入的，用 <code>,</code> 隔开，不同 <code>call()</code> 的是，它返回的是函数</li></ul><!-- rebuild by neat -->]]></content>
      <categories>
        <category>前端</category>
        <category>JavaScript</category>
        <category>进阶</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>Apply</tag>
        <tag>Call</tag>
      </tags>
  </entry>
  <entry>
    <title>Git生成SSH</title>
    <url>/archives/64992bff.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Git的安装，常用命令，生成SSH密钥等。</p><a id="more"></a><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>下载地址：<a href="http://npm.taobao.org/mirrors/git-for-windows/" target="_blank" rel="noopener external nofollow noreferrer">git-for-windows镜像</a></p><h2 id="查看命令"><a href="#查看命令" class="headerlink" title="查看命令"></a>查看命令</h2><p>查看用户名：<code>git config user.name</code></p><p>查看用户邮箱：<code>git config user.email</code></p><h2 id="修改提交信息"><a href="#修改提交信息" class="headerlink" title="修改提交信息"></a>修改提交信息</h2><p>修改用户名：<code>git config --global user.name “Zi Jun”</code></p><p>修改邮箱：<code>git config --global user.email “zijun2030@163.com”</code></p><h2 id="检查是否已经存在SSH密钥"><a href="#检查是否已经存在SSH密钥" class="headerlink" title="检查是否已经存在SSH密钥"></a>检查是否已经存在SSH密钥</h2><p><code>cd ~/.ssh</code> 如果能进入说明已经存在</p><h2 id="生成SSH密钥"><a href="#生成SSH密钥" class="headerlink" title="生成SSH密钥"></a>生成SSH密钥</h2><p><code>ssh-keygen -t rsa -C “zijun2030@163.com”</code> 按3个回车键，密码为空</p><p>文件存放位置 <code>~/.ssh</code>,如果是window的话，Administrator用户，位置：<code>C:\User\Administrator.ssh</code> 下面，如果是其他用户，需要换成对应的用户</p><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Git</category>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript进阶-PromiseAsync区别</title>
    <url>/archives/6f36c6d1.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录从一到面试题引出的 <code>setTimeout</code>, <code>Promise</code>, <code>async/await</code> 的区别。</p><a id="more"></a><h3 id="经典面试题"><a href="#经典面试题" class="headerlink" title="经典面试题"></a>经典面试题</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"async1 start"</span>);</span><br><span class="line">    <span class="keyword">await</span> async2();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"async1 end"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"async2 start"</span>);</span><br><span class="line">    <span class="keyword">await</span> async3();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"async2 end"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async3</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"async3"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"script start"</span>);</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"setTiemout"</span>);</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">async1();</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"promise1"</span>);</span><br><span class="line">    resolve();</span><br><span class="line">&#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"promise2"</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"script end"</span>);</span><br></pre></td></tr></table></figure><p>题目的本质就是考察 <code>setTimeout</code>、<code>promise</code>、<code>async/await</code> 的实现及执行顺序，以及 <code>javaScript</code> 的事件循环的相关问题。</p><h3 id="答案"><a href="#答案" class="headerlink" title="答案"></a>答案</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// script start</span></span><br><span class="line"><span class="comment">// async1 start</span></span><br><span class="line"><span class="comment">// async2 start</span></span><br><span class="line"><span class="comment">// async3</span></span><br><span class="line"><span class="comment">// promise1</span></span><br><span class="line"><span class="comment">// script end</span></span><br><span class="line"><span class="comment">// async2 end</span></span><br><span class="line"><span class="comment">// promise2</span></span><br><span class="line"><span class="comment">// async1 end</span></span><br><span class="line"><span class="comment">// setTimeout</span></span><br></pre></td></tr></table></figure><h3 id="事件循环"><a href="#事件循环" class="headerlink" title="事件循环"></a>事件循环</h3><p><code>JavaScrit</code>主线程不断地循环往复的从任务列队中读取任务，执行任务，其中运行机制称为事件循环（event loop）。</p><h3 id="微任务-宏任务"><a href="#微任务-宏任务" class="headerlink" title="微任务/宏任务"></a>微任务/宏任务</h3><p>任务类型：</p><ul><li>微任务：为 <code>async/await</code> 和 <code>Promise</code> 实现延迟执行，在每一个事件循环之前，微任务队列总是被清空（执行）<ul><li><code>process.nextTick</code></li><li><code>promise</code></li><li><code>async/await</code></li></ul></li><li>宏任务：用于处理 <code>I/O</code> 和 计时器等事件<ul><li><code>setTimeout</code></li><li><code>setInterval</code></li><li><code>I/O</code></li><li><code>UI渲染</code></li></ul></li></ul><h3 id="异步运行机制"><a href="#异步运行机制" class="headerlink" title="异步运行机制"></a>异步运行机制</h3><p><code>JavaScript</code> 主线程拥有一个 <strong>执行栈（同步任务）</strong> 和一个 <strong>任务队列</strong>，主线程会依次执行代码，</p><ul><li>当遇到函数（同步）时，会先将函数入栈，函数运行结束后再将函数出栈</li><li>当遇到任务（异步）时，这些任务会返回一个值，让主线程不在此阻塞，使主线程继续执行下去，而真正的任务交给 <strong>浏览器内核</strong> 执行，浏览器内核执行结束后，会将该任务事先定义好的 <strong>回调函数</strong> 加入相应的任务队列中</li><li>当 <code>JS</code> 主线程清空执行栈之后，会按先入先出的顺序读取微任务队列中的回调函数，并将函数入栈，继续运行执行栈，直到清空执行栈，再去读取任务队列</li></ul><h3 id="面试题执行解析"><a href="#面试题执行解析" class="headerlink" title="面试题执行解析"></a>面试题执行解析</h3><p><strong>关键点：</strong></p><ul><li><code>setTimeout</code> 为宏任务，会放置到任务队列最后执行</li><li>同级任务队列执行的模式时先进先出的原则</li><li><code>async/await</code> 中 <code>await</code> 后面的函数执行是从右到左的，即先执行 <code>await</code> 函数，在暂停(跳出) <code>async</code> 函数，执行 <code>async</code> 外面的代码</li><li>执行任务等级：<code>promise</code> &gt; <code>await</code> &gt; <code>setTimeout</code></li></ul><p><strong>具体执行步骤：</strong></p><ol><li>代码执行（主任务），<code>async1</code>,<code>async2</code>,<code>async3</code> 都是声明的异步函数，所以会跳过，直接到 <code>console.log(&quot;script start&quot;)</code>,所以会打印 <code>script start</code></li><li>执行到 <code>setTimeout</code>,<code>setTimeout</code> 为宏任务，虽然是延迟0秒执行，但是是放置到任务队列（暂命名：<strong>宏任务1</strong>）去的。往后，线程执行 <code>async1()</code>,执行 <code>async1</code> 里面的代码，打印 <code>async1 start</code></li><li>继续执行 <code>async1</code> 中的代码，便会执行 <code>async2()</code>。线程执行 <code>async2</code> 里面的代码，打印 <code>async2 start</code></li><li>线程往下执行 <code>async2</code>，遇到 <code>await async3()</code>，参照第3步，代码打印 <code>async3</code></li><li>重点来了，当第4步执行完了之后，线程回到 <code>async2()</code> 中的 <code>await async2()</code>，将回调函数（任务）放置到微任务队列（暂命名：<strong>微任务1</strong>）中。然后继续执行主任务。即执行 <code>new Promise</code>，由于 <code>promise</code> 会立即执行，所以打印 <code>promise1</code></li><li>重点又来了，由于 <code>then</code> 和 <code>await</code> 类似，所以，在执行第5步之后，其实后面的代码（<code>then</code>中的函数（任务））会放置到微任务队列（暂命名：<strong>微任务2</strong>）中。然后继续执行主任务，即执行 <code>console.log(&quot;script end&quot;)</code>，所以打印 <code>script end</code></li><li>此时，主任务已经执行完了，然后清空（执行）微任务队列。通过上述分析，可以知道，微任务队列中，有两个微任务：一个是<strong>微任务1</strong>，还有一个<strong>微任务2</strong>。根据先进先出的原则，开始执行<strong>微任务1</strong>，打印 <code>async2 end</code>。注意此时，执行完之后，线程会回到 <code>async1()</code> 中的 <code>await async2()</code>里，将回调函数（任务）放置到微任务队列（暂命名：<strong>微任务3</strong>）中</li><li>继续清空微任务队列，还是有两个：一个是<strong>微任务2</strong>，还要一个<strong>微任务3</strong>。根据先进先出的原则，开始执行<strong>微任务2</strong>，打印 <code>promise2</code></li><li>继续清空微任务队列，只有一个了，那就是<strong>微任务3</strong>，即打印 <code>async1 end</code></li><li>最后清空宏任务，打印 <code>setTimeout</code></li></ol><!-- rebuild by neat -->]]></content>
      <categories>
        <category>前端</category>
        <category>JavaScript</category>
        <category>进阶</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>Promise</tag>
        <tag>Async</tag>
        <tag>Await</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript进阶-严格模式</title>
    <url>/archives/fb69cc5d.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录JavaScript严格模式的详解。</p><a id="more"></a><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>除了正常运行模式，ECMAscript5 中添加了第二种运行模式：“严格模式”（strict mode）。顾名思义，<code>这种模式要求JavaScript</code> 在更严格的模式中运行。</p><p>设立“严格模式”的目的，主要有以下几个原因：</p><ul><li>消除 <code>JavaScript</code> 语法的一些不合理，不严谨之处，减少一些怪异行为</li><li>消除代码运行的一些不安全之处，保证代码运行的安全</li><li>提高编译效率，增加运行速度</li></ul><p>e.g. 浏览器中 <code>F12</code> 键进入调试模式：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">x = <span class="number">3.14</span>; <span class="comment">// 不会报错，正常</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">"user strict"</span></span><br><span class="line">y = <span class="number">6.18</span>; <span class="comment">// Uncaught ReferenceError: y is not defined</span></span><br></pre></td></tr></table></figure><h2 id="进入标志"><a href="#进入标志" class="headerlink" title="进入标志"></a>进入标志</h2><p>进入“严格模式”的标志，是 <code>&quot;use strict&quot;;</code>。老版本的浏览器会把它当做一行普通的字符串，会忽略。</p><h2 id="如何调用"><a href="#如何调用" class="headerlink" title="如何调用"></a>如何调用</h2><p>“严格模式”有两种调用方式</p><ol><li><p>针对整个脚本文件</p><p>需要将 <code>&quot;use strict&quot;;</code> 放在脚本文件的第一行。</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="meta">    "use strict"</span>;</span></span><br><span class="line"><span class="actionscript">    <span class="comment">// 以下代码为 严格模式</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">    <span class="comment">// 以下代码为 正常模式</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>针对单个函数</p><p>需要将 <code>&quot;use strict&quot;;</code> 放在函数体的第一行。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">strict</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="string">"user strict"</span>;</span><br><span class="line">    <span class="comment">// 以下代码为 严格模式</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">noStrict</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 以下代码为 正常模式</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="严格模式的限制"><a href="#严格模式的限制" class="headerlink" title="严格模式的限制"></a>严格模式的限制</h2><ul><li><p>不允许使用未声明的变量</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line">a = <span class="number">1</span>; <span class="comment">// Uncaught ReferenceError: a is not defined</span></span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;&#125; <span class="comment">// Uncaught ReferenceError: i is not defined</span></span><br></pre></td></tr></table></figure></li><li><p>不允许删除变量或对象，只有 <code>configurable</code> 设置为 <code>true</code> 的对象属性，才能被删除</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">delete</span> a; <span class="comment">// Uncaught SyntaxError: Delete of an unqualified identifier in strict mode.</span></span><br><span class="line"><span class="keyword">var</span> b = &#123;<span class="attr">x</span>: <span class="number">1</span>&#125;;</span><br><span class="line"><span class="keyword">delete</span> b.x; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><div class="note warning no-icon"><p>为什么 <code>var</code> / <code>let</code> / <code>const</code> 声明的变量无法删除？<br></p><p>在正常模式，变量或对象执行 <code>delete</code> 不会报错，但是删除操作不会成功。比如：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> c = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> d = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">delete</span> c;</span><br><span class="line"><span class="keyword">delete</span> d;</span><br><span class="line"><span class="built_in">console</span>.log(c); <span class="comment">// &gt; 1</span></span><br><span class="line"><span class="built_in">console</span>.log(d); <span class="comment">// &gt; 2</span></span><br></pre></td></tr></table></figure><p><strong>究其原因，是因为用不管是在正常模式还是“严格模式”下，<code>var</code> 声明的变量，其属性是 <code>configuarable = false</code>，所以不能删除</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertyDescriptor(<span class="built_in">window</span>, <span class="string">'a'</span>));</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    configurable: false,</span></span><br><span class="line"><span class="comment">    enumerable: true,</span></span><br><span class="line"><span class="comment">    value: 1,</span></span><br><span class="line"><span class="comment">    writable: true</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">/*</span></span><br></pre></td></tr></table></figure><p>更多的 对象属性，可查看<a href="/archives/27b30017.html">《JavaScript进阶-对象属性》</a></p></div></li><li><p>不允许删除函数</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="keyword">delete</span> foo; <span class="comment">// Uncaught SyntaxError: Delete of an unqualified identifier in strict mode.</span></span><br></pre></td></tr></table></figure></li><li><p>不允许变量重名</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">x, x</span>)</span>&#123;&#125; <span class="comment">// Uncaught SyntaxError: Duplicate parameter name not allowed in this context</span></span><br></pre></td></tr></table></figure></li><li><p>不允许使用八进制</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="keyword">let</span> x = <span class="number">010</span>; <span class="comment">// Uncaught SyntaxError: Octal literals are not allowed in strict mode.</span></span><br></pre></td></tr></table></figure></li><li><p>不允许使用转义字符</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="keyword">let</span> x = \<span class="number">010</span>; <span class="comment">// Uncaught SyntaxError: Invalid or unexpected token</span></span><br></pre></td></tr></table></figure></li><li><p>不允许对只读属性赋值</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj, <span class="string">"x"</span>, &#123;<span class="attr">value</span>:<span class="number">0</span>, <span class="attr">writable</span>:<span class="literal">false</span>&#125;);</span><br><span class="line">obj.x = <span class="number">3.14</span>; <span class="comment">// Uncaught TypeError: Cannot assign to read only property 'x' of object '#&lt;Object&gt;'</span></span><br></pre></td></tr></table></figure></li><li><p>不允许对一个使用getter方法读取的属性进行赋值</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;<span class="keyword">get</span> x() &#123;<span class="keyword">return</span> <span class="number">0</span>&#125; &#125;;</span><br><span class="line">obj.x = <span class="number">3.14</span>; <span class="comment">// Uncaught TypeError: Cannot set property x of #&lt;Object&gt; which has only a getter</span></span><br></pre></td></tr></table></figure></li><li><p>不允许删除一个不允许删除的属性</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="keyword">delete</span> <span class="built_in">Object</span>.prototype; <span class="comment">// Uncaught TypeError: Cannot delete property 'prototype' of function Object() &#123; [native code] &#125;</span></span><br></pre></td></tr></table></figure></li><li><p>变量名不能使用 <code>eval</code> 字符串</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="keyword">var</span> <span class="built_in">eval</span> = <span class="number">3.14</span>; <span class="comment">// Uncaught SyntaxError: Unexpected eval or arguments in strict mode</span></span><br></pre></td></tr></table></figure></li><li><p>变量名不能使用 <code>arguments</code> 字符串</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="keyword">var</span> <span class="built_in">arguments</span> = <span class="number">3.14</span>; <span class="comment">// Uncaught SyntaxError: Unexpected eval or arguments in strict mode</span></span><br></pre></td></tr></table></figure></li><li><p>在作用域 <code>eval()</code> 创建的变量不能被调用</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="built_in">eval</span> (<span class="string">"var x = 2"</span>);</span><br><span class="line">alert (x); <span class="comment">// Uncaught ReferenceError: x is not defined</span></span><br></pre></td></tr></table></figure></li><li><p>禁止 <code>this</code> 关键字指向全局对象</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="meta">    "use strict"</span>;</span><br><span class="line">    <span class="keyword">this</span>.a = <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br><span class="line">f(); <span class="comment">// Uncaught TypeError: Cannot set property 'a' of undefined</span></span><br></pre></td></tr></table></figure></li><li><p>保留关键字（<code>implements</code>、<code>interface</code>、<code>let</code>、<code>package</code>、<code>private</code>、<code>protected</code>、<code>public</code>、<code>static</code>、<code>yield</code>）</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="keyword">var</span> public = <span class="number">2</span>; <span class="comment">// Uncaught SyntaxError: Unexpected strict mode reserved word</span></span><br></pre></td></tr></table></figure></li></ul><!-- rebuild by neat -->]]></content>
      <categories>
        <category>前端</category>
        <category>JavaScript</category>
        <category>进阶</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>前端</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript进阶-回流重绘</title>
    <url>/archives/1ae5dc8a.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录页面的回流和重绘，以及相关优化。</p><a id="more"></a><h3 id="浏览器渲染大致流程"><a href="#浏览器渲染大致流程" class="headerlink" title="浏览器渲染大致流程"></a>浏览器渲染大致流程</h3><p>浏览器解析文档（JS、CSS、HTML）的流程图，可见 <a href="/archives/8bab0c48.html">链接</a></p><p>其大致过程为：</p><ol><li>浏览器请求到HTML文档后，将HTML解析并构建DOM树（DOM Tree）</li><li>处理CSS，解析成CSS样式规则（CSS Style Rules）</li><li>结合DOM树和CSS样式规则构建渲染树（Render Tree）</li><li>浏览器计算Render Tree中每个渲染对象的位置和大小，即布局（Layout）- 回流</li><li>最后进行绘制（Painting），根据回流得到的信息结合渲染树，渲染展示 - 重绘</li></ol><h3 id="回流（reflow）"><a href="#回流（reflow）" class="headerlink" title="回流（reflow）"></a>回流（reflow）</h3><p>当元素的规模尺寸、布局、隐藏等改变，而导致渲染树（Render Tree）的一部分或全部重新构建，浏览器重新渲染的过程称为回流。每个页面至少会进行一次回流，就在页面第一次加载的时候。</p><p>触发回流：</p><ul><li>页面首次渲染</li><li>添加或删除可见的DOM元素， 比如元素的 <code>display</code> 属性</li><li>元素的位置、尺寸发生改变（包括外边距、内边框、边框大小、高度、宽度等）</li><li>元素内容发生变化（文字数量或者图片大小）</li><li>元素字体大小改变</li><li>浏览器的窗口尺寸变化</li><li>激活CSS伪类（比如::hover）</li></ul><h3 id="重绘（repaint）"><a href="#重绘（repaint）" class="headerlink" title="重绘（repaint）"></a>重绘（repaint）</h3><p>当渲染树（Render Tree）中的一些元素需要更新属性，这些属性只影响元素的外观、风格（e.g. <code>color</code>，<code>background</code>），并不影响布局，浏览器会将新样式赋予给元素并重新绘制它，这个过程称为重绘。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="built_in">document</span>.body.style;</span><br><span class="line">s.padding = <span class="string">"2px"</span>; <span class="comment">// 回流+重绘</span></span><br><span class="line">s.border = <span class="string">"1px solid red"</span>; <span class="comment">// 再一次 回流+重绘</span></span><br><span class="line">s.color = <span class="string">"blue"</span>; <span class="comment">// 再一次重绘</span></span><br><span class="line">s.backgroundColor = <span class="string">"#ccc"</span>; <span class="comment">// 再一次 重绘</span></span><br><span class="line">s.fontSize = <span class="string">"14px"</span>; <span class="comment">// 再一次 回流+重绘</span></span><br><span class="line"><span class="built_in">document</span>.body.appendChild(<span class="built_in">document</span>.createTextNode(<span class="string">'abc!'</span>)); <span class="comment">// 添加node，再一次 回流+重绘</span></span><br></pre></td></tr></table></figure><div class="note warning no-icon"><p>回流必将引起重绘，而重绘并一定会引起回流。</p></div><h3 id="如何优化"><a href="#如何优化" class="headerlink" title="如何优化"></a>如何优化</h3><p>回流和重绘非常影响Web性能，因为每一次HTML和CSS的重新解析然后再构建成渲染树（Render Tree），都需要经过大量的计算，这个过程是很耗时间耗性能的。以下是针对减少回流和重绘的优化方案：</p><ol><li>不要直接使用JS操作DOM元素的样式，选择用一个class代替</li><li>如果要操作DOM,尽量将需要改变DOM的操作一次完成</li><li>不要使用table 布局，因为table 的每一个行甚至每一个单元格的样式更新都会导致整个table 重新布局</li><li>减少DOM的深度，可以减少解析器耗时</li><li>尽量简化CSS</li><li>复杂的动画，可以使其元素脱离文档流，使用 <code>position:absolute</code> 或者 <code>position:fixed</code>，以减少对父元素的影响</li></ol><!-- rebuild by neat -->]]></content>
      <categories>
        <category>前端</category>
        <category>JavaScript</category>
        <category>进阶</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>前端</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript进阶-原型和原型链</title>
    <url>/archives/d76fa986.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录原型和原型链的简单式理解。</p><a id="more"></a><h3 id="原型"><a href="#原型" class="headerlink" title="原型"></a>原型</h3><p>简单来说就是有一个构造函数，当用这个构造函数 <code>new</code> 一个实例出来的时候，这个实例的原型就是这个构造函数。在 <code>JavaScript</code> 中，有两个原型：</p><ul><li><code>prototype</code>：这个一个显式原型属性，只有函数才拥有该属性</li><li><code>__proto__</code>：这是每个对象（引用类型）都有的隐式原型属性，指向了创建该对象（实例）的构造函数的原型</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">this</span>.name = name;</span><br><span class="line">   <span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> person = <span class="keyword">new</span> Person(<span class="string">'zi jun'</span>, <span class="number">18</span>);</span><br></pre></td></tr></table></figure><div class="note warning no-icon"><ul><li><p><code>JavaScript</code> 中所有的引用类型（<code>Fucntion</code>/ <code>Array</code>/<code>Object</code>）都有自己的构造函数。</p></li><li><p><code>let arr = []</code> 的时候其实就是等于 <code>let arr = new Array()</code>。</p></li></ul></div><h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><p>创建函数有两种方式：</p><ol><li>通过 <code>function</code> 关键字定义</li><li>通过 <code>new Function</code></li></ol><p>其中函数又分为 普通函数 和 构造函数，两者唯一的区别就是调用的方式不同，语法上没有差异</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">normalFn</span>(<span class="params"></span>) </span>&#123;&#125; <span class="comment">// 普通函数（函数名首字母小写）</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ConstructFn</span>(<span class="params"></span>) </span>&#123;&#125; <span class="comment">// 构造函数（函数名首字母大写）</span></span><br></pre></td></tr></table></figure><p>传统对象的方式有多种，其中传统方法是通过构造函数来创建对象，使用 <code>new</code> 关键字即可创建，创建出来的对象实例可通过 <code>constructor</code> 来访问构造函数。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ConstructFn</span>(<span class="params"></span>) </span>&#123;&#125; <span class="comment">// 构造函数</span></span><br><span class="line"><span class="keyword">let</span> obj = <span class="keyword">new</span> ConstructFn(); <span class="comment">// 构造函数实例化（创建）对象</span></span><br><span class="line"><span class="built_in">console</span>.log(obj.constructor); <span class="comment">// &gt; f ConstuctFn() &#123;&#125; 对象可以通过 constructor 来访问构造函数</span></span><br><span class="line"><span class="built_in">console</span>.log(ConstructFn.prototype); <span class="comment">// &gt; &#123;constructor: f&#125;</span></span><br><span class="line">ConstructFn.prototype.name = <span class="string">'zi'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(ConstructFn.prototype); <span class="comment">// &gt; &#123;name: "zi", constructor: f ConsturctFn()&#123;&#125;&#125;</span></span><br></pre></td></tr></table></figure><div class="note warning"><p>在 <code>JavaScript</code> 中，万物皆对象，函数也是对象，只不过函数相对于对象有着更为精确的定义。</p></div><h3 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h3><p>为了证明 <code>prototype</code> 属性是函数独有，而 <code>__proto__</code> 是每个对象都有的，可以用以下代码测试：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(a.prototype); <span class="comment">// &gt; &#123;constructor: f&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(a.__proto__); <span class="comment">// &gt; f () &#123;[native code]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line"><span class="built_in">console</span>.log(obj.prototype); <span class="comment">// &gt; undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(obj.__proto__); <span class="comment">// &gt; &#123;constructor: ƒ, __defineGetter__: ƒ,  …&#125;</span></span><br></pre></td></tr></table></figure><div class="note warning no-icon"><p><code>undefined</code> 和 <code>null</code> 同属于对象，但是他们都没有原型，为什么？在 <code>JavaScript</code> 中，目前只有两个只有一个值的数据类型，那就是 <code>undefined</code> 和 <code>null</code>，由于这两种数据类型有且只有一个值，并且没有方法，所以自然就没有原型了。</p></div><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="literal">undefined</span>.__proto__); <span class="comment">// Uncaught TypeError: Cannot read property '__proto__' of undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="literal">null</span>.__proto__); <span class="comment">// // Uncaught TypeError: Cannot read property '__proto__' of null</span></span><br></pre></td></tr></table></figure><h3 id="构造函数创建对象"><a href="#构造函数创建对象" class="headerlink" title="构造函数创建对象"></a>构造函数创建对象</h3><ol><li>创建一个新对象</li><li>将新创建的对象的隐式原型指向其构造函数的显示原型</li><li>赋值，将 <code>this</code> 指向这个新对象</li><li>返回新对象</li></ol><p>将新创建的对象的隐式原型指向其构造函数的显示原型，也就是说：<code>对象.__proto__ === 构造函数.prototype</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Fn</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="keyword">let</span> obj = <span class="keyword">new</span> Fn();</span><br><span class="line"><span class="built_in">console</span>.log(obj.__proto__ === Fn.prototype); <span class="comment">// &gt; true</span></span><br></pre></td></tr></table></figure><p>那么，我们在为构造函数添加原型方法时，就可以通过两种方式来访问：</p><ol><li>通过构造函数的显式原型</li><li>通过实例化对象的隐式原型</li></ol><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Fn</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="keyword">let</span> obj = <span class="keyword">new</span> Fn();</span><br><span class="line">Fn.prototype.more = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;<span class="built_in">console</span>.log(<span class="string">'Fn-protopype-more'</span>)&#125;</span><br><span class="line"><span class="comment">// 通过构造函数的显式原型</span></span><br><span class="line">Fn.prototype.more(); <span class="comment">// &gt; "Fn-prototype-more"</span></span><br><span class="line"><span class="comment">// 通过实例化对象的隐式原型</span></span><br><span class="line">obj.__proto__.more(); <span class="comment">// &gt; "Fn-prototype-more"</span></span><br></pre></td></tr></table></figure><p>用原生new操作符实例化构造函数创建对象：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">this</span>.name = name; <span class="comment">// 构造函数中this指向window</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> person = <span class="keyword">new</span> Person(<span class="string">'zi'</span>); <span class="comment">// this指向person对象</span></span><br><span class="line"><span class="built_in">console</span>.log(person.__proto__ === Person.prototype); <span class="comment">// &gt; true</span></span><br><span class="line"><span class="built_in">console</span>.log(Person.prototype.constructor === Person); <span class="comment">// &gt; true</span></span><br></pre></td></tr></table></figure><p>用自定义NEW操作符实例化构造函数创建对象：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">this</span>.name = name; <span class="comment">// 构造函数中this指向window</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> NEW = <span class="function"><span class="keyword">function</span> (<span class="params">p, ...params</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">let</span> o = &#123;&#125;; <span class="comment">// 创建一个新对象</span></span><br><span class="line">   o.__proto__ = p.prototype; <span class="comment">// 新对象的隐式原型指向构造函数的显示原型</span></span><br><span class="line">   p.call(o, ...params); <span class="comment">// 改变this指向</span></span><br><span class="line">   <span class="keyword">return</span> o;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> person = NEW (Person, <span class="string">'zi'</span>); <span class="comment">// this指向person对象</span></span><br><span class="line"><span class="built_in">console</span>.log(person.__proto__ === Person.prototype); <span class="comment">// &gt; true</span></span><br><span class="line"><span class="built_in">console</span>.log(Person.prototype.constructor === Person); <span class="comment">// &gt; true</span></span><br></pre></td></tr></table></figure><h3 id="原型链"><a href="#原型链" class="headerlink" title="原型链"></a>原型链</h3><p><strong>原型链就是实例与原型之间的链接。</strong></p><p>先看上面使用过的一个简单例子：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Fn</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="keyword">let</span> obj = <span class="keyword">new</span> Fn();</span><br><span class="line">Fn.prototype.more = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;<span class="built_in">console</span>.log(<span class="string">'Fn-protopype-more'</span>)&#125;</span><br><span class="line"><span class="comment">// 通过实例化对象的隐式原型</span></span><br><span class="line">obj.__proto__.more(); <span class="comment">// &gt; "Fn-prototype-more"</span></span><br><span class="line">obj.more(); <span class="comment">// &gt; "Fn-prototype-more"</span></span><br><span class="line"><span class="built_in">console</span>.log(obj.__proto__.more === obj.more); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>以上代码可知： <code>obj.__proto__.more() === obj.more()</code>。</p><p>再看下面一个稍微复杂的例子：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 构造函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="keyword">this</span>.fn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(<span class="string">"Fn-fn"</span>) &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 对构造函数的原型修改（因为构造函数已存在此方法）方法</span></span><br><span class="line">Fn.prototype.fn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(<span class="string">"Fn-prototype-fn"</span>) &#125;;</span><br><span class="line"><span class="comment">// 对象的原型新增方法</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.fn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(<span class="string">"Object-fn"</span>) &#125;;</span><br><span class="line"><span class="comment">// 构造函数创建新对象</span></span><br><span class="line"><span class="keyword">let</span> obj = <span class="keyword">new</span> Fn();</span><br><span class="line"><span class="comment">// 新对象修改（因为对象原型已存在此方法）方法</span></span><br><span class="line">obj.fn = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(<span class="string">"obj-fn"</span>) &#125;;</span><br><span class="line">obj.fn(); <span class="comment">// &gt; obj-fn</span></span><br><span class="line">obj.fn2; <span class="comment">// &gt; undefined</span></span><br></pre></td></tr></table></figure><p>以上代码中，有4个重名的 <code>fn</code> 函数，分别是：</p><ol><li>构造函数 <code>Fn</code> 的方法</li><li>构造函数 <code>Fn</code> 原型上的方法</li><li><code>Object</code> 对象原型上的方法</li><li>实例对象 <code>ojb</code> 的方法</li></ol><p>具体查找 <code>fn</code> 方法的原型链如下：</p><ol><li>寻找某个方法或者属性，会先从自身对象寻找</li><li>如果没有，则会去构造函数寻找，注意这里没有用到原型链</li><li>紧接着，会到构造函数的原型上寻找，这里开始用到了原型链</li><li>接下来，回到 <code>Object</code> 对象的原型寻找，因为 <code>Object</code> 对象是所有对象之父，可以说所有的对象都继承了 <code>Object</code></li><li>最后，由于 <code>Object.__proto__</code> 指向了 <code>null</code>，这也就是原型链的末端</li></ol><p><img data-src="../../assets/20200703171428.png" alt=""></p><p>向上第一层原型是：<code>obj.__proto__</code>，访问到了 <code>Fn.prototype</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(obj.__proto__ === Fn.prototype); <span class="comment">// &gt; true</span></span><br></pre></td></tr></table></figure><p>向上第二层原型是：<code>obj.__proto__.__proto__</code>，访问到了 <code>Object.prototype</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(obj.__proto__.__proto__ === <span class="built_in">Object</span>.prototype); <span class="comment">// &gt; true</span></span><br></pre></td></tr></table></figure><p>向上第三层原型是：<code>obj.__proto__.__proto__.__proto__</code>，访问到了 <code>Object.prototype.__proto__</code>，最后指向了 <code>null</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(obj.__proto__.__proto__.__proto__ === <span class="literal">null</span>); <span class="comment">// &gt; true</span></span><br></pre></td></tr></table></figure><h3 id="原型链图"><a href="#原型链图" class="headerlink" title="原型链图"></a>原型链图</h3><p><img data-src="../../assets/image-20200706144951384.png" alt=""></p><ul><li><p>原型对象层级（属性的原型链查找过程）：<br><code>obj</code> -&gt; <code>Fn.prototype</code> -&gt; <code>Object.prototype</code> -&gt; <code>null</code><br><code>function Fn</code> / <code>function Object</code> -&gt; <code>function Function</code> -&gt; <code>Object.prototype</code> -&gt; <code>null</code></p></li><li><p>构造函数层级（构造函数作为对象，是由谁创建的）：<br><code>obj</code> -&gt; <code>function Fn()</code> -&gt; <code>function Function()</code></p><p><code>function Object()</code> -&gt; <code>function Function()</code></p></li></ul><div class="note warning no-icon"><ul><li>所有的实例（对象）的 <code>__proto_</code> 都指向该构造函数的原型对象（<code>prototype</code>）</li><li>所有的函数（包括构造函数）都是 <code>Function</code> 的实例，所以所有函数的 <code>__proto_</code> 都指向 <code>Function</code> 的原型对象（Function.prototype）</li><li>所有的原型对象（包括 <code>Function</code>的原型对象-<code>Function.prototype</code>）都是 <code>Object</code> 的实例，所以 <code>__proto_</code> 都指向 <code>Object</code>(构造函数)的原型对象。而 <code>Object</code>构造函数的 <code>__proto__</code>指向 <code>null</code></li><li><code>Function</code> 构造函数本身就是 <code>Function</code> 的实例，所以 <code>__proto_</code> 指向 <code>Function</code> 的原型对象</li></ul></div><!-- rebuild by neat -->]]></content>
      <categories>
        <category>前端</category>
        <category>JavaScript</category>
        <category>进阶</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>原型</tag>
        <tag>原型链</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript进阶-对象属性</title>
    <url>/archives/27b30017.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要详细记录JavaScript中的对象属性：命名属性、数据属性、访问器属性、内部属性。</p><a id="more"></a><h2 id="对象属性"><a href="#对象属性" class="headerlink" title="对象属性"></a>对象属性</h2><h3 id="对象属性类型"><a href="#对象属性类型" class="headerlink" title="对象属性类型"></a>对象属性类型</h3><ul><li>命名属性 - 可直接通过 <code>.</code> 访问到的属性</li><li>数据属性 - 专门保存一个值的属性</li><li>访问器属性 - 保护数据属性的特殊属性，不实际存储数据</li><li>内部属性 - 不能通过 <code>.</code> 直接访问的属性，比如 <code>class</code>、<code>__proto__</code></li></ul><h3 id="涉及的属性方法"><a href="#涉及的属性方法" class="headerlink" title="涉及的属性方法"></a>涉及的属性方法</h3><ul><li><code>Object.getOwnPropertyDescriptor(obj, &quot;属性名&quot;)</code>：获取指定属性的描述（必须是自有属性，不适用于原型链的属性）</li><li><code>Object.defineProperty(obj, &quot;属性名&quot;, {特性})</code>：在指定对象上添加新属性或修改属性，如果是新增且为指定特性，则会将数据属性的默认值全部设为 <code>false</code></li></ul><h3 id="数据属性"><a href="#数据属性" class="headerlink" title="数据属性"></a>数据属性</h3><p>数据属性的4大特性</p><ul><li><code>configuable</code>：是否可配置，表示能否通过 <code>delete</code> 删除属性，默认为 <code>true</code></li><li><code>enumerable</code>： 是否可枚举，表示能够通过 <code>for-in</code> 循环返回属性，默认为 <code>true</code></li><li><code>value</code>：包含这个属性的数据值</li><li><code>writable</code>：是否可读写，表示能否修改属性的值，默认为 <code>true</code></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="keyword">let</span> person = &#123;</span><br><span class="line">    name: <span class="string">'zi jun'</span>,</span><br><span class="line">    age: <span class="number">20</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertyDescriptor(person, <span class="string">"name"</span>));</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">	configurable: true,</span></span><br><span class="line"><span class="comment">	enumberable: true,</span></span><br><span class="line"><span class="comment">	value: "zi jun",</span></span><br><span class="line"><span class="comment">	writable: true</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(person, <span class="string">"name"</span>, &#123;</span><br><span class="line">    writable: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertyDescriptor(person, <span class="string">"name"</span>));</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">	configurable: true,</span></span><br><span class="line"><span class="comment">	enumberable: true,</span></span><br><span class="line"><span class="comment">	value: "zi jun",</span></span><br><span class="line"><span class="comment">	writable: false</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><div class="note warning"><p>在正常模式下，<code>delete</code> 一个 <code>configurable</code> 为 <code>false</code> 的变量或对象，不会报错，只是会删除不成功。而在“严格模式”下，则会报错。</p></div><div class="note warning no-icon"><p>针对变量对象，在“严格模式”下：</p><ul><li><p>如果是用 <code>var</code> 声明的，可以理解为在 <code>window</code> 对象上定义了这个属性，可以利用 <code>Object.getOwnPropertyDescriptor(obj, &quot;属性名&quot;)</code> 查看可配置特性，查看是否可删除。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertyDescriptor(<span class="built_in">window</span>, <span class="string">'a'</span>));</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    configurable: false,</span></span><br><span class="line"><span class="comment">    enumerable: true,</span></span><br><span class="line"><span class="comment">    value: 1,</span></span><br><span class="line"><span class="comment">    writable: true</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">/*</span></span><br></pre></td></tr></table></figure></li><li><p>如果是用ES6+的 <code>let</code> / <code>const</code> 声明的，不能删除，如何理解？</p></li></ul></div><h3 id="访问器属性"><a href="#访问器属性" class="headerlink" title="访问器属性"></a>访问器属性</h3><p>访问器属性的4大特性</p><ul><li><code>get</code>：函数或 <code>undefined</code>，在取属性值时被调用 <code>getter</code> 访问器</li><li><code>set</code>：函数或 <code>undefined</code>，在设置属性值时被调用 <code>setter</code> 访问器</li><li><code>enumerable</code>：是否可枚举，表示能够通过 <code>for-in</code> 循环返回属性，默认为 <code>true``value</code>：包含这个属性的数据值</li><li><code>configuable</code>：是否可配置，表示能否通过 <code>delete</code> 删除属性，默认为 <code>true</code></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    _name: <span class="string">'zi jun'</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(person, <span class="string">"name"</span>, &#123;</span><br><span class="line">    <span class="keyword">set</span>: function(value) &#123;</span><br><span class="line">        <span class="keyword">this</span>._name = <span class="string">"new name: "</span> + value;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">get</span>: function() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"My name is "</span> + <span class="keyword">this</span>._name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(person._name); <span class="comment">// &gt; "zi jun"</span></span><br><span class="line"><span class="built_in">console</span>.log(person.name); <span class="comment">// &gt; "My name is zi jun"</span></span><br><span class="line">person.name = <span class="string">"Devin"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(person.name); <span class="comment">// &gt; My name is new name: Devin</span></span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
      <categories>
        <category>前端</category>
        <category>JavaScript</category>
        <category>进阶</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>前端</tag>
        <tag>对象</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript进阶-字面量</title>
    <url>/archives/3d4f90ed.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录JavaScript中字面量的详解。</p><a id="more"></a><h3 id="什么是字面量"><a href="#什么是字面量" class="headerlink" title="什么是字面量"></a>什么是字面量</h3><p>字面量(literal)表示如何表达这个值，一般除去表达式，给变量赋值时，等号右边都可以认为是字面量</p><p>字面量</p><ul><li>字符串字面量</li><li>数组字面量</li><li>对象字面量</li><li>函数字面量</li></ul><p>示例：<code>let str = “hello world”;</code> <code>&quot;hello world&quot;</code> 就是字符串字面量，<code>str</code> 是变量名。</p><p><strong>字面量，简单理解，就是不用 <code>JavaScript</code> 的 <code>new</code> 操作符创建实例。</strong></p><h3 id="什么是对象字面量"><a href="#什么是对象字面量" class="headerlink" title="什么是对象字面量"></a>什么是对象字面量</h3><p><code>js</code> 创建对象的两种方式</p><ul><li>标准创建对象方式(<code>new</code>)</li><li>对象字面量创建方式</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 标准创建对象方式(new)</span></span><br><span class="line"><span class="keyword">let</span> obj = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">obj.a = <span class="string">"aaa"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(obj.a); <span class="comment">// &gt; "aaa"</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 对象字面量创建方式</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    a: <span class="string">"aaa"</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(obj.a); <span class="comment">// &gt; "aaa"</span></span><br></pre></td></tr></table></figure><h3 id="对象字面量的特性"><a href="#对象字面量的特性" class="headerlink" title="对象字面量的特性"></a>对象字面量的特性</h3><ol><li><p>这种对象不是一个构造函数，不能使用 <code>new</code> 进行实例化</p></li><li><p>它是引用类型，也就意味着对象名是一个指针，当你把对象名赋值给另一个变量时，你在新变量上所做的任何操作都会影响源对象</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    a: <span class="string">"aaa"</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> b = obj;</span><br><span class="line">b.b = <span class="string">"bbb"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(obj.b); <span class="comment">// &gt; "bbb"</span></span><br></pre></td></tr></table></figure></li><li><p>对象中的所有成员默认是公开的，如果想实现私有成员，只能采用ES6的 <code>Symbol</code> 来定义一个成员名，然后采用 <code>export</code> 模块化来达到隔离效果</p></li></ol><h3 id="测试字面量赋值效率"><a href="#测试字面量赋值效率" class="headerlink" title="测试字面量赋值效率"></a>测试字面量赋值效率</h3><p>在Chrome上做了对比：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.time(<span class="string">"测试1"</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> a = &#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">"测试1"</span>); <span class="comment">// &gt; 测试1: 0.256103515625ms</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">"测试2"</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">"测试2"</span>); <span class="comment">// &gt; 测试2: 0.6318359375ms</span></span><br></pre></td></tr></table></figure><p><strong>原因为：</strong> <code>{}</code> 是字面量，可以立即求值，而 <code>new Object()</code> 本质上是方法（只不过这个方法是内置的）调用，既然是方法调用，就涉及到在 <code>proto</code> 链中遍历该方法，当找到该方法后，又会生成方法调用调用必须的堆栈信息，方法调用结束后，还要释放该堆栈。</p><!-- rebuild by neat -->]]></content>
      <categories>
        <category>前端</category>
        <category>JavaScript</category>
        <category>进阶</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>字面量</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript进阶-数组遍历对比</title>
    <url>/archives/df1d3395.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录JavaScript中数组的遍历方法，及性能对比。</p><a id="more"></a><h3 id="运行效率对比："><a href="#运行效率对比：" class="headerlink" title="运行效率对比："></a>运行效率对比：</h3><ul><li>测试浏览器为：MicroSoft Edge (Chrome Version: 83.0)</li><li>前置数组：<code>var arr = [1, 2, 3,..., 999999, 1000000];</code></li></ul><table><thead><tr><th align="center">遍历方法</th><th align="left">测试代码</th><th>测试耗时(十次取平均)</th></tr></thead><tbody><tr><td align="center">for</td><td align="left"><code>for(let i = 0, len = arr; i &lt; len; i++){}</code></td><td>1.9915ms</td></tr><tr><td align="center">forEach</td><td align="left"><code>arr.forEach((item, index, arr) =&gt; {})</code></td><td>10.9488ms</td></tr><tr><td align="center">map</td><td align="left"><code>arr.map((item, index, arr) =&gt; {})</code></td><td>15.6615ms</td></tr><tr><td align="center">for…in…</td><td align="left"><code>for(let key in arr){}</code></td><td>172.8816ms</td></tr><tr><td align="center">for…of…</td><td align="left"><code>for(let item of arr){}</code></td><td>12.7118ms</td></tr><tr><td align="center">filter</td><td align="left"><code>arr.filter(item =&gt; {})</code></td><td>15.5326ms</td></tr><tr><td align="center">every</td><td align="left"><code>arr.every(item =&gt; {})</code></td><td>0.021ms</td></tr><tr><td align="center">some</td><td align="left"><code>arr.some(item =&gt; {})</code></td><td>13.5862ms</td></tr><tr><td align="center">reduce</td><td align="left"><code>arr.reduce((total, currentValue, currentIndex, arr) =&gt; {})</code></td><td>10.9067ms</td></tr><tr><td align="center">find</td><td align="left"><code>arr.find(item =&gt; {});</code></td><td>13.7206ms</td></tr><tr><td align="center">findIndex</td><td align="left"><code>arr.findIndex(item =&gt; {})</code></td><td>13.5396ms</td></tr></tbody></table><h3 id="for"><a href="#for" class="headerlink" title="for"></a>for</h3><ul><li><p>最简单的一种循环遍历方法，使用频率也是最高。一般使用优化策略：将变量的长度缓存起来，避免重复获取数组的长度。</p></li><li><p>可以使用关键字 <code>break</code>：终止循环，<code>continue</code>：跳过本次循环，<code>return</code>：返回所在函数。</p></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ARR = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>, len = ARR.length; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(ARR[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// &gt; a b c</span></span><br></pre></td></tr></table></figure><h3 id="forEach"><a href="#forEach" class="headerlink" title="forEach"></a>forEach</h3><ul><li><p>对数组进行遍历循环，对数组中的每一个项运行给定函数。</p></li><li><p>参数是 <code>function</code> 类型。第一个参数是数组里的元素，第二个参数为数组里元素的索引，第三个参数为数组本身。</p></li><li><p>不能使用 <code>break</code>、<code>continue</code>、<code>return</code> 等关键字终止或跳出循环。</p></li><li><p>这个方法没有返回值。</p></li><li><p>改变的是原数组。</p></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ARR = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>];</span><br><span class="line">ARR.forEach(<span class="function">(<span class="params">item, index, array</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(item);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// &gt; a b c</span></span><br></pre></td></tr></table></figure><h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><ul><li>“映射”功能，对数组中的每一项运行给定函数，并返回每次函数调用的结果组成的数组。</li><li>参数是 <code>function</code> 类型。第一个参数是数组里的元素，第二个参数为数组里元素的索引，第三个参数为数组本身。(和 <code>forEach</code> 一致)。</li><li>不改变原数组，相当于对原数组拷贝一份，并修改。与原数组的长度一致。</li><li>高阶函数。</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ARR = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>];</span><br><span class="line"><span class="keyword">let</span> newArr = ARR.map(<span class="function">(<span class="params">item, index, arr</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`item-<span class="subst">$&#123;item&#125;</span>`</span>; </span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(ARR); <span class="comment">// &gt; ['a', 'b', 'c']</span></span><br><span class="line"><span class="built_in">console</span>.log(newArr); <span class="comment">// &gt; ['item-a', 'item-b', 'item-c']</span></span><br></pre></td></tr></table></figure><h3 id="for-in…"><a href="#for-in…" class="headerlink" title="for..in…"></a>for..in…</h3><ul><li>变量数组，返回每一项的数组索引。</li><li>一般不使用在数组遍历中，更多的使用在对象的遍历中。</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ARR = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>];</span><br><span class="line"><span class="keyword">for</span>( <span class="keyword">let</span> key <span class="keyword">in</span> ARR) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// &gt; 0 1 2</span></span><br></pre></td></tr></table></figure><h3 id="for…of…"><a href="#for…of…" class="headerlink" title="for…of…"></a>for…of…</h3><ul><li>ES6新增。对数组中的每一项进行处理。</li><li>可以使用关键字 <code>break</code>：终止循环，<code>continue</code>：跳过本次循环，<code>return</code>：返回所在函数。</li><li>可以遍历所有可迭代的数据结构，比如数组、类数组对象、字符串等。</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ARR = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>];</span><br><span class="line"><span class="keyword">for</span>( <span class="keyword">let</span> item <span class="keyword">of</span> ARR) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(item);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// &gt; a b c</span></span><br></pre></td></tr></table></figure><h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h3><ul><li>遍历数组，过滤出符合条件的元素并返回一个新数组。</li><li>不改变原数组，相当于对原数组拷贝一份，并修改。但是只返回符合条件的项，所以与原数组的长度可能不一致。</li><li>高阶函数。</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ARR = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>];</span><br><span class="line"><span class="keyword">let</span> newArr = ARR.filter(<span class="function"><span class="params">item</span> =&gt;</span> item &gt; <span class="string">"b"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(ARR); <span class="comment">// &gt; ['a', 'b', 'c']</span></span><br><span class="line"><span class="built_in">console</span>.log(newArr); <span class="comment">// &gt; ['c']</span></span><br></pre></td></tr></table></figure><h3 id="every"><a href="#every" class="headerlink" title="every"></a>every</h3><ul><li>对数组中的每一项运行给定函数，如果函数中每一项都符合函数条件，即为true，则返回 <code>true</code> ，否则返回 <code>false</code>。</li><li>不改变原数组。</li><li>高阶函数</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ARR = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>];</span><br><span class="line"><span class="keyword">let</span> bool = ARR.every(<span class="function"><span class="params">item</span> =&gt;</span> item &lt; <span class="string">"d"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(ARR); <span class="comment">// &gt; ['a', 'b', 'c']</span></span><br><span class="line"><span class="built_in">console</span>.log(bool); <span class="comment">// &gt; true</span></span><br></pre></td></tr></table></figure><h3 id="some"><a href="#some" class="headerlink" title="some"></a>some</h3><ul><li>对数组中的每一项运行给定函数，如果函数中只要至少有一项符合函数条件，即为true，则返回 <code>true</code> ，否则返回 <code>false</code>。</li><li>不改变原数组。</li><li>高阶函数。</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ARR = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>];</span><br><span class="line"><span class="keyword">let</span> bool = ARR.some(<span class="function"><span class="params">item</span> =&gt;</span> item &lt; <span class="string">"b"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(ARR); <span class="comment">// &gt; ['a', 'b', 'c']</span></span><br><span class="line"><span class="built_in">console</span>.log(bool); <span class="comment">// &gt; true</span></span><br></pre></td></tr></table></figure><h3 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h3><ul><li>接收一个函数作为累加器，数组中的每个值（从左到右）开始缩减，最终计算为一个值。</li><li>可以作为高阶函数，用于函数的compose。</li><li>对于空数组是不会执行回调函数的。</li><li>高阶函数。</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ARR = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>];</span><br><span class="line"><span class="keyword">let</span> result = ARR.reduce(<span class="function">(<span class="params">total, currentValue</span>) =&gt;</span> total + currentValue);</span><br><span class="line"><span class="built_in">console</span>.log(ARR); <span class="comment">// &gt; ['a', 'b', 'c']</span></span><br><span class="line"><span class="built_in">console</span>.log(result); <span class="comment">// &gt; abc</span></span><br></pre></td></tr></table></figure><h3 id="find"><a href="#find" class="headerlink" title="find"></a>find</h3><ul><li>返回数组中符合测试函数条件的第一个元素的值，否则返回 <code>undefined</code>。</li><li>对于空数组，函数是不会执行的。</li><li>不改变原数组。</li><li>高阶函数。</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ARR = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>];</span><br><span class="line"><span class="keyword">let</span> result = ARR.find(<span class="function"><span class="params">item</span> =&gt;</span> item === <span class="string">"b"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(ARR); <span class="comment">// &gt; ['a', 'b', 'c']</span></span><br><span class="line"><span class="built_in">console</span>.log(result); <span class="comment">// &gt; b</span></span><br></pre></td></tr></table></figure><h3 id="findIndex"><a href="#findIndex" class="headerlink" title="findIndex"></a>findIndex</h3><ul><li>返回数组中符合测试函数条件的第一个元素的值索引值，否则返回 <code>-1</code></li><li>对于空数组，函数是不会执行的。</li><li>不改变原数组。</li><li>高阶函数。</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ARR = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>];</span><br><span class="line"><span class="keyword">let</span> result = ARR.findIndex(<span class="function"><span class="params">item</span> =&gt;</span> item === <span class="string">"b"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(ARR); <span class="comment">// &gt; ['a', 'b', 'c']</span></span><br><span class="line"><span class="built_in">console</span>.log(result); <span class="comment">// &gt; 1</span></span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
      <categories>
        <category>前端</category>
        <category>JavaScript</category>
        <category>进阶</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>前端</tag>
        <tag>遍历</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript进阶-防抖节流</title>
    <url>/archives/a635d2be.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录JavaScript的防抖和节流。</p><a id="more"></a><h2 id="防抖"><a href="#防抖" class="headerlink" title="防抖"></a>防抖</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>防抖确保了一个函数只有在一个固定的时间段内没有被调用过后，才会被调用。比如说只有在1毫秒过后，才允许执行这个函数。</p><p><strong>换句话说：防抖会等待事件不再高频触发，再触发。</strong></p><h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 防抖</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>delay &#123;number&#125; 等待时间</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>fn &#123;Function&#125; 需执行函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params">delay, fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> timer;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">        timer &amp;&amp; clearTimeout(timer);</span><br><span class="line">        timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            fn(...args);</span><br><span class="line">            timer = <span class="literal">null</span>;</span><br><span class="line">        &#125;, delay);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="节流"><a href="#节流" class="headerlink" title="节流"></a>节流</h2><h3 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h3><p>节流限制了一个函数可以在短时间内被调用的次数。比如说在1毫秒内最多执行此函数1次。</p><p><strong>换句话说：节流会忽略在短时间内高频发生的事件，只按照计划好的频率触发。</strong></p><h3 id="实现-1"><a href="#实现-1" class="headerlink" title="实现"></a>实现</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 节流</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>delay &#123;number&#125; 计划好的执行间隔</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>fn &#123;Function&#125; 需执行函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">throttled</span>(<span class="params">delay, fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> lastCall = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> NOW = (<span class="keyword">new</span> <span class="built_in">Date</span>).getTime();</span><br><span class="line">        <span class="keyword">if</span>(NOW - lastCall &lt; delay) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        lastCall = NOW;</span><br><span class="line">        <span class="keyword">return</span> fn(...args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><h3 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h3><ul><li>防抖在我们关心高频事件发生过后，得到的那个结果的时候，比较有用，比如用户迅速输入完一串用户名，对其进行查重的结果</li><li>节流在我们不关心函数参数是什么的时候比较有用，比如鼠标移动，滚轮事件，我们在乎的是操作的频率</li></ul><h3 id="运用场景"><a href="#运用场景" class="headerlink" title="运用场景"></a>运用场景</h3><ul><li><p>防抖(<code>debounce</code>)</p><ul><li>Search搜索联想，用户在不断输入值时，用防抖来节约请求资源</li><li>Window触发Resize的时候，不断调整浏览器窗口大小会不断触发这个事件，用防抖让其只触发一次</li></ul></li><li><p>节流(<code>throttle</code>)</p><ul><li>验证码在指定时间内只发送一次</li><li>监听滚动事件，比如是否滑到底部自动加载更多</li></ul></li></ul><h3 id="为什么要用闭包"><a href="#为什么要用闭包" class="headerlink" title="为什么要用闭包"></a>为什么要用闭包</h3><p>如果页面只需要处理一个防抖/节流函数，不需要闭包也是可以实现的，可以将变量变成全局变量，比如：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 单个防抖处理</span></span><br><span class="line"><span class="keyword">let</span> timer</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">delay</span>(<span class="params">delay, fn</span>) </span>&#123;</span><br><span class="line">        timer &amp;&amp; clearTimeout(timer);</span><br><span class="line">        timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            fn(...args);</span><br><span class="line">        &#125;, delay);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样处理会出现如下问题：</p><ol><li>对于一个页面上需要多个防抖函数的时候，需要写很多重复代码</li><li>全局变量污染作用域</li></ol><p>这时候闭包的优势就体现出来了，保护全局作用域不被污染，又能做到函数复用。</p><!-- rebuild by neat -->]]></content>
      <categories>
        <category>前端</category>
        <category>JavaScript</category>
        <category>进阶</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>前端</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript秘密花园-对象</title>
    <url>/archives/3aa91138.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录JavaScript秘密花园-对象。</p><p>原文地址：<a href="http://bonsaiden.github.io/JavaScript-Garden/zh" target="_blank" rel="noopener external nofollow noreferrer">JavaScript秘密花园</a></p><a id="more"></a><h3 id="对象使用和属性"><a href="#对象使用和属性" class="headerlink" title="对象使用和属性"></a>对象使用和属性</h3><p>JavaScript中所有变量都可以当作对象使用，除了两个例外 <code>null</code> 和 <code>undefined</code>。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="literal">false</span>.toString(); <span class="comment">// =&gt; "false"</span></span><br><span class="line"><span class="number">2.</span>toString(); <span class="comment">// Uncaught SyntaxError: Invalid or unexpected token</span></span><br><span class="line"><span class="literal">null</span>.toString(); <span class="comment">// Uncaught TypeError: Cannot read property 'toString' of null</span></span><br><span class="line"><span class="literal">undefined</span>.toString(); <span class="comment">// Uncaught TypeError: Cannot read property 'toString' of undefined</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>].toString(); <span class="comment">// =&gt; "1, 2"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">Foo.bar = <span class="number">1</span>;</span><br><span class="line">Foo.bar; <span class="comment">// =&gt; 1</span></span><br></pre></td></tr></table></figure><p>一个常见的误解是数字的字面量不能当作对象使用。这是因为 <code>JavaScript</code> 解析器的一个错误，它试图将点（<code>.</code>）操作符解析为浮点数字面值的一部分。如上面代码。有很多变通方法可以让数字的字面量看起来像对象。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="number">2.</span>.toString(); <span class="comment">// =&gt; "2" 第二个点号可以正常解析</span></span><br><span class="line"><span class="number">2</span> .toString(); <span class="comment">// =&gt; "2" 注意点号前面的空格</span></span><br><span class="line">(<span class="number">2</span>).toString(); <span class="comment">// =&gt; "2" 2先被计算</span></span><br></pre></td></tr></table></figure><p><strong>对象作为数据类型</strong></p><p><code>JavaScript</code> 的对象可以作为哈希表使用，主要用来保存命名的键与值的对应关系。使用对象的字面语法 <code>{}</code> 可以创建一个简单对象。这个新创建的对象从 <code>Object.prototype</code> 继承，没有任何自定义属性。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> foo = &#123;&#125;; <span class="comment">// 一个空对象</span></span><br><span class="line"><span class="keyword">let</span> bar = &#123; <span class="attr">test</span>: <span class="number">12</span> &#125;; <span class="comment">// 一个新对象，拥有一个值为12的自定义属性 “test”</span></span><br></pre></td></tr></table></figure><p><strong>访问属性</strong></p><p>有两种方式来访问对象的属性：</p><ul><li>点操作符</li><li>中括号操作符</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> foo = &#123; <span class="attr">name</span>: <span class="string">"zi jun"</span> &#125;;</span><br><span class="line">foo.name; <span class="comment">// =&gt; zi jun</span></span><br><span class="line">foo[<span class="string">'name'</span>]; <span class="comment">// =&gt; zi jun</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">get</span> = "name";</span><br><span class="line">foo[<span class="keyword">get</span>]; // =&gt; zi jun</span><br><span class="line"></span><br><span class="line">foo.1234; // Uncaught SyntaxError: Unexpected number</span><br></pre></td></tr></table></figure><p>两种语法是等价的，但是中括号操作符在下面两种情况下依然有效：</p><ul><li>动态设置属性</li><li>属性名不是一个有效的变量名</li></ul><p><strong>删除属性</strong></p><p>删除属性的唯一方法是使用 <code>delete</code> 操作符。设置属性为 <code>undefined</code> 或者 <code>null</code> 并不能真正地删除属性，而仅仅是移除了属性和值的关联。</p><p><strong>属性名的语法</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> test = &#123;</span><br><span class="line">  <span class="string">'case'</span>: <span class="string">'I am a keyword so I must be notated as a string'</span>,</span><br><span class="line">  <span class="keyword">delete</span>: <span class="string">'I am a keyword too so me'</span> <span class="comment">// 出错：SyntaxError</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>对象的属性名可以使用字符串或者普通字符声明。但是由于 <code>JavaScript</code> 解析器的另一个错误设计， 上面的第二种声明方式在 <code>ECMAScript 5</code> 之前会抛出 <code>SyntaxError</code> 的错误。因此为了在更低版本的 <code>JavaScript</code> 引擎下也能正常运行， 必须使用<em>字符串字面值</em>声明方式。</p><h3 id="原型"><a href="#原型" class="headerlink" title="原型"></a>原型</h3><p><code>JavaScript</code> 不包含传统的类继承模型，而是使用 <code>prototype</code> 原型模型。</p><p>由于 <code>JavaScript</code> 是唯一一个被广泛使用的基于原型继承的语言，所以理解两种继承模式的差异是需要一定时间的。</p><p>更多的详情，可以查看 <a href="/archives/d76fa986.html">链接</a></p><p><strong>属性查找</strong></p><p>当查找一个对象的属性时，JavaScript 会向上遍历原型链，直到找到给定名称的属性为止。</p><p>到查找到达原型链的顶部 - 也就是 <code>Object.prototype</code> - 但是仍然没有找到指定的属性，就会返回 <code>undefined</code>。</p><h3 id="hasOwnProperty函数"><a href="#hasOwnProperty函数" class="headerlink" title="hasOwnProperty函数"></a>hasOwnProperty函数</h3><h3 id="for…in…循环"><a href="#for…in…循环" class="headerlink" title="for…in…循环"></a>for…in…循环</h3><!-- rebuild by neat -->]]></content>
      <categories>
        <category>前端</category>
        <category>JavaScript</category>
        <category>秘密花园</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>对象</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript进阶-Node浏览器事件循环机制</title>
    <url>/archives/1e61d9e.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Node和浏览器中事件循环机制的区别。</p><a id="more"></a><h3 id="Node-js运行机制"><a href="#Node-js运行机制" class="headerlink" title="Node.js运行机制"></a>Node.js运行机制</h3><p>Node.js是一个事件驱动I/O服务端JavaScript环境，基于Google的V8引擎。而I/O处理方面使用了自己设计的Libuv，Libuv是一个基于事件驱动的跨平台抽象层，封装了不同操作系统一些底层特性，对外提供统一的API，事件循环机制也是它里面的实现。</p><ul><li>V8引擎解析JavaScript脚本</li><li>解析之后的代码调用Node API</li><li>Libuv库负责Node API的执行，它将不同的任务分配给不同的线程，形成一个Event Loop，以异步的方式将任务的执行结果返回给V8引擎</li><li>V8引擎再将结果返回给用户</li></ul><h3 id="Libuv中的6个阶段"><a href="#Libuv中的6个阶段" class="headerlink" title="Libuv中的6个阶段"></a>Libuv中的6个阶段</h3><p>Libuv引擎中的事件循环分为6个阶段，它们按顺序反复执行。每当进入某个阶段，都会从对应的回调队列中取出函数执行。当队列为空或者执行的回调函数数量达到系统设定的阈值，就会进入下一阶段。</p><p>Node中事件循环顺序：外部输入数据 -&gt; 轮询阶段（poll） -&gt; 检查阶段（check） -&gt; 关闭事件回调阶段（close callback） -&gt; 定时器检测阶段（timer） -&gt; I/O事件回调阶段（I/O callback） -&gt; 闲置阶段（idle，prepare） -&gt; 轮询阶段 …</p><p><img data-src="../../assets/20200605165008.png" alt=""></p><h3 id="Node与浏览器的事件循环差异"><a href="#Node与浏览器的事件循环差异" class="headerlink" title="Node与浏览器的事件循环差异"></a>Node与浏览器的事件循环差异</h3><ul><li><p>浏览器环境下，microtask的任务队列是每个macrotask执行完成之后执行。</p></li><li><p>而在node.js中，microtask会在事件循环的各个阶段之间执行，也就是说，每一个阶段执行完毕，就会去执行microtask队列中的任务。</p><p><img data-src="../../assets/20190911192413535.png" alt=""></p></li></ul><p>举例说明：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'timer1'</span>)</span><br><span class="line">    <span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'promise1'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'timer2'</span>)</span><br><span class="line">    <span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'promise2'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br></pre></td></tr></table></figure><p><strong>对于浏览器：</strong></p><p>浏览器端的处理过程如下：执行第一个宏任务时，输出同步代码timer1之后，发现微任务then(),执行微任务输出promise1；接着执行第二个宏任务，输出同步任务timer2，发现微任务，执行微任务，输出promise2。即：timer1 -&gt;promise1-&gt;timer2-&gt;promise2。浏览器端的处理过程如下：</p><p><img data-src="../../assets/20190911193801966.gif" alt=""></p><p><strong>Node情况分两种：</strong></p><ul><li>如果是node11版本，与浏览器执行结果一样</li><li>如果是node10及以下：要看第一个定时器执行完，第二个定时器是否在完成队列中。<ul><li>如果是第二个定时器还未在完成队列中，最后的结果为 timer1=&gt;promise1=&gt;timer2=&gt;promise2</li><li>如果是第二个定时器已经在完成队列中，则最后的结果为timer1=&gt;timer2=&gt;promise1=&gt;promise2(下文过程解释基于这种情况下)。</li></ul></li></ul><p>1.全局脚本（main()）执行，将2个timer依次放入timer队列，main()执行完毕，调用栈空闲，任务队列开始执行；<br>2.首先进入timers阶段，执行timer1的回调函数，打印timer1，并将promise1.then回调放入microtask队列，同样的步骤执行timer2，打印timer2；<br>3.至此，timer阶段执行结束，event loop进入下一个阶段之前，执行microtask队列的所有任务，依次打印promise1、promise2<br>node端执行过程：</p><p><img data-src="../../assets/20200205200105105.gif" alt=""></p><!-- rebuild by neat -->]]></content>
      <categories>
        <category>前端</category>
        <category>JavaScript</category>
        <category>进阶</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>Node</tag>
      </tags>
  </entry>
  <entry>
    <title>Github使用Netlify加速</title>
    <url>/archives/ec0de0bc.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录github访问加速和账户验证。</p><a id="more"></a><h2 id="github访问加速"><a href="#github访问加速" class="headerlink" title="github访问加速"></a>github访问加速</h2><ol><li>打开 <a href="https://zijunwork.github.io/weblog/#/" target="_blank" rel="noopener external nofollow noreferrer">Netlify</a> 官网 -&gt; [注册] -&gt; 关联 GitHub 登录 -&gt; [New site from Git] -&gt; 选择GitHub</li><li>进入Github的认证授权页面，点击 <code>Authorize Netlify by Netlify</code></li><li>点击 <code>All repositories</code> 直接选择授权所有仓库，这个授权在设置中可以改</li><li>选择一个项目 如果是 docsify 项目，选择 <code>Base directory</code> 为 <code>/docs</code> 点击 [Deploy site] 发布即可</li><li>部署完成后，Netlify会自动生成一个随机的二级域名 <code>xxx.netlify.com</code>，点击[Site Settings]可以修改为自定义的二级域名</li><li>Site details下点击[Change site name]，可以为这个站点设置一个自定义的名字</li></ol><h2 id="账户验证"><a href="#账户验证" class="headerlink" title="账户验证"></a>账户验证</h2><ol><li><p>Basic 验证</p><p>填写对应的用户名和密码即可验证。</p></li><li><p>OAuth 验证，e.g. SourceTee验证用户方式之一</p><p>[github] -&gt; [Settings] -&gt; [Developer settings] -&gt; [OAuth Apps] 应用的名称随便填，主页 URL 填写<code>http://localhost:8080</code>，跳转网址填写 <code>http://localhost:8080/oauth/redirect</code>。</p></li><li><p>Token 验证，e.g. Webstorm 登录github方式之一</p><p>[github] -&gt; [Settings] -&gt; [Developer settings] -&gt; [Personal access tokens] 生成新的token，用token登录即可。</p></li></ol><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Git</category>
        <category>Github</category>
      </categories>
      <tags>
        <tag>Git</tag>
        <tag>Github</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript进阶-模块化</title>
    <url>/archives/b92372a3.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录JavaScript模块化的几个重要发展阶段，无模块化，CommonJS，AMD规范，CMD规范，ES6模块化。</p><a id="more"></a><p>随着前端 <code>JavaScript</code> 代码复杂度的提高，<code>JavaScript</code> 模块化这个概念被提出来，前端社区也不断地实现前端模块化。下面介绍 <code>JavaScript</code> 模块化及其是如何一步一步地发展起来的。</p><h3 id="无模块化"><a href="#无模块化" class="headerlink" title="无模块化"></a>无模块化</h3><p><code>JavaScript</code> 最初的作用仅仅是验证表单，后来会添加一些动画，但是这些 <code>JavaScript</code> 代码很多在一个文件中就可以完成了，所以，我们只需在 <code>html</code> 文件中添加一个 <code>script</code> 标签。</p><p>后来，随着前端复杂度的提高，为了能够提高项目的可读性、可扩展性等，我们的 <code>JavaScript</code> 文件逐渐多了起来，不再是一个 <code>js</code> 文件就可以解决的了，而是把每一个 <code>js</code> 文件当做一个模块。那么，这是的 <code>js</code> 引入方式是怎么样的呢？大概是下面这样：</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"other1.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"other2.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>即简单地将所有的 <code>js</code> 文件统统放在一起。但是这些文件的顺序不能出错，比如，<code>jquery</code> 需要先引入，才能引入 <code>jquery</code> 插件，才能在其他的文件中使用 <code>jquery</code>。</p><p><strong>优点：</strong></p><ul><li>相比于使用一个 <code>js</code> 文件，这种多个 <code>js</code> 文件实现最简单的模块化的思想是进步的</li></ul><p><strong>缺点：</strong></p><ul><li><strong>污染全局作用域。</strong>因为每一个模块都是暴露在全局的，简单的使用，会导致全局变量命名冲突。当然，我们也可以使用命名空间的方式来解决。</li><li><strong>依赖关系不明显，不利于维护。</strong>比如，<code>jquery</code> 的某个插件就依赖于 <code>jquery</code>，如果忘记引用 <code>jquery</code> 了，那么就会报错。</li></ul><h3 id="IIFE"><a href="#IIFE" class="headerlink" title="IIFE"></a>IIFE</h3><p>IIFE就是自执行函数，这种方式是其实是对 <code>js</code> 单独文件的优化方式。</p><p><strong>优点：</strong>在一个单独的函数作用域中执行代码，<strong>避免变量冲突</strong>。</p><p><strong>缺点：</strong> <strong>依赖关系不明显，不利于维护。</strong>比如，<code>jquery</code> 的某个插件就依赖于 <code>jquery</code>，如果忘记引用 <code>jquery</code> 了，那么就会报错。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		data: []</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure><h3 id="CommonJS规范"><a href="#CommonJS规范" class="headerlink" title="CommonJS规范"></a>CommonJS规范</h3><p><code>CommonJS</code> 就是一个 <code>JavaScript</code> 模块化的规范，该规范最初是用在服务端的 <code>node</code> 中，前端的 <code>webpack</code> 也是对 <code>CommonJS</code>原生支持的。根据这个规范，每一个文件就是一个模块，其内部定义的变量是属于这个模块的，不会对外暴露，也就是说不会污染全局变量。</p><p><code>CommonJS</code> 的核心思想就是通过 <code>require</code> 方法来同步加载所需要依赖的其他模块，然后通过 <code>exports</code> 或者 <code>module.exports</code> 来导出需要暴露的接口。如下所示：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// a.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> x = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">let</span> addX = <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> value + x;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">module</span>.exports.x = x;</span><br><span class="line"><span class="built_in">module</span>.exports.addX = addX;</span><br></pre></td></tr></table></figure><p>这里的 <code>a.js</code> 就是一个 <code>CommonJS</code> 规范的模块了。这里的 <code>module</code> 就代表了这个模块，<code>module</code> 的 <code>exports</code> 属性就是对外暴露的接口，可以对外导出外部可以访问的变量，比如这里的 <code>x</code> 和 <code>addX</code>。</p><p><code>exports</code> 是对 <code>module.exports</code> 的引用。比如，我们可以认为在一个模块的顶部有这句代码：<code>exports = module.exports</code>，所以，我们不能直接给 <code>exports</code> 赋值，比如 <code>number</code>、<code>function</code> 等。</p><p>然后我们就可以在其他模块中引入这个模块使用了：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// b.js</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="built_in">require</span>(<span class="string">"./a.js"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(a.x); <span class="comment">// &gt; 5</span></span><br><span class="line"><span class="built_in">console</span>.log(a.addX(<span class="number">2</span>)); <span class="comment">// &gt; 7</span></span><br></pre></td></tr></table></figure><p>这里的 <code>require</code> 就会获取到 <code>a.js</code> 所暴露的 <code>module.exports</code> 变量，然后就可以使用暴露的 <code>x</code> 和 <code>addX</code> 了。</p><div class="note warning no-icon"><p><code>module.exports</code> 才是真正的接口，<code>exports</code> 只不过是它的一个辅助工具。最终返回给调用的是 <code>module.exports</code> 而不是 <code>exports</code>。所有的 <code>exports</code> 收集到的属性和方法，都赋值给了 <code>module.exports</code>。当然，这有个前提，就是 <code>module.exports</code> 本身不具备任何属性和方法。<code>module.exports</code> 已经具备一些属性和方法，那么 <code>exprots</code> 收集来的信息将被忽略。使用最好遵循这两点：</p><ol><li>最好别分别定义 <code>module.exports</code> 和 <code>exports</code></li><li>NodeJS开发者建议导出对象用 <code>module.exports</code>，导出多个方法和变量用 <code>exports</code></li></ol></div><p><strong>优点：</strong></p><ul><li><code>CommonJs</code> 规范在服务端率先完成了 <code>JavaScript</code> 的模块化，解决了依赖、全局变量污染的问题，这也是 <code>js</code> 运行在服务端的必要条件</li></ul><p><strong>缺点：</strong></p><ul><li>由于 <code>CommonJS</code> 是同步加载模块的，在服务端文件都是保存在硬盘上，所以同步加载没有问题，但是对于浏览器端，需要将文件从服务端请求过来，那么同步加载就不适用了，所以， <code>CommonJS</code> 是不合适用于浏览器端的。</li></ul><h3 id="AMD规范"><a href="#AMD规范" class="headerlink" title="AMD规范"></a>AMD规范</h3><p><code>CommonJs</code> 规范加载模块是同步的，也就是说，只有加载完成，才能执行后面的操作。 <code>AMD</code> 规范是非同步加载模块，允许指定回调函数。由于 <code>Node.js</code> 主要用于服务器编程，模块文件一般都已经存在于本地硬盘，所以加载起来比较快，不用考虑非同步加载的方式，所以 <code>CommonJS</code> 规范比较适用。但是，浏览器环境，要从服务端加载模块，这时就必须采用非同步模式，因此浏览器一般采用 <code>AMD</code> 规范。而 <code>AMD</code> 规范的实现，就是大名鼎鼎的 <code>require.js</code>了。</p><p><code>AMD</code> 标准中，定义了下面两个API:</p><ol><li><code>require([module], callback)</code></li><li><code>define(id, [module], callback)</code></li></ol><p>即通过 <code>define</code> 来定义一个模块，然后使用 <code>require</code> 来加载一个模块。并且，<code>require</code> 还支持 <code>CommonJS</code> 的模块导出方式。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义模块</span></span><br><span class="line">define(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> alertName = <span class="function">(<span class="params">str</span>) =&gt;</span> &#123;</span><br><span class="line">        alert(<span class="string">`I am <span class="subst">$&#123;str&#125;</span>`</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> &#123; alertName &#125;;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 引用模块</span></span><br><span class="line"><span class="built_in">require</span>([<span class="string">'alert'</span>], <span class="function"><span class="keyword">function</span>(<span class="params">alert</span>) </span>&#123;</span><br><span class="line">    alert.alertName(<span class="string">"zi jun"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>优点：</strong></p><ul><li>适合在浏览器环境中异步加载模块，可以并行加载多个模块</li></ul><p><strong>缺点：</strong></p><ul><li>提高了开发成本，并且不能按需加载，而是必须提前加载所有的依赖</li></ul><h3 id="CMD规范"><a href="#CMD规范" class="headerlink" title="CMD规范"></a>CMD规范</h3><p><code>CMD</code> 规范是阿里的玉伯提出来的，实现 <code>js</code> 库为 <code>sea.js</code>。它和 <code>require.js</code> 非常类似，即一个 <code>js</code> 文件就是一个模块，但是 <code>CMD</code> 的加载方式更加优秀，是通过按需加载的方式，而不是必须在模块开始就加载所有的依赖。如下：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require, exports, module</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> $ = <span class="built_in">require</span>(<span class="string">'jquery'</span>);</span><br><span class="line">    exports.doSomething = <span class="string">"//"</span>;</span><br><span class="line">    <span class="built_in">module</span>.exports = <span class="string">"//"</span>;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>优点：</strong></p><ul><li>同样实现了浏览器端的模块化加载</li><li>可以按需加载，依赖就近</li></ul><p><strong>缺点：</strong></p><ul><li>依赖 <code>SPM</code> 打包，模块的加载逻辑偏重</li></ul><div class="note warning no-icon"><p><code>AMD</code> 和 <code>CMD</code> 的区别：前者对于依赖的模块提前执行，而后者是延迟执行。前者推崇依赖前置，而后者推崇依赖就近，即只在需要用到某个模块时再 <code>require</code>。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// AMD</span></span><br><span class="line"><span class="comment">// 依赖必须一开始就前置</span></span><br><span class="line">define([<span class="string">"./a"</span>, <span class="string">"./b"</span>], (a, b) =&gt; &#123;</span><br><span class="line">    a.doSomething();</span><br><span class="line">    b.doSomething();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// CMD</span></span><br><span class="line"><span class="comment">// 依赖按需加载，就近原则</span></span><br><span class="line">define(<span class="function">(<span class="params"><span class="built_in">require</span>, exports, <span class="built_in">module</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="built_in">require</span>(<span class="string">"./a"</span>);</span><br><span class="line">    a.doSomething();</span><br><span class="line">    <span class="keyword">let</span> b = <span class="built_in">require</span>(<span class="string">"./b"</span>);</span><br><span class="line">    b.doSomething();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div><h3 id="ES6模块化"><a href="#ES6模块化" class="headerlink" title="ES6模块化"></a>ES6模块化</h3><p>之前的几种模块方案都是前端社区自己实现的，只是得到了大家的认可和广泛使用，而ES6的模块化方案才是真正的规范。在ES6中，我们可以使用 <code>import</code> 关键字引入模块，通过 <code>export</code> 关键字导出模块，功能较之前几种方案更为强大，也是我们所推崇的。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> sqrt = <span class="built_in">Math</span>.sqrt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> square = <span class="function"><span class="params">x</span> =&gt;</span> x * x;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">diag</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sqrt(square(x) + square(y));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; square, diag &#125; <span class="keyword">from</span> <span class="string">"./utils"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(square(<span class="number">2</span>)); <span class="comment">// &gt; 4</span></span><br><span class="line"><span class="built_in">console</span>.log(diag(<span class="number">3</span>, <span class="number">4</span>)); <span class="comment">// &gt; 5</span></span><br></pre></td></tr></table></figure><h4 id="基本规则或特点"><a href="#基本规则或特点" class="headerlink" title="基本规则或特点"></a>基本规则或特点</h4><ul><li>每个模块只加载一次，每一个 <code>js</code> 只执行一次，如果下次再去加载同目录下的同文件，直接从内存中读取。一个模块就是一个单例，或者说就是一个对象。</li><li>每一个模块内声明的变量都是局部变量，不会污染全局作用域。</li><li>模块内部的变量或者函数可以通过 <code>export</code> 导出。</li><li>一个模块可以导入别的模块。</li></ul><h4 id="import和export导出方式"><a href="#import和export导出方式" class="headerlink" title="import和export导出方式"></a>import和export导出方式</h4><h5 id="综合导出变量"><a href="#综合导出变量" class="headerlink" title="综合导出变量"></a>综合导出变量</h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// lib.js</span></span><br><span class="line"><span class="keyword">let</span> name = <span class="string">"zi jun"</span>;</span><br><span class="line"><span class="keyword">let</span> sayName = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">"hello, zi jun"</span>;  </span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> &#123;name, sayName&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; name, sayName &#125; <span class="keyword">from</span> <span class="string">"./lib"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(name); <span class="comment">// &gt; "zi jun";</span></span><br><span class="line"><span class="built_in">console</span>.log(sayName); <span class="comment">// &gt; "hello, zi jun"</span></span><br></pre></td></tr></table></figure><h5 id="导出时修改名称"><a href="#导出时修改名称" class="headerlink" title="导出时修改名称"></a>导出时修改名称</h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// lib.js</span></span><br><span class="line"><span class="keyword">let</span> name = <span class="string">"zi jun"</span>;</span><br><span class="line"><span class="keyword">export</span> &#123;name <span class="keyword">as</span> myName&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; myName &#125; <span class="keyword">from</span> <span class="string">"./lib"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(myName); <span class="comment">// &gt; "zi jun"</span></span><br></pre></td></tr></table></figure><h5 id="直接导出"><a href="#直接导出" class="headerlink" title="直接导出"></a>直接导出</h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// lib.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> name = <span class="string">"zi jun"</span>;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; name &#125; <span class="keyword">from</span> <span class="string">"./lib"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(name); <span class="comment">// &gt; "zi jun"</span></span><br></pre></td></tr></table></figure><h5 id="匿名导出"><a href="#匿名导出" class="headerlink" title="匿名导出"></a>匿名导出</h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// lib.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    name: <span class="string">"zi jun"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> info <span class="keyword">from</span> <span class="string">"./lib"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(info.name); <span class="comment">// &gt; "zi jun"</span></span><br></pre></td></tr></table></figure><h5 id="通配符导出"><a href="#通配符导出" class="headerlink" title="通配符导出"></a>通配符导出</h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// other.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    name: <span class="string">"zi jun"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// lib.js</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">as</span> myName <span class="keyword">from</span> <span class="string">"./other"</span>;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> myName <span class="keyword">from</span> <span class="string">"./lib"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(myName.name); <span class="comment">// &gt; "zi jun"</span></span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
      <categories>
        <category>前端</category>
        <category>JavaScript</category>
        <category>进阶</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>前端</tag>
        <tag>模块化</tag>
      </tags>
  </entry>
  <entry>
    <title>前端优化-性能优化</title>
    <url>/archives/47836f53.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录前端的一些优化处理技巧的整理，比如如何快速渲染大量图片，如何提高页面加载速度等。</p><a id="more"></a><p>前端性能的一个重要指标就是页面加载时间，前端优化主要围绕提高加载速度进行。</p><p><img data-src="../../assets/20200610181332-1591784460323.png" alt=""></p><h3 id="页面级内容优化"><a href="#页面级内容优化" class="headerlink" title="页面级内容优化"></a>页面级内容优化</h3><ol><li><strong>减少HTTP请求数。</strong>Web前端80%的响应时间花在图片，样式，脚本等资源下载上。最直接的方式是减少页面所需资源，但不现实。所以，减少HTTP请求数是主要途径。以下从 减少一部分请求 -&gt; 不用请求，分别说明：<ul><li><strong>合并HTTP请求资源</strong><ul><li><strong>针对文件 - 合并JS/CSS文件。</strong>比如服务端PHP的压缩应用：Minify，它会合并多个CSS或者JavaScript文件，移除一些不必要的空格和注释，进行gzip压缩，并且会设置浏览器的缓存头。在前端框架Vue中，Webpack同样具有类似功能。</li><li><strong>针对图片 - 使用图片精灵。</strong>将小的图片合并在一张图片之中，通过 <code>background-image</code> 和 <code>background-position</code> 控制显示。</li><li><strong>针对图片 - 使用行内图片（Base64编码）处理。</strong>对于较小的图片，可以转换为base64格式，vue中可以配置此项，一般大小限制为10KB左右。因为较大图片会导致转化较慢，还就是base64没有缓存，每次都需要重新反复请求。</li><li><strong>针对图片 - 懒加载。</strong>对于图片量比较大的而言，浏览到哪图片加载到哪是最好的显示效果，可以大大提高首屏的加载时间。</li><li><strong>懒加载资源（减少当前屏/首屏的HTTP请求）。</strong>如果上面的图片懒加载，其他资源也是可以懒加载的，比如Vue中的懒加载路由处理。</li></ul></li><li><strong>不用HTTP请求</strong><ul><li><strong>针对图片 - 使用Iconfont替代。</strong>比如可以使用阿里的iconfont字体图标库，下载在本地，可以替代小的图片。</li></ul></li><li><strong>设置数据缓存</strong><ul><li><strong>设置HTTP缓存。</strong>通过设置HTTP头的缓存设置，可以减少HTTP请求。具体的可以看 <a href="/archives/bff68fd9.html">链接</a>。</li><li><strong>设置数据缓存。</strong>通过浏览器本地设置sessionStorage或localStorage来存储一些数据，减少不必要的请求。</li></ul></li></ul></li><li><strong>较少DNS查询。</strong>DNS(Domain Name System)。用户输入URL之后，浏览器首先要查询域名（hostname）对应服务器的IP地址，一般需要耗费20-120毫秒的时间。DNS查询查找完成之前，浏览器无法从服务器下载任何数据。浏览器DNS缓存有效期一般为1分钟左右。减少不同的主机名的数量会减少DNS查询，但是也会减少页面并行下载资源的数量，即会增加了响应时间。原则是把组件分散到2-4个主机名下，这是同时减少DNS查询和运行高并发下载的折中方案。</li><li><strong>减少DOM数量。</strong>DOM数量直接回影响浏览器引擎渲染的速度（虽然这个过程会比较快），JavaScript DOM操作也会更慢，但是减少DOM数量也会提高页面的渲染速度。</li><li><strong>减少Iframe的使用。</strong>Iframe的使用会使得页面的加载代价昂贵，通常Iframe加载的开销比普通DOM div高1-2个数量级。还有Iframe会阻塞onload事件（虽然可以动态赋值src解决）。</li><li><strong>预加载。</strong>预先加载利用浏览器空闲时间请求将来要使用的资源，以便用户访问下一页面时更快地响应。一般在HTML中 <code>&lt;head&gt;&lt;/head&gt;</code> 标签内设置。比如：<code>&lt;link rel=&#39;preload&#39; href=&quot;image.png&quot;&gt;</code>。具体的可以查看 <a href="/archives/10b3b1eb.html">链接</a></li><li><strong>适当使用异步请求。</strong>对于独立的数据请求，避免同步接口的阻塞性，可以使用异步请求同步并行请求。</li><li><strong>尽量减少回流和重绘。</strong>回流会导致布局改变从而需要页面重新构建，渲染，影响性能。而重绘只会渲染局部，不需要整个页面重新渲染。</li><li><strong>避免重定向。</strong>客户端收到服务器的重定向响应后，会根据响应头中Location的地址再次发送请求。重定向会影响用户体验，尤其是多次重定向时，用户在一段时间内看不到任何内容，只看到浏览器进度条一直在刷新。</li><li><strong>避免404错误。</strong>HTTP请求很昂贵，返回无效的响应（如404未找到）完全没必要，降低用户体验而且毫无益处。</li></ol><!-- rebuild by neat -->]]></content>
      <categories>
        <category>前端</category>
        <category>优化</category>
      </categories>
      <tags>
        <tag>优化</tag>
      </tags>
  </entry>
  <entry>
    <title>前端优化-10万条数据处理</title>
    <url>/archives/46a5683c.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录后端由于没有分页，一次性返回了10万条数据，前端如何渲染的问题。</p><a id="more"></a><p>以下介绍下初级工程师、中级工程师、高级工程师应对此问题的处理方案。</p><h3 id="初级处理方案"><a href="#初级处理方案" class="headerlink" title="初级处理方案"></a>初级处理方案</h3><p>直接从后端请求数据，渲染到页面的硬编码方案，思路如下：</p><p><img data-src="../../assets/2020006191426.jpg" alt=""></p><p>代码如下：</p><p>请求后端数据：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> fetchList() &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; data &#125; = <span class="keyword">await</span> getMockData();</span><br><span class="line">    <span class="keyword">this</span>.dataList = data; </span><br><span class="line">    <span class="keyword">this</span>.renderList = data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>渲染数据：</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"list-wrap"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"list-item"</span> <span class="attr">v-for</span>=<span class="string">"item in renderList"</span> <span class="attr">:key</span>=<span class="string">"item.id"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;item.name&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>搜索数据：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">handleSearch() &#123;</span><br><span class="line">  <span class="keyword">this</span>.renderList = <span class="keyword">this</span>.dataList.filter(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> item.name.includes(<span class="keyword">this</span>.keys);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>页面完整代码：</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"test-page"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 搜索 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"list-search"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">"请输入"</span> <span class="attr">v-model</span>=<span class="string">"keys"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"handleSearch"</span>&gt;</span>搜索<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 列表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"list-wrap"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"list-item"</span> <span class="attr">v-for</span>=<span class="string">"item in renderList"</span> <span class="attr">:key</span>=<span class="string">"item.id"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;item.name&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  data() &#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line">      dataList: [],</span><br><span class="line">      renderList: [],</span><br><span class="line"><span class="actionscript">      keys: <span class="string">""</span></span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  mounted() &#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">this</span>.fetchList();</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods: &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 获取数据列表</span><br><span class="line">     */</span><br><span class="line">    fetchList() &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> result = [];</span></span><br><span class="line"><span class="javascript">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = <span class="number">100000</span>; i &lt; len; i++) &#123;</span></span><br><span class="line">        result.push(&#123;</span><br><span class="line">          id: i,</span><br><span class="line"><span class="javascript">          name: <span class="string">`这是第<span class="subst">$&#123;i + <span class="number">1</span>&#125;</span>行数据：i = <span class="subst">$&#123;i&#125;</span>`</span></span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"><span class="actionscript">      <span class="keyword">this</span>.dataList = result;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">this</span>.renderList = result;</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 搜索</span><br><span class="line">     */</span><br><span class="line">    handleSearch() &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.renderList = <span class="keyword">this</span>.dataList.filter(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> item.name.includes(<span class="keyword">this</span>.keys);</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><div class="note warning"><ul><li><p>这种做法本质上是可以实现基本的需求，但是有明显的缺点，那就是数据一次性渲染到页面中，数据量庞大将导致页面性能急剧降低，造成页面卡顿。</p></li><li><p>根据页面显示：<code>Finish: 25.57s, DOMContentLoaded:888ms, Load:25.21s</code>，可见这100000条数据，在页面一次性渲染花费了25s。消耗巨大。</p></li></ul></div><h3 id="中级处理方案"><a href="#中级处理方案" class="headerlink" title="中级处理方案"></a>中级处理方案</h3><p>熟悉防抖函数和节流函数，并使用懒加载和分页的方案。思路如下：</p><p><img data-src="../../assets/c684f0b9faca41cab12a395f9da749e0.jpg" alt=""></p><p>懒加载 + 分页方案：懒加载的实现主要是通过监听窗口的滚动，当某一个占位元素可见之后再去加载下一个数据，原理如下：这里我们通过监听 <code>window</code> 的 <code>scroll</code> 事件，判断是否滚动到页面底部，从而自己实现一个懒加载方案。</p><p>完整代码：</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"test-page"</span> <span class="attr">ref</span>=<span class="string">"poll"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 搜索 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"list-search"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">"请输入"</span> <span class="attr">v-model</span>=<span class="string">"keys"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"handleSearch"</span>&gt;</span>搜索<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 列表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"list-wrap"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"list-item"</span> <span class="attr">v-for</span>=<span class="string">"item in renderList"</span> <span class="attr">:key</span>=<span class="string">"item.id"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; item.name &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  data() &#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line">      dataList: [],</span><br><span class="line">      renderList: [],</span><br><span class="line"><span class="actionscript">      keys: <span class="string">""</span>,</span></span><br><span class="line"></span><br><span class="line">      prevY: 0,</span><br><span class="line">      curPage: 1,</span><br><span class="line">      pageSize: 20</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  mounted() &#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">this</span>.fetchList();</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="keyword">const</span> getData = <span class="keyword">this</span>.debounce(<span class="number">300</span>, <span class="keyword">this</span>.scrollAndLoading);</span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.addEventListener(<span class="string">"scroll"</span>, getData, <span class="literal">false</span>);</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods: &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 获取数据列表</span><br><span class="line">     */</span><br><span class="line">    fetchList() &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> result = [];</span></span><br><span class="line"><span class="javascript">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = <span class="number">100000</span>; i &lt; len; i++) &#123;</span></span><br><span class="line">        result.push(&#123;</span><br><span class="line">          id: i,</span><br><span class="line"><span class="javascript">          name: <span class="string">`这是第<span class="subst">$&#123;i + <span class="number">1</span>&#125;</span>行数据：i = <span class="subst">$&#123;i&#125;</span>`</span></span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"><span class="actionscript">      <span class="keyword">this</span>.dataList = result;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">this</span>.renderList = <span class="keyword">this</span>.dataList.slice(<span class="number">0</span>, <span class="keyword">this</span>.pageSize * <span class="keyword">this</span>.curPage);</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 搜索</span><br><span class="line">     */</span><br><span class="line">    handleSearch() &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.dataList = <span class="keyword">this</span>.dataList.filter(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> item.name.includes(<span class="keyword">this</span>.keys);</span></span><br><span class="line">      &#125;);</span><br><span class="line"><span class="actionscript">      <span class="keyword">this</span>.curPage = <span class="number">1</span>;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">this</span>.renderList = <span class="keyword">this</span>.dataList.slice(<span class="number">0</span>, <span class="keyword">this</span>.pageSize * <span class="keyword">this</span>.curPage);</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 防抖函数</span><br><span class="line">     * @param delay &#123;number&#125; 延迟时间</span><br><span class="line"><span class="javascript">     * @param fn &#123;<span class="function"><span class="keyword">function</span>&#125; 回调函数</span></span></span><br><span class="line"><span class="javascript">     * @returns &#123;<span class="function"><span class="keyword">function</span>(<span class="params">...[*]=</span>)&#125;</span></span></span><br><span class="line">     */</span><br><span class="line">    debounce(delay, fn) &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> timer;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(<span class="rest_arg">...args</span>)</span> </span>&#123;</span></span><br><span class="line">        timer &amp;&amp; clearTimeout(timer);</span><br><span class="line"><span class="javascript">        timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line">          fn(...args);</span><br><span class="line"><span class="actionscript">          timer = <span class="literal">null</span>;</span></span><br><span class="line">        &#125;, delay);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 滚动并加载</span><br><span class="line">     */</span><br><span class="line">    scrollAndLoading(data) &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> scrollTop =</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.documentElement.scrollTop || <span class="built_in">document</span>.body.scrollTop;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> clientHeight =</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.documentElement.clientHeight || <span class="built_in">document</span>.body.clientHeight;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> scrollHeight =</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.documentElement.scrollHeight || <span class="built_in">document</span>.body.scrollHeight;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (<span class="built_in">window</span>.scrollY &gt; <span class="keyword">this</span>.prevY) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.prevY = <span class="built_in">window</span>.scrollY;</span></span><br><span class="line">        if (</span><br><span class="line">          scrollHeight &gt; clientHeight &amp;&amp;</span><br><span class="line">          scrollTop + clientHeight &gt;= scrollHeight</span><br><span class="line">        ) &#123;</span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.curPage++;</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.renderList = <span class="keyword">this</span>.dataList.slice(</span></span><br><span class="line">            0,</span><br><span class="line"><span class="actionscript">            <span class="keyword">this</span>.pageSize * <span class="keyword">this</span>.curPage</span></span><br><span class="line">          );</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><div class="note warning"><ul><li>这种做法无论是搜索前还是搜索后，都利用了懒加载，所以不用太担心数据量大带来的性能瓶颈。</li><li>以上代码存有bug,可以优化，比如搜索结果会覆盖源数据。</li><li>这样处理，由于防抖的原因，加载时会有停顿效果，不能“一滑到底”。</li></ul></div><h3 id="高级处理方案"><a href="#高级处理方案" class="headerlink" title="高级处理方案"></a>高级处理方案</h3><ul><li>运用虚拟滚动技术来优化长列表</li><li>JS缓冲器来分片处理长列表</li><li>Web Worker处理数据，全部用Web Worker处理做异步回调，必要的时候可以引入WebAssembly模块做数据处理</li></ul><p><strong>虚拟滚动技术</strong></p><p>原理：其实是按需显示的一种实现，即只对可见区域进行渲染，对非可见区域中的数据不渲染或部分渲染的技术，从而达到极高的渲染性能。</p><p>比如10万条数据需要同时渲染，我们的屏幕的可见区域的高度为500px，而列表单项的高度为50px，则此时我们在屏幕中最多只能看到10个列表项，那么在首次渲染的时候，我们只需加载10条数据即可。</p><p><img data-src="../../assets/05553d49ce7a4e9290eba7ccbdb71833.jpg" alt=""></p><p>首次加载完，当滚动发生时，通过计算当前滚动值可以得知此时在屏幕可见区域应该显示的列表项。假设滚动发生，滚动条距离顶部的位置为150px，则可见区域内的列表项为第4项到第13项。</p><p><img data-src="../../assets/ca633915f4e94e86acf42786d3a01c86.jpg" alt=""></p><p>实现：在首屏加载的时候，只加载可视区域内需要的列表项，当滚动发生时，动态通过计算获取可视区域内的列表项，并将非可视区域内存在的列表项删除。</p><ul><li>计算当前可视区域起始数据索引（<code>startIndex</code>）</li><li>计算当前可视区域结束数据索引（<code>endIndex</code>）</li><li>计算当前可视区域的数据，并渲染到页面中</li><li>计算 <code>startIndex</code> 对应的数据在整个列表中的偏移位置 <code>startOffset</code> 并设置到列表上</li></ul><p><img data-src="../../assets/907fdf3af0364eb893a2508c73c55ed3.jpg" alt=""></p><p>由于只是对可视区域内的列表项进行渲染，所以为了保持列表容器的高度并可正常的触发滚动，将HTML结果设计如下：</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"infinite-list-container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"infinite-list-phantom"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"infinite-list"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- item --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><code>infinite-list-container</code> 为可视区域的容器</li><li><code>infinite-list-phantom</code> 为容器内的占位，高度为总列表高度，用于形成滚动条</li><li><code>infinite-list</code> 为列表项的渲染区域</li></ul><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"infinite-list-container"</span> @<span class="attr">scroll</span>=<span class="string">"handleScrollEvent"</span> <span class="attr">ref</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">"infinite-list-phantom"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:style</span>=<span class="string">"&#123; height: listHeight + 'px' &#125;"</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"infinite-list"</span> <span class="attr">:style</span>=<span class="string">"&#123; transform: getTransform &#125;"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"list-item"</span> <span class="attr">v-for</span>=<span class="string">"item in renderList"</span> <span class="attr">:key</span>=<span class="string">"item.id"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; item.name &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  data() &#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line">      dataList: [],</span><br><span class="line">      screenHeight: 0,</span><br><span class="line">      itemHeight: 50,</span><br><span class="line">      scrollTop: 0,</span><br><span class="line">      start: 0,</span><br><span class="line"><span class="actionscript">      end: <span class="literal">null</span>,</span></span><br><span class="line">      startOffset: 0</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  computed: &#123;</span><br><span class="line">    listHeight() &#123;</span><br><span class="line"><span class="actionscript">      <span class="keyword">return</span> <span class="keyword">this</span>.dataList.length * <span class="keyword">this</span>.itemHeight;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    visibleCount() &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="built_in">Math</span>.ceil(<span class="keyword">this</span>.screenHeight / <span class="keyword">this</span>.itemHeight);</span></span><br><span class="line">    &#125;,</span><br><span class="line">    renderList() &#123;</span><br><span class="line"><span class="actionscript">      <span class="keyword">return</span> <span class="keyword">this</span>.dataList.slice(</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">this</span>.start,</span></span><br><span class="line"><span class="javascript">        <span class="built_in">Math</span>.min(<span class="keyword">this</span>.end, <span class="keyword">this</span>.dataList.length)</span></span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line">    getTransform() &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="string">`translate3d(0, <span class="subst">$&#123;<span class="keyword">this</span>.startOffset&#125;</span>px, 0)`</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  mounted() &#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">this</span>.fetchList();</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">this</span>.screenHeight = <span class="keyword">this</span>.$refs.list.clientHeight;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">this</span>.start = <span class="number">0</span>;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">this</span>.end = <span class="keyword">this</span>.start + <span class="keyword">this</span>.visibleCount;</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods: &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 获取数据列表</span><br><span class="line">     */</span><br><span class="line">    fetchList() &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> result = [];</span></span><br><span class="line"><span class="javascript">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = <span class="number">100000</span>; i &lt; len; i++) &#123;</span></span><br><span class="line">        result.push(&#123;</span><br><span class="line">          id: i,</span><br><span class="line"><span class="javascript">          name: <span class="string">`这是第<span class="subst">$&#123;i + <span class="number">1</span>&#125;</span>行数据：i = <span class="subst">$&#123;i&#125;</span>`</span></span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"><span class="actionscript">      <span class="keyword">this</span>.dataList = result;</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 监听滚动</span><br><span class="line">     */</span><br><span class="line">    handleScrollEvent() &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> scrollTop = <span class="keyword">this</span>.$refs.list.scrollTop;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">this</span>.scrollTop = scrollTop;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.start = <span class="built_in">Math</span>.floor(scrollTop / <span class="keyword">this</span>.itemHeight);</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">this</span>.end = <span class="keyword">this</span>.start + <span class="keyword">this</span>.visibleCount;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">this</span>.startOffset = scrollTop - (scrollTop % <span class="keyword">this</span>.itemHeight);</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">"less"</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.infinite-list-container</span> &#123;</span></span><br><span class="line">  height: 100vh;</span><br><span class="line">  overflow: auto;</span><br><span class="line">  position: relative;</span><br><span class="line">  -webkit-overflow-scrolling: touch;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-class">.infinite-list-phantom</span> &#123;</span></span><br><span class="line">  position: absolute;</span><br><span class="line">  left: 0;</span><br><span class="line">  top: 0;</span><br><span class="line">  right: 0;</span><br><span class="line">  z-index: 1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-class">.infinite-list</span> &#123;</span></span><br><span class="line">  left: 0;</span><br><span class="line">  right: 0;</span><br><span class="line">  top: 0;</span><br><span class="line">  position: absolute;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-class">.list-item</span> &#123;</span></span><br><span class="line">  height: 50px;</span><br><span class="line">  p &#123;</span><br><span class="line">    padding: 0;</span><br><span class="line">    margin: 0;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
      <categories>
        <category>前端</category>
        <category>优化</category>
      </categories>
      <tags>
        <tag>优化</tag>
      </tags>
  </entry>
  <entry>
    <title>前端优化-预加载</title>
    <url>/archives/10b3b1eb.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录前端预加载技术。</p><a id="more"></a><p>当我们谈到前端的性能时，总是会提到比如合并、压缩、缓存或者在服务器上开启gzip之类，目的都是为了让页面加载更快。更多的前端性能优化，可见 <a href="/archives/47836f53.html">链接</a>。</p><p>资源预加载（prefetch）则是另一种性能优化的技术。Pre-fetching会提示浏览器那些未来一定或可能使用到的资源，有时在当前页面见效，有些则在未来可能打开的页面生效。但是这并不是一种单一的技术，实际上可以拆分成很多小点：</p><ul><li><p><strong>DNS-prefetch</strong></p><p>通过指定具体的URL来告知客户端未来会用到相关的资源，这样浏览器可以尽早地解析DNS。比如我们需要一个在example.com的图片或者视频文件，可以这样设置：</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"dns-prefetch"</span> <span class="attr">href</span>=<span class="string">"//example.com"</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>Preconnect</strong></p><p>和DNS prefetch类似，Preconnect不仅会解析DNS，还会建立TCP握手连接和TLS协议（如果需要）。用法如下：</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"preconnect"</span> <span class="attr">href</span>=<span class="string">"//example.com"</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>Prefetch</strong></p><p>当能确定网页在未来一定会使用到某个资源时，可以让浏览器提前请求并且缓存好供后续使用。它的作用是告诉浏览器加载下一页面可能会用到的资源，注意，是下一页面，而不是当前页面。Prefetch支持预拉取图片、脚本或者任何可以被浏览器缓存的资源。用法如下：</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"prefetch"</span> <span class="attr">href</span>=<span class="string">"image.png"</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>Prerender</strong></p><p>它可以让浏览器提前加载指定页面的所有资源。Prerender就像是在后台打开了一个隐藏的Tab，会下载所有的资源、创建DOM、渲染页面、执行JS等。如果用户进入指定的链接，隐藏的这个页面就会立即进入用户的视线。</p></li><li><p><strong>Preload</strong></p><p>它提供了一种声明式的命令，让浏览器提前加载指定资源(加载后并不执行)，需要执行时再执行。它不会阻塞Lloaded事件的触发。通常应用场景为加载font字体。用户如下：</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"preload"</span> <span class="attr">href</span>=<span class="string">"fonts/cicle_fina-webfont.woff"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"preload"</span> <span class="attr">href</span>=<span class="string">"bg-image-narrow.png"</span> <span class="attr">as</span>=<span class="string">"image"</span> <span class="attr">media</span>=<span class="string">"(max-width: 600px)"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"preload"</span> <span class="attr">href</span>=<span class="string">"bg-image-wide.png"</span> <span class="attr">as</span>=<span class="string">"image"</span> <span class="attr">media</span>=<span class="string">"(min-width: 601px)"</span> <span class="attr">crossorigin</span>=<span class="string">"anonymous"</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><code>rel=preload</code> 声明这是一个preload</li><li><code>href</code> 指明资源的位置</li><li><code>as</code> 指明资源类型，这是为了让浏览器精确设置优先级，设置正确的Accept头部</li><li><code>crossorigin</code> 指定使用的跨域设置</li><li><code>media</code> 指定媒体查询</li></ul></li></ul><div class="note warning no-icon"><p>Preload和Prefetch的区别：</p><table><thead><tr><th></th><th align="center">preload</th><th align="center">prefetch</th></tr></thead><tbody><tr><td>语法</td><td align="center"><code>&lt;link rel=&quot;preload&quot; href=&quot;img.png&quot;&gt;</code></td><td align="center"><code>&lt;link rel=&quot;prefetch&quot; href=&quot;img.png&quot;&gt;</code></td></tr><tr><td>使用场景</td><td align="center">本页面接下来大概率要使用的资源</td><td align="center">下个页面的资源，下个页面很可能会去访问</td></tr><tr><td>加载时间</td><td align="center">立即加载（一般而言，跟as有关）</td><td align="center">浏览器闲置的时候才会加载（一般而言）</td></tr></tbody></table></div><!-- rebuild by neat -->]]></content>
      <categories>
        <category>前端</category>
        <category>优化</category>
      </categories>
      <tags>
        <tag>优化</tag>
        <tag>预加载</tag>
      </tags>
  </entry>
  <entry>
    <title>读《你不知道的JavaScript(上卷)》</title>
    <url>/archives/3dacf7de.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录阅读《你不知道的JavaScript（上卷）》的一些笔记，主要内容为作用域和闭包、this和原型对象。</p><a id="more"></a><h2 id="作用域和闭包"><a href="#作用域和闭包" class="headerlink" title="作用域和闭包"></a>作用域和闭包</h2><h3 id="什么是作用域"><a href="#什么是作用域" class="headerlink" title="什么是作用域"></a>什么是作用域</h3><p><strong>作用域</strong> 用一套设计好的规则来存储变量，并在之后能够方便的找到这些变量，这套规则称之为作用域。</p><p><strong><code>JavaScript</code>的工作原理</strong></p><ul><li><code>JavaScript</code>引擎：从头到尾负责整个 <code>JavaScript</code> 程序的编译及执行过程</li><li><code>JavaScript</code>编译器：负责语法分析及代码生成等<ol><li>分词/词法分析(Tokenizing/Lexing)：这个过程会将字符代码分解为有意义的代码块，这些代码块称为词法单元(token)。例如：<code>var a = 2;</code> , 这段程序会被分解为 <code>var</code>、<code>a</code>、<code>=</code>、<code>2</code>、<code>;</code>。</li><li>语法分析(Parsing)：这个过程是将词法单元流转换成一个由元素逐级嵌套所组成的代表了程序语法结构的树。这个数被称为“抽线语法树”(Abstract Syntax Tree, AST)。</li><li>代码生成()：将 <code>AST</code> 转换为可执行代码，简单来说就是有某种方法可以将 <code>var a = 2;</code> 的 <code>AST</code> 转换为一组机器指令，用来创建一个叫作 <code>a</code> 的变量(包括分配内存等)，并将一个值存储在 <code>a</code> 中。</li></ol></li><li><code>JavaScript</code>作用域：负责收集并维护由所有声明的标识符(变量)组成的一系列查询</li></ul><p><strong>作用域查询规则</strong></p><ul><li>LHS查询(Left Handle Search)：查找的目的是对变量进行赋值会触发（赋值操作的目标是谁，我要赋值了）</li><li>RHS查询(Right Handle Search)：查找的目的是获取变量的值会触发（谁是赋值操作的源头，我要用它）<ul><li>其查询规则为嵌套查询，也就是在当前作用域中没有查找到，引擎就会在外层嵌套中继续查找，直到最外层(全局作用域)为止</li><li>如果没有查找到，严格模式下，会抛出 <code>ReferenceError</code> 错误，非严格模式下，会自动在全局作用域下创建此变量</li><li>如果找到了，但是其之前没有被赋值，那么就会返回 <code>undefined</code></li></ul></li></ul><div class="note warning"><p>对象的属性或方法调用也会触发RHS查询</p></div><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> b = a;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> c = foo(<span class="number">2</span>);</span><br><span class="line"><span class="built_in">console</span>.log(c); <span class="comment">// =&gt; 4</span></span><br></pre></td></tr></table></figure><p>上面代码解析过程如下：</p><ol><li>编译器对上面字符串进行分词、语法分析，然后生成代码</li><li>JS引擎联合作用域开始执行代码<ol><li><code>c</code> 需要被赋值，会触发一次LHS查询，然后需要使用 <code>foo(2)</code> 这个变量的值，这里会触发一次RHS查询</li><li><code>foo(2)</code> 调用过程中，参数赋值会隐式地触发一次 <code>a = 2</code> 的赋值操作，触发一次LHS查询</li><li>进入函数体，<code>var b = a;</code> <code>b</code> 需要被赋值，会触发一次LHS查询，然后需要使用 <code>a</code> 这个变量，这里会触发一次RHS查询，获取值</li><li><code>return a + b;</code> ，这里需要分别获取 <code>a</code> 和 <code>b</code> 这两个变量的值，所以会各自触发一次RHS查询，自此这一步，引擎共计进行了3次LHS查询，4次RHS查询</li></ol></li></ol><p><strong>作用域异常</strong></p><ul><li><code>ReferenceError</code>：作用域判别失败触发，比如在使用变量的时候未找到此变量的创建</li><li><code>TypeError</code>：作用域判别成功了，但是对结果的操作是非法或不合理<ul><li>引用 <code>null</code> 或 <code>undefined</code> 类型值中的属性</li><li>对一个非函数类型的值进行函数调用</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> b = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// Uncaught ReferenceError: a is not defined</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="literal">null</span>.a); <span class="comment">// Uncaught TypeError: Cannot read property 'a' of null</span></span><br><span class="line"><span class="built_in">console</span>.log(b()); <span class="comment">// Uncaught TypeError: b is not a function</span></span><br></pre></td></tr></table></figure><h3 id="词法作用域"><a href="#词法作用域" class="headerlink" title="词法作用域"></a>词法作用域</h3><p><strong>作用域共有两种工作模型</strong></p><ul><li>词法作用域（大多数语言采用）</li><li>动态作用域（<code>Bash</code> 脚本、<code>Perl</code> 中的一些模式）</li></ul><p><strong>词法作用域</strong></p><p>词法作用域就是定义在词法阶段的作用域。换句话说，词法作用域是由你在写代码时将变量和块作用域写在哪里决定的，因此当词法分析器处理代码时会保持作用域不变。</p><p><strong>遮比效应</strong></p><div class="note warning"><p>无论函数在哪里被调用，也无论它如何被调用，它的词法作用域都只由函数被声明时所处的位置决定</p></div><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line">    foo();</span><br><span class="line">&#125;</span><br><span class="line">bar(); <span class="comment">// =&gt; 1</span></span><br></pre></td></tr></table></figure><p>我们要牢牢记住，词法作用域只关注函数在何处被声明，而不是在何处被调用，<code>foo</code> 函数位于全局作用域被声明，所以它对 <code>a</code> 变量的RHS查找当然是在全局作用域中。</p><p><strong>欺骗词法</strong></p><ul><li><code>eval()</code> <code>eval()</code> 函数可以接受一个字符串作为参数，并将里面的内容作为生成代码并执行。在正常模式下，<code>eval()</code> 中的内容中的声明（变量或函数），就会对所处的词法作用域进行修改</li><li><code>with</code> <code>with</code> 通常被当作重复引用同一个对象中的多个属性的快捷键，可以不需要重复引用对象本身</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    a: <span class="number">1</span>,</span><br><span class="line">    b: <span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 单调乏味的重复 obj</span></span><br><span class="line">obj.a = <span class="number">3</span>;</span><br><span class="line">obj.b = <span class="number">4</span>;</span><br><span class="line"><span class="comment">// 简单的快捷方式</span></span><br><span class="line"><span class="keyword">with</span>(obj) &#123;</span><br><span class="line">    a = <span class="number">3</span>;</span><br><span class="line">    b = <span class="number">4</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note warning no-icon"><p><code>eval()</code> 函数如果接受了含有一个或多个声明的代码，就会修改其所处的词法作用域，而 <code>with</code> 声明实际上是根据你传递给它的对象凭空创建了一个全新的词法作用域</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">with</span>(obj) &#123;</span><br><span class="line">        a = <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> o1 = &#123;</span><br><span class="line">    a: <span class="number">3</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> o2 = &#123;</span><br><span class="line">    b: <span class="number">3</span></span><br><span class="line">&#125;;</span><br><span class="line">foo(o1);</span><br><span class="line"><span class="built_in">console</span>.log(o1.a); <span class="comment">// =&gt; 2</span></span><br><span class="line"></span><br><span class="line">foo(o2);</span><br><span class="line"><span class="built_in">console</span>.log(o2.a); <span class="comment">// =&gt; undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// =&gt; 2</span></span><br></pre></td></tr></table></figure><p>为什么最后输出2？可以这样理解，当我们传递<code>o1</code>给<code>with</code>时，<code>with</code>所声明的作用域是<code>o1</code>，而这个作用域中含有一个同<code>o1.a</code>属性相符的标识符。但当我们将<code>o2</code>作为作用域时，其中并没有<code>a</code>标识符，因此进行了正常的LHS标识符查找。<code>o2</code>的作用域、<code>foo(..)</code>的作用域和全局作用域中都没有找到标识符<code>a</code>，因此当<code>a = 2</code>执行时，自动创建了一个全局变量（因为是非严格模式）。</p></div><div class="note warning"><p><code>eval()</code> 和 <code>with</code> 这两个可以欺骗词法作用域的机制，会导致 <code>JavaScript</code> 引擎在编译阶段的数项性能优化（基于词法静态分析的优化）失效，最终会导致性能下降。所以，在“严格模式”下，或是日常使用中，禁止使用它们。</p></div><h3 id="函数作用域和块作用域"><a href="#函数作用域和块作用域" class="headerlink" title="函数作用域和块作用域"></a>函数作用域和块作用域</h3><ul><li>函数内部的全部变量都可以在整个函数范围内使用和复用，函数外部无法访问到这些变量。</li><li>如果想要隐藏内部实现，可以再用一个函数包裹</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">b</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(a + b);</span><br><span class="line">    &#125;</span><br><span class="line">    foo(<span class="number">3</span>);</span><br><span class="line">&#125;</span><br><span class="line">bar(); <span class="comment">// =&gt; 4</span></span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// Uncaught ReferenceError: a is not defined</span></span><br><span class="line">foo(<span class="number">3</span>); <span class="comment">// Uncaught ReferenceError: foo is not defined</span></span><br></pre></td></tr></table></figure><p><strong>函数声明和函数表达式</strong></p><p>区分函数声明和函数表达式最简单的方法是看 <code>function</code> 关键字出现在声明中的位置，如果 <code>function</code> 是声明中的第一个词，那么就是一个函数声明，否则就是一个函数表达式。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 函数声明</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun1</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数表达式</span></span><br><span class="line"><span class="keyword">var</span> fun2 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数表达式</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">fun3</span>(<span class="params"></span>)</span>&#123;&#125;)()</span><br></pre></td></tr></table></figure><div class="note warning"><p>立即执行函数（IIFE [Immedidately Invoked Function Expression]），比如：<code>(function foo(){..})()</code> 第一个 <code>()</code> 将函数变成表达式，第二个 <code>()</code> 执行了这个函数</p></div><p><strong>块作用域</strong></p><p>块作用域指的是变量和函数不仅可以属于所处的作用域，也可以属于某个代码块（通常指 <code>{..}</code> 内部）</p><ul><li>从ES3开始，<code>try/catch</code> 结构在 <code>catch</code> 分句中具有块作用域</li><li>ES6中， <code>let/const</code> 可以将变量绑定到所在的任意作用域中</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i); <span class="comment">// =&gt; 0, 1, 2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(i); <span class="comment">// =&gt; 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 以上代码等同</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(i); <span class="comment">// =&gt; 0, 1, 2</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(i); <span class="comment">// =&gt; 3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上代码，<code>i</code> 会被绑定在 <code>for</code> 循环的外部作用域中。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i); <span class="comment">// =&gt; 0, 1, 2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(i); <span class="comment">// Uncaught ReferenceError: i is not defined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 以上代码等同</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">let</span> j;</span><br><span class="line">    <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++) &#123;</span><br><span class="line">        <span class="keyword">let</span> i = j;</span><br><span class="line">        <span class="built_in">console</span>.log(i); <span class="comment">// =&gt; 0, 1, 2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上代码，<code>for</code> 循环头部的 <code>let</code> 不仅将 <code>i</code> 绑定到了 <code>for</code> 循环中，事实上它将其重新绑定到了循环的每一个迭代中，确保使用上一个循环迭代结束时的值重新进行赋值。</p><h3 id="提升"><a href="#提升" class="headerlink" title="提升"></a>提升</h3><ul><li>函数声明和变量(<code>var</code>)声明都会被提升，但函数会优先被提升，然后才是变量</li><li>提升出现在编译阶段，赋值则是执行阶段的任务</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">a = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// =&gt; 1</span></span><br><span class="line"><span class="keyword">var</span> a;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(b); <span class="comment">// =&gt; undefined</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="number">2</span>;</span><br></pre></td></tr></table></figure><p>上面代码第一个示例： <code>var a = 1</code>，<code>JavaScript</code> 实际上会将其看成两个声明 <code>var a;</code>, <code>a = 1;</code></p><ul><li><code>var a;</code> 是在编译阶段进行的</li><li><code>a = 1;</code> 赋值声明会在原地等待执行阶段，才进行处理</li></ul><p>上面代码第二个示例，虽然 <code>var a;</code> 被提升了，但查询 <code>a</code> 比赋值 <code>a</code> 早了一步， 所以输出是 <code>undefined</code></p><p><strong>函数优先</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">foo(); <span class="comment">// =&gt; "Function"</span></span><br><span class="line"><span class="keyword">var</span> foo;</span><br><span class="line">foo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Var"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Fucntion"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>函数声明覆盖</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">foo(); &#x2F;&#x2F; 2</span><br><span class="line">function foo() &#123;</span><br><span class="line">    console.log(1);</span><br><span class="line">&#125;</span><br><span class="line">function foo() &#123;</span><br><span class="line">    console.log(2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>更多的详情可见 <code>let</code>、<code>const</code>、<code>function</code>、<code>var</code> 详解，<a href="/archives/71a05d55.html">链接</a></p></blockquote><h3 id="作用域闭包"><a href="#作用域闭包" class="headerlink" title="作用域闭包"></a>作用域闭包</h3><h2 id="This和对象原型"><a href="#This和对象原型" class="headerlink" title="This和对象原型"></a>This和对象原型</h2><!-- rebuild by neat -->]]></content>
      <categories>
        <category>书籍</category>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>书籍</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript进阶-隐式转换</title>
    <url>/archives/db8c76a2.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录JavaScript中 <code>valueOf</code> 和 <code>toString</code> 的隐式调用。</p><a id="more"></a><p>记录本篇主要是在高阶函数中的函数柯里化案例中，涉及到了函数返回结果重写了 <code>toString</code> 函数。具体的代码案例可见 <a href="/archives/af81bd5c.html">链接</a>。下面一步步解析。</p><h3 id="JavaScript的对象"><a href="#JavaScript的对象" class="headerlink" title="JavaScript的对象"></a>JavaScript的对象</h3><p><code>JavaScript</code> 中多有的变量都可以当作对象使用，除了2个例外：<code>null</code> 和 <code>undefined</code>。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">'hello'</span>.toString(); <span class="comment">// =&gt; "hello"</span></span><br><span class="line"><span class="literal">false</span>.toString(); <span class="comment">// =&gt; "false"</span></span><br><span class="line"><span class="number">2.</span>toString(); <span class="comment">// Uncaught SyntaxError: Invalid or unexpected token</span></span><br><span class="line"><span class="literal">null</span>.toString(); <span class="comment">// Uncaught TypeError: Cannot read property 'toString' of null</span></span><br><span class="line"><span class="literal">undefined</span>.toString(); <span class="comment">// Uncaught TypeError: Cannot read property 'toString' of undefined</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>].toString(); <span class="comment">// =&gt; "1, 2"</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">say</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">say.toString(); <span class="comment">// =&gt; "function say() &#123;&#125;"</span></span><br></pre></td></tr></table></figure><p>注意以上，<code>null</code> 和 <code>undefined</code> 不能作为对象使用，所以不能使用对象的公共方法，报错。但是 <code>number</code> 类型也报错了，其实这是一个误解！这是因为 <code>JavaScring</code>解析器的一个错误，它试图将点操作符解析为浮点数字面量的一部分。以下这样写就没问题：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="number">2</span>).toString(); <span class="comment">// =&gt; "2" 2先被计算</span></span><br><span class="line"><span class="number">2.</span>.toString(); <span class="comment">// =&gt; "2" 注意点好前面的空格</span></span><br><span class="line"><span class="number">2</span> .toString(); <span class="comment">// =&gt; "2" 第二个点号可以正常解析</span></span><br></pre></td></tr></table></figure><h3 id="隐式转换的调用"><a href="#隐式转换的调用" class="headerlink" title="隐式转换的调用"></a>隐式转换的调用</h3><p>每个对象都有 <code>toString</code> 和 <code>valueOf</code> 这两个函数，且都可以被改写，每个对象执行完毕，如果被用以操作 <code>JavaScript</code> 解析器就会自动调用对象的这两个方法。<br><code>toString</code> 和 <code>valueOf</code> 这两个函数，是解释器用来帮助我们自动完成类型之间的转换（一般是对象到基本类型的转换），进而输出令我们满意的结果。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  i: <span class="number">10</span>,</span><br><span class="line">  valueOf: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"执行了valueOf"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.i + <span class="number">20</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  toString: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"执行了toString"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.valueOf() + <span class="number">20</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">alert(obj); <span class="comment">// 50 执行了toString 执行了valueOf</span></span><br><span class="line">alert(+obj); <span class="comment">// 30 执行了valueOf</span></span><br><span class="line">alert(obj &gt; <span class="number">40</span>); <span class="comment">// false 执行了valueOf</span></span><br><span class="line">alert(obj == <span class="number">30</span>); <span class="comment">// true 执行了valueOf</span></span><br><span class="line">alert(obj === <span class="number">30</span>); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><p>由上面可以看出，虽然我们没有调用 <code>obj</code> 的任何方法，但是要使用 <code>obj</code> 进行操作时，JS解析器自动帮我们调用了其 <code>toString</code> 或 <code>valueOf</code> 方法。</p><div class="note warning"><p>最后一个未输出任何字符串，是因为：JS解析器直接先判断类型是否一样，明显一个是Object，一个是Number，所以直接不相等，不需要再去求值了。</p></div><p>那么何时调用 <code>toString</code>，何时调用 <code>valueOf</code> 呢？</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123;</span><br><span class="line">  i: <span class="number">10</span>,</span><br><span class="line">  toString: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"执行了toString"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.i;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">alert(a); <span class="comment">// 10 执行了toString</span></span><br><span class="line">alert(+a); <span class="comment">// 10 执行了toString</span></span><br><span class="line">alert(<span class="string">""</span> + a); <span class="comment">// 10 执行了toString</span></span><br><span class="line">alert(<span class="built_in">String</span>(a)); <span class="comment">// 10 执行了toString</span></span><br><span class="line">alert(<span class="built_in">Number</span>(a)); <span class="comment">// 10 执行了toString</span></span><br><span class="line">alert(a == <span class="string">"10"</span>); <span class="comment">// true 执行了toString</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> b = &#123;</span><br><span class="line">  i: <span class="number">10</span>,</span><br><span class="line">  valueOf: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"执行了valueOf"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.i;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">alert(b); <span class="comment">// 10 [object Object]</span></span><br><span class="line">alert(+b); <span class="comment">// 10 执行了valueOf</span></span><br><span class="line">alert(<span class="string">""</span> + b); <span class="comment">// 10 执行了valueOf</span></span><br><span class="line">alert(<span class="built_in">String</span>(b)); <span class="comment">// 10 [object Object]</span></span><br><span class="line">alert(<span class="built_in">Number</span>(b)); <span class="comment">// 10 执行了valueOf</span></span><br><span class="line">alert(b == <span class="string">"10"</span>); <span class="comment">// true 执行了valueOf</span></span><br></pre></td></tr></table></figure><div class="note warning no-icon"><ul><li>需要转换为字符串时，会调用 <code>toString</code> 且 <code>toString &gt; valueOf</code> 需要转换为数字时，会调用 <code>valueOf</code> 且 <code>valueOf &gt; toString</code></li><li>如果只重写了 <code>toString</code>，对象转换时会无视 <code>valueOf</code> 的存在，来进行转换</li><li>在不能调用 <code>toString</code> 的情况下，只能让 <code>valueOf</code>上阵</li><li>对象在作为操作数（加减乘除、比较运算）时，解释器优先调用 <code>valueOf</code>，而其他情况，解释器总是认为我们想要的是字符串，所以会优先调用 <code>toString</code></li></ul></div><!-- rebuild by neat -->]]></content>
      <categories>
        <category>前端</category>
        <category>JavaScript</category>
        <category>进阶</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>ToString</tag>
        <tag>ValueOf</tag>
      </tags>
  </entry>
  <entry>
    <title>前端正则-常用正则整理</title>
    <url>/archives/94c6a923.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要了常用的正则表达式，便于工作查询。</p><a id="more"></a><h2 id="校验数字"><a href="#校验数字" class="headerlink" title="校验数字"></a>校验数字</h2><ol><li>大于等于0的整数：<code>/^\d+$/</code></li><li>大于等于1的整数：<code>/^[1-9]\d*$/</code>·····1</li><li>大于等于2的整数：<code>/^([1-9]\d+|[2-9])$/</code></li><li>大于0（包括小数）：<code>/^(?!(0[0-9]{0,}$))[0-9]{1,}[.]{0,}[0-9]{0,}$/</code></li><li>大于等于0（包括小数）：<code>/^([0-9]+(\.\d+)?|0\.\d+)$/</code></li></ol><h2 id="校验字符"><a href="#校验字符" class="headerlink" title="校验字符"></a>校验字符</h2><ol><li>中文：<code>/[\u4E00-\u9FA5]/</code></li><li>英文和数字：<code>/^[A-Za-z0-9]+$/</code></li><li>数字、26个英文字母或者下划线组成：<code>^\w+$</code></li></ol><h2 id="特殊需求表达式"><a href="#特殊需求表达式" class="headerlink" title="特殊需求表达式"></a>特殊需求表达式</h2><ol><li>超链接：<code>/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&amp;=]*)?/</code></li><li>身份证号码：<code>/^([0-9]){7,18}(x|X)?$/</code></li><li>用户名（只能包括数字、字母、下划线，4-12位）：<code>/^[a-zA-z]\w{3,11}$/</code></li><li>密码（只能包括数字、字母、下划线，6-12位）：<code>/^[a-zA-z]\w{5,11}$/</code></li><li>手机号码：<code>/^1\d{10}$/</code></li><li>座机号码：<code>/^0\d{2,3}-?\d{7,8}$/</code></li><li>邮箱：<code>/^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/</code></li><li>微信号：<code>/^[a-zA-Z]([-_a-zA-Z0-9]{5,19})+$/</code></li></ol><h3 id="其他常用"><a href="#其他常用" class="headerlink" title="其他常用"></a>其他常用</h3><ol><li>获取文件后缀名：<code>/\.\w+$/.exec(str)</code></li></ol><!-- rebuild by neat -->]]></content>
      <categories>
        <category>前端</category>
        <category>JavaScript</category>
        <category>正则</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>正则</tag>
      </tags>
  </entry>
  <entry>
    <title>30道前端面试题</title>
    <url>/archives/d7ca445d.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本次主要记录整理-<code>JavaScript</code>30道经典面试题。</p><p>原链接名：<a href="https://www.toutiao.com/a6826253589988508171/?tt_from=copy_link&timestamp=1589419516&app=news_article&utm_source=copy_link&use_new_style=1&req_id=202005140925150100210751331569BE93&group_id=6826253589988508171" target="_blank" rel="noopener external nofollow noreferrer">《30道经典面试题，靠它我在一线拿到了20k的前端开发工程师岗位》</a></p><a id="more"></a><h3 id="什么是防抖和节流？有什么区别？如何实现？"><a href="#什么是防抖和节流？有什么区别？如何实现？" class="headerlink" title="什么是防抖和节流？有什么区别？如何实现？"></a>什么是防抖和节流？有什么区别？如何实现？</h3><p><strong>防抖：</strong>高频事件被触发n秒后再执行回调，如果在这n秒内又被触发，则重新计时。主要是限制高频事件被触发的频率。</p><p><strong>节流：</strong>在指定时间内，只能触发一次函数，如果这个单位时间内触发多次函数，只有一次生效。</p><p><strong>区别：</strong></p><ul><li>函数防抖和函数节流都是防止某一时间内频繁触发函数，但是实现原理不一样</li><li>函数防抖是某一段时间内只执行一次（触发频率影响最终时间）；而函数节流是间隔时间执行（触发频率不影响最终时间）</li></ul><p><strong>运用场景：</strong></p><ul><li><p>防抖(<code>debounce</code>)</p><ul><li>Search搜索联想，用户在不断输入值时，用防抖来节约请求资源</li><li>Window触发Resize的时候，不断调整浏览器窗口大小会不断触发这个事件，用防抖让其只触发一次</li></ul></li><li><p>节流(<code>throttle</code>)</p><ul><li>验证码在指定时间内只发送一次</li><li>监听滚动事件，比如是否滑到底部自动加载更多</li></ul></li></ul><p><strong>如何实现：</strong></p><ul><li>防抖：每次触发事件时都取消之前的延时调用方法</li><li>节流：每次触发事件时都判断当前是否有等待执行的延时函数</li></ul><div class="note primary"><p>详细的防抖和节流，可查看 <a href="/archives/a635d2be.html">链接</a></p></div><h3 id="get和post请求的误区"><a href="#get和post请求的误区" class="headerlink" title="get和post请求的误区"></a>get和post请求的误区</h3><p><strong>误区：</strong>get请求参数的大小存在限制，而post请求的参数大小是无限制的。</p><p>实际上HTTP协议从未规定GET/POST的请求长度限制是多少，对get请求参数的限制是来源于浏览器或web服务器，浏览器或web服务器限制了url的长度。</p><ul><li>HTTP协议未规定GET和POST的长度限制</li><li>GET的最大长度显示是因为浏览器和web服务器限制了URI的长度</li><li>不同的浏览器和web服务器，限制的最大长度不一样</li><li>要支持IE,则最大长度为2083byte，若只支持Chrome，则最大长度8182byte</li></ul><p>get和post在缓存方面的区别：</p><ul><li>get请求类似于查找的过程，用户获取数据，可以不用每次都与数据库连接，所以可以使用缓存</li><li>post不同，post做的一般是修改和删除工作，所以必须与数据库交互，所以不能使用缓存</li></ul><h3 id="模块化发展历程"><a href="#模块化发展历程" class="headerlink" title="模块化发展历程"></a>模块化发展历程</h3><p>可以从IIFE -&gt; CommonJS -&gt; AMD -&gt; CMD -&gt; UMD -&gt; Webpack -&gt; ES Module几个过程考虑。模块化主要是用来抽离公共代码，隔离作用域，避免变量冲突等。</p><p><strong>IIFE：</strong>使用自执行函数来编写模块化。</p><ul><li>特点：在一个单独的函数作用域中执行代码，避免变量冲突。</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		data: []</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure><p><strong>CommonJS：</strong>node.js中自带的模块化。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br></pre></td></tr></table></figure><p><strong>AMD：</strong>使用requireJS来编写模块化。</p><ul><li>特点：依赖必须提前声明好。</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">define(<span class="string">"./index.js"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">code</span>)) </span>&#123;</span><br><span class="line">	<span class="comment">// code 就是 index.js 返回的内容       </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>CMD：</strong>使用seaJS来编写模块化。</p><ul><li>特点：支持动态导入依赖文件。</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require, exports, module</span>)) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> indexCode = <span class="built_in">require</span>(<span class="string">"./index.js"</span>);       </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>UMD：</strong>兼容AMD，CommonJS模块化语法。</p><p><strong>Webpack：</strong>Webpack版本中的代码分割。</p><p><strong>ES Modules：</strong>ES6引入的模块化，支持import来导入另一个js。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> a <span class="keyword">from</span> <span class="string">"a"</span>;</span><br></pre></td></tr></table></figure><div class="note primary"><p>更多的模块化详解，可查看 <a href="/archives/b92372a3.html">链接</a></p></div><h3 id="npm模块安装机制"><a href="#npm模块安装机制" class="headerlink" title="npm模块安装机制"></a>npm模块安装机制</h3><ol><li>发出 <code>npm install</code> 命令</li><li>查询 node_modules 目录中是否已经存在指定模块</li><li>如存在，不再重新安装</li><li>如不存在，npm 向 registry 查询模块压缩包的网址</li><li>下载压缩包，存放在根目录的 <code>.npm</code> 目录里</li><li>解压压缩包到当前项目的 node_modules 目录</li></ol><h3 id="ES5与ES6的继承区别"><a href="#ES5与ES6的继承区别" class="headerlink" title="ES5与ES6的继承区别"></a>ES5与ES6的继承区别</h3><ul><li>ES5的继承是通过 <code>prototype</code> 或构造函数机制来实现。ES5的继承实质上是先创建子类的实例对象，然后再将父类的方法添加到 <code>this</code> 上（<code>Parent.apply(this)</code>）</li><li>ES6的继承机制完全不同，实质上是先创建父类的实例对象 <code>this</code> (所以必须先调用父类的 <code>super()</code> 方法)，然后再用子类的构造函数修改 <code>this</code></li></ul><p><strong>ES5实现继承 - 原型链实现</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 原型链继承 子类的原型指向父类的实例</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SuperType</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.colors = [<span class="string">"red"</span>, <span class="string">"blue"</span>, <span class="string">"green"</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SubType</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">SubType.prototype = <span class="keyword">new</span> SuperType();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> instance1 = <span class="keyword">new</span> SubType();</span><br><span class="line"><span class="built_in">console</span>.log(instance1); <span class="comment">// &gt; SubType</span></span><br><span class="line"><span class="built_in">console</span>.log(instance1.colors); <span class="comment">// &gt; ["red", "blue", "green"]</span></span><br><span class="line">instance1.colors.push(<span class="string">"black"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(instance1.colors); <span class="comment">// &gt; ["red", "blue", "green", "black"]</span></span><br><span class="line"><span class="keyword">let</span> instance2 = <span class="keyword">new</span> SubType();</span><br><span class="line"><span class="built_in">console</span>.log(instance2.colors); <span class="comment">// &gt; ["red", "blue", "green", "black"]</span></span><br></pre></td></tr></table></figure><p>缺点：</p><ul><li>原型链继承共享属性，属于引用类型，引用副本实例属性的修改必然会引起其他副本实例属性的修改</li><li>不能像父类构造函数随时传递参数，很不灵活</li></ul><p><strong>ES5实现继承 - 构造函数</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 借用构造函数继承 在执行Child构造函数时，将</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Parent</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.colors = [<span class="string">"red"</span>, <span class="string">"blue"</span>, <span class="string">"green"</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Child</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  Parent.call(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> instance3 = <span class="keyword">new</span> Child();</span><br><span class="line"><span class="built_in">console</span>.log(instance3); <span class="comment">// &gt; Child: &#123;colors: ["red", "blue", "green"]&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(instance3.colors); <span class="comment">// &gt; ["red", "blue", "green"]</span></span><br><span class="line">instance3.colors.push(<span class="string">"black"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(instance3.colors); <span class="comment">// &gt; ["red", "blue", "green", "black"]</span></span><br><span class="line"><span class="keyword">let</span> instance4 = <span class="keyword">new</span> Child();</span><br><span class="line"><span class="built_in">console</span>.log(instance4.colors); <span class="comment">// &gt; ["red", "blue", "green"]</span></span><br></pre></td></tr></table></figure><p>缺点：</p><ul><li>单独使用无法达到函数复用，因为每一个函数和属性都需要在构造函数中定义</li><li><code>instance of</code> 操作无法确定子类实例和父类之间的关系，因为子类的 <code>prototype</code> 和父类无关</li></ul><p><strong>ES6实现继承 - Class</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// class实现继承</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">  colors = [<span class="string">"red"</span>, <span class="string">"blue"</span>, <span class="string">"green"</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> instance5 = <span class="keyword">new</span> Child();</span><br><span class="line"><span class="built_in">console</span>.log(instance5); <span class="comment">// &gt; Child: &#123;colors: ["red", "blue", "green"]&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(instance5.colors); <span class="comment">// &gt; ["red", "blue", "green"]</span></span><br><span class="line">instance5.colors.push(<span class="string">"black"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(instance5); <span class="comment">// &gt; Child: &#123;colors: ["red", "blue", "green", "black"]&#125;</span></span><br><span class="line"><span class="keyword">let</span> instance6 = <span class="keyword">new</span> Child();</span><br><span class="line"><span class="built_in">console</span>.log(instance6.colors); <span class="comment">// &gt; ["red", "blue", "green"]</span></span><br></pre></td></tr></table></figure><h3 id="setTimeout、Promise、Async-Await-的区别"><a href="#setTimeout、Promise、Async-Await-的区别" class="headerlink" title="setTimeout、Promise、Async/Await 的区别"></a>setTimeout、Promise、Async/Await 的区别</h3><ul><li><code>setTimeout</code>：定时器，可以延迟执行，属于宏任务，在 <code>JavaScript</code> 事件循环中，执行优先度最低。</li><li><code>Promise</code>：微任务，本身是同步的立即执行函数，当在执行 <code>resolve</code> 或者 <code>reject</code> 的时候，此时是异步操作，会先执行 <code>then/catch</code> 等，当主栈完成后，才回去调用 <code>resolve/reject</code> 中存放的方法执行。</li><li><code>async/await</code>：微任务，<code>async</code> 函数返回一个 <code>Promise</code> 对象，当函数执行的时候，一旦遇到 <code>await</code> 就会先返回，等到触发的异步操作完成，再执行函数体内后面的语句。</li><li>执行任务优先级： <code>Promise</code> &gt; <code>await</code> &gt; <code>setTimeout</code></li></ul><div class="note warning"><p>更多的执行顺序，事件循环等详细，可查看 <a href="/archives/6f36c6d1.html">链接</a></p></div><h3 id="定时器的执行顺序或机制"><a href="#定时器的执行顺序或机制" class="headerlink" title="定时器的执行顺序或机制"></a>定时器的执行顺序或机制</h3><p>因为 <code>JS</code> 是单线程的，浏览器遇到 <code>setTimeout</code> 或者 <code>setInterval</code> 会先执行完当前的代码块（主(宏)任务），在此之前会把定时器（宏任务）推入浏览器的待执行事件队列里，等到浏览器执行完当前代码（主任务和微任务）之后，会看下事件队列里有没有宏任务，有的话才执行定时器代码。</p><div class="note warning"><p>即使把定时器的时间设置为0，还是会先执行主任务，把宏任务推入事件队列中。</p></div><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> testSet = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        a++;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"setInterval"</span>);</span><br><span class="line">        <span class="keyword">if</span> (a &lt; <span class="number">10</span>) &#123;</span><br><span class="line">            clearInterval(testSet);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="number">20</span>);</span><br><span class="line">    <span class="keyword">var</span> testSet1 = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"setTimeout"</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"test"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">test();</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// test</span></span><br><span class="line"><span class="comment">// test</span></span><br><span class="line"><span class="comment">// test</span></span><br><span class="line"><span class="comment">// setInterval</span></span><br><span class="line"><span class="comment">// setTimeout</span></span><br></pre></td></tr></table></figure><h3 id="‘1’-’2’-’3’-map-parseInt-输出"><a href="#‘1’-’2’-’3’-map-parseInt-输出" class="headerlink" title="[‘1’,’2’,’3’].map(parseInt) 输出"></a>[‘1’,’2’,’3’].map(parseInt) 输出</h3><p>本题主要考察 <code>map()</code> 函数的参数，和 <code>parseInt()</code> 方法的参数。</p><p><strong>答案</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// [1, NaN, NaN]</span></span><br></pre></td></tr></table></figure><p>数组的 <code>map()</code> 方法返回一个新数组，数组中的元素为原始数组元素调用函数处理后的值。</p><p><strong><code>map()</code>特性</strong></p><ul><li><code>map()</code> 方法按照原始数组元素顺序依次处理元素</li><li><code>map()</code> 方法不会对数组进行检测</li><li><code>map()</code> 方法不会改变原始数组</li></ul><p><strong><code>map()</code>语法</strong></p><p><code>array.map(function(currentValue, index, arr), thisValue)</code></p><ul><li><code>function(currentValue, index, arr)</code> 必须，函数。数组中的每个元素都会执行这个函数<ul><li><code>currentValue</code> 必须，当前元素的值</li><li><code>index</code> 可选，当前元素的索引值</li><li><code>arr</code> 可选，当前元素属于的数组对象</li></ul></li><li><code>thisValue</code> 可选。对象作为改执行回调时使用，传递给函数，用作 <code>this</code> 的值，如果省略，或者传入 <code>null</code>, <code>undefined</code>，那么回调函数的 <code>this</code> 为全局对象</li></ul><p>字符串方法 <code>parseInt()</code> 可解析一个字符串，返回一个整数。</p><p><strong><code>parseInt()</code>特性</strong></p><ul><li><code>parseInt()</code> 方法返回字符串中以第一个数字开始的连续数值字符</li><li><code>parseInt()</code> 方法开头和结尾的空格是允许的</li><li><code>parseInt()</code> 方法如果第一个非空字符不能转换为数字，那么返回 <code>NaN</code></li></ul><p><strong><code>pareseInt()</code>语法</strong></p><p><code>parseInt(string, radix)</code></p><ul><li><code>string</code> 必须，要被解析的字符串</li><li><code>radix</code> 可选，表示要解析的数字的基数（进制数），该值介于 <code>2~36</code> 之间<ul><li>如果省略该参数，或其值为0，则数字将以 10 为基数来解析</li><li>如果以 <code>0x</code>或 <code>0X</code> 开头，则数字将以 16 为基数来解析</li><li>如果该参数 小于 2 或者 大于 36，则 <code>parseInt()</code> 将返回 <code>NaN</code></li></ul></li></ul><p><strong>具体执行步骤：</strong></p><ol><li><code>parseInt(1, 0)</code>，基数参数的值为0，那么数字将以10进制解析，返回1</li><li><code>parseInt(2, 1)</code>，基数参数的值小于2，无法解析，返回 <code>NaN</code></li><li><code>parseInt(3, 2)</code>，基于参数表示2进制解析，但是3不在二进制（<code>0/1</code>）中，无法解析，返回 <code>NaN</code></li></ol><h3 id="Doctype-作用"><a href="#Doctype-作用" class="headerlink" title="Doctype 作用"></a>Doctype 作用</h3><p><code>Doctype</code> 声明文档的解析类型，避免浏览器的怪异模式，让浏览器渲染结果保持一致性。</p><ul><li>怪异模式： 浏览器使用自己的怪异模式来解析渲染页面（默认）</li><li>标准模式：浏览器使用W3C标准来解析渲染页面</li></ul><p><strong>特性</strong></p><ul><li>页面如果doctype声明，那么默认的渲染方式为浏览器自己的怪异模式</li><li><code>html5</code> 中使用 <code>&lt;!doctype html&gt;</code> 来声明文档解析类型</li><li>doctype声明不区分大小写</li></ul><h3 id="fetch-发送-2-次请求的原因"><a href="#fetch-发送-2-次请求的原因" class="headerlink" title="fetch 发送 2 次请求的原因"></a>fetch 发送 2 次请求的原因</h3><p>fetch 发送 post 请求的时候，总是发送2次，第一次状态码是 <code>204</code>，第二次才是真正的请求。原因为：</p><p>fetch的实现机制导致的结果。当发生跨域请求时，第一次发送一个 Options 请求，询问服务器是否允许接受请求，如果服务器支持，则在第二次中发送真正的请求（第二次自动发送）。</p><h3 id="TCP三次握手"><a href="#TCP三次握手" class="headerlink" title="TCP三次握手"></a>TCP三次握手</h3><p>三次握手之所以是3次，原因是3次是保证 服务器（server）和 客户端（client）均让对方知道自己的接受和发送能力没问题而保证的最小次数。</p><ol><li>第一次：client =&gt; server。server 知道 client 具备发送能力</li><li>第二次：server =&gt; client。client 知道 server 具备发送和接收能力。（此时 client 还需要让 server 知道自己接收能力没有问题，于是需要第三次）</li><li>第三次：client =&gt; server。server 知道 client 具备接收能力。</li></ol><p>以上服务端和客户端完成了三次握手，建立连接。需要注意的是在三次握手中，为了保证后续的握手是为了应答上一个握手，每次握手都会带一个标识 <code>seq</code>（连接数据包），后续的 <code>ACk</code>（应答数据包） 都会对这个 <code>seq</code> 进行加1来进行确认。</p><div class="note warning no-icon"><p>更多的关于HTTP三次握手和四次挥手详情，可见 <a href="/archives/19577025.html">链接</a></p></div><h3 id="Cookie、sessionStorage、localStorage-的区别"><a href="#Cookie、sessionStorage、localStorage-的区别" class="headerlink" title="Cookie、sessionStorage、localStorage 的区别"></a>Cookie、sessionStorage、localStorage 的区别</h3><p>共同点：都是保存在浏览器端，并且遵循同源策略。</p><p>不同点：</p><ol><li>数据与服务器之间的交互方式<ul><li>Cookie的数据始终在浏览器和服务端来回传递。</li><li>SessionStorage和LocalStorage不会自动把数据发给服务端，仅保存在本地。</li></ul></li><li>存储大小<ul><li>Cookie数据大小不能超过4K。</li><li>SessionStorage和LocalStorage虽然也有存储大小的限制，但比Cookie大得多，可以达到5M左右。</li></ul></li><li>有效时间<ul><li>Cookie的数据有效时间需要设置，与窗口或浏览器关闭无关。</li><li>SessionStorage的数据只保存在当前浏览器窗口，窗口关闭后自动删除。</li><li>LocalStorage的数据会持久存储，即使浏览器关闭后数据也不会丢失，除非主动删除。</li></ul></li></ol><div class="note warning no-icon"><p>更多的关于Cookie、sessionStorage、localStorage详情，可见 <a href="/archives/4fd295e0.html">链接</a></p></div><h3 id="Cookie-如何防范-XSS-攻击"><a href="#Cookie-如何防范-XSS-攻击" class="headerlink" title="Cookie 如何防范 XSS 攻击"></a>Cookie 如何防范 XSS 攻击</h3><p>XSS（跨站脚本攻击）是指攻击者在返回的HTML中嵌入JavaScript脚本，为了减轻这些攻击，需要在HTTP头部配上，Set-Cookie属性。</p><ul><li><code>secure</code>：这个属性告诉浏览器仅在请求为https的时候发送Cookie</li><li><code>httpOnly</code>：这个属性可以防止XSS，它会禁止JavaScript脚本来访问Cookie</li></ul><h3 id="浏览器和-Node-事件循环的区别"><a href="#浏览器和-Node-事件循环的区别" class="headerlink" title="浏览器和 Node 事件循环的区别"></a>浏览器和 Node 事件循环的区别</h3><ul><li>浏览器环境下，微任务的任务队列是每个宏任务执行完之后执行。</li><li>Node.js环境下，微任务会在事件循环的各个阶段执行，也就是说，每一个阶段执行完，就会去执行微任务队列中的任务。</li></ul><p>其中Promise属于为任务，浏览器和Node中对Promise的异步事件处理顺序就不一样。Node版本V11.0以上，这两者之间的顺序就相同了。</p><div class="note warning no-icon"><p>更多的关于浏览器、Node循环机制详情，可见 <a href="/archives/1e61d9e.html">链接</a></p></div><h3 id="HTTPS中间人攻击"><a href="#HTTPS中间人攻击" class="headerlink" title="HTTPS中间人攻击"></a>HTTPS中间人攻击</h3><p>HTTPS中间人攻击的原理就是劫持公钥，然后伪造公钥去获取传输的数据包。</p><p><strong>中间人攻击过程如下：</strong></p><ol><li>服务器向客户端发送公钥</li><li>攻击者自己生成一个伪造的公钥，发送给客户端</li><li>客户端收到伪造的公钥后，生成加密hash值发给服务器</li><li>攻击者获得加密hash值，用自己的私钥解密获取真密钥，同时生成假的加密hash值，发给服务器</li><li>服务器用私钥解密获得假的密钥，服务器用加密密钥加密传输信息</li></ol><p><strong>防范方法：</strong>服务端在发送浏览器的公钥中加入CA证书，浏览器可以验证CA证书的有效性</p><p><strong>HTTPS服务端和客户端交互流程：</strong></p><p><img data-src="../../assets/1453209832.png" alt=""></p><h3 id="前端优化策略"><a href="#前端优化策略" class="headerlink" title="前端优化策略"></a>前端优化策略</h3><ol><li>减少HTTP请求数</li><li>从设计实现层面简化页面</li><li>合理设置HTTP缓存</li><li>资源合并与压缩</li><li>CSS Sprites</li><li>懒加载图片</li></ol><div class="note warning no-icon"><p>更多的关于前端优化，可见 <a href="/archives/47836f53.html">链接</a></p></div><h3 id="重绘和回流"><a href="#重绘和回流" class="headerlink" title="重绘和回流"></a>重绘和回流</h3><p>重绘（Repaint）和回流（Reflow）是渲染步骤中的一小节，但是这两个步骤对于性能影响很大。</p><ul><li>重绘是当节点需要更改外观而不会影响布局的，比如改变 <code>color</code> 就叫做重绘。</li><li>回流是布局或者几何属性需要改变就称为回流。</li></ul><p>回流必定发生重绘，重绘不一定会引发回流。回流所需的成本比重绘高的多，改变深层次的节点很可能导致父节点的一系列回流。所以比如：改变 <code>window</code> 大小、改变字体、文字改变、定位或者浮动、盒模型等会导致性能问题。</p><p>很多人不知道，重绘和回流其实和 Event Loop 有关。当Event Loop执行完 Microtasks 后，会判断 document 是否需要更新。因为浏览器是60Hz的刷新率，每16ms才会更新一次，然后判断是否有 resize 或者 scroll 事件、判断是否触发了 media query、更新动画并发送事件、判断是否有全屏操作等最后更新界面。</p><p><strong>减少重绘和回流：</strong></p><ul><li>使用 <code>visibility</code> 替代 <code>display:none</code>，因为前者只会引起重绘，而后者会引发回流</li><li>不要使用 <code>table</code> 布局，因为很小的改动将会造成整个 <code>table</code> 的重新布局</li></ul><h3 id="Vue列表渲染Key"><a href="#Vue列表渲染Key" class="headerlink" title="Vue列表渲染Key"></a>Vue列表渲染Key</h3><p>Vue 和 React 都是采用 diff 算法来对比新旧虚拟节点，从而更新节点。其 diff 的原理为：</p><ul><li>两个相同的组件产生类似的 DOM 结构，不同的组件产生不同的 DOM 结构</li><li>同一层级的一组节点，他们可以通过唯一的 id 进行区分</li></ul><p>Key值的作用就是保证 diff 算法中能够正确识别节点、保证节点更新或节点插入时能够找到正确的位置区域去插入或者更新节点。总而言之，就是为了高效的更新虚拟DOM。</p><h3 id="为什么虚拟Dom会提高性能"><a href="#为什么虚拟Dom会提高性能" class="headerlink" title="为什么虚拟Dom会提高性能"></a>为什么虚拟Dom会提高性能</h3><p>虚拟DOM相当于在 js 和 真实 dom 中间加了一个缓存，利用 dom diff 算法避免了没有必要的 dom 操作，从而提高性能。具体实现步骤如下：</p><ol><li>利用 JavaScript 对象结构表示 DOM 树的结构，然后用这个树构建一个真正的DOM树，插入到文档当中</li><li>当状态变更的时候，重新构造一棵新的对象树，然后利用新的树和旧的树进行比较，记录两棵树的差异</li><li>把记录的差异应用到构建的真正的DOM树上，实现视图更新</li></ol><h3 id="清除浮动方式有哪些，哪种比较好"><a href="#清除浮动方式有哪些，哪种比较好" class="headerlink" title="清除浮动方式有哪些，哪种比较好"></a>清除浮动方式有哪些，哪种比较好</h3><p>常用的一般有三种：</p><ul><li><code>.clearfix</code></li><li><code>clear:both</code></li><li><code>overflow:hidden</code></li></ul><p>比较好的是 <code>.clearfix</code>。后两者具有局限性。</p><p><code>clear: both</code> 若是用在同一容器内相邻元素上，那是最好的。但是在容器外就造成相邻容器的包裹层元素塌陷。</p><p><code>overflow: hidden</code>若是用在容器中，可以形成 BFC，避免浮动造成的元素塌陷</p><h3 id="分析比较-opacity-0、visibility-hidden、display-none-优劣"><a href="#分析比较-opacity-0、visibility-hidden、display-none-优劣" class="headerlink" title="分析比较 opacity: 0、visibility: hidden、display: none 优劣"></a>分析比较 opacity: 0、visibility: hidden、display: none 优劣</h3><ul><li><code>display: none</code>：会让元素完全从渲染树中消失，渲染的时候不占据任何空间，不能点击。非继承属性。回流渲染，性能消耗较大。</li><li><code>visibility: hidden</code>：不会让元素从渲染树中消失，渲染元素继续占据空间，只是内容不可见，不能点击。继承属性。重绘渲染，性能消耗较小。</li><li><code>opacity: 0</code>：不会让元素从渲染树中消失，渲染元素继续占据空间，只是内容不可见，可以点击。非继承属性。重绘渲染，性能消耗较小。</li></ul><h3 id="Css-Sprite-是什么"><a href="#Css-Sprite-是什么" class="headerlink" title="Css Sprite 是什么"></a>Css Sprite 是什么</h3><p>图片精灵：将多个小图片拼接到一个图片中。通过 <code>background-position</code> 和元素尺寸调节需要显示的背景图案。</p><p><strong>优点：</strong></p><ul><li>减少 HTTP 请求数，极大地提高页面的加载速度</li><li>增加图片信息重复度，提高压缩比，减少图片大小</li></ul><p><strong>缺点：</strong></p><ul><li>图片合并麻烦</li><li>不易维护，修改一个图片可能需要重新布局整个图片和样式</li></ul><h3 id="Link与-import的区别"><a href="#Link与-import的区别" class="headerlink" title="Link与@import的区别"></a>Link与@import的区别</h3><ul><li><code>link</code> 是HTML方式，<code>@import</code> 是CSS方式</li><li><code>link</code> 最大限度支持并行下载，<code>@import</code> 过多嵌套导致串行下载</li><li><code>link</code> 可以通过 <code>rel=&quot;alternate stylesheet&quot;</code> 指定候选样式</li><li>浏览器对 <code>link</code> 支持早于 <code>@import</code>，可以使用 <code>@import</code> 对老浏览器隐藏样式</li><li><code>@import</code> 必须在样式规则之前，可以在css文件中引用其他文件</li></ul><h3 id="JS的四种设计模式"><a href="#JS的四种设计模式" class="headerlink" title="JS的四种设计模式"></a>JS的四种设计模式</h3><ul><li><strong>工厂模式</strong>：简单的工厂模式可以理解为解决多个相似的问题</li><li><strong>单例模式</strong>：只能被实例化（构造函数给实例添加属性和方法）一次</li><li><strong>沙箱模式</strong>：将一些函数放到自执行函数里面，但要用闭包暴露接口，用变量接收暴露的接口，再调用里面的值，否则无法使用里面的值</li><li><strong>发布者订阅模式</strong>：就例如我们关注某个公众号，然后他对应有新消息就会给你推送，代码实现逻辑是用数组存储订阅者，发布者回调函数里面通知的方式是遍历订阅者数组，并将发布者内容传入订阅者数组</li></ul><h3 id="下面代码输出什么1"><a href="#下面代码输出什么1" class="headerlink" title="下面代码输出什么1"></a>下面代码输出什么1</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="number">1</span>: <span class="string">"a"</span>, <span class="number">2</span>: <span class="string">"b"</span>, <span class="number">3</span>: <span class="string">"c"</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">set</span> = new Set([1, 2, 3, 4, 5]);</span><br><span class="line">obj.hasOwnProperty("1");</span><br><span class="line">obj.hanOwnProperty(1);</span><br><span class="line"><span class="keyword">set</span>.has("1");</span><br><span class="line"><span class="keyword">set</span>.has(1);</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="literal">true</span></span><br><span class="line"><span class="literal">true</span></span><br><span class="line"><span class="literal">false</span></span><br><span class="line"><span class="literal">true</span></span><br></pre></td></tr></table></figure><p>所有对象键（不包括Symbols）都会被存储为字符串，即使你没有给定字符串类型的键。这就是为什么 <code>obj.hasOwnProperty(&quot;1&quot;)</code> 也返回 <code>true</code>。上面的说法并不适用于 <code>Set</code>。在我们的 <code>Set</code> 中没有 <code>“1”</code>，<code>set.has(‘1’)</code> 返回 <code>false</code>，它有数字类型 <code>1</code>，<code>set.has(1)</code> 返回 <code>true</code></p><h3 id="下面代码输出什么2"><a href="#下面代码输出什么2" class="headerlink" title="下面代码输出什么2"></a>下面代码输出什么2</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// example 1</span></span><br><span class="line"><span class="keyword">var</span> a = &#123;&#125;, b = <span class="string">"123"</span>, c = <span class="number">123</span>;</span><br><span class="line">a[b] = <span class="string">"b"</span>; <span class="comment">// &lt;=&gt; a["123"] = "b";</span></span><br><span class="line">a[c] = <span class="string">"c"</span>; <span class="comment">// &lt;=&gt; a["123"] = "c";</span></span><br><span class="line"><span class="built_in">console</span>.log(a[b]); <span class="comment">// &gt; "c"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// example 2</span></span><br><span class="line"><span class="keyword">var</span> a = &#123;&#125;, b = <span class="built_in">Symbol</span>(<span class="string">"123"</span>), c = <span class="built_in">Symbol</span>(<span class="string">"123"</span>);</span><br><span class="line">a[b] = <span class="string">"b"</span>; <span class="comment">// b是Symbol类型，不转换</span></span><br><span class="line">a[c] = <span class="string">"c"</span>; <span class="comment">// c是Symbol类型，不转换</span></span><br><span class="line"><span class="built_in">console</span>.log(a[b]); <span class="comment">// &gt; "b"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// example 3</span></span><br><span class="line"><span class="keyword">var</span> a = &#123;&#125;, b = &#123;<span class="attr">key</span>: <span class="string">"123"</span>&#125;, c = &#123;<span class="attr">key</span>: <span class="string">"456"</span>&#125;;</span><br><span class="line">a[b] = <span class="string">"b"</span>; <span class="comment">// &lt;=&gt; a[object Object] = "b"</span></span><br><span class="line">a[c] = <span class="string">"c"</span>; <span class="comment">// &lt;=&gt; a[ojbect Object] = "c"</span></span><br><span class="line"><span class="built_in">console</span>.log(a[b]); <span class="comment">// &gt; "c"</span></span><br></pre></td></tr></table></figure><ul><li>对象的键名只能是字符串和 <code>Symbol</code> 类型</li><li>除了 <code>Symbol</code> 类型，其他类型的键名会自动转为字符串类型</li><li>对象转字符串默认会调用 <code>toString()</code> 方法</li></ul><!-- rebuild by neat -->]]></content>
      <categories>
        <category>面试</category>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>面试</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3TS教程-TpyeScript</title>
    <url>/archives/dc53bec9.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Vue3TS教程-TpyeScript-1。</p><a id="more"></a><h3 id="编程语言分类"><a href="#编程语言分类" class="headerlink" title="编程语言分类"></a>编程语言分类</h3><ul><li>动态类型语言（Dynamically Typed Language）<ul><li>在代码运行期间，才会做数据类型检查</li><li>弱类型语言</li><li>JavaScript、Python、Ruby</li></ul></li><li>静态类型语言（Statically Typed Language）<ul><li>数据类型检查发生在代码编译阶段（运行前)</li><li>强类型语言</li><li>C、C++、Java</li></ul></li></ul><div class="note warning no-icon"><ul><li>编译型语言<ul><li>对源代码进行编译，生成可以执行的二进制代码，执行的是编译后的结果</li><li>C、C++、Swift、Object-C</li></ul></li><li>解释型语言<ul><li>需要解释器载入脚本运行，由于每条语句都是执行的时候才进行解释翻译（成二进制），所以解释型语言执行效率要低些</li><li>JavaScript、Python、PHP、Ruby</li></ul></li></ul></div><h3 id="TypeScript优势"><a href="#TypeScript优势" class="headerlink" title="TypeScript优势"></a>TypeScript优势</h3><ul><li>程序更容易理解（代码本身即注释）</li><li>效率更高（配合IDE代码补全和提示）</li><li>更少的错误（编译阶段即可发生错误）</li><li>更好的兼容性（完全兼容JavaScript）</li></ul><h3 id="安装TypeScript"><a href="#安装TypeScript" class="headerlink" title="安装TypeScript"></a>安装TypeScript</h3><p>前提是本地已安装好：<strong>Node.js</strong> 和 <strong>NPM</strong>。</p><p>安装 <code>TypeScrip</code> ：</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm install -g typescript</span><br></pre></td></tr></table></figure><p>使用 <code>tsc</code> 全局命令：</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">// 查看 tsc 版本</span><br><span class="line">tsc -v</span><br><span class="line">// 编译 ts 文件</span><br><span class="line">tsc test.ts</span><br></pre></td></tr></table></figure><h3 id="原始数据类型"><a href="#原始数据类型" class="headerlink" title="原始数据类型"></a>原始数据类型</h3><ul><li><code>Boolean</code></li><li><code>Null</code></li><li><code>Undefined</code></li><li><code>Number</code></li><li><code>bigInt</code></li><li><code>String</code></li><li><code>Symbol</code></li></ul><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 布尔型</span></span><br><span class="line"><span class="keyword">let</span> isDone: <span class="built_in">boolean</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数字类型</span></span><br><span class="line"><span class="comment">// 支持2进制和8进制</span></span><br><span class="line"><span class="keyword">let</span> age: <span class="built_in">number</span> = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">let</span> binaryNumber: <span class="built_in">number</span> = <span class="number">0b11111</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 字符串类型</span></span><br><span class="line"><span class="keyword">let</span> firstName: <span class="built_in">string</span> = <span class="string">"devin"</span>;</span><br><span class="line"><span class="keyword">let</span> message: <span class="built_in">string</span> = <span class="string">`Hello, <span class="subst">$&#123;firstName&#125;</span>, age is <span class="subst">$&#123;age&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// undefined 和 null</span></span><br><span class="line"><span class="comment">// undefined 和 null是所有类型的子类型</span></span><br><span class="line"><span class="keyword">let</span> u: <span class="literal">undefined</span> = <span class="literal">undefined</span>;</span><br><span class="line"><span class="keyword">let</span> n: <span class="literal">null</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">let</span> num: <span class="built_in">number</span> = <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// bigint 和 symbol</span></span><br><span class="line"><span class="comment">// let bigNum: bigint = 100n; // ES2020以下不被支持</span></span><br><span class="line"><span class="comment">// let s: symbol = Symbol("id"); // ES2015以下不被支持</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 空值</span></span><br><span class="line"><span class="comment">// void表示没有任何返回值的函数</span></span><br><span class="line"><span class="keyword">let</span> consoleFun = (): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"consoleFun"</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="Any类型"><a href="#Any类型" class="headerlink" title="Any类型"></a>Any类型</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 任意值类型</span></span><br><span class="line"><span class="keyword">let</span> notSure: <span class="built_in">any</span> = <span class="number">4</span>;</span><br><span class="line">notSure = <span class="string">"maybe it is a string"</span>;</span><br><span class="line">notSure = <span class="string">"boolean"</span>;</span><br><span class="line"><span class="comment">// 在任意值上访问任何属性都是允许的</span></span><br><span class="line">notSure.myName;</span><br><span class="line"><span class="comment">// 也允许调用任何方法</span></span><br><span class="line">notSure.getName();</span><br></pre></td></tr></table></figure><h3 id="Array和Tuple"><a href="#Array和Tuple" class="headerlink" title="Array和Tuple"></a>Array和Tuple</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 数组类型，最简单的是使用 "类型 + []" 来表示数组，当然还有数组泛型表示法</span></span><br><span class="line"><span class="comment">// 数组的项中不允许出现其他的类型</span></span><br><span class="line"><span class="keyword">let</span> arrayOfNumber: <span class="built_in">number</span>[] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">arrayOfNumber.push(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 常规、数组泛型、接口表示数组</span></span><br><span class="line"><span class="keyword">const</span> a: <span class="built_in">number</span>[] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">const</span> b: <span class="built_in">Array</span>&lt;<span class="built_in">number</span>&gt; = [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line"><span class="keyword">interface</span> INumberArray &#123;</span><br><span class="line">  [index: <span class="built_in">number</span>]: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> c: INumberArray = [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 元组的表示和数组相似，只不过它将类型写在里面，对每一项起到了限制的作用，不能多不能少且类型必须对应</span></span><br><span class="line"><span class="keyword">let</span> user: [<span class="built_in">string</span>, <span class="built_in">number</span>] = [<span class="string">"Devin"</span>, <span class="number">20</span>];</span><br></pre></td></tr></table></figure><h3 id="Interface"><a href="#Interface" class="headerlink" title="Interface"></a>Interface</h3><p>Duck Typing 概念：</p><blockquote><p>如果某个东西长得像鸭子，像鸭子一样游泳，像鸭子一样嘎嘎叫，那它就可以被看成是一只鸭子。</p></blockquote><p>本质是利用接口实现多态，在 TypeScript 中主要有两种作用：</p><ol><li>当做一个接口，让类来实现，从而实现多态</li><li>当做一个“模板”，模板内可以包含number、string、function等，这样给实现了模板的对象动态增加属性</li></ol><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个接口</span></span><br><span class="line"><span class="keyword">interface</span> IPerson &#123;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">  age: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 定义变量，类型是IPerson,这样就约束了该变量的形状和接口必须和IPerson一致</span></span><br><span class="line"><span class="keyword">const</span> DEVIN: IPerson = &#123;</span><br><span class="line">  name: <span class="string">"devin"</span>,</span><br><span class="line">  age: <span class="number">20</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果需要不完全匹配，可以使用可选属性</span></span><br><span class="line"><span class="keyword">interface</span> IPersonNotDefine &#123;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">  age?: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> ZI_JUN: IPersonNotDefine = &#123;</span><br><span class="line">  name: <span class="string">"zi_jun"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果在对象中的字段只能在创建时被赋值，可以使用只读属性</span></span><br><span class="line"><span class="keyword">interface</span> IPersonReadOnly &#123;</span><br><span class="line">  readonly id: <span class="built_in">number</span>;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">  age?: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> DATA: IPersonReadOnly = &#123;</span><br><span class="line">  id: <span class="number">1</span>,</span><br><span class="line">  name: <span class="string">"data"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果在对象中新增其他为定义的属性，可以使用任意属性</span></span><br><span class="line"><span class="keyword">interface</span> IPersonAny &#123;</span><br><span class="line">  readonly id: <span class="built_in">number</span>;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">  age?: <span class="built_in">number</span>;</span><br><span class="line">  [name:<span class="built_in">string</span>]: <span class="built_in">any</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> anyPerson: IPersonAny = &#123;</span><br><span class="line">  id: <span class="number">2</span>,</span><br><span class="line">  name: <span class="string">"everyOne"</span>,</span><br><span class="line">  high: <span class="number">172</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认参数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addDefault</span>(<span class="params">x: <span class="built_in">number</span> = 1, y: <span class="built_in">number</span> = 2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可选参数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addNotFixed</span>(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span>, z?: <span class="built_in">number</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (z) &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y + z;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 剩余参数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addRest</span>(<span class="params">x: <span class="built_in">number</span> = 1, y: <span class="built_in">number</span> = 2, ...rest: <span class="built_in">number</span>[]</span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result: <span class="built_in">number</span> = x + y;</span><br><span class="line">  rest.forEach(<span class="function"><span class="params">item</span> =&gt;</span> result += item);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重载</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reverse</span>(<span class="params">x: <span class="built_in">number</span></span>): <span class="title">number</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reverse</span>(<span class="params">x: <span class="built_in">string</span></span>): <span class="title">string</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reverse</span>(<span class="params">x: <span class="built_in">string</span> | <span class="built_in">number</span></span>): <span class="title">number</span> | <span class="title">string</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> x === <span class="string">"number"</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Number</span>(x.toString().split(<span class="string">""</span>).reverse().join(<span class="string">""</span>));</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> x === <span class="string">"string"</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">String</span>(x.split(<span class="string">""</span>).reverse().join(<span class="string">""</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数本身的类型</span></span><br><span class="line"><span class="keyword">const</span> addNotFixedRe: <span class="function">(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span>, z?: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">number</span> = addNotFixed;</span><br><span class="line"></span><br><span class="line"><span class="comment">// interface描述函数类型</span></span><br><span class="line"><span class="keyword">interface</span> IAdd &#123;</span><br><span class="line">  (x: <span class="built_in">number</span>, y: <span class="built_in">number</span>, z?: <span class="built_in">number</span>): <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> addNotFixedOther: IAdd = addNotFixed;</span><br></pre></td></tr></table></figure><h3 id="类型推论"><a href="#类型推论" class="headerlink" title="类型推论"></a>类型推论</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 类型推论</span></span><br><span class="line"><span class="keyword">let</span> str = <span class="string">"hello"</span>; <span class="comment">// &lt;=&gt; let str: string = "hello";</span></span><br><span class="line"><span class="keyword">let</span> data; <span class="comment">// &lt;=&gt; let data: any;</span></span><br></pre></td></tr></table></figure><h3 id="联合类型"><a href="#联合类型" class="headerlink" title="联合类型"></a>联合类型</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 联合类型</span></span><br><span class="line"><span class="keyword">let</span> numberOrString: <span class="built_in">number</span> | <span class="built_in">string</span>;</span><br><span class="line"><span class="comment">// 联合类型只能访问联合类型中共有属性和方法</span></span><br><span class="line">numberOrString.toString();</span><br></pre></td></tr></table></figure><h3 id="类型断言"><a href="#类型断言" class="headerlink" title="类型断言"></a>类型断言</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 类型断言</span></span><br><span class="line"><span class="comment">// 使用 as 关键字选择联合类型中的某种类型</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getLength</span>(<span class="params">input: <span class="built_in">string</span> | <span class="built_in">number</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> str: <span class="built_in">string</span> = input <span class="keyword">as</span> <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">if</span> (str.length) &#123;</span><br><span class="line">    <span class="keyword">return</span> str.length;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> num: <span class="built_in">number</span> = input <span class="keyword">as</span> <span class="built_in">number</span>;</span><br><span class="line">    <span class="keyword">return</span>  num.toString().length;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="类型守卫"><a href="#类型守卫" class="headerlink" title="类型守卫"></a>类型守卫</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 利用类型判断（typeof instanceof）在不同条件分支里，做对应的类型处理</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getLength</span>(<span class="params">input: <span class="built_in">string</span> | <span class="built_in">number</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> input === <span class="string">"string"</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> input.length;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> input.toString().length;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Class类"><a href="#Class类" class="headerlink" title="Class类"></a>Class类</h3><p>面向对象编程的三大特点:</p><ul><li><strong>封装。</strong>将对数据的操作细节隐藏起来，只暴露对外的接口。外界调用端不需要也不可能知道细节，就能通过对外提供的接口来访问该对象。</li><li><strong>继承。</strong>子类继承父类，子类除了拥有父类的所有特性（属性和方法）外，还有一些更具体的特性。</li><li><strong>多态。</strong>由继承而产生了相关的不同的类，对同一个方法可以有不同的响应。</li></ul><p>类成员访问修饰符：</p><ul><li><code>public</code> 修饰的属性或方法是公有的，可以在任何地方被访问到，默认所有的属性和方法是公有的</li><li><code>private</code> 修饰的属性或方法是私有的，不能在声明它的类的外部访问，也不能在子类访问</li><li><code>protected</code> 修饰的属性或方法是受保护的，它和 <code>private</code> 类似，区别是它在子类中是允许被访问的</li></ul><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义类</span></span><br><span class="line"><span class="keyword">class</span> Animal &#123;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">  &#125;;</span><br><span class="line">  run(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> is running`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> snake: Animal = <span class="keyword">new</span> Animal(<span class="string">"lily"</span>);</span><br><span class="line">snake.run(); <span class="comment">// =&gt; lily is running</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 类的继承</span></span><br><span class="line"><span class="keyword">class</span> Dog <span class="keyword">extends</span> Animal &#123;</span><br><span class="line">  back() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> is barking`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> dog: Dog = <span class="keyword">new</span> Dog(<span class="string">"Amy"</span>);</span><br><span class="line">dog.run(); <span class="comment">// =&gt; Amy is running</span></span><br><span class="line">dog.back(); <span class="comment">// =&gt; Amy is barking</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写构造函数</span></span><br><span class="line"><span class="comment">// 子类在构造函数中，必须使用 super 调用父类的方法</span></span><br><span class="line"><span class="keyword">class</span> Cat <span class="keyword">extends</span> Animal &#123;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="keyword">super</span>(name);</span><br><span class="line">    <span class="keyword">this</span>.name = <span class="string">`Animal <span class="subst">$&#123;name&#125;</span>`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  run() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`Haha, <span class="subst">$&#123;<span class="keyword">super</span>.run()&#125;</span>`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> cat: Cat = <span class="keyword">new</span> Cat(<span class="string">"Lisa"</span>);</span><br><span class="line">cat.run(); <span class="comment">// =&gt; Haha, Animal Lisa is running</span></span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义类</span></span><br><span class="line"><span class="comment">// protected修饰的属性不能在外部访问，但是可以在子类访问</span></span><br><span class="line"><span class="keyword">class</span> Animal &#123;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">protected</span> age: <span class="built_in">number</span>;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">name: <span class="built_in">string</span>, agent: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">  &#125;;</span><br><span class="line">  run(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> is running`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> snake: Animal = <span class="keyword">new</span> Animal(<span class="string">"lily"</span>, <span class="number">10</span>);</span><br><span class="line"><span class="built_in">console</span>.log(snake.name); <span class="comment">// &gt; lily</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Dog <span class="keyword">extends</span> Animal &#123;</span><br><span class="line">  age: <span class="built_in">number</span>;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">name: <span class="built_in">string</span>, age: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="keyword">super</span>(name, age);</span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> dog: Dog = <span class="keyword">new</span> Dog(<span class="string">"lei"</span>, <span class="number">20</span>);</span><br><span class="line"><span class="built_in">console</span>.log(dog.age); <span class="comment">// &gt; 20</span></span><br></pre></td></tr></table></figure><h3 id="类与接口"><a href="#类与接口" class="headerlink" title="类与接口"></a>类与接口</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义接口</span></span><br><span class="line"><span class="keyword">interface</span> IRadio &#123;</span><br><span class="line">  switchRadio(trigger: <span class="built_in">boolean</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类实现接口,实现多态</span></span><br><span class="line"><span class="keyword">class</span> Car <span class="keyword">implements</span> IRadio &#123;</span><br><span class="line">  <span class="keyword">public</span> switchRadio(trigger: <span class="built_in">boolean</span>): <span class="built_in">void</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类实现接口,实现多态</span></span><br><span class="line"><span class="keyword">class</span> CellPhone <span class="keyword">implements</span> IRadio &#123;</span><br><span class="line">  <span class="keyword">public</span> switchRadio(trigger: <span class="built_in">boolean</span>): <span class="built_in">void</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 以下实现类实现多个接口，实现多态 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 方式一：实现多个接口，在类上处理 */</span></span><br><span class="line"><span class="keyword">interface</span> IBattery &#123;</span><br><span class="line">  checkBatteryStatus(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> Phone <span class="keyword">implements</span> IRadio, IBattery &#123;</span><br><span class="line">  <span class="keyword">public</span> switchRadio(trigger: <span class="built_in">boolean</span>): <span class="built_in">void</span> &#123;&#125;</span><br><span class="line">  <span class="keyword">public</span> checkBatteryStatus(): <span class="built_in">void</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 方式二：实现多个接口，在接口上处理 */</span></span><br><span class="line"><span class="keyword">interface</span> IBattery <span class="keyword">extends</span> IRadio &#123;</span><br><span class="line">  checkBatteryStatus(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> PhoneWithBattery <span class="keyword">implements</span> IBattery &#123;</span><br><span class="line">  <span class="keyword">public</span> switchRadio(trigger: <span class="built_in">boolean</span>): <span class="built_in">void</span> &#123;&#125;</span><br><span class="line">  <span class="keyword">public</span> checkBatteryStatus(): <span class="built_in">void</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Enums枚举"><a href="#Enums枚举" class="headerlink" title="Enums枚举"></a>Enums枚举</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 枚举，定义取值为已限定的内容，默认从0开始赋值，也可以为字符串可以反向映射</span></span><br><span class="line"><span class="keyword">enum</span> Direction &#123;</span><br><span class="line">  Up,</span><br><span class="line">  Down,</span><br><span class="line">  Left,</span><br><span class="line">  Right</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(Direction.Up); <span class="comment">// &gt; 0</span></span><br><span class="line"><span class="built_in">console</span>.log(Direction[<span class="number">1</span>]); <span class="comment">// &gt; "Down"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 常量枚举,在编译阶段被删除，性能高，但是不能反向映射</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">enum</span> DirectionStr &#123;</span><br><span class="line">  Up = <span class="string">"UP"</span> ,</span><br><span class="line">  Down = <span class="string">"DOWN"</span>,</span><br><span class="line">  Left = <span class="string">"LEFT"</span>,</span><br><span class="line">  Right = <span class="string">"RIGHT"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(DirectionStr[<span class="string">"Left"</span>]); <span class="comment">// &gt; "LEFT"</span></span><br></pre></td></tr></table></figure><h3 id="Generics泛型"><a href="#Generics泛型" class="headerlink" title="Generics泛型"></a>Generics泛型</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 泛型，在定义函数、接口、类时，相当占位符或参数，使用时才指定类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果不指定类型，则传入类型为any,返回类型也为any</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">echo</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> arg;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> result = echo(<span class="number">123</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义泛型函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">echoGenerics</span>&lt;<span class="title">T</span>&gt;(<span class="params">arg: T</span>): <span class="title">T</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> arg;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> resultGen: <span class="built_in">number</span> = echoGenerics(<span class="number">123</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义泛型函数，泛型多个值</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">swap</span>&lt;<span class="title">T</span>, <span class="title">U</span>&gt;(<span class="params">tuple: [T,  U]</span>): [<span class="title">U</span>, <span class="title">T</span>] </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [tuple[<span class="number">1</span>], tuple[<span class="number">0</span>]];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> resultSwap: [<span class="built_in">number</span>, <span class="built_in">string</span>] = swap([<span class="string">"string"</span>, <span class="number">123</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义泛型接口，函数泛型约束</span></span><br><span class="line"><span class="keyword">interface</span> ILength &#123;</span><br><span class="line">  length: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getLength</span>&lt;<span class="title">T</span> <span class="title">extends</span> <span class="title">ILength</span>&gt;(<span class="params">arg: T</span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> arg.length;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(getLength([<span class="number">1</span>, <span class="number">2</span>])); <span class="comment">// &gt; 2</span></span><br><span class="line"><span class="built_in">console</span>.log(getLength(<span class="string">"hello"</span>)); <span class="comment">// &gt; 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义泛型类</span></span><br><span class="line"><span class="keyword">class</span> Person&lt;T&gt; &#123;</span><br><span class="line">  <span class="keyword">public</span> name: T;</span><br><span class="line">  sayHi: <span class="function">(<span class="params">name: T, age: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">string</span> = (name: T,  age: <span class="built_in">number</span>): <span class="function"><span class="params">string</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`Hello, my name is <span class="subst">$&#123;name&#125;</span>, age is <span class="subst">$&#123;age&#125;</span>`</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> Lily: Person&lt;<span class="built_in">number</span>&gt; = <span class="keyword">new</span> Person&lt;<span class="built_in">number</span>&gt;();</span><br><span class="line"><span class="built_in">console</span>.log(Lily.name); <span class="comment">// &gt; undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(Lily.sayHi(<span class="number">10</span>,<span class="number">11</span>)); <span class="comment">// &gt; Hello, my name is 10, age is 11</span></span><br><span class="line"><span class="built_in">console</span>.log(Lily.name); <span class="comment">// &gt; 10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Amy: Person&lt;<span class="built_in">string</span>&gt; = <span class="keyword">new</span> Person&lt;<span class="built_in">string</span>&gt;();</span><br><span class="line"><span class="built_in">console</span>.log(Amy.name); <span class="comment">// &gt; undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(Amy.sayHi(<span class="string">"Amy"</span>, <span class="number">20</span>)); <span class="comment">// &gt; Hello, my name is Amy, age is 20</span></span><br><span class="line"><span class="built_in">console</span>.log(Amy.name); <span class="comment">// &gt; Amy</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义泛型接口，类实现</span></span><br><span class="line"><span class="keyword">interface</span> IPerson&lt;T&gt; &#123;</span><br><span class="line">  sayHi(name: T, age: <span class="built_in">number</span>): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> PersonClass&lt;T&gt; <span class="keyword">implements</span> IPerson&lt;T&gt; &#123;</span><br><span class="line">  sayHi(name: T,  age: <span class="built_in">number</span>): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`Hello, my name is <span class="subst">$&#123;name&#125;</span>, age is <span class="subst">$&#123;age&#125;</span>`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> Lei: PersonClass&lt;<span class="built_in">string</span>&gt; = <span class="keyword">new</span> PersonClass();</span><br><span class="line"><span class="built_in">console</span>.log(Lei.sayHi(<span class="string">"Lei"</span>, <span class="number">20</span>)); <span class="comment">// &gt; Hello, my name is Lei, age is 20</span></span><br></pre></td></tr></table></figure><h3 id="type类型别名"><a href="#type类型别名" class="headerlink" title="type类型别名"></a>type类型别名</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取姓名，普通写法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getName</span>(<span class="params">n: <span class="built_in">string</span> | (() =&gt; <span class="built_in">string</span>)</span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> n === <span class="string">"string"</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> n;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> n();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取姓名，类型别名</span></span><br><span class="line"><span class="keyword">type</span> Name = <span class="built_in">string</span>;</span><br><span class="line"><span class="keyword">type</span> NameResolver = <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">string</span>;</span><br><span class="line"><span class="keyword">type</span> NameType = Name | NameResolver;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getNameByType</span>(<span class="params">n: NameType</span>): <span class="title">Name</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> n === <span class="string">"string"</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> n;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> n();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 交叉类型</span></span><br><span class="line"><span class="keyword">interface</span> IName &#123;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> IPerson = IName &amp; &#123; age: <span class="built_in">number</span> &#125;;</span><br><span class="line"><span class="keyword">let</span> Lei: IPerson = &#123; name: <span class="string">"Lei"</span>, age: <span class="number">20</span> &#125;;</span><br></pre></td></tr></table></figure><h3 id="declare声明文件"><a href="#declare声明文件" class="headerlink" title="declare声明文件"></a>declare声明文件</h3><ul><li><code>declare var</code> / <code>declare let</code> / <code>declare const</code> 声明全局变量</li><li><code>declare function</code> 声明全局方法</li><li><code>declare class</code> 声明全局类</li><li><code>declare enum</code> 声明全局枚举类型</li><li><code>declare namespace</code> 声明（含有子属性的）全局对象</li></ul><h3 id="内置对象"><a href="#内置对象" class="headerlink" title="内置对象"></a>内置对象</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> b: <span class="built_in">Boolean</span> = <span class="keyword">new</span> <span class="built_in">Boolean</span>(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">let</span> e: <span class="built_in">Error</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"error"</span>);</span><br><span class="line"><span class="keyword">let</span> d: <span class="built_in">Date</span> = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"><span class="keyword">let</span> r: <span class="built_in">RegExp</span> = <span class="regexp">/[a-z]/</span>;</span><br><span class="line"><span class="keyword">let</span> body: HTMLElement = <span class="built_in">document</span>.body;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Partial、Omit功能性类型</span></span><br><span class="line"><span class="keyword">interface</span> IPerson &#123;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">  age: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> Lei: IPerson = &#123; name: <span class="string">"Lei"</span>, age: <span class="number">20</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Partial 可以把传入的类型都变成可选</span></span><br><span class="line"><span class="keyword">type</span> IPartialPerson = Partial&lt;IPerson&gt;;</span><br><span class="line"><span class="keyword">let</span> Amy: IPartialPerson = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Omit 可以忽略传入类型的某个属性</span></span><br><span class="line"><span class="keyword">type</span> IOmitPerson = Omit&lt;IPerson, <span class="string">"name"</span>&gt;;</span><br><span class="line"><span class="keyword">let</span> Han: IOmitPerson = &#123; age: <span class="number">30</span> &#125;;</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Vue</category>
        <category>Vue3教程</category>
      </categories>
      <tags>
        <tag>TypeScript</tag>
        <tag>Vue3</tag>
      </tags>
  </entry>
  <entry>
    <title>前端正则-正则基础</title>
    <url>/archives/bfcd137d.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录正则表达式的基础。</p><a id="more"></a><h2 id="什么是正则表达式"><a href="#什么是正则表达式" class="headerlink" title="什么是正则表达式"></a>什么是正则表达式</h2><p>正则表达式就是处理字符串的，也可以用它来处理一些复杂的字符串。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 找出这个字符串中的所有数字</span></span><br><span class="line"><span class="keyword">const</span> str = <span class="string">'abc123de45fgh6789ijk0'</span>;</span><br><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/\d+/g</span></span><br><span class="line"><span class="built_in">console</span>.log(str.match(reg)); <span class="comment">// &gt; ["123", "45", "6789", "0"]</span></span><br></pre></td></tr></table></figure><h2 id="正则表达式的创建方式"><a href="#正则表达式的创建方式" class="headerlink" title="正则表达式的创建方式"></a>正则表达式的创建方式</h2><p>创建正则表达式有两种方式：</p><ul><li>字面量创建方式（常用方式）： <code>const reg = /pattern/flags;</code></li><li>实例创建方式: <code>const reg = new RegExp(parttern, flags);</code></li></ul><p>其中 <code>pattern</code> 为正则表达式，<code>flags</code> 为标识（修饰符）。</p><p>其中修饰符有3中：</p><ul><li><code>i</code>: 忽略大小写匹配</li><li><code>g</code>: 全局匹配，应用于所有字符串，而非在找到第一个匹配项时停止</li><li><code>m</code>: 多行匹配，到达一行文本末尾时不停止，继续下一行匹配</li></ul><h2 id="元字符"><a href="#元字符" class="headerlink" title="元字符"></a>元字符</h2><p><strong>代表特殊含义的元字符</strong></p><ul><li><code>\d</code>: 0-9之间的任意数字，<code>\d</code>只占一个位置</li><li><code>\w</code>: 数字，字母，下划线 0-9，a-z，A-Z</li><li><code>\s</code>: 空格或者空白</li><li><code>\D</code>: 除了数字</li><li><code>\W</code>: 除了数字，除了字母，除了下划线</li><li><code>\S</code>: 除了空格，除了空白</li><li><code>\n</code>: 匹配换行符</li><li><code>.</code>: 处理换行符的任意一个字符</li><li><code>\</code>: 转义字符</li><li><code>|</code>: 或者</li><li><code>()</code>: 分组</li><li><code>^</code>: 限定开始位置，本身不占用位置</li><li><code>$</code>: 限定结束位置，本身不占位置</li><li><code>[a-z]</code>: 任意字母，<code>[]</code>表示任意一个</li><li><code>[^a-z]</code>: 非字母， <code>[]</code> 中 <code>^</code>表示除了</li><li><code>[abc]</code>: abc三个字母中的任何一个</li><li><code>[^abc]</code>: 除了abc这三个字母中的任何一个字符</li></ul><p><strong>代表次数的量词元字符</strong></p><ul><li><code>*</code>: 0到多个</li><li><code>+</code>: 1到多个</li><li><code>?</code>: 0次或者1次，可有可无</li><li><code>{n}</code>: 正好n次</li><li><code>{n,}</code>: n到多次</li><li><code>{n, m}</code>: n到m次</li></ul><div class="note warning no-icon"><ul><li>量词出现在元字符后面，如 <code>\d+</code>， 表示限定出现在前面的元字符的次数</li><li>一般 <code>[]</code> 中的字符没有特殊含义</li><li><code>()</code>具有提高优先级的功能，凡是有 <code>|</code> 出现的时候，我们一定需要 <code>()</code> 来提高优先级</li></ul></div><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> str = <span class="string">'1223334444'</span>;</span><br><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/\d&#123;2&#125;/g</span>; <span class="comment">// 限定元字符的量级</span></span><br><span class="line"><span class="keyword">const</span> res = str.match(reg);</span><br><span class="line"><span class="built_in">console</span>.log(res); <span class="comment">// &gt; ["12", "23", "33", "44", "44"]</span></span><br><span class="line"><span class="keyword">const</span> str2 = <span class="string">'  我这里是空格  '</span>;</span><br><span class="line"><span class="keyword">const</span> reg2 = <span class="regexp">/^\s+|\s+$/g</span>;</span><br><span class="line"><span class="keyword">const</span> res2 = str2.replace(reg2, <span class="string">''</span>);</span><br><span class="line"><span class="built_in">console</span>.log(res2); <span class="comment">// &gt; 我这里是空格</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 一般[]中的字符没有特殊含义</span></span><br><span class="line"><span class="keyword">const</span> str1 = <span class="string">'abc'</span>;</span><br><span class="line"><span class="keyword">const</span> str2 = <span class="string">'dbc'</span>;</span><br><span class="line"><span class="keyword">const</span> str3 = <span class="string">'.bc'</span>;</span><br><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/[ab.]bc/</span>;</span><br><span class="line"><span class="built_in">console</span>.log(reg.test(str1)); <span class="comment">// &gt; true</span></span><br><span class="line"><span class="built_in">console</span>.log(reg.test(str2)); <span class="comment">// &gt; false</span></span><br><span class="line"><span class="built_in">console</span>.log(reg.test(str3)); <span class="comment">// &gt; true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 匹配18-65年龄段</span></span><br><span class="line"><span class="keyword">const</span> reg2 = <span class="regexp">/(18|19)|[2-5]\d|6[0-5]/</span>;</span><br><span class="line"><span class="built_in">console</span>.log(reg2.test(<span class="number">66</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ()提高优先级</span></span><br><span class="line"><span class="keyword">const</span> str = <span class="string">'aaabbb'</span>;</span><br><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/(a+)(?:b+)/</span>;</span><br><span class="line"><span class="keyword">const</span> res = str.match(reg);</span><br><span class="line"><span class="built_in">console</span>.log(res); <span class="comment">// &gt; ["aaabbb", "aaa", index: 0, input: "aaabbb", groups: undefined]</span></span><br></pre></td></tr></table></figure><h2 id="正则的特性"><a href="#正则的特性" class="headerlink" title="正则的特性"></a>正则的特性</h2><ul><li>贪婪性：所谓的贪婪性就是正则在捕获时，每一次会尽可能多的去捕获符合条件的内容。如果我们想尽可能的少去捕获符合条件的字符串的话，可以在量词元字符后加 <code>?</code></li><li>懒惰性：懒惰性则是正则在成功捕获一次后不管后面的字符串有没有符合条件的，都不再捕获。如果要捕获目标中所有符合条件的字符串，可以用标识符 <code>g</code> 标明全局捕获</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> str = <span class="string">'123aa456'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/\d+/</span>; <span class="comment">// 懒惰性：只捕获一次，贪婪性：一次尽可能多的捕获</span></span><br><span class="line"><span class="keyword">const</span> res = str.match(reg);</span><br><span class="line"><span class="built_in">console</span>.log(res); <span class="comment">// &gt; ["123", index: 0, input: "123aa456", groups: undefined]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reg2 = <span class="regexp">/\d+/g</span>; <span class="comment">// 解决懒惰性，但有贪婪性</span></span><br><span class="line"><span class="keyword">const</span> res2 = str.match(reg2);</span><br><span class="line"><span class="built_in">console</span>.log(res2); <span class="comment">// &gt; ["123", "456"]</span></span><br><span class="line"><span class="keyword">const</span> reg3 = <span class="regexp">/\d+?/</span>; <span class="comment">// 解决贪婪性，但有懒惰性</span></span><br><span class="line"><span class="keyword">const</span> res3 = str.match(reg3);</span><br><span class="line"><span class="built_in">console</span>.log(res3); <span class="comment">// &gt; ["1", index: 0, input: "123aa456", groups: undefined]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reg4 = <span class="regexp">/\d+?/g</span>; <span class="comment">// 解决贪婪性、懒惰性</span></span><br><span class="line"><span class="keyword">const</span> res4 = str.match(reg4);</span><br><span class="line"><span class="built_in">console</span>.log(res4); <span class="comment">// &gt; ["1", "2", "3", "4", "5", "6"]</span></span><br></pre></td></tr></table></figure><h2 id="正则的相关方法"><a href="#正则的相关方法" class="headerlink" title="正则的相关方法"></a>正则的相关方法</h2><ol><li><code>reg.test(str)</code>: 验证字符串是否符合正则，符合返回 <code>true</code>， 否则返回 <code>false</code></li><li><code>reg.exec(str)</code>: 用来捕获符合规则的字符串</li><li><code>str.match(reg)</code>: 如果匹配成功，就返回匹配成功的数组，如果匹配不成功，就返 <code>null</code></li><li><code>str.replace(reg)</code>: 替换字符串</li></ol><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// reg.test(str)</span></span><br><span class="line"><span class="keyword">const</span> str = <span class="string">'abc'</span>;</span><br><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/\w+/</span>;</span><br><span class="line"><span class="built_in">console</span>.log(reg.test(str)); <span class="comment">// &gt; true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// reg.exec(str)</span></span><br><span class="line"><span class="keyword">const</span> str = <span class="string">'abc123cba456aaa789'</span>;</span><br><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/\d+/</span>;</span><br><span class="line"><span class="built_in">console</span>.log(reg.exec(str)); <span class="comment">// &gt; ["123", index: 3, input: "abc123cba456aaa789", groups: undefined]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// str.match(reg)</span></span><br><span class="line"><span class="keyword">const</span> str = <span class="string">'abc123cba456aaa789'</span>;</span><br><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/\d+/g</span>;</span><br><span class="line"><span class="built_in">console</span>.log(str.match(reg)); <span class="comment">// &gt; ["123", "456", "789"]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// str.replace(reg)</span></span><br><span class="line"><span class="keyword">const</span> str = <span class="string">'a111bc222de'</span>;</span><br><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/\d+/g</span>;</span><br><span class="line"><span class="keyword">const</span> reg2 = <span class="regexp">/\d/g</span>;</span><br><span class="line"><span class="keyword">const</span> res = str.replace(reg, <span class="string">'?'</span>);</span><br><span class="line"><span class="keyword">const</span> res2 = str.replace(reg2, <span class="string">'?'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(res); <span class="comment">// &gt; a?bc?de</span></span><br><span class="line"><span class="built_in">console</span>.log(res2); <span class="comment">// &gt; a???bc???de</span></span><br></pre></td></tr></table></figure><h2 id="零宽断言"><a href="#零宽断言" class="headerlink" title="零宽断言"></a>零宽断言</h2><p>用于查找在某些内容（但不包括这些内容）之前或之后的东西，这个位置应该满足一定的条件（即断言），因此也被称为零宽断言。</p><ul><li>零宽度正预测先行断言 <code>(?=exp)</code> 字符出现的位置的右边必须匹配到exp这个表达式</li><li>零宽读负预测先行断言 <code>(?!exp)</code> 字符出现的位置的右边不能是exp这个表达式</li><li>零宽度正回顾后发断言 <code>(?&lt;=exp)</code> 字符出现的位置的前边是exp这个表达式</li><li>零宽度负回顾后发断言 `(? 字符出现的位置的前边不是exp这个表达式</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// (?=exp)</span></span><br><span class="line"><span class="keyword">const</span> str = <span class="string">"i'm singing and dancing"</span>;</span><br><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/\w+(?=ing)/g</span>;</span><br><span class="line"><span class="keyword">const</span> res = str.match(reg);</span><br><span class="line"><span class="built_in">console</span>.log(res); <span class="comment">// &gt; ["sing", "danc"]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// (?!exp)</span></span><br><span class="line"><span class="keyword">const</span> str2 = <span class="string">'nodejs'</span>;</span><br><span class="line"><span class="keyword">const</span> reg2 = <span class="regexp">/node(?!js)/g</span>;</span><br><span class="line"><span class="built_in">console</span>.log(reg2.test(str2)); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// (?&lt;=exp) </span></span><br><span class="line"><span class="keyword">const</span> str3 = <span class="string">'￥998$888'</span>;</span><br><span class="line"><span class="keyword">const</span> reg3 = <span class="regexp">/(?&lt;=\$)\d+/g</span>;</span><br><span class="line"><span class="built_in">console</span>.log(str3.match(reg3)); <span class="comment">// &gt; ["888"]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// (?&lt;!exp)</span></span><br><span class="line"><span class="keyword">const</span> str4 = <span class="string">'￥998$888'</span>;</span><br><span class="line"><span class="keyword">const</span> reg4 = <span class="regexp">/(?&lt;!\$)\d+/g</span>;</span><br><span class="line"><span class="built_in">console</span>.log(str4.match(reg4)); <span class="comment">// &gt; ["998", "88"]</span></span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
      <categories>
        <category>前端</category>
        <category>JavaScript</category>
        <category>正则</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>正则</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript进阶-高阶函数</title>
    <url>/archives/af81bd5c.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录JavaScript中的一个少说但是实际经常使用的名词 - 高阶函数。</p><a id="more"></a><h2 id="什么是高阶函数"><a href="#什么是高阶函数" class="headerlink" title="什么是高阶函数"></a>什么是高阶函数</h2><p>参数或是返回值为函数的函数，就称为<strong>高阶函数</strong>。</p><p>换言之，至少满足以下条件之一的函数，都可以成为高阶函数：</p><ol><li>函数可以作为参数被传递</li><li>函数可以作为返回值输出</li></ol><p>常见的高阶函数有：<code>reduce</code>、<code>map</code> 、<code>filter</code>、<code>sort</code>、<code>setTimeout</code>、事件（<code>window.addEventListener(&quot;load&quot;, () =&gt; {})</code>） 等函数。</p><h3 id="Function参数"><a href="#Function参数" class="headerlink" title="Function参数"></a>Function参数</h3><p>先看一下函数参数的用法，最经典的案例就是 <code>Array#map</code>。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> newArr = arr.map(<span class="function"><span class="params">item</span> =&gt;</span> item + <span class="number">1</span>);</span><br><span class="line"><span class="built_in">console</span>.log(newArr); <span class="comment">// &gt; [2, 3, 4]</span></span><br></pre></td></tr></table></figure><h3 id="Function返回值"><a href="#Function返回值" class="headerlink" title="Function返回值"></a>Function返回值</h3><p>返回值是函数的函数，我们也经常使用，最著名的就是 <code>Function#bind</code>。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayHello</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`Hello, <span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Function</span>.prototype.myBind = <span class="function"><span class="keyword">function</span>(<span class="params">context, ...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> func = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> func.call(context, ...args, ...arguments);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> helloD = sayHello.myBind(&#123;<span class="attr">name</span>: <span class="string">'Devin'</span>&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(helloD()); <span class="comment">// &gt; Hello, Devin</span></span><br></pre></td></tr></table></figure><h3 id="函数柯里化"><a href="#函数柯里化" class="headerlink" title="函数柯里化"></a>函数柯里化</h3><p>柯里化，就是先给原始函数传入几个参数，他会生成一个新的函数，然后让新的函数去处理接下来的参数。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 普通的add函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 柯里化</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curryAdd</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">y</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x + y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">add(<span class="number">1</span>, <span class="number">2</span>); <span class="comment">// =&gt; 3</span></span><br><span class="line">curryAdd(<span class="number">1</span>)(<span class="number">2</span>); <span class="comment">// =&gt; 3</span></span><br></pre></td></tr></table></figure><p>实际上就是把 <code>add</code> 函数的 <code>x, y</code> 两个参数变成了先用一个函数接受 <code>x</code>，然后返回一个函数去处理 <code>y</code> 参数。</p><h3 id="经典面试题"><a href="#经典面试题" class="headerlink" title="经典面试题"></a>经典面试题</h3><p>实现一个 <code>add</code> 方法，使计算结果能够满足如下预期：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">add(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>); <span class="comment">// =&gt; 6</span></span><br><span class="line">add(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)(<span class="number">4</span>); <span class="comment">// =&gt; 10</span></span><br><span class="line">add(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>)(<span class="number">4</span>)(<span class="number">5</span>); <span class="comment">// =&gt; 15</span></span><br></pre></td></tr></table></figure><p><strong>普通函数</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a, b, c</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b + c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(add(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)); <span class="comment">// &gt; 6</span></span><br></pre></td></tr></table></figure><p><strong>柯里化函数（最简单的一种）</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">b</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">c</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> a + b + c;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(add(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>)); <span class="comment">// &gt; 6</span></span><br></pre></td></tr></table></figure><p><strong>进阶</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 第一次执行，定义一个数组用来存储所有的参数，只执行第一次！</span></span><br><span class="line">  <span class="keyword">let</span> _args = [].slice.call(<span class="built_in">arguments</span>);</span><br><span class="line">  <span class="comment">// 利用闭包的特性保存_args并收集所有的参数值，非第一次</span></span><br><span class="line">  <span class="keyword">let</span> _add = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    _args.push(...arguments);</span><br><span class="line">    <span class="keyword">return</span> _add;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// 利用隐式转换的特性，当最后执行时隐式转换，并计算最终的值返回</span></span><br><span class="line">  _add.toString = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> _args.reduce(<span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> _add;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(add(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>)); <span class="comment">// &gt; f 6</span></span><br><span class="line"><span class="built_in">console</span>.log(add(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)(<span class="number">4</span>)); <span class="comment">// &gt; f 10</span></span><br><span class="line"><span class="built_in">console</span>.log(add(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>)(<span class="number">4</span>)(<span class="number">5</span>)); <span class="comment">// &gt; f 15</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ES6写法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 第一次执行，定义一个变量存储所有的参数之和，只执行第一次！</span></span><br><span class="line">    <span class="keyword">let</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>, len = args.length; i &lt; len; i++) &#123;</span><br><span class="line">        res += args[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 非第一次执行，定义一个闭包，处理剩余所有参数</span></span><br><span class="line">    <span class="keyword">let</span> ret = <span class="function"><span class="keyword">function</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>, len = args.length; i &lt; len; i++) &#123;</span><br><span class="line">            res += args[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 函数的属性（隐式转换）,自定义输出内容</span></span><br><span class="line">    ret.toString = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">	    <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(add(<span class="number">1</span>)(<span class="number">2</span>, <span class="number">3</span>)); <span class="comment">// &gt; f 6</span></span><br></pre></td></tr></table></figure><p><strong>toString()函数的隐式转换</strong></p><p>为什么上面输出的是 <code>f 6</code> ，而不是 <code>6</code> ？</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 案例一</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">20</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(add + <span class="number">10</span>); <span class="comment">// &gt; function add() &#123;return 20;&#125;10</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 案例二</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">20</span>;</span><br><span class="line">&#125;</span><br><span class="line">add.toString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(add + <span class="number">10</span>); <span class="comment">// &gt; 20</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 案例三</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">20</span>;</span><br><span class="line">&#125;</span><br><span class="line">add.valueOf = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line">add.toString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(add + <span class="number">10</span>); <span class="comment">// &gt; 15</span></span><br></pre></td></tr></table></figure><div class="note warning no-icon"><ul><li>需要转换为字符串时，会调用 <code>toString</code>，需要转换为数字时，会调用 <code>valueOf</code>，更多的 <code>toString</code> 方法可见 <a href="/archives/db8c76a2.html">链接</a></li><li>当我们没有重新定义 <code>toString</code> 与 <code>valueOf</code> 方法时，函数的隐式转换会调用默认的 <code>toString</code> 方法，它会将函数的定义内容作为字符串返回</li><li>当我们主动定义了 <code>toString/valueOf</code> 方法时，那么隐式转换的返回结果则由我们自己控制了</li><li>在输出结果为数字的情况下，<code>valueOf</code> 会比 <code>toString</code> 后执行</li><li>柯里化函数涉及了3个技术点<ul><li>闭包</li><li>高阶函数</li><li>隐式转换</li></ul></li></ul></div><!-- rebuild by neat -->]]></content>
      <categories>
        <category>前端</category>
        <category>JavaScript</category>
        <category>进阶</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>前端</tag>
        <tag>高阶函数</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3基础-CompositionAPI</title>
    <url>/archives/89d8d59e.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Vue3基础-CompositionAPI。</p><a id="more"></a><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>在Vue2中编写Vue组件使用的是选项式API（<code>data</code>、<code>computed</code>、<code>created</code>、<code>mounted</code>、<code>methods</code>…）,当我们页面（组件）变得复杂时，逻辑代码也会增长，我们必须不断地“跳转”相关的选项块，这种碎片化使得理解和维护复杂组件变得困难。随后，采用 <code>Mixin</code> 来解决复用性问题，即 <code>Mixin</code>可以抽取公共逻辑和方法，但 <code>Mixin</code> 提供的数据和函数，无法在组件中直接体现，这导致组件的维护人员需要非常熟悉被引入的 <code>Mixin</code> 对象，不然会出现重命名而导致bug的情况。</p><h3 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h3><table><thead><tr><th>Vue2 - 选项式API</th><th>Vue3 - Hook inside <code>setup()</code></th></tr></thead><tbody><tr><td><code>beforeCreate()</code></td><td>–</td></tr><tr><td><code>created()</code></td><td>–</td></tr><tr><td><code>beforeMount()</code></td><td><code>onBeforeMount()</code></td></tr><tr><td><code>mounted()</code></td><td><code>onMounted()</code></td></tr><tr><td><code>beforeUpdate()</code></td><td><code>onBeforeUpdate()</code></td></tr><tr><td><code>updated()</code></td><td><code>onUpdated()</code></td></tr><tr><td><code>beforeDestroy()</code></td><td><code>onBeforeUnmount()</code></td></tr><tr><td><code>destroyed()</code></td><td><code>onUnmounted()</code></td></tr><tr><td><code>errorCaptured()</code></td><td><code>onErrorCaptured()</code></td></tr></tbody></table><p>基本的周期历程：创建 -&gt; 加载 -&gt; 更新 -&gt; 卸载，Vue3 对比 Vue2：</p><ul><li>命名变化：周期函数均以 <code>on</code> 开头命名</li><li>废弃创建阶段的周期函数 <code>beforeCreate()</code> 和 <code>created()</code>，使用 <code>setup()</code> 替代</li><li>卸载阶段的周期函数重命名：<code>beforeDestory()</code> 调整为 <code>onBeforeUnmount()</code>，<code>destoryed()</code> 调整为 <code>onUnmounted()</code></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script lang=<span class="string">"ts"</span>&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; defineComponent, onBeforeMount &#125; <span class="keyword">from</span> <span class="string">"vue"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span><br><span class="line">  beforeCreate() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"beforeCreate"</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"created"</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"setup"</span>);</span><br><span class="line">    onBeforeMount(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"onBeforeMount"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    onMounted(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"onMounted"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"mounted"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ setup</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ beforeCreate</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ created</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ beforeMount</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ onBeforeMount</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ onMounted</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ mounted</span></span><br></pre></td></tr></table></figure><p>跟Vue2中的 <code>beforeCreate</code>、<code>created</code> 一样，在Vue3中 <code>setup</code> 执行时尚未创建组件实例，因此在 <code>setup</code> 选项中没有 <code>this</code>。这意味着，除了 <code>props</code> 之外，<code>setup</code> 中无法访问组件中声明的任何属性（ 本地状态、计算属性、方法等）。</p><h3 id="setup"><a href="#setup" class="headerlink" title="setup"></a>setup</h3><ol><li><code>setup()</code> 不是生命周期钩子函数</li><li>Vue3的生命周期函数，可以按需导入组件中，且只能在 <code>set()</code> 函数中声明</li><li><code>setup()</code> 显式返回一个对象，这个对象的所有内容都会暴露给组件的其他部分</li></ol><p><code>setup()</code>只是基于 <code>beforeCreate()</code> 运行，但函数内部无法通过 <code>this</code> 获取组件实例，而且 <code>setup()</code> 有着生命周期钩子不具备的参数：<code>props</code> 和 <code>context</code>。</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!-- helloworld.vue --&gt;</span><br><span class="line">&lt;script lang&#x3D;&quot;ts&quot;&gt;</span><br><span class="line">import &#123; defineComponent &#125; from &quot;vue&quot;;</span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    msg: &#123;</span><br><span class="line">      type: String</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  setup(props: any, context: any) &#123;</span><br><span class="line">    &#x2F;&#x2F; 组件props</span><br><span class="line">    console.log(props);</span><br><span class="line">    &#x2F;&#x2F; Attribute(非响应式对象)、组件插槽（非响应式对象）、触发事件（方法）</span><br><span class="line">    const &#123; attrs, slots, emit &#125; &#x3D; context;</span><br><span class="line">    console.log(attrs);</span><br><span class="line">    console.log(slots);</span><br><span class="line">    console.log(emit);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><p>这里的 <code>props</code> 就是组件内部定义的 <code>props</code>，是由父组件传入的参数，假如父组件传入了一个属性名为 <code>msg</code> 的 <code>props</code>，在 <code>setup()</code> 中可以通过 <code>props.msg</code> 直接获取到。而且这个 <code>porps</code> 是响应式的，当传入新的 <code>props</code> 时，<code>props</code> 会被更新，但正是因为 <code>props</code> 是响应式的，所以不能直接对 <code>props</code> 使用ES6的解构，因为它会消除 <code>props</code> 的响应式，Vue3提供了一个 <code>toRefs()</code> 全局方法来解决这个问题。</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; toRefs &#125; <span class="keyword">from</span> <span class="string">"vue"</span>;</span><br><span class="line">setup(props) &#123;</span><br><span class="line">  <span class="comment">// 通过 toRefs 包装过后的 props 可以在 ES6 解构之后依然具有响应式</span></span><br><span class="line">  <span class="keyword">const</span> &#123; msg &#125; = toRefs(props);</span><br><span class="line">  <span class="built_in">console</span>.log(msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果在 <code>setup()</code> 内部注册声明周期钩子，则需要从Vue引入带有 <code>on</code> 前缀的生命周期工具函数：</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; toRefs, onMounted &#125; <span class="keyword">from</span> <span class="string">"vue"</span>;</span><br><span class="line">setup(props) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; msg &#125; = toRefs(props);</span><br><span class="line">  <span class="comment">// 注册声明周期函数</span></span><br><span class="line">  onMounted(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"onMounted"</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的 <code>onMounted</code> 等声明周期工具函数，会接收一个函数作为参数。在组件中对应的生命周期钩子（<code>mounted</code>）触发时，会执行这个被传入的函数。</p><p>如果 <code>setup()</code> 显示的返回了一个对象，那么这个对象对于这个组件而言是完全可用的：</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">setup() &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    name: <span class="string">"devin"</span>,</span><br><span class="line">    sayHello: <span class="function">(<span class="params">msg: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`Hello, <span class="subst">$&#123;msg&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">mounted() &#123;</span><br><span class="line">  <span class="comment">// 直接使用setup的返回值</span></span><br><span class="line">  <span class="keyword">this</span>.sayHello(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对于上面的 <code>setup()</code> 的变量 <code>name</code> 字段，还不是一个响应式变量，以下有两种方式来将 <code>name</code> 包装为响应式：</p><ol><li>使用 <code>ref</code> 全局方法来包装变量，使得此变量具有响应式。</li><li>使用 <code>reactive</code> 来实现数据绑定。</li></ol><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!-- ref响应式 --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;hello&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;text&quot; v-model&#x3D;&quot;name&quot; &#x2F;&gt;</span><br><span class="line">    &lt;h3&gt;&#123;&#123; name &#125;&#125;&lt;&#x2F;h3&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang&#x3D;&quot;ts&quot;&gt;</span><br><span class="line">import &#123; defineComponent, ref &#125; from &quot;vue&quot;;</span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    const name &#x3D; ref(&quot;&quot;);</span><br><span class="line">    return &#123;</span><br><span class="line">      name</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!-- reactive响应式 --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;hello&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;text&quot; v-model&#x3D;&quot;name&quot; &#x2F;&gt;</span><br><span class="line">    &lt;h3&gt;&#123;&#123; name &#125;&#125;&lt;&#x2F;h3&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang&#x3D;&quot;ts&quot;&gt;</span><br><span class="line">import &#123; defineComponent, reactive, toRefs &#125; from &quot;vue&quot;;</span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    const initData &#x3D; reactive(&#123;</span><br><span class="line">      name: &quot;&quot;</span><br><span class="line">    &#125;);</span><br><span class="line">    return &#123;</span><br><span class="line">      ...toRefs(initData)</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><p>两者的对比：</p><ul><li><code>ref</code> 推荐定义基本类型，获取时需要使用 <code>value</code> 属性</li><li><code>reactive</code> 推荐定义复杂的数据类型，暴露时如使用ES6语法，需要使用 <code>toRefs</code> 包装</li></ul><p>除了返回一个对象以外，<code>setup()</code> 还可以返回一个渲染函数，如果直接返回渲染函数，则组件中定义的 <code>template</code> 将会实效：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;hello&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;text&quot; v-model&#x3D;&quot;inputData.text&quot; &#x2F;&gt;</span><br><span class="line">    &lt;h3&gt;&#123;&#123; inputData.text &#125;&#125;&lt;&#x2F;h3&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang&#x3D;&quot;ts&quot;&gt;</span><br><span class="line">import &#123; defineComponent, reactive, h &#125; from &quot;vue&quot;;</span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    const initData &#x3D; reactive(&#123;</span><br><span class="line">      inputData: &#123;</span><br><span class="line">        text: &quot;22&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    &#x2F;&#x2F; 返回的渲染函数会覆盖template</span><br><span class="line">    return () &#x3D;&gt; h(&quot;div&quot;, [initData.inputData.text]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><h3 id="computed"><a href="#computed" class="headerlink" title="computed"></a>computed</h3><p><code>setup()</code>的本意是用来替代 <code>mixin</code>，因此除了 <code>data</code>、<code>methods</code>、声明周期钩子之外，还有许多组件选项需要解决。</p><p><code>computed</code> 分两种：</p><ul><li><p>组件中的 <code>computed</code>，和Vue2中的用法一致，计算属性可以在组件中直接使用</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!-- vue2 --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;p&gt;&#123;&#123; booksMessage &#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      books: []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  computed: &#123;</span><br><span class="line">  	booksMessage() &#123;</span><br><span class="line">    	return this.books.length &gt; 0 ? &#39;Yes&#39; : &#39;No&#39;</span><br><span class="line">  	&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure></li><li><p><code>setup()</code> 中的 <code>computed</code>,需要通过全局工具函数 <code>computed</code> 来包装</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!-- vue3 --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;p&gt;&#123;&#123; booksMessage &#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&lt;script lang&#x3D;&quot;ts&quot;&gt;</span><br><span class="line">import &#123; defineComponent, ref, computed &#125; from &quot;vue&quot;;</span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    const books &#x3D; ref([]);</span><br><span class="line">    const booksMessage &#x3D; computed(() &#x3D;&gt; books.value.length &gt; 0 ? &#39;Yes&#39; : &#39;No&#39;);</span><br><span class="line">    return &#123;</span><br><span class="line">      books,</span><br><span class="line">      booksMessage</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure></li></ul><h3 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h3><p><code>watch</code> 和 <code>computed</code> 一样，也分两种：</p><ul><li><p>组件中的 <code>watch</code>,和Vue2中的用法一致</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!-- vue2 --&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data: () &#x3D;&gt; (&#123;</span><br><span class="line">    question: &#39;&#39;,</span><br><span class="line">    answer: &#39;good luck&#39;</span><br><span class="line">  &#125;)</span><br><span class="line">  watch: &#123;</span><br><span class="line">  	question(new, old) &#123;</span><br><span class="line">     	&#x2F;&#x2F; 当 question 变化的时候会执行该函数</span><br><span class="line">    	if (new.indexOf(&#39;?&#39;) &gt; -1) &#123;</span><br><span class="line">      	console.log(&#39;answer: &#39;, this.answer);</span><br><span class="line">    	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure></li><li><p><code>setup()</code>中的 <code>watch</code>,需要通过全局工具函数 <code>watch</code>来包装</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!-- vue3 --&gt;</span><br><span class="line">&lt;script lang&#x3D;&quot;ts&quot;&gt;</span><br><span class="line">import &#123; defineComponent, ref, watch &#125; from &quot;vue&quot;;</span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">	  const question &#x3D; ref(&#39;&#39;);</span><br><span class="line">    const answer &#x3D; ref(&#39;good luck&#39;);</span><br><span class="line">    watch(question, (new, old) &#x3D;&gt; &#123;</span><br><span class="line">      if (new.indexOf(&#39;?&#39;) &gt; -1) &#123;</span><br><span class="line">      	console.log(&#39;answer: &#39;, this.answer.value);</span><br><span class="line">    	&#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    return &#123;</span><br><span class="line">      question,</span><br><span class="line">      answer</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure></li></ul><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Vue</category>
        <category>Vue3</category>
      </categories>
      <tags>
        <tag>Vue3</tag>
        <tag>集成</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3基础-组件</title>
    <url>/archives/69214ec0.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Vue3基础-组件。</p><a id="more"></a><h3 id="单文件组件"><a href="#单文件组件" class="headerlink" title="单文件组件"></a>单文件组件</h3><p>通过 <code>Vue.createApp()</code> 创建的应用，可以使用 <code>component</code> 方法创建自定义组件：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!-- About.vue --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;about&quot;&gt;</span><br><span class="line">    &lt;h1&gt;hello, &#123;&#123; msg &#125;&#125;&lt;&#x2F;h1&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&lt;script lang&#x3D;&quot;ts&quot;&gt;</span><br><span class="line">import &#123; defineComponent &#125; from &quot;vue&quot;;</span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  name: &quot;About&quot;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      msg: &quot;Devin&quot;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><p>其写法与 <strong>Vue2</strong> 基本一致，如果有组件引入：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!-- About --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;about&quot;&gt;</span><br><span class="line">    &lt;h1&gt;hello, &#123;&#123; msg &#125;&#125;&lt;&#x2F;h1&gt;</span><br><span class="line">    &lt;hello-world&gt;&lt;&#x2F;hello-world&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&lt;script lang&#x3D;&quot;ts&quot;&gt;</span><br><span class="line">import &#123; defineComponent &#125; from &quot;vue&quot;;</span><br><span class="line">import HelloWorld from &quot;@&#x2F;components&#x2F;HelloWorld.vue&quot;;</span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  name: &quot;About&quot;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      msg: &quot;Devin&quot;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    HelloWorld</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><p>上面代码中，<strong>components</strong> 中使用的是大驼峰（帕斯卡pascal）命名法组件，而在 <code>template</code> 中使用的是短线命名法（中线命名法）。</p><h3 id="Props"><a href="#Props" class="headerlink" title="Props"></a>Props</h3><p>与Vue2一样，可定义组件传递参数</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;script lang&#x3D;&quot;ts&quot;&gt;</span><br><span class="line">  export default defineComponent(&#123;</span><br><span class="line">  &#x2F;&#x2F; ...</span><br><span class="line">  props: &#123;</span><br><span class="line">    likes: String, &#x2F;&#x2F; 仅限定类型</span><br><span class="line">    years: &#123;</span><br><span class="line">      type: [String, Number],</span><br><span class="line">      required: true, &#x2F;&#x2F; 必填</span><br><span class="line">    &#125;,</span><br><span class="line">    info: &#123;</span><br><span class="line">      type: Object,</span><br><span class="line">      default: () &#x3D;&gt; (&#123; &#x2F;&#x2F; 对象和数组类型的默认值只能用函数返回</span><br><span class="line">        title: &#39;这里是对象类型的 prop&#39;,</span><br><span class="line">      &#125;),</span><br><span class="line">    &#125;,</span><br><span class="line">    type: &#123;</span><br><span class="line">      &#x2F;&#x2F; 自定义校验函数</span><br><span class="line">      validator: (val: string) &#x3D;&gt; (</span><br><span class="line">        [&#39;success&#39;, &#39;warning&#39;, &#39;danger&#39;].indexOf(val) !&#x3D;&#x3D; -1</span><br><span class="line">      ),</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#x2F;&#x2F; ...</span><br><span class="line">&#125;);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><h3 id="无状态组件"><a href="#无状态组件" class="headerlink" title="无状态组件"></a>无状态组件</h3><p>组件只接收 <code>props</code>，没有定义 <code>data</code>、<code>methods</code>、<code>computed</code> 等响应数据的组件，被称之为无状态组件。其实写法跟普通组件无异，Vue2中无状态组件的性能（初始化）比普通组件快的多，而在Vue3中，有状态组件的性能官方宣称可以比肩无状态组件。</p><h3 id="Mixin"><a href="#Mixin" class="headerlink" title="Mixin"></a>Mixin</h3><p>与无状态组件相对应的是有状态组件，也就是带有 <strong>data</strong> 等响应数据的组件，我们工作中写的组件大部分也是有状态组件。<code>Mixin</code> 可以实现组件共用和逻辑抽取。</p><p>假如我们有3个组件，它们的js部分都包含以下内容：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script lang=<span class="string">"ts"</span>&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; defineComponent &#125; <span class="keyword">from</span> <span class="string">"vue"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      loading: <span class="literal">false</span>,</span><br><span class="line">      tableList: []</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    title: &#123;</span><br><span class="line">      type: <span class="built_in">String</span>,</span><br><span class="line">      required: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    getTableList() &#123;</span><br><span class="line">      <span class="keyword">this</span>.loading = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">return</span> getList</span><br><span class="line">      	.then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        	<span class="keyword">this</span>.tableList = res.data;</span><br><span class="line">      	&#125;)</span><br><span class="line">      	.catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        	<span class="comment">// do catch</span></span><br><span class="line">      	&#125;)</span><br><span class="line">      	.finally(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        	<span class="keyword">this</span>.loading = <span class="literal">false</span>;</span><br><span class="line">      	&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>3个组件都包含：</p><ul><li>响应数据 <code>data</code>: <code>loading</code>，<code>tableList</code></li><li>组件参数 <code>props</code>：<code>title</code></li><li>方法 <code>methods</code>: <code>getTableList</code></li></ul><p>这些逻辑完全一样，如果要在3个组件中各写一份完全一样的代码，不利于维护，有了 <strong>mixin</strong> 之后，我们就能把这些逻辑写在一个对象里面并导出：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*  mixin-getTablePage.js */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      loading: <span class="literal">false</span>,</span><br><span class="line">      tableList: []</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    title: &#123;</span><br><span class="line">      type: <span class="built_in">String</span>,</span><br><span class="line">      required: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    getTableList() &#123;</span><br><span class="line">      <span class="keyword">this</span>.loading = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">return</span> getList</span><br><span class="line">      	.then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        	<span class="keyword">this</span>.tableList = res.data;</span><br><span class="line">      	&#125;)</span><br><span class="line">      	.catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        	<span class="comment">// do catch</span></span><br><span class="line">      	&#125;)</span><br><span class="line">      	.finally(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        	<span class="keyword">this</span>.loading = <span class="literal">false</span>;</span><br><span class="line">      	&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>然后在需要用到这部分逻辑的组件中引入，并注册到 <code>mixins</code>, <code>mixins</code> 接收的是一个数组，也就是说可以同时注册多个 <code>mixins</code>:</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script lang=<span class="string">"ts"</span>&gt;</span><br><span class="line"><span class="keyword">import</span> MixinGetTablePage <span class="keyword">from</span> <span class="string">"@/mixins/mixin-getTablePage.js"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  mixins: [ MixinGetTablePage ]</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>Vue 在初始化组件的时候，会将引入的 <code>mixin</code> 对象和当前组件进行合并，在合并的时候如果遇到了同名选项，对于不同的类型（<code>data</code>, <code>props</code>, <code>methods</code>）会有不同的策略：</p><ol><li><p>如果是 <code>props</code>、<code>methods</code>、<code>components</code>、<code>directives</code> 冲突，会以组件本身的键值对覆盖 <code>mixin</code></p></li><li><p>对于生命周期钩子函数出现冲突，会先触发 <code>mixin</code> 中的钩子函数，然后再触发组件中的钩子函数</p></li><li><p>如果 <code>data</code> 发生冲突，将执行浅层次的合并：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* mixin-test.js */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      user: &#123;</span><br><span class="line">        name: <span class="string">"Devin"</span>,</span><br><span class="line">        id: <span class="number">1</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* user.vue */</span></span><br><span class="line">&lt;script lang=<span class="string">"ts"</span>&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; defineComponent &#125; <span class="keyword">from</span> <span class="string">"vue"</span>;</span><br><span class="line"><span class="keyword">import</span> MixinTest <span class="keyword">from</span> <span class="string">"@/mixins/mixin-test"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span><br><span class="line">  mixins: [MixinTest],</span><br><span class="line">  data() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      user: &#123;</span><br><span class="line">        id: <span class="number">2</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 合并的结果：</span></span><br><span class="line"><span class="regexp">&#123;</span></span><br><span class="line"><span class="regexp">  user: &#123;</span></span><br><span class="line"><span class="regexp">    id: 2</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>而在 Vue2中，<code>data</code> 会执行深层次的合并，上面的结果会变成：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  user: &#123;</span><br><span class="line">    id: <span class="number">2</span>,</span><br><span class="line">    name: <span class="string">"Devin"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Vue</category>
        <category>Vue3</category>
      </categories>
      <tags>
        <tag>Vue3</tag>
        <tag>集成</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3基础-安装</title>
    <url>/archives/4a522fcf.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Vue3基础-安装。</p><a id="more"></a><h3 id="构建项目方式"><a href="#构建项目方式" class="headerlink" title="构建项目方式"></a>构建项目方式</h3><p>构建Vue3项目有两种方式：</p><ul><li>Vue CLI 构建</li><li>Vite 构建</li></ul><h3 id="Vue-CLI构建"><a href="#Vue-CLI构建" class="headerlink" title="Vue CLI构建"></a>Vue CLI构建</h3><p>为了快速构建Vue项目，Vue团队开发了脚手架工具：Vue CLI，这个脚手架需要全局安装：</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">npm install <span class="literal">-g</span> @vue/cli</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">yarn global add @vue/cli</span><br></pre></td></tr></table></figure><div class="note warning no-icon"><p>安装过程中如遇到以下报错：</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">E:\&gt;npm install <span class="literal">-g</span> @vue/cli</span><br><span class="line">npm WARN deprecated request@<span class="number">2.88</span>.<span class="number">2</span>: request has been deprecated, see https://github.com/request/request/issues/<span class="number">3142</span></span><br><span class="line">npm WARN deprecated @hapi/joi@<span class="number">15.1</span>.<span class="number">1</span>: <span class="keyword">Switch</span> to <span class="string">'npm install joi'</span></span><br><span class="line">npm WARN deprecated @hapi/address@<span class="number">2.1</span>.<span class="number">4</span>: Moved to <span class="string">'npm install @sideway/address'</span></span><br><span class="line">npm WARN deprecated @hapi/bourne@<span class="number">1.3</span>.<span class="number">2</span>: This version has been deprecated and is no longer supported or maintained</span><br><span class="line">npm WARN deprecated @hapi/topo@<span class="number">3.1</span>.<span class="number">6</span>: This version has been deprecated and is no longer supported or maintained</span><br><span class="line">npm WARN deprecated @hapi/hoek@<span class="number">8.5</span>.<span class="number">1</span>: This version has been deprecated and is no longer supported or maintained</span><br><span class="line">npm WARN deprecated har<span class="literal">-validator</span>@<span class="number">5.1</span>.<span class="number">5</span>: this library is no longer supported</span><br><span class="line">npm ERR! Unexpected <span class="keyword">end</span> of JSON input <span class="keyword">while</span> parsing near <span class="string">'...5832&#125;,"3.2.0-dev.2018'</span></span><br><span class="line"></span><br><span class="line">npm ERR! A complete log of this run can be found <span class="keyword">in</span>:</span><br><span class="line">npm ERR!     C:\Users\Administrator\AppData\Roaming\npm<span class="literal">-cache</span>\_logs\<span class="number">2020</span><span class="literal">-10</span><span class="literal">-30T06_47_05_264Z</span><span class="literal">-debug</span>.log</span><br></pre></td></tr></table></figure><p>解决：</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">E:\&gt;npm config set registry https://registry.npm.taobao.org</span><br><span class="line">E:\&gt;npm i <span class="literal">-g</span> @vue/cli</span><br></pre></td></tr></table></figure></div><p>对于Vue 3.x的项目，需要使用 Vue CLI v4.5以上的版本。如果本地的Vue CLI版本较低，也可以使用上面命令升级。</p><p>安装完成之后可以在命令行输入 <code>vue -V</code>，如果出现版本号则安装成功。</p><p>Vue CLI构建项目有两种方式：</p><ul><li><code>vue create xx</code> 创建项目</li><li><code>vue ui</code> 创建项目</li></ul><p><strong>Vue UI创建</strong></p><ol><li>创建文件夹：<code>E:/vue3-admin</code>、包管理器：<code>yarn</code>、初始化git仓库</li><li>手动</li><li>choose Vue version: <code>3.x(Preview)</code>、考虑到后台管理采用 ant-design-vue，所以 CSS pre-processor：<code>Less</code>、formatter config: <code>ESLint+Prettier</code>、Pick addition lint features: <code>Lint on save</code> + <code>Lint and fix on commit</code></li></ol><p><strong>Vue create xx创建</strong></p><ol><li><code>cd e:</code></li><li><code>vue create vue3-admin</code></li><li><code>Manually select features</code></li></ol><div class="note warning no-icon"><p>安装完成之后，打开 <strong>main.ts</strong>，发现有 <strong>ts</strong> 报错：</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">TS2345: Argument of type <span class="string">'typeof import("E:/vue3-h5/node_modules/vue/dist/vue")'</span> is not assignable to <span class="keyword">parameter</span> of type <span class="string">'Component&lt;any, any, any, Record&lt;string, ComputedGetter&lt;any&gt; | WritableComputedOptions&lt;any&gt;&gt;, MethodOptions&gt;'</span>.</span><br></pre></td></tr></table></figure><p>原因：启用 <strong>TypeScript</strong> 必须要让 <strong>TypeScript</strong> 正确推断 <strong>Vue</strong> 组件选项中的类型，需要使用 <code>defineComponent</code></p><p>解决：在 <strong>app.vue</strong> 中添加以下代码</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!-- app.vue --&gt;</span><br><span class="line">&lt;script lang&#x3D;&quot;ts&quot;&gt;</span><br><span class="line">import &#123; Vue &#125; from &quot;vue-class-component&quot;;</span><br><span class="line">export default class App extends Vue &#123;&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- OR --&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang&#x3D;&quot;ts&quot;&gt;</span><br><span class="line">import &#123;defineComponent&#125; from &quot;vue&quot;;</span><br><span class="line">export default defineComponent(&#123;&#125;)</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure></div><h3 id="Vite构建"><a href="#Vite构建" class="headerlink" title="Vite构建"></a>Vite构建</h3><p>除了上面之前常用的 Vue CLI方式创建项目之外，Vue3.x还可以通过新工具 Vite 来创建项目。 Vite 是一个由原生ES模块驱动的Web开发构建工具，支持模块热更新和按需加载。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">yarn global add create<span class="literal">-vite</span><span class="literal">-app</span></span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">npm i <span class="literal">-g</span> create<span class="literal">-vite</span><span class="literal">-app</span></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">yarn create vite<span class="literal">-app</span> vue3<span class="literal">-admin</span><span class="literal">-vite</span></span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">npm init vite<span class="literal">-app</span> vue3<span class="literal">-admin</span><span class="literal">-vite</span></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">yarn</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">npm i</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">yarn dev</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">npm run dev</span><br></pre></td></tr></table></figure><p>项目结构：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">│  .gitignore</span><br><span class="line">│  index.html</span><br><span class="line">│  package.json</span><br><span class="line">│  yarn.lock</span><br><span class="line">│          </span><br><span class="line">├─node_modules</span><br><span class="line">│          </span><br><span class="line">├─public</span><br><span class="line">│      favicon.ico</span><br><span class="line">│      </span><br><span class="line">└─src</span><br><span class="line">    │  App.vue</span><br><span class="line">    │  index.css</span><br><span class="line">    │  main.js</span><br><span class="line">    │  </span><br><span class="line">    ├─assets</span><br><span class="line">    │      logo.png</span><br><span class="line">    │      </span><br><span class="line">    └─components</span><br><span class="line">            HelloWorld.vue</span><br></pre></td></tr></table></figure><h3 id="CLI项目结构"><a href="#CLI项目结构" class="headerlink" title="CLI项目结构"></a>CLI项目结构</h3><p><img data-src="../../assets/image-20201026162732885.png" alt="image-20201026162732885"></p><p>与 vue2 项目结构类似，</p><ul><li><code>public文件夹</code>：可以存放一些不需要经过webpack打包的文件<ul><li><code>index.html文件</code>：打包编译后的项目入口</li></ul></li><li><code>src文件夹</code><ul><li><code>assets目录</code>：静态资源目录</li><li><code>components目录</code>：组件目录</li><li><code>main.js文件</code>：webpack打包的入口文件</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// main.js vue3挂载实例</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">"vue"</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">"./App.vue"</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">"./router"</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">"./store"</span>;</span><br><span class="line"></span><br><span class="line">createApp(App)</span><br><span class="line">  .use(store)</span><br><span class="line">  .use(router)</span><br><span class="line">  .mount(<span class="string">"#app"</span>);</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// mian.js vue2挂载实例</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">"vue"</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">"./App.vue"</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">"./router"</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">"./store"</span>;</span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  router,</span><br><span class="line">  store,</span><br><span class="line">  render: <span class="function">(<span class="params">h</span>) =&gt;</span> h(App),</span><br><span class="line">&#125;).$mount(<span class="string">"#app"</span>);</span><br></pre></td></tr></table></figure><p>这里的 <code>createApp</code> 方法是Vue3新增的全局API，用来创建一个Vue应用，并挂载到某个DOM节点。参照Vue3和Vue2的代码，从表面上看，<code>createApp</code> 只是改良版的 <code>render</code> 函数，但其实解决了Vue2中一些不太优雅的用法，具体表现为：</p><ul><li>Vue2中Vue没有“应用”的概念，所谓的应用只是一个 <code>Vue</code>的根实例：<code>new Vue()</code>，当我们需要修改一些全局属性的时候，只能通过Vue对象本身来修改，这样造成的结果就是会污染<code>Vue</code>对象，导致从同一个<code>Vue</code> 创建的实例会共享相同的全局配置</li><li>Vue3中而是通过 <code>createApp</code> 创建应用，返回的是独立的实例，修改该实例的属性不会影响其他 <code>createApp</code> 创建的实例</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Vue2全局属性</span></span><br><span class="line">Vue.prototype.$http = axios;</span><br><span class="line">Vue.directive(<span class="string">'focus'</span>, &#123;</span><br><span class="line">  inserted: <span class="function"><span class="params">el</span> =&gt;</span> el.focus();</span><br><span class="line">&#125;);</span><br><span class="line">Vue.config.errorHandler = errorHandler;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Vue3独立实例</span></span><br><span class="line"><span class="comment">// foo和bar都具备了focus指令，但这两个指令的内容相互独立</span></span><br><span class="line"><span class="keyword">const</span> foo = createApp(Foo);</span><br><span class="line">foo.directive(<span class="string">"focus"</span>, &#123;&#125;);</span><br><span class="line"><span class="keyword">const</span> bar = createApp(Bar);</span><br><span class="line">bar.directive(<span class="string">"focus"</span>, &#123;&#125;);</span><br></pre></td></tr></table></figure><p>如果需要两个应用共享配置，可以通过 <code>createApp</code> 创建一个工厂函数：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// foo和bar会具备同一个focus指令</span></span><br><span class="line"><span class="keyword">const</span> crateMyApp = <span class="function"><span class="params">options</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> app = createApp(options);</span><br><span class="line">  app.directive(<span class="string">'focus'</span>, &#123;&#125;);</span><br><span class="line">  <span class="keyword">return</span> app;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> foo = createMyApp(Foo).mount(<span class="string">"#foo"</span>);</span><br><span class="line"><span class="keyword">const</span> bar = createMyBar(Bar).mount(<span class="string">"#bar"</span>);</span><br></pre></td></tr></table></figure><h3 id="TypeScript"><a href="#TypeScript" class="headerlink" title="TypeScript"></a>TypeScript</h3><p>Vue3有一个重要的特性就是更好的支持 <code>TypeScript</code>。在使用Vue CLI创建项目的时候，可以选择 <code>TypeScript</code>，这样就能直接创建 <code>ts</code> 项目。如果一开始没有创建 <code>ts</code> 项目，那如何让现有项目支持 <code>ts</code> 呢？有两种方式：</p><ol><li><p>可以通过命令 <code>vue add typescript</code> 将项目改造为 <code>ts</code> 项目，（前提是电脑上装有Vue CLI）</p></li><li><p>手动引入 <strong>typescript</strong></p><ol><li><p><code>npm i typescript -D</code> 安装 <strong>typescript</strong> 依赖</p></li><li><p>项目根目录创建 <strong>tsconfig.json</strong> 文件：</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"include"</span>: [</span><br><span class="line">    <span class="string">"src/**/*.ts"</span>,</span><br><span class="line">    <span class="string">"src/**/*.tsx"</span>,</span><br><span class="line">    <span class="string">"src/**/*.vue"</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"exclude"</span>: [</span><br><span class="line">    <span class="string">"node_modules"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"compilerOptions"</span>: &#123;</span><br><span class="line">    <span class="comment">// 与 Vue 的浏览器支持保持一致</span></span><br><span class="line">    <span class="attr">"target"</span>: <span class="string">"es5"</span>,</span><br><span class="line">    <span class="comment">// 如果使用 webpack 2+ 或 rollup，可以利用 tree-shake:</span></span><br><span class="line">    <span class="attr">"module"</span>: <span class="string">"es2015"</span>,</span><br><span class="line">    <span class="comment">// 这可以对 `this` 上的数据 property 进行更严格的推断</span></span><br><span class="line">    <span class="attr">"strict"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"moduleResolution"</span>: <span class="string">"node"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>将 <strong>src</strong> 目录下的 <strong>main.js</strong> 文件名改为 <strong>main.ts</strong>，以及其他 <strong>js</strong> 文件改为 <strong>ts</strong> 后缀，比如：<strong>config.js</strong> =&gt; <strong>config.ts</strong></p></li><li><p><strong>src</strong> 根目录新增文件 <strong>shim-vue.d.ts</strong></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="keyword">module</span> '*.vue' &#123;</span><br><span class="line">  <span class="keyword">import</span> <span class="keyword">type</span> &#123; DefineComponent &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line">  <span class="keyword">const</span> component: DefineComponent&lt;&#123;&#125;, &#123;&#125;, <span class="built_in">any</span>&gt;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> component</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>由于Vue3是使用 <strong>TypeScript</strong> 编写的，所以只要在 <code>&lt;script&gt;</code> 标签上声明 <code>lang=&quot;ts&quot;</code> ，就能直接在 <strong>.vue</strong> 文件中使用 <strong>ts</strong> 语法。</p></li></ol></li></ol><h3 id="配置IDE"><a href="#配置IDE" class="headerlink" title="配置IDE"></a>配置IDE</h3><p>此处内容仅适用于 <strong>webstrorm</strong>。我们在项目中集成了 <code>eslint</code> 和 <code>prettier</code>，默认情况下 <strong>webstrom</strong> 是没有启用这两个插件的，需要我们手动开启。</p><p>搜索 <code>eslint</code>，进行设置：</p><p><img data-src="../../assets/image-20201030155637306.png" alt="image-20201030155637306"></p><p>搜索 <code>prettier</code>，进行设置：</p><p><img data-src="../../assets/image-20201030160001157.png" alt="image-20201030160001157"></p><p>如果编辑器未能正常识别 <code>v-</code> 指令，原因为 <strong>webstorm</strong> 没有正确读取 <code>node_module</code> 包，可按照以下操作解决（选择“资源根”）：</p><p><img data-src="../../assets/image-20201030160252466.png" alt="image-20201030160252466"></p><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Vue</category>
        <category>Vue3</category>
      </categories>
      <tags>
        <tag>Vue3</tag>
        <tag>集成</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue集成2:配置优化</title>
    <url>/archives/13614b08.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Vue项目基于 <code>Vue</code> + <code>Vant</code> 的二次集成及优化。以便开箱即用。</p><a id="more"></a><h3 id="基本配置文件"><a href="#基本配置文件" class="headerlink" title="基本配置文件"></a>基本配置文件</h3><p>修改（新增）<code>vue.config.js</code>：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> PORT = process.env.port || <span class="number">8088</span>;</span><br><span class="line"><span class="keyword">const</span> IS_PRODUCTION = process.env.NODE_ENV === <span class="string">"production"</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  publicPath: IS_PRODUCTION ? <span class="string">"/"</span> : <span class="string">"/"</span>,</span><br><span class="line">  lintOnSave: !IS_PRODUCTION,</span><br><span class="line">  productionSourceMap: <span class="literal">false</span>,</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    port: PORT,</span><br><span class="line">    open: <span class="literal">true</span>,</span><br><span class="line">    https: <span class="literal">false</span>,</span><br><span class="line">    compress: <span class="literal">false</span>,</span><br><span class="line">    overlay: &#123;</span><br><span class="line">      warnings: <span class="literal">true</span>,</span><br><span class="line">      errors: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="配置路径别名"><a href="#配置路径别名" class="headerlink" title="配置路径别名"></a>配置路径别名</h3><p>修改 <code>vue.config.js</code> 的 <code>chainWebpack</code> 属性：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> resolve = <span class="function"><span class="params">dir</span> =&gt;</span> path.join(__dirname, dir);</span><br><span class="line"><span class="keyword">const</span> PORT = process.env.port || <span class="number">8088</span>;</span><br><span class="line"><span class="keyword">const</span> IS_PRODUCTION = process.env.NODE_ENV === <span class="string">"production"</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  publicPath: IS_PRODUCTION ? <span class="string">"/"</span> : <span class="string">"/"</span>,</span><br><span class="line">  lintOnSave: !IS_PRODUCTION,</span><br><span class="line">  productionSourceMap: <span class="literal">false</span>,</span><br><span class="line">  chainWebpack: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    config.resolve.alias</span><br><span class="line">      .set(<span class="string">"@"</span>, resolve(<span class="string">"src"</span>))</span><br><span class="line">      .set(<span class="string">"views"</span>, resolve(<span class="string">"src/views"</span>))</span><br><span class="line">      .set(<span class="string">"components"</span>, resolve(<span class="string">"src/components"</span>))</span><br><span class="line">      .set(<span class="string">"api"</span>, resolve(<span class="string">"src/api"</span>))</span><br><span class="line">      .set(<span class="string">"utils"</span>, resolve(<span class="string">"src/utils"</span>))</span><br><span class="line">      .set(<span class="string">"assets"</span>, resolve(<span class="string">"src/assets"</span>))</span><br><span class="line">      .set(<span class="string">"store"</span>, resolve(<span class="string">"src/store"</span>))</span><br><span class="line">      .set(<span class="string">"styles"</span>, resolve(<span class="string">"src/styles"</span>))</span><br><span class="line">  &#125;,</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    port: PORT,</span><br><span class="line">    open: <span class="literal">true</span>,</span><br><span class="line">    https: <span class="literal">false</span>,</span><br><span class="line">    compress: <span class="literal">false</span>,</span><br><span class="line">    overlay: &#123;</span><br><span class="line">      warnings: <span class="literal">true</span>,</span><br><span class="line">      errors: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="配置全局样式"><a href="#配置全局样式" class="headerlink" title="配置全局样式"></a>配置全局样式</h3><p>如果给 <code>sass</code>样式文件：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  css: &#123;</span><br><span class="line"> 	loaderOptions: &#123;</span><br><span class="line">    sass: &#123;</span><br><span class="line">      data: <span class="string">`@import "@/styles/global/index.scss";`</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果是 <code>less</code>样式文件：</p><ol><li><p>先安装依赖：<code>yarn add style-resources-loader --dev</code> （如果没有 <code>less-loader</code>，也需要安装 <code>less-loader</code>）</p></li><li><p>在 <code>src</code> 下新建目录及文件：<code>styles/global/index.less</code></p></li><li><p>修改 <code>vue.config.js</code> 的 <code>chainWebpack</code> 属性：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    chainWebpack: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> ADD_STYLE_SOURCE = <span class="function">(<span class="params">rule</span>) =&gt;</span> &#123;</span><br><span class="line">      rule.use(<span class="string">"style-resource"</span>)</span><br><span class="line">        .loader(<span class="string">"style-resources-loader"</span>)</span><br><span class="line">        .options(&#123;</span><br><span class="line">          patterns: [resolve(<span class="string">'src/styles/global/index.less'</span>)]</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> TYPES = [<span class="string">'vue-modules'</span>, <span class="string">'vue'</span>, <span class="string">'normal-modules'</span>, <span class="string">'normal'</span>]</span><br><span class="line">    TYPES.forEach(<span class="function"><span class="params">type</span> =&gt;</span> ADD_STYLE_SOURCE(config.module.rule(<span class="string">'less'</span>).oneOf(type)))</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="针对请求数优化"><a href="#针对请求数优化" class="headerlink" title="针对请求数优化"></a>针对请求数优化</h3><p>修改 <code>vue.config.js</code> 中的 <code>chainWebpakc</code> 属性：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    chainWebpack: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">		config.plugins.delete(<span class="string">"prefetch"</span>);</span><br><span class="line">        config.plugins.delete(<span class="string">"preload"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="CDN加载优化"><a href="#CDN加载优化" class="headerlink" title="CDN加载优化"></a>CDN加载优化</h3><ol><li><p>先安装 <code>axios</code> 插件：<code>yarn add axios</code></p></li><li><p>修改 <code>vue.config.js</code>（注意此处还进行了压缩 <code>html</code> 中的 <code>css</code> 优化）：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">const</span> IS_PRODUCTION = process.env.NODE_ENV === <span class="string">"production"</span>;</span><br><span class="line">    <span class="keyword">const</span> cdn = &#123;</span><br><span class="line">        css: [],</span><br><span class="line">        js: [</span><br><span class="line">            <span class="string">"https://cdn.bootcdn.net/ajax/libs/vue/2.6.11/vue.min.js"</span>,</span><br><span class="line">            <span class="string">"https://cdn.bootcdn.net/ajax/libs/vue-router/3.2.0/vue-router.min.js"</span>,</span><br><span class="line">            <span class="string">"https://cdn.bootcdn.net/ajax/libs/vuex/3.5.1/vuex.min.js"</span>,</span><br><span class="line">            <span class="string">"https://cdn.bootcdn.net/ajax/libs/axios/0.19.2/axios.min.js"</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> externals = &#123;</span><br><span class="line">      vue: <span class="string">"Vue"</span>,</span><br><span class="line">      vuex: <span class="string">"Vuex"</span>,</span><br><span class="line">      <span class="string">"vue-router"</span>: <span class="string">"VueRouter"</span>,</span><br><span class="line">      axios: <span class="string">"axios"</span></span><br><span class="line">    &#125;;</span><br><span class="line">	</span><br><span class="line">	chainWebpack: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(IS_PRODUCTION) &#123;</span><br><span class="line">            config.plugin(<span class="string">"html"</span>).tap(<span class="function"><span class="params">args</span> =&gt;</span> &#123;</span><br><span class="line">        		args[<span class="number">0</span>].cdn = cdn;</span><br><span class="line">        		args[<span class="number">0</span>].minify.minifyCSS = <span class="literal">true</span>;</span><br><span class="line">        		<span class="keyword">return</span> args;</span><br><span class="line">      		&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">	</span><br><span class="line">	configureWebpack: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    	<span class="keyword">if</span> (IS_PRODUCTION) &#123;</span><br><span class="line">      		config.externals = EXTERNALS;</span><br><span class="line">    	&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>修改 <code>html</code> 文件：</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"icon"</span> <span class="attr">href</span>=<span class="string">"&lt;%= BASE_URL %&gt;favicon.ico"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">htmlWebpackPlugin.options.title</span> %&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用CDN的CSS文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%</span> <span class="attr">for</span> (<span class="attr">var</span> <span class="attr">i</span> <span class="attr">in</span> <span class="attr">htmlWebpackPlugin.options.cdn</span> &amp;&amp; <span class="attr">htmlWebpackPlugin.options.cdn.css</span>) &#123; %&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"&lt;%= htmlWebpackPlugin.options.cdn.css[i] %&gt;"</span> <span class="attr">rel</span>=<span class="string">"preload"</span> <span class="attr">as</span>=<span class="string">"style"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"&lt;%= htmlWebpackPlugin.options.cdn.css[i] %&gt;"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用CDN的JS文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%</span> <span class="attr">for</span> (<span class="attr">var</span> <span class="attr">i</span> <span class="attr">in</span> <span class="attr">htmlWebpackPlugin.options.cdn</span> &amp;&amp; <span class="attr">htmlWebpackPlugin.options.cdn.js</span>) &#123; %&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"&lt;%= htmlWebpackPlugin.options.cdn.js[i] %&gt;"</span> <span class="attr">rel</span>=<span class="string">"preload"</span> <span class="attr">as</span>=<span class="string">"script"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">noscript</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">strong</span>&gt;</span>We're sorry but <span class="tag">&lt;<span class="name">%=</span> <span class="attr">htmlWebpackPlugin.options.title</span> %&gt;</span> doesn't work properly without JavaScript enabled. Please enable it to continue.<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- built files will be auto injected --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%</span> <span class="attr">for</span> (<span class="attr">var</span> <span class="attr">i</span> <span class="attr">in</span> <span class="attr">htmlWebpackPlugin.options.cdn</span> &amp;&amp; <span class="attr">htmlWebpackPlugin.options.cdn.js</span>) &#123; %&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&lt;%= htmlWebpackPlugin.options.cdn.js[i] %&gt;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="代码分割优化"><a href="#代码分割优化" class="headerlink" title="代码分割优化"></a>代码分割优化</h3><p>修改 <code>vue.config.js</code> 中 <code>chainWebpack</code> 属性：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    chainWebpack: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (IS_NOT_DEV) &#123;</span><br><span class="line">              config.optimization.splitChunks(&#123;</span><br><span class="line">                    chunks: <span class="string">"all"</span>,</span><br><span class="line">                    cacheGroups: &#123;</span><br><span class="line">                          libs: &#123;</span><br><span class="line">                                name: <span class="string">"chunk-libs"</span>,</span><br><span class="line">                                test: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">                                priority: <span class="number">10</span>,</span><br><span class="line">                                chunks: <span class="string">"initial"</span></span><br><span class="line">                          &#125;,</span><br><span class="line">                          commons: &#123;</span><br><span class="line">                                name: <span class="string">"chunk-commons"</span>,</span><br><span class="line">                                test: resolve(<span class="string">"src/components"</span>),</span><br><span class="line">                                minChunks: <span class="number">3</span>,</span><br><span class="line">                                priority: <span class="number">5</span>,</span><br><span class="line">                                reuseExistingChunk: <span class="literal">true</span></span><br><span class="line">                          &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">              &#125;);</span><br><span class="line">              config.optimization.runtimeChunk(<span class="string">"single"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="去除console"><a href="#去除console" class="headerlink" title="去除console"></a>去除console</h3><p>由于 <code>vue-cli 4.x</code> 采用的是 <code>terser</code> 压缩，所以跟之前 <code>vue-cli 3.x</code> 版本不一样：</p><p>修改 <code>vue.config.js</code> 中 <code>configureWebpack</code> 属性：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.export = &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    configureWebpack: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (IS_PROD) &#123;</span><br><span class="line">        config.optimization.minimizer.map(<span class="function"><span class="params">arg</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> OPTION = arg.options.terserOptions.compress;</span><br><span class="line">          OPTION.drop_console = <span class="literal">true</span>;</span><br><span class="line">          OPTION.pure_funcs = [<span class="string">"console.*"</span>];</span><br><span class="line">          arg.extractComments = <span class="literal">false</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="配置打包分析工具"><a href="#配置打包分析工具" class="headerlink" title="配置打包分析工具"></a>配置打包分析工具</h3><ol><li><p>安装插件：<code>yarn add webpack-bundle-analyzer --dev</code></p></li><li><p>修改 <code>vue.config.js</code> 中 <code>configureWebpack</code> 属性：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.export = &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    configureWebpack: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (IS_PROD) &#123;</span><br><span class="line"> 		config.plugin(<span class="string">"analyzer"</span>).use(BundleAnalyzerPlugin);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="配置gzip压缩"><a href="#配置gzip压缩" class="headerlink" title="配置gzip压缩"></a>配置gzip压缩</h3><p>这个优化需要前后端配合。</p><p>前端方面：</p><ol><li><p>安装插件：<code>yarn add compression-webpack-plugin</code></p></li><li><p>修改 <code>vue.config.js</code> 中 <code>chainWebpack</code> 属性：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.export = &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    chainWebpack: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (IS_NOT_DEV) &#123;</span><br><span class="line">        config</span><br><span class="line">          .plugin(<span class="string">"compression"</span>)</span><br><span class="line">          .use(CompressionWebpackPlugin)</span><br><span class="line">          .tap(<span class="function"><span class="params">()</span> =&gt;</span> [</span><br><span class="line">            &#123;</span><br><span class="line">              algorithm: <span class="string">"gzip"</span>,</span><br><span class="line">              test: <span class="regexp">/\.js$|\.html$|\.css/</span>,</span><br><span class="line">              threshold: <span class="number">10240</span>,</span><br><span class="line">              minRatio: <span class="number">0.8</span>,</span><br><span class="line">              deleteOriginalAssets: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">          ]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>服务端方面：</p><figure class="highlight"><table><tr><td class="code"><pre><span class="line">// nginx: nginx.conf</span><br><span class="line">server &#123;</span><br><span class="line">    gzip on;</span><br><span class="line">    gzip_buffers 4 16K;</span><br><span class="line">    gzip_comp_level 5;</span><br><span class="line">    gzip_min_length 100k;</span><br><span class="line">    gzip_types text/plain application/x-javascript application/javascript application/json text/css application/xml text/javascript image/jpeg image/gif image/png;</span><br><span class="line">    gzip_vary on;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="code"><pre><span class="line">// tomcat: server.xml</span><br><span class="line">&lt;Connector </span><br><span class="line">    port="8080" </span><br><span class="line">    protocol="HTTP/1.1"</span><br><span class="line">    connectionTimeout="20000"</span><br><span class="line"> </span><br><span class="line">    compression="on"   </span><br><span class="line">    compressableMimeType="text/html,text/xml,text/javascript,text/css,text/plain,application/javascript"</span><br><span class="line">    useSendfile="false"/&gt;</span><br></pre></td></tr></table></figure><h3 id="配置图片压缩"><a href="#配置图片压缩" class="headerlink" title="配置图片压缩"></a><del>配置图片压缩</del></h3><ol><li>安装插件：<code>cnpm install image-webpack-loader --save-dev</code>（这里使用 <code>yarn</code>安装会有点网络问题，所以这里使用 <code>cnpm</code> 安装）</li><li>修改 <code>vue.config.js</code> 中 <code>chainWebpack</code> 属性：</li></ol><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.export = &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    chainWebpack: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">        config.module</span><br><span class="line">              .rule(<span class="string">'images'</span>)</span><br><span class="line">              .use(<span class="string">'image-webpack-loader'</span>)</span><br><span class="line">              .loader(<span class="string">'image-webpack-loader'</span>)</span><br><span class="line">              .options(&#123;</span><br><span class="line">                bypassOnDebug: <span class="literal">true</span>,</span><br><span class="line">                pngquant: &#123;</span><br><span class="line">                  quality: [<span class="number">0.75</span>, <span class="number">0.90</span>],</span><br><span class="line">                  speed: <span class="number">5</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;)</span><br><span class="line">              .end()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>安装的插件：</p><ol><li><code>yarn add style-resources-loader --dev</code></li><li><code>yarn add axios</code></li><li><code>yarn add webpack-bundle-analyzer --dev</code></li><li><code>yarn add compression-webpack-plugin</code></li><li><code>yarn add dayjs</code></li><li><code>yarn add lodash</code></li><li><code>yarn add qs</code></li><li><code>yarn vue-i18n</code></li><li><code>yarn add husky</code></li><li><code>yarn add svg-sprite-loader</code></li><li><code>yarn add weixin-js-sdk</code></li></ol><p>完整 <code>vue.config.js</code>：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Overview:   Vue配置优化</span></span><br><span class="line"><span class="comment"> * @Author:     Zi_Jun</span></span><br><span class="line"><span class="comment"> * @Email:      zijun2030@163.com</span></span><br><span class="line"><span class="comment"> * @Date:       2020/7/7 20:24</span></span><br><span class="line"><span class="comment"> * @Mark:       1、 配置路径别名</span></span><br><span class="line"><span class="comment"> *              2、 配置全局样式</span></span><br><span class="line"><span class="comment"> *              3、 针对请求数优化</span></span><br><span class="line"><span class="comment"> *              4、 CDN优化,后续可根据项目需要添加</span></span><br><span class="line"><span class="comment"> *              5、 代码分割优化</span></span><br><span class="line"><span class="comment"> *              6、 生产去除console</span></span><br><span class="line"><span class="comment"> *              7、 配置打包分析工具</span></span><br><span class="line"><span class="comment"> *              8、 配置前端gzip压缩</span></span><br><span class="line"><span class="comment"> *              9、 Iconfont与SvgIcon组件共存兼容</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> CompressionWebpackPlugin = <span class="built_in">require</span>(<span class="string">"compression-webpack-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; BundleAnalyzerPlugin &#125; = <span class="built_in">require</span>(<span class="string">"webpack-bundle-analyzer"</span>);</span><br><span class="line"><span class="keyword">const</span> resolve = <span class="function"><span class="params">dir</span> =&gt;</span> path.join(__dirname, dir);</span><br><span class="line"><span class="keyword">const</span> PORT = process.env.PORT || <span class="number">8088</span>;</span><br><span class="line"><span class="keyword">const</span> IS_PROD = [<span class="string">"production"</span>, <span class="string">"prod"</span>].includes(process.env.NODE_ENV);</span><br><span class="line"><span class="keyword">const</span> IS_NOT_DEV = process.env.NODE_ENV !== <span class="string">"development"</span>;</span><br><span class="line"><span class="keyword">const</span> cdn = &#123;</span><br><span class="line">  css: [],</span><br><span class="line">  js: [</span><br><span class="line">    <span class="string">"https://cdn.bootcdn.net/ajax/libs/vue/2.6.11/vue.min.js"</span>,</span><br><span class="line">    <span class="string">"https://cdn.bootcdn.net/ajax/libs/vue-router/3.2.0/vue-router.min.js"</span>,</span><br><span class="line">    <span class="string">"https://cdn.bootcdn.net/ajax/libs/vuex/3.5.1/vuex.min.js"</span>,</span><br><span class="line">    <span class="string">"https://cdn.bootcdn.net/ajax/libs/axios/0.19.2/axios.min.js"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> externals = &#123;</span><br><span class="line">  vue: <span class="string">"Vue"</span>,</span><br><span class="line">  vuex: <span class="string">"Vuex"</span>,</span><br><span class="line">  <span class="string">"vue-router"</span>: <span class="string">"VueRouter"</span>,</span><br><span class="line">  axios: <span class="string">"axios"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  publicPath: IS_PROD ? <span class="string">"/"</span> : <span class="string">"/"</span>,</span><br><span class="line">  outputDir: process.env.OUTPUT_DIR || <span class="string">"dist"</span>,</span><br><span class="line">  productionSourceMap: <span class="literal">false</span>,</span><br><span class="line">  lintOnSave: process.env.NODE_ENV !== <span class="string">"production"</span>,</span><br><span class="line">  parallel: <span class="built_in">require</span>(<span class="string">"os"</span>).cpus().length &gt; <span class="number">1</span>,</span><br><span class="line">  pwa: &#123;</span><br><span class="line">    iconPaths: &#123;</span><br><span class="line">      favicon32: <span class="string">"favicon.ico"</span>,</span><br><span class="line">      favicon16: <span class="string">"favicon.ico"</span>,</span><br><span class="line">      appleTouchIcon: <span class="string">"favicon.ico"</span>,</span><br><span class="line">      maskIcon: <span class="string">"favicon.ico"</span>,</span><br><span class="line">      msTileImage: <span class="string">"favicon.ico"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  chainWebpack: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> TYPES = [<span class="string">"vue-modules"</span>, <span class="string">"vue"</span>, <span class="string">"normal-modules"</span>, <span class="string">"normal"</span>];</span><br><span class="line">    <span class="keyword">const</span> ADD_STYLE_SOURCE = <span class="function"><span class="params">rule</span> =&gt;</span> &#123;</span><br><span class="line">      rule</span><br><span class="line">        .use(<span class="string">"style-resource"</span>)</span><br><span class="line">        .loader(<span class="string">"style-resources-loader"</span>)</span><br><span class="line">        .options(&#123;</span><br><span class="line">          patterns: [resolve(<span class="string">"src/styles/global/index.less"</span>)]</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    TYPES.forEach(<span class="function"><span class="params">type</span> =&gt;</span></span><br><span class="line">      ADD_STYLE_SOURCE(config.module.rule(<span class="string">"less"</span>).oneOf(type))</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    config.plugins.delete(<span class="string">"preload"</span>);</span><br><span class="line">    config.plugins.delete(<span class="string">"prefetch"</span>);</span><br><span class="line"></span><br><span class="line">    config.resolve.alias</span><br><span class="line">      .set(<span class="string">"@"</span>, resolve(<span class="string">"src"</span>))</span><br><span class="line">      .set(<span class="string">"views"</span>, resolve(<span class="string">"src/views"</span>))</span><br><span class="line">      .set(<span class="string">"components"</span>, resolve(<span class="string">"src/components"</span>))</span><br><span class="line">      .set(<span class="string">"api"</span>, resolve(<span class="string">"src/api"</span>))</span><br><span class="line">      .set(<span class="string">"utils"</span>, resolve(<span class="string">"src/utils"</span>))</span><br><span class="line">      .set(<span class="string">"assets"</span>, resolve(<span class="string">"src/assets"</span>))</span><br><span class="line">      .set(<span class="string">"store"</span>, resolve(<span class="string">"src/store"</span>))</span><br><span class="line">      .set(<span class="string">"styles"</span>, resolve(<span class="string">"src/styles"</span>));</span><br><span class="line"></span><br><span class="line">    config.module</span><br><span class="line">      .rule(<span class="string">"svg"</span>)</span><br><span class="line">      .exclude.add(resolve(<span class="string">"src/assets/icons"</span>))</span><br><span class="line">      .end();</span><br><span class="line">    <span class="keyword">const</span> svgRule = config.module.rule(<span class="string">"icons"</span>);</span><br><span class="line">    svgRule.uses.clear();</span><br><span class="line">    svgRule.include.add(resolve(<span class="string">"src/assets/icons"</span>));</span><br><span class="line">    svgRule</span><br><span class="line">      .test(<span class="regexp">/\.svg$/</span>)</span><br><span class="line">      .use(<span class="string">"svg-sprite-loader"</span>)</span><br><span class="line">      .loader(<span class="string">"svg-sprite-loader"</span>)</span><br><span class="line">      .options(&#123;</span><br><span class="line">        symbolId: <span class="string">"icon-[name]"</span></span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (IS_NOT_DEV) &#123;</span><br><span class="line">      config.optimization.splitChunks(&#123;</span><br><span class="line">        cacheGroups: &#123;</span><br><span class="line">          vendor: &#123;</span><br><span class="line">            chunks: <span class="string">"all"</span>,</span><br><span class="line">            test: <span class="regexp">/node_modules/</span>,</span><br><span class="line">            name: <span class="string">"vendor"</span>,</span><br><span class="line">            minChunks: <span class="number">1</span>,</span><br><span class="line">            maxInitialRequests: <span class="number">5</span>,</span><br><span class="line">            minSize: <span class="number">0</span>,</span><br><span class="line">            priority: <span class="number">100</span></span><br><span class="line">          &#125;,</span><br><span class="line">          common: &#123;</span><br><span class="line">            chunks: <span class="string">"all"</span>,</span><br><span class="line">            test: <span class="regexp">/[\\/]src[\\/]js[\\/]/</span>,</span><br><span class="line">            name: <span class="string">"common"</span>,</span><br><span class="line">            minChunks: <span class="number">2</span>,</span><br><span class="line">            maxInitialRequests: <span class="number">5</span>,</span><br><span class="line">            minSize: <span class="number">0</span>,</span><br><span class="line">            priority: <span class="number">60</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      config.optimization.runtimeChunk(<span class="string">"single"</span>);</span><br><span class="line">      config.optimization.minimize(<span class="literal">true</span>);</span><br><span class="line">      config</span><br><span class="line">        .plugin(<span class="string">"compression"</span>)</span><br><span class="line">        .use(CompressionWebpackPlugin)</span><br><span class="line">        .tap(<span class="function"><span class="params">()</span> =&gt;</span> [</span><br><span class="line">          &#123;</span><br><span class="line">            algorithm: <span class="string">"gzip"</span>,</span><br><span class="line">            test: <span class="regexp">/\.js$|\.html$|\.css/</span>,</span><br><span class="line">            threshold: <span class="number">10240</span>,</span><br><span class="line">            minRatio: <span class="number">0.8</span>,</span><br><span class="line">            deleteOriginalAssets: <span class="literal">false</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (IS_PROD) &#123;</span><br><span class="line">      config.plugin(<span class="string">"html"</span>).tap(<span class="function"><span class="params">args</span> =&gt;</span> &#123;</span><br><span class="line">        args[<span class="number">0</span>].cdn = cdn;</span><br><span class="line">        args[<span class="number">0</span>].minify.minifyCSS = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> args;</span><br><span class="line">      &#125;);</span><br><span class="line">      config.plugin(<span class="string">"analyzer"</span>).use(BundleAnalyzerPlugin);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  configureWebpack: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (IS_PROD) &#123;</span><br><span class="line">      config.externals = externals;</span><br><span class="line">      config.optimization.minimizer.map(<span class="function"><span class="params">arg</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> OPTION = arg.options.terserOptions.compress;</span><br><span class="line">        OPTION.drop_console = <span class="literal">true</span>;</span><br><span class="line">        OPTION.pure_funcs = [<span class="string">"console.*"</span>];</span><br><span class="line">        arg.extractComments = <span class="literal">false</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    host: <span class="built_in">require</span>(<span class="string">"./src/utils/get-ip"</span>),</span><br><span class="line">    port: PORT,</span><br><span class="line">    open: <span class="literal">true</span>,</span><br><span class="line">    https: <span class="literal">false</span>,</span><br><span class="line">    compress: <span class="literal">false</span>,</span><br><span class="line">    overlay: &#123;</span><br><span class="line">      warnings: <span class="literal">true</span>,</span><br><span class="line">      errors: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Vue</category>
        <category>集成</category>
      </categories>
      <tags>
        <tag>集成</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue集成4-总结整理</title>
    <url>/archives/d89bc9ca.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Vue项目基于 <code>Vue</code> + <code>Vant</code> 的二次集成及优化。以便开箱即用。</p><a id="more"></a><p>前面3篇只是记录了项目的部分集成及优化过程，由于时间原因，再此做了一个项目的总结。</p><h3 id="项目优势"><a href="#项目优势" class="headerlink" title="项目优势"></a>项目优势</h3><p><img data-src="../../assets/vue-h5.jpg" alt="vue-h5"></p><h3 id="项目地址"><a href="#项目地址" class="headerlink" title="项目地址"></a>项目地址</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">https://github.com/zijunwork/vue-h5.git</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Vue</category>
        <category>集成</category>
      </categories>
      <tags>
        <tag>集成</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue集成1-生成项目</title>
    <url>/archives/c373e9aa.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Vue项目基于 <code>Vue</code> + <code>Vant</code> 的二次集成及优化。以便开箱即用。</p><a id="more"></a><h3 id="安装Vue"><a href="#安装Vue" class="headerlink" title="安装Vue"></a>安装Vue</h3><p>具体的安装可以参照 <a href="https://cli.vuejs.org/zh/guide/" target="_blank" rel="noopener external nofollow noreferrer">官网</a>。</p><ol><li>打开cmd</li><li>安装 <code>Vue-cli</code>：<code>npm install @vue/cli -g</code></li><li>安装 <code>yarn</code>：<code>npm install yarn -g</code>（可以不使用 <code>yarn</code>）</li><li>切换到对应磁盘，以便建立项目：<code>E:</code></li><li>这里以UI形式创建项目：<code>vue ui</code></li><li>创建完成项目、安装依赖：<code>yarn install</code></li></ol><h3 id="集成Vant"><a href="#集成Vant" class="headerlink" title="集成Vant"></a>集成Vant</h3><ol><li><p>安装 <code>vant</code>：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yarn add vant</span><br><span class="line">yarn add babel-plugin-import --dev</span><br></pre></td></tr></table></figure></li><li><p>配置 <code>.babel.config.js</code>：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  presets: [<span class="string">"@vue/cli-plugin-babel/preset"</span>],</span><br><span class="line">  plugins: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"import"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        libraryName: <span class="string">"vant"</span>,</span><br><span class="line">        libraryDirectory: <span class="string">"es"</span>,</span><br><span class="line">        style: <span class="literal">true</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">"vant"</span></span><br><span class="line">    ]</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li></ol><h3 id="集成Rem"><a href="#集成Rem" class="headerlink" title="集成Rem"></a>集成Rem</h3><ol><li><p>安装插件：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yarn add postcss-pxtorem --dev</span><br><span class="line">yarn add amfe-flexible</span><br></pre></td></tr></table></figure></li><li><p><code>main.js</code> 引入：<code>import “amfe-flexible”</code></p></li><li><p>修改(新建) <code>post.config.js</code>：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins: &#123;</span><br><span class="line">    autoprefixer: &#123;</span><br><span class="line">      overrideBrowserslist: [</span><br><span class="line">        <span class="string">"Android 4.1"</span>,</span><br><span class="line">        <span class="string">"iOS 7.1"</span>,</span><br><span class="line">        <span class="string">"Chrome &gt; 31"</span>,</span><br><span class="line">        <span class="string">"ff &gt; 31"</span>,</span><br><span class="line">        <span class="string">"ie &gt;= 8"</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"postcss-pxtorem"</span>: &#123;</span><br><span class="line">      rootValue: <span class="number">37.5</span>,</span><br><span class="line">      propList: [<span class="string">"*"</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li></ol><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Vue</category>
        <category>集成</category>
      </categories>
      <tags>
        <tag>集成</tag>
      </tags>
  </entry>
  <entry>
    <title>读《启示录-打造用户喜爱的产品》</title>
    <url>/archives/f9d474c3.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录阅读《启示录-打造用户喜爱的产品》一书的重点笔记。</p><a id="more"></a><p>打造一款成功产品的十条规律：</p><ol><li><p>产品经理的任务是探索产品的价值、可用性、可行性。</p></li><li><p>探索（定义）产品需要产品经理、交互设计师、软件架构师的通力合作。</p></li><li><p>开发人眼不擅长用户体验设计，因为开发人员脑子里想的是实现模型，而用户看重的是产品的概念模型。</p></li><li><p>用户体验设计就是交互设计、视觉设计。</p></li><li><p>功能（产品需求）和用户体验设计密不可分。</p></li><li><p>产品创意必须尽早的、反复的接受目标用户的试用，以便获取有效的用户体验。</p></li><li><p>为了验证产品的价值和可用性，必须尽早的、反复的请目标用户测试产品创意。</p></li><li><p>采用高保真的产品原型是全体团队成员了解用户需求和用户体验最有效的途径。</p></li><li><p>产品经理的目标是在最短的时间内把握复杂的市场、用户需求，确定产品的基本要求-价值、可用性、可行性。</p></li><li><p>一旦认定产品符合以上基本要求，它就是一个完整的概念，去掉任何因素，都不可能达到预期结果。</p></li></ol><h2 id="人员"><a href="#人员" class="headerlink" title="人员"></a>人员</h2><p>人员是指负责定义和开发产品的团队成员的角色和职责。</p><h3 id="界定产品经理和产品营销人员的职责"><a href="#界定产品经理和产品营销人员的职责" class="headerlink" title="界定产品经理和产品营销人员的职责"></a>界定产品经理和产品营销人员的职责</h3><ul><li>产品经理负责详细定义待开发的产品，让真实的用户测试产品</li><li>产品营销负责向外宣传和推广产品，负责产品发布，为扩展市场销售渠道、组织营销活动、醋精产品销售提供服务</li><li>营销人员是产品经理获取产品需求的重要来源，产品经理是营销人眼获取市场营销信息的重要来源</li></ul><h3 id="界定产品管理和项目管理"><a href="#界定产品管理和项目管理" class="headerlink" title="界定产品管理和项目管理"></a>界定产品管理和项目管理</h3><ul><li>产品管理的职责是探索（定义）有价值的、可用的、可行的产品</li><li>项目管理则关注如何执行计划以按期交付产品</li></ul><h3 id="优秀项目经理的七个特点"><a href="#优秀项目经理的七个特点" class="headerlink" title="优秀项目经理的七个特点"></a>优秀项目经理的七个特点</h3><ul><li>工作紧迫感。可以传递给大家工作的积极性和高效性。</li><li>善于捕捉问题。迅速的、准确的指出问题要害，改善会议效果。</li><li>思路清晰。需要排除排期冲突，日程中断等因素，专注执行时间和效率。</li><li>用数据说话。懂得利用数据识别项目方向，确认项目进度，改善开发流程。</li><li>果断。及时向团队收集数据和建议，适时向上级汇报，帮助大家有问题利用数据做出决策。</li><li>判断力。何时催促进度，何时向上级汇报，何时收集更多信息。</li><li>态度。不能为可行性、资源不足，时间不够，资金匮乏等找借口，必须自己克服。</li></ul><h3 id="产品经理与软件开发"><a href="#产品经理与软件开发" class="headerlink" title="产品经理与软件开发"></a>产品经理与软件开发</h3><ul><li>只有与开发团结融洽合作，才有可能开发出合格的产品</li><li>形成合作关系的关键是双方承认平等-任何一方不从属于另一方</li><li>开发可以帮助产品经理完善产品定义，因为开发最清楚产品设计的可行性</li><li>开发帮助产品经理完善产品定义的3种方式<ul><li>让开发人员直接面对用户或顾客，比如要求开发人员参加产品原型测试</li><li>项开发人员了解最新的技术发展动向，讨论哪些新技术可以应用于产品</li><li>在产品的初期阶段，让开发参与产品评估，协助策划方案</li></ul></li><li>产品经理配合开发人员的3条建议<ul><li>只定义满足基本要求的产品，然后更多的与开发之间形成良好的互动</li><li>一旦进入开发阶段，尽可能避免修改产品的需求</li><li>开发阶段如果遇到诸多问题，比如，用例丢失，设计缺陷等，应迅速在维持产品基本功能，尽量避免修改的原则上，拿出解决方案</li></ul></li><li>与开发团结合作应该遵循的规则：预留余量（20%）的自主时间。在产品管理上为开发团队预留20%的自主时间，让他们自由支配。开发团结可以利用这些时间重写代码、完善架构、重构代码库中有缺陷的部分，提高系统性能，避免“需要停下来重写代码”的情形发生。</li></ul><h3 id="产品经理必须成长的技能"><a href="#产品经理必须成长的技能" class="headerlink" title="产品经理必须成长的技能"></a>产品经理必须成长的技能</h3><ul><li>时间管理。熟练，迅速的区分重要任务和紧急任务，合理的规划和安排时间</li><li>对产品的热情。如果是你，你打算怎样完善自己最喜欢的产品</li><li>运用技术的能力。多学习和理解技术，并适时运用于产品当中</li><li>沟通技能。头口表达和书面表达。条理清晰，言简意赅。演讲推荐：《演讲致胜：讲故事的一书》</li><li>商业知识面。技术讨论、成本结构、边际效应、市场份额、产品定位和品牌等</li><li>学习思路：研发产品之前，需要学习哪些知识，需要多长时间，如何利用这些知识</li></ul><h3 id="产品总监"><a href="#产品总监" class="headerlink" title="产品总监"></a>产品总监</h3><ul><li>建设产品团队。注意要雇佣比自己聪明的人，团队成员的出色表现就是自己的出色表现</li><li>规划公司的产品战略。产品总监要负责制定产品组合路线图，兼顾用户需求和商业目标，从全局出发制定产品发布计划</li></ul><h3 id="产品经理的目标管理"><a href="#产品经理的目标管理" class="headerlink" title="产品经理的目标管理"></a>产品经理的目标管理</h3><ul><li>永远不要告诉别人怎么做。告诉他们做什么，他们自然会发挥天赋，给你惊喜</li><li>留给用户体验设计师和开发人员的空间越大，他们就越有可能打造出用户喜爱的产品</li></ul><h3 id="管理上司的几条经验"><a href="#管理上司的几条经验" class="headerlink" title="管理上司的几条经验"></a>管理上司的几条经验</h3><ol><li>为项目波动做好准备。提高警惕，记录工作进度。指定项目计划时，预留出时间应对变化和调整，做好“做无用功”的心理准备</li><li>注意沟通的方式和频率。有写人喜欢用邮件、聊天软件或是口头汇报，弄清上司的喜好，对症下药</li><li>会前沟通。组织好会议的诀窍是在正式会议召开前充分沟通，也就是逐一向高管和上司确认你的观点和建议，确保会议取得大家的一致意见，确保会议的高效率性</li><li>多提建议，少谈问题。管理者希望听到解决问题的方法，而不是抱怨。所以在提出问题的同时，并附上你的依据和建议</li><li>向上司借力。把想法告诉上司，让上司向高管传达建议</li><li>充分准备。在思路和计划上的漏洞多做思考做到事无巨细</li><li>多用数据和事实说话。多做准备工作，收集事实和数据，才有说服力</li></ol><h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><p>流程是指探索、开发富有创意的产品时，反复应用的步骤和成功的实践经验。</p><h3 id="评估产品机会"><a href="#评估产品机会" class="headerlink" title="评估产品机会"></a>评估产品机会</h3><ol><li>产品要解决什么问题？（产品价值）</li><li>为谁解决这个问题？（目标市场）</li><li>成功的机会有多大？（市场规模）</li><li>怎样判断产品成功与否？（度量指标或收益指标）</li><li>有哪些同类产品？（竞争格局）</li><li>为什么我们适合做这个产品？（竞争优势）</li><li>时机合适吗？（市场时机）</li><li>如何把产品推向市场？（营销组合策略）</li><li>成功的必要条件是什么？（解决方案要满足的条件）</li><li>根据以上问题，给出评估结论。（继续或放弃）</li></ol><h3 id="软件项目的两个阶段"><a href="#软件项目的两个阶段" class="headerlink" title="软件项目的两个阶段"></a>软件项目的两个阶段</h3><ol><li>探索产品。弄清楚要开发什么产品，定义正确的产品。重心在分析各种创意，收集用户需求，运用新技术等</li><li>执行产品。开发该产品，正确的开发产品。重心在于执行-开发、测试、发布</li></ol><p>采用流水线方式并行开发产品。也就是说，一旦1.0版本的产品进入项目执行阶段，就开始定义2.0版本的产品。一旦前一个版本进入开发阶段，就把创造的热情投入到下一个版本中，这个版本可以收集上一个版本的问题，遗漏或建议等</p><h3 id="产品说明文档"><a href="#产品说明文档" class="headerlink" title="产品说明文档"></a>产品说明文档</h3><p>产品经理的核心责任是确保向开发团队交付具有成功潜力的产品说明文档。</p><p>理想的产品说明文档：</p><ol><li>产品说明文档应该完整地描述用户体验。不只是用户需求，还包括交互设计和视觉设计。</li><li>产品说明文档必须准确地描述软件的行为。文字和图片尽可能表达。</li><li>产品说明文档的直观化。由于受众较广，需要直接表现。</li><li>产品说明文档应该可以修改。开发阶段，总有意想不到的情况出现，需要修改说明文档以适应新情况。</li><li>产品说明文档，应该逻辑清晰，条理清晰，以主线或模块划分。</li></ol><p>只有一种形式的产品说明文档可以满足上述要求，那就是 <strong>高保真原型</strong>。</p><h3 id="用户体验设计"><a href="#用户体验设计" class="headerlink" title="用户体验设计"></a>用户体验设计</h3><p>敏捷方法里有个概念叫 “第零次迭代”，产品经理和用户体验设计师利用这段时间先完成产品设计工作，然后交由开发人员开始迭代开发。</p><h3 id="产品设计方式"><a href="#产品设计方式" class="headerlink" title="产品设计方式"></a>产品设计方式</h3><ol><li>产品经理与设计师合作设计产品的高保真原型。这个原型只具备实现商业目标的最基本的功能要求，以及良好的用户体验和吸引力。只设计基本功能的产品可以把复杂度降到最低，把开发时间减到最少。</li><li>邀请以为开发人员（比如架构师或主程序员）参与设计原型。请他检查原型，帮助产品经理和设计师估算各种功能的直接成本和间接成本，指出设计上的误区，并分析、评估尚不确定是否可行的功能。</li><li>请真实用户验证（测试）产品原型，这一点至关重要。在产品团队全力开发产品前，产品经理和设计师必须确信产品是用户需要的。</li></ol><h3 id="创新"><a href="#创新" class="headerlink" title="创新"></a>创新</h3><ul><li>创新不是发现新的问题，而是用新方法解决已有的问题。观察人们对现有产品的不满，是创新的最佳途径。</li><li>20%法则。用20%的工作时间来从事创新研究。</li></ul><h2 id="产品"><a href="#产品" class="headerlink" title="产品"></a>产品</h2><p>产品是指富有创意的产品具有的鲜明特征。</p><h3 id="苹果公司的产品启示"><a href="#苹果公司的产品启示" class="headerlink" title="苹果公司的产品启示"></a>苹果公司的产品启示</h3><ul><li>硬件为软件服务。与其他硬件公司不同，苹果公司明白硬件必须为软件服务，这种关系不能颠倒。软件直接服务用户，满足用户需求。</li><li>软件为用户体验服务。苹果公司的所有工作都围绕着产品的可用性、交互设计、视觉设计、工业设计展开。</li><li>用户体验为情感服务。他们比谁都清楚是什么让消费者为产品疯狂，他们知道怎样抓住用户的情感需求。</li><li>产品为真正的需求服务。手机并非苹果公司首创，但他们挖掘出尚未被满足的用户需求。</li></ul><h3 id="客户需求和产品需求"><a href="#客户需求和产品需求" class="headerlink" title="客户需求和产品需求"></a>客户需求和产品需求</h3><p>产品需求不能用户说了算，原因如下：</p><ol><li>在看到具体的产品之前，用户很难知道自己需要什么</li><li>用户不知道什么样的产品是可行的（在目前的技术条件下可以实现）</li><li>用户之前缺少沟通，需求很难统一</li></ol><h3 id="新瓶装老酒"><a href="#新瓶装老酒" class="headerlink" title="新瓶装老酒"></a>新瓶装老酒</h3><p>想要在成熟的市场抢占一席之地，精明的公司至少要手握两件“法宝”：</p><ol><li>对目标市场了如指掌，对现有产品的缺陷洞若观火。</li><li>跟踪最新的技术趋势，让之前无法实现的方案变得可能。</li></ol><h3 id="产品情感挖掘"><a href="#产品情感挖掘" class="headerlink" title="产品情感挖掘"></a>产品情感挖掘</h3><p>消费者分类：</p><ol><li>非理性消费者（即尝鲜者）的情感需求与大众的相同，但更为强烈。愤怒、恐惧、孤独这类消极情绪被放大后，会导致非理性消费行为。在生活中，非理性消费者为了满足情感需求，会付出大大超出解决问题本身所需要的精力和成本。</li><li>技术爱好者（即技术创新者）购买产品，仅仅是因为产品采用了新的技术。这类消费者容易误导产品经理。</li><li>普通大众具有和非理性消费者同样的情感需求，只是在程度上没有那么强烈。随着产品的完善，他们也会逐步加入消费者队伍。</li><li>理性消费者只会购买他们认为实用、成熟的产品。他们更务实，只会购买性价比合适的产品。</li><li>观望者（即跟随者）约占总数的15%,他们同样有需求，但只会购买公认好用的产品。</li></ol><p>这几类消费者中，非理性消费者最值得产品经理注意。发现产品的内在价值，比如产品经理可以深入了解他们的想法和感受，就能抓住这种情感需求。</p><h3 id="用户体验"><a href="#用户体验" class="headerlink" title="用户体验"></a>用户体验</h3><ul><li>交互设计和视觉设计缺一不可。但大部分团队缺固执地认为只要招聘一位设计师，就能完成这两项工作。</li><li>视觉设计可以满足用户的情感需求。比如：协调的配色、优美的字体、漂亮的布局等</li></ul><h3 id="大众网络服务产品的要点"><a href="#大众网络服务产品的要点" class="headerlink" title="大众网络服务产品的要点"></a>大众网络服务产品的要点</h3><ol><li>可用性。大众网络服务产品必须具有良好的用户体验。比如，页面加载缓慢让用户无法忍受，也是糟糕的用户体验。</li><li>人物角色。用户一旦过多，就应该按典型特征将用户分类。比如，到时测试就可以邀请典型用户参与。</li><li>扩展性。建议开发资源和运维资源预留20% 专门为扩展做好准备。</li><li>持续可用性。比如网络中断，系统故障，在系统设计上最好有相关方案。</li><li>保护用户隐私。</li><li>口碑营销。向推荐产品的用户给予奖励。</li><li>全球化。产品设计之初需要考虑，避免之后开发增加开发成本。</li><li>平滑部署。 逐步过渡，尽量让用户适应缓慢，比如，用户版本可切换，模块逐步重构，等。</li><li>用户社区管理。多用类似“回馈用户”的活动表达对他们的重视。</li></ol><!-- rebuild by neat -->]]></content>
      <categories>
        <category>书籍</category>
        <category>产品</category>
      </categories>
      <tags>
        <tag>书籍</tag>
        <tag>产品</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript进阶-变量声明</title>
    <url>/archives/71a05d55.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录JavaScript中变量和函数的声明，<code>let</code>, <code>const</code>, <code>function</code>, <code>var</code>。</p><a id="more"></a><p>要想搞清楚提升的本质，这里主要需要理解 <code>JavaScript</code> 变量的 <strong>创建</strong>(create)、<strong>初始化</strong>(initialize)、<strong>赋值</strong>(assign)。</p><h2 id="var声明"><a href="#var声明" class="headerlink" title="var声明"></a>var声明</h2><p>假设有如下代码：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(x); <span class="comment">// &gt; undefined</span></span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">var</span> y = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line">fn();</span><br></pre></td></tr></table></figure><p>以上代码解析：</p><ol><li><code>JavaScript</code>引擎编译阶段：创建变量 - 作用域创建函数变量 <code>fn</code> (<code>function fn(){...}</code>)</li><li><code>JavaScript</code>引擎执行阶段：进入 <code>fn</code>,为 <code>fn</code> 创建一个环境</li><li><code>JavaScript</code>引擎编译阶段：创建变量 - 作用域创建变量 <code>x</code>, <code>y</code></li><li><code>JavaScript</code>引擎编译阶段：初始化变量 - <code>x</code>, <code>y</code> 分别为 <code>undefined</code></li><li><code>JavaScript</code>引擎执行阶段：赋值 - <code>x</code> 赋值为1， <code>y</code> 赋值为2</li></ol><p>结论：<code>var</code> 声明会在代码执行之前（编译阶段）就完成了变量的 <strong>创建</strong>、<strong>初始化</strong>。这就解释了为什么在 <code>var x = 1;</code>之前，<code>console.log(x)</code> 会得到 <code>undefined</code>。</p><h2 id="function声明"><a href="#function声明" class="headerlink" title="function声明"></a>function声明</h2><p>假设有如下代码，也可以看上面的一段代码：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">fn2();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">3</span>); <span class="comment">// &gt; 3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上代码解析：</p><ol><li><code>JavaScript</code>引擎编译阶段：创建变量 - 作用域创建函数变量 <code>fn2</code> (<code>function fn2(){...}</code>)</li><li><code>JavaScript</code>引擎执行阶段：进入 <code>fn2</code>,为 <code>fn2</code> 创建一个环境</li><li><code>JavaScript</code>引擎执行阶段：执行代码</li></ol><div class="note warning no-icon"><p><code>var a = 1;</code> 的提升，相当于在顶部执行了 <code>var a;</code> 和 <code>a = 1;</code> <strong>创建</strong> 和 <strong>初始化</strong></p><p><code>function fn(){}</code> 的创建相当于把这个函数整体提升到了顶部，<strong>创建</strong> 和 <strong>初始化</strong>，并不存在 <strong>赋值</strong> 一说，因为按照《你不知道的JavaScript(上卷)》的解释：</p><blockquote><p>如果将函数声明 <code>function fn(a) {..}</code> 概念化为普通的变量声明和赋值，比如 <code>var fn;</code> <code>fn = function(a){..}</code> 。如果这样理解的话，这个函数声明将需要进行LHS查询。实际上引擎在执行代码时，不会有专门用来将一个函数值 “分配给” <code>fn</code>。因此，将函数声明理解成LHS查询和赋值的形式并不合适。</p></blockquote></div><h2 id="let声明"><a href="#let声明" class="headerlink" title="let声明"></a>let声明</h2><p>假设有如下代码:</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(x); <span class="comment">// Uncaught ReferenceError: Cannot access 'x' before initialization</span></span><br><span class="line">    <span class="keyword">let</span> x;</span><br><span class="line">    x = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上代码解析：</p><ol><li><code>JavaScript</code>引擎编译阶段(块作用域)：创建变量 - 创建变量 <code>x</code></li><li><code>JavaScript</code>引擎执行阶段(块作用域)：执行代码 <code>console.log(x)</code>，RHS查询变量 <code>x</code></li><li><code>JavaScript</code>引擎执行阶段(块作用域)：初始化 - <code>x</code> 初始化 <code>x = undefined</code></li><li><code>JavaScript</code>引擎执行阶段(块作用域)：赋值 - 变量 <code>x</code> 赋值为2</li></ol><div class="note warning no-icon"><p>为何不是报错为 <code>undefined</code>？个人总结如下：</p><ul><li><code>defined/undefined</code> 界定的标准是：变量是否创建和初始化</li></ul></div><p>上面代码，可以直观感受到 <code>let</code> 中没有变量提升，因为在变量声明之前使用变量都报错了。如果按照 <code>var</code> 申明变量的逻辑分析，如果有变量提升，那么在对 <code>x</code> 进行RHS查询的时候，不应该报错。真的是 <code>let</code> 中没有变量提升吗？看以下例子：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="number">1</span>;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(x); <span class="comment">// Uncaught ReferenceError: Cannot access 'x' before initialization</span></span><br><span class="line">    <span class="keyword">let</span> x;</span><br><span class="line">    x = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上代码解析：</p><ol><li><code>JavaScript</code>引擎编译阶段(外层)：创建变量 - 创建变量 <code>x</code> 并初始化 <code>x = 1</code></li><li><code>JavaScript</code>引擎编译阶段(内层)：创建变量 - 创建变量 <code>x</code></li><li><code>JavaScript</code>引擎执行阶段(内层)：执行代码 <code>console.log(x)</code>，<code>RHL</code>查询变量 <code>x</code></li><li><code>JavaScript</code>引擎执行阶段(内层)：初始化 - <code>x = undefined</code></li><li><code>JavaScript</code>引擎执行阶段(内层)：赋值 - <code>x = 2</code></li></ol><p>从这段代码可以看出，内层环境中 <code>x</code> 变量肯定是有提升的，不然，按照作用域的查询规格，就会查找外层的 <code>x</code>。</p><div class="note warning no-icon"><p>以上2段的代码可以总结出：</p><ul><li><code>var</code> 声明变量，其创建和初始化都是在编译过程中完成的，赋值在执行阶段</li><li><code>let</code> 声明变量，其创建是在编译过程中完成的，初始化和赋值则是在执行过程中完成的</li><li><code>defined/undefined</code> 界定的标准是：变量是否创建和初始化</li><li><code>initialization</code> 界定的标准是：变量是否初始化</li></ul></div><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul><li><code>var</code> 声明变量，在引擎编译阶段完成变量的创建和初始化，也就是创建和初始化被提升了，变量赋值在引擎执行阶段</li><li><code>let</code> 声明变量，在引擎编译阶段完成变量的创建，也就是创建被提升了，变量初始化和赋值在引擎执行阶段</li><li><code>function</code> 声明函数，在引擎编译阶段完成函数的创建和初始化，也就是创建和初始化被提升了，不存在赋值一说</li><li><code>const</code> 声明常量，在引擎编译阶段完成变量的创建，也就是创建被提升了，变量初始化在引擎执行阶段，不允许赋值</li></ul><!-- rebuild by neat -->]]></content>
      <categories>
        <category>前端</category>
        <category>JavaScript</category>
        <category>进阶</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>前端</tag>
      </tags>
  </entry>
  <entry>
    <title>Window Terminal美化</title>
    <url>/archives/53fc366f.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Window Terminal 美化教程。</p><p>参考链接：<a href="https://www.chuchur.com/article/windows-terminal-beautify" target="_blank" rel="noopener external nofollow noreferrer">https://www.chuchur.com/article/windows-terminal-beautify</a></p><a id="more"></a><h3 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h3><p><img data-src="../../assets/20200912134239.png" alt=""></p><h3 id="安装准备"><a href="#安装准备" class="headerlink" title="安装准备"></a>安装准备</h3><ol><li>安装软件：在微软商店中搜索 <code>windows terminal</code>，安装即可。</li><li>安装字体：<code>Sarasa Term SC</code>，<a href="https://gitee.com/zijun2030/static/blob/master/fonts/sarasa-term-sc-regular.ttf" target="_blank" rel="noopener external nofollow noreferrer">下载链接</a></li><li>背景图片：<a href="https://gitee.com/zijun2030/static/blob/master/images/stack.jpg" target="_blank" rel="noopener external nofollow noreferrer">https://gitee.com/zijun2030/static/blob/master/images/stack.jpg</a></li></ol><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">// This file was initially generated by Windows Terminal 1.0.1401.0</span></span><br><span class="line"><span class="comment">// It should still be usable in newer versions, but newer versions might have additional</span></span><br><span class="line"><span class="comment">// settings, help text, or changes that you will not see unless you clear this file</span></span><br><span class="line"><span class="comment">// and let us generate a new one for you.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// To view the default settings, hold "alt" while clicking on the "Settings" button.</span></span><br><span class="line"><span class="comment">// For documentation on these settings, see: https://aka.ms/terminal-documentation</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"$schema"</span>: <span class="string">"https://aka.ms/terminal-profiles-schema"</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">"defaultProfile"</span>: <span class="string">"&#123;61c54bbd-c2c6-5271-96e7-009a87ff44bf&#125;"</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// You can add more global application settings here.</span></span><br><span class="line">    <span class="comment">// To learn more about global settings, visit https://aka.ms/terminal-global-settings</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// If enabled, selections are automatically copied to your clipboard.</span></span><br><span class="line">    <span class="attr">"copyOnSelect"</span>: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If enabled, formatted data is also copied to your clipboard</span></span><br><span class="line">    <span class="attr">"copyFormatting"</span>: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// A profile specifies a command to execute paired with information about how it should look and feel.</span></span><br><span class="line">    <span class="comment">// Each one of them will appear in the 'New Tab' dropdown,</span></span><br><span class="line">    <span class="comment">//   and can be invoked from the commandline with `wt.exe -p xxx`</span></span><br><span class="line">    <span class="comment">// To learn more about profiles, visit https://aka.ms/terminal-profile-settings</span></span><br><span class="line">    <span class="attr">"profiles"</span>:</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"defaults"</span>: &#123;</span><br><span class="line">            <span class="comment">// Put settings here that you want to apply to all profiles</span></span><br><span class="line">            <span class="attr">"acrylicOpacity"</span>: <span class="number">0.8</span>, <span class="comment">//背景透明度</span></span><br><span class="line">            <span class="attr">"useAcrylic"</span>: <span class="literal">true</span>, <span class="comment">// 启用毛玻璃</span></span><br><span class="line">            <span class="attr">"backgroundImage"</span>: <span class="string">"G:\\PCBeautiful\\stack.jpg"</span>, <span class="comment">//背景图片</span></span><br><span class="line">            <span class="attr">"backgroundImageOpacity"</span>: <span class="number">0.5</span>, <span class="comment">//图片透明度</span></span><br><span class="line">            <span class="attr">"backgroundImageStretchMode"</span>: <span class="string">"fill"</span>, <span class="comment">//填充模式</span></span><br><span class="line">            <span class="comment">// "icon": "ms-appx:///ProfileIcons/&#123;9acb9455-ca41-5af7-950f-6bca1bc9722f&#125;.png", //图标</span></span><br><span class="line">            <span class="attr">"fontFace"</span>: <span class="string">"Sarasa Term SC"</span>, <span class="comment">//字体</span></span><br><span class="line">            <span class="attr">"fontSize"</span>: <span class="number">14</span>, <span class="comment">//文字大小</span></span><br><span class="line">            <span class="attr">"colorScheme"</span>: <span class="string">"Solarized Dark"</span>, <span class="comment">//主题</span></span><br><span class="line">            <span class="attr">"cursorColor"</span>: <span class="string">"#FFFFFF"</span>, <span class="comment">//光标颜色</span></span><br><span class="line">            <span class="attr">"cursorShape"</span>: <span class="string">"bar"</span> <span class="comment">//光标形状</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"list"</span>:</span><br><span class="line">        [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// Make changes here to the powershell.exe profile.</span></span><br><span class="line">                <span class="attr">"guid"</span>: <span class="string">"&#123;61c54bbd-c2c6-5271-96e7-009a87ff44bf&#125;"</span>,</span><br><span class="line">                <span class="attr">"name"</span>: <span class="string">"Windows PowerShell"</span>,</span><br><span class="line">                <span class="attr">"commandline"</span>: <span class="string">"powershell.exe"</span>,</span><br><span class="line">                <span class="attr">"hidden"</span>: <span class="literal">false</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// Make changes here to the cmd.exe profile.</span></span><br><span class="line">                <span class="attr">"guid"</span>: <span class="string">"&#123;0caa0dad-35be-5f56-a8ff-afceeeaa6101&#125;"</span>,</span><br><span class="line">                <span class="attr">"name"</span>: <span class="string">"命令提示符"</span>,</span><br><span class="line">                <span class="attr">"commandline"</span>: <span class="string">"cmd.exe"</span>,</span><br><span class="line">                <span class="attr">"hidden"</span>: <span class="literal">false</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"guid"</span>: <span class="string">"&#123;b453ae62-4e3d-5e58-b989-0a998ec441b8&#125;"</span>,</span><br><span class="line">                <span class="attr">"hidden"</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="attr">"name"</span>: <span class="string">"Azure Cloud Shell"</span>,</span><br><span class="line">                <span class="attr">"source"</span>: <span class="string">"Windows.Terminal.Azure"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"guid"</span>: <span class="string">"&#123;d03c1390-5c3e-436e-8fc5-4dda38d15919&#125;"</span>,</span><br><span class="line">                <span class="attr">"icon"</span>: <span class="string">"ms-appx:///ProfileIcons/&#123;9acb9455-ca41-5af7-950f-6bca1bc9722f&#125;.png"</span>,</span><br><span class="line">                <span class="attr">"name"</span>: <span class="string">"Bash"</span>,</span><br><span class="line">                <span class="attr">"tabTitle"</span>: <span class="string">"Bash"</span>,</span><br><span class="line">                <span class="attr">"commandline"</span>: <span class="string">"bash.exe"</span>,</span><br><span class="line">                <span class="attr">"closeOnExit"</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"fontFace"</span>: <span class="string">"Sarasa Term SC"</span>,</span><br><span class="line">                <span class="attr">"hidden"</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="attr">"snapOnInput"</span>: <span class="literal">true</span></span><br><span class="line">              &#125;                </span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add custom color schemes to this array.</span></span><br><span class="line">    <span class="comment">// To learn more about color schemes, visit https://aka.ms/terminal-color-schemes</span></span><br><span class="line">    <span class="attr">"schemes"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"Solarized Dark"</span>,</span><br><span class="line">            <span class="attr">"black"</span>: <span class="string">"#002831"</span>,</span><br><span class="line">            <span class="attr">"red"</span>: <span class="string">"#d11c24"</span>,</span><br><span class="line">            <span class="attr">"green"</span>: <span class="string">"#738a05"</span>,</span><br><span class="line">            <span class="attr">"yellow"</span>: <span class="string">"#a57706"</span>,</span><br><span class="line">            <span class="attr">"blue"</span>: <span class="string">"#2176c7"</span>,</span><br><span class="line">            <span class="attr">"purple"</span>: <span class="string">"#c61c6f"</span>,</span><br><span class="line">            <span class="attr">"cyan"</span>: <span class="string">"#259286"</span>,</span><br><span class="line">            <span class="attr">"white"</span>: <span class="string">"#eae3cb"</span>,</span><br><span class="line">            <span class="attr">"brightBlack"</span>: <span class="string">"#475b62"</span>,</span><br><span class="line">            <span class="attr">"brightRed"</span>: <span class="string">"#bd3613"</span>,</span><br><span class="line">            <span class="attr">"brightGreen"</span>: <span class="string">"#475b62"</span>,</span><br><span class="line">            <span class="attr">"brightYellow"</span>: <span class="string">"#536870"</span>,</span><br><span class="line">            <span class="attr">"brightBlue"</span>: <span class="string">"#708284"</span>,</span><br><span class="line">            <span class="attr">"brightPurple"</span>: <span class="string">"#5956ba"</span>,</span><br><span class="line">            <span class="attr">"brightCyan"</span>: <span class="string">"#819090"</span>,</span><br><span class="line">            <span class="attr">"brightWhite"</span>: <span class="string">"#fcf4dc"</span>,</span><br><span class="line">            <span class="attr">"background"</span>: <span class="string">"#001e27"</span>,</span><br><span class="line">            <span class="attr">"foreground"</span>: <span class="string">"#708284"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"Solarized Darcula"</span>,</span><br><span class="line">            <span class="attr">"black"</span>: <span class="string">"#25292a"</span>,</span><br><span class="line">            <span class="attr">"red"</span>: <span class="string">"#f24840"</span>,</span><br><span class="line">            <span class="attr">"green"</span>: <span class="string">"#629655"</span>,</span><br><span class="line">            <span class="attr">"yellow"</span>: <span class="string">"#b68800"</span>,</span><br><span class="line">            <span class="attr">"blue"</span>: <span class="string">"#2075c7"</span>,</span><br><span class="line">            <span class="attr">"purple"</span>: <span class="string">"#797fd4"</span>,</span><br><span class="line">            <span class="attr">"cyan"</span>: <span class="string">"#15968d"</span>,</span><br><span class="line">            <span class="attr">"white"</span>: <span class="string">"#d2d8d9"</span>,</span><br><span class="line">            <span class="attr">"brightBlack"</span>: <span class="string">"#25292a"</span>,</span><br><span class="line">            <span class="attr">"brightRed"</span>: <span class="string">"#f24840"</span>,</span><br><span class="line">            <span class="attr">"brightGreen"</span>: <span class="string">"#629655"</span>,</span><br><span class="line">            <span class="attr">"brightYellow"</span>: <span class="string">"#b68800"</span>,</span><br><span class="line">            <span class="attr">"brightBlue"</span>: <span class="string">"#2075c7"</span>,</span><br><span class="line">            <span class="attr">"brightPurple"</span>: <span class="string">"#797fd4"</span>,</span><br><span class="line">            <span class="attr">"brightCyan"</span>: <span class="string">"#15968d"</span>,</span><br><span class="line">            <span class="attr">"brightWhite"</span>: <span class="string">"#d2d8d9"</span>,</span><br><span class="line">            <span class="attr">"background"</span>: <span class="string">"#3d3f41"</span>,</span><br><span class="line">            <span class="attr">"foreground"</span>: <span class="string">"#d2d8d9"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add custom keybindings to this array.</span></span><br><span class="line">    <span class="comment">// To unbind a key combination from your defaults.json, set the command to "unbound".</span></span><br><span class="line">    <span class="comment">// To learn more about keybindings, visit https://aka.ms/terminal-keybindings</span></span><br><span class="line">    <span class="attr">"keybindings"</span>:</span><br><span class="line">    [</span><br><span class="line">        <span class="comment">// Copy and paste are bound to Ctrl+Shift+C and Ctrl+Shift+V in your defaults.json.</span></span><br><span class="line">        <span class="comment">// These two lines additionally bind them to Ctrl+C and Ctrl+V.</span></span><br><span class="line">        <span class="comment">// To learn more about selection, visit https://aka.ms/terminal-selection</span></span><br><span class="line">        &#123; <span class="attr">"command"</span>: &#123;<span class="attr">"action"</span>: <span class="string">"copy"</span>, <span class="attr">"singleLine"</span>: <span class="literal">false</span> &#125;, <span class="attr">"keys"</span>: <span class="string">"ctrl+c"</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">"command"</span>: <span class="string">"paste"</span>, <span class="attr">"keys"</span>: <span class="string">"ctrl+v"</span> &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Press Ctrl+Shift+F to open the search box</span></span><br><span class="line">        &#123; <span class="attr">"command"</span>: <span class="string">"find"</span>, <span class="attr">"keys"</span>: <span class="string">"ctrl+shift+f"</span> &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Press Alt+Shift+D to open a new pane.</span></span><br><span class="line">        <span class="comment">// - "split": "auto" makes this pane open in the direction that provides the most surface area.</span></span><br><span class="line">        <span class="comment">// - "splitMode": "duplicate" makes the new pane use the focused pane's profile.</span></span><br><span class="line">        <span class="comment">// To learn more about panes, visit https://aka.ms/terminal-panes</span></span><br><span class="line">        &#123; <span class="attr">"command"</span>: &#123; <span class="attr">"action"</span>: <span class="string">"splitPane"</span>, <span class="attr">"split"</span>: <span class="string">"auto"</span>, <span class="attr">"splitMode"</span>: <span class="string">"duplicate"</span> &#125;, <span class="attr">"keys"</span>: <span class="string">"alt+shift+d"</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="安装模块"><a href="#安装模块" class="headerlink" title="安装模块"></a>安装模块</h2><ol><li><p>因为执行Install-Module会报错以下信息：因为在此系统上禁止运行脚本。有关详细信息，先以管理员权限运行windows terminal，然后执行以下命令：</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment">##允许执行脚本</span></span><br><span class="line"><span class="built_in">set-executionpolicy</span> remotesigned</span><br></pre></td></tr></table></figure></li><li><pre><code class="powershell"><span class="built_in">Install-Module</span> git<span class="literal">-aliases</span> <span class="literal">-AllowClobber</span>
<span class="built_in">Install-Module</span> posh<span class="literal">-git</span>
<span class="built_in">Install-Module</span> oh<span class="literal">-my</span><span class="literal">-posh</span> <span class="comment">#</span>
<span class="built_in">Install-Module</span> DirColors  <span class="comment">#让 ls (Get-ChildItem) 像 Unix 系终端一样具有多彩色</span>
&lt;!--￼<span class="number">2</span>--&gt;</code></pre></li><li><p>正常情况 ，你会看到 C:\Users[your name]\Documents\WindowsPowerShell\Microsoft. PowerShell_profile.ps1，编辑此文件</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Import-Module</span> DirColors</span><br><span class="line"><span class="built_in">Import-Module</span> posh<span class="literal">-git</span></span><br><span class="line"><span class="built_in">Import-Module</span> oh<span class="literal">-my</span><span class="literal">-posh</span></span><br><span class="line"><span class="built_in">Import-Module</span> git<span class="literal">-aliases</span> <span class="literal">-DisableNameChecking</span></span><br><span class="line"><span class="built_in">Set-Theme</span> PowerLine</span><br></pre></td></tr></table></figure></li></ol><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Windows</category>
        <category>Cmd</category>
      </categories>
      <tags>
        <tag>Terminal</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue集成3-样式优化</title>
    <url>/archives/90bef2f9.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Vue项目基于 <code>Vue</code> + <code>Vant</code> 的二次集成及优化。以便开箱即用。</p><a id="more"></a><h3 id="样式分离化"><a href="#样式分离化" class="headerlink" title="样式分离化"></a>样式分离化</h3><p>样式采用如下结构：</p><ul><li>全局样式（变量、方法，可在任何样式中直接使用变量和方法）</li><li>页面样式（页面、组件、重置、普通、其他，采用样式分离，需要在 <code>main</code> 引入入口文件）</li></ul><h3 id="全局样式"><a href="#全局样式" class="headerlink" title="全局样式"></a>全局样式</h3><p>根据上一篇文章：配置优化中，在打包文件中定义了全局样式，<code>/src/styles/global/index.less</code>，现在扩展如下：</p><ul><li><code>global</code><ul><li><code>_mixins.less</code></li><li><code>_variables.less</code></li><li><code>index.less</code></li></ul></li></ul><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* _mixins.less */</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Overview:   Global mixins</span></span><br><span class="line"><span class="comment"> * @Author:     Zi_Jun</span></span><br><span class="line"><span class="comment"> * @Email:      zijun2030@163.com</span></span><br><span class="line"><span class="comment"> * @Date:       2020/7/8 11:22</span></span><br><span class="line"><span class="comment"> * @Mark:       //</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*========================================</span></span><br><span class="line"><span class="comment">Layout</span></span><br><span class="line"><span class="comment">e.g.:.wh(20px)</span></span><br><span class="line"><span class="comment">========================================*/</span></span><br><span class="line"><span class="selector-class">.wh</span>(<span class="keyword">@value</span>) &#123;</span><br><span class="line">  <span class="selector-tag">width</span>: <span class="keyword">@value</span>;</span><br><span class="line">  <span class="selector-tag">height</span>: <span class="keyword">@value</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.flex-center</span>() &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*========================================</span></span><br><span class="line"><span class="comment">Ellipsis</span></span><br><span class="line"><span class="comment">e.g.: .ell()</span></span><br><span class="line"><span class="comment">========================================*/</span></span><br><span class="line"><span class="selector-class">.ell</span>() &#123;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">-ms-text-overflow</span>: ellipsis;</span><br><span class="line">  <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">  <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">  <span class="attribute">word-break</span>: break-all;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.ell2(@num: 2) &#123;</span><br><span class="line">  <span class="selector-tag">word-break</span>: <span class="selector-tag">break-all</span>;</span><br><span class="line">  <span class="selector-tag">text-overflow</span>: <span class="selector-tag">ellipsis</span>;</span><br><span class="line">  <span class="selector-tag">display</span>: <span class="selector-tag">-webkit-box</span>;</span><br><span class="line">  <span class="selector-tag">-webkit-box-orient</span>: <span class="selector-tag">vertical</span>;</span><br><span class="line">  <span class="selector-tag">-webkit-line-clamp</span>: <span class="keyword">@num</span>;</span><br><span class="line">  <span class="selector-tag">overflow</span>: <span class="selector-tag">hidden</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*========================================</span></span><br><span class="line"><span class="comment">Gradient</span></span><br><span class="line"><span class="comment">e.g.:.gradient(to right, red, yellow)</span></span><br><span class="line"><span class="comment">========================================*/</span></span><br><span class="line">.gradient(@direction: to right, @leftColor, @rightColor) &#123;</span><br><span class="line">  <span class="selector-tag">background-image</span>: <span class="selector-tag">linear-gradient</span>(<span class="keyword">@direction</span>, @leftColor, @rightColor);</span><br><span class="line">  <span class="selector-tag">background-image</span>: <span class="selector-tag">-webkit-linear-gradient</span>(<span class="keyword">@direction</span>, @leftColor, @rightColor);</span><br><span class="line">  <span class="selector-tag">background-image</span>: <span class="selector-tag">-o-linear-gradient</span>(<span class="keyword">@direction</span>, @leftColor, @rightColor);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*========================================</span></span><br><span class="line"><span class="comment">Opacity</span></span><br><span class="line"><span class="comment">e.g.:.opacity(.5)</span></span><br><span class="line"><span class="comment">========================================*/</span></span><br><span class="line"><span class="selector-class">.opacity</span>(<span class="keyword">@value</span>) &#123;</span><br><span class="line">  <span class="selector-tag">opacity</span>: <span class="keyword">@value</span>;</span><br><span class="line">  @value-ie: @value * 100;</span><br><span class="line">  filter: alpha(opacity=@value-ie);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* _variables.less */</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Overview:   Global variables</span></span><br><span class="line"><span class="comment"> * @Author:     Zi_Jun</span></span><br><span class="line"><span class="comment"> * @Email:      zijun2030@163.com</span></span><br><span class="line"><span class="comment"> * @Date:       2020/7/8 11:17</span></span><br><span class="line"><span class="comment"> * @Mark:       //</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*========================================</span></span><br><span class="line"><span class="comment">Color</span></span><br><span class="line"><span class="comment">========================================*/</span></span><br><span class="line">@theme-color: #e16531;</span><br><span class="line">@color-9: #999;</span><br><span class="line">@color-6: #666;</span><br><span class="line">@color-3: #333;</span><br><span class="line">@black: #000;</span><br><span class="line">@white: #fff;</span><br><span class="line">@gray-1: #f7f8fa;</span><br><span class="line">@gray-2: #f2f3f5;</span><br><span class="line">@gray-3: #ebedf0;</span><br><span class="line">@gray-4: #dcdee0;</span><br><span class="line">@gray-5: #c8c9cc;</span><br><span class="line">@gray-6: #969799;</span><br><span class="line">@gray-7: #646566;</span><br><span class="line">@gray-8: #323233;</span><br><span class="line">@red: #ee0a24;</span><br><span class="line">@blue: #1989fa;</span><br><span class="line">@orange: #ff976a;</span><br><span class="line">@orange-dark: #ed6a0c;</span><br><span class="line">@orange-light: #fffbe8;</span><br><span class="line">@green: #07c160;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*========================================</span></span><br><span class="line"><span class="comment">Font</span></span><br><span class="line"><span class="comment">========================================*/</span></span><br><span class="line">@font-size: 14px;</span><br><span class="line">@font: @font-size/1.2 Helvetica, Tahoma, Arial, "PingFang SC", "Hiragino Sans GB", "Heiti SC", "Microsoft YaHei", "WenQuanYi Micro Hei", sans-serif;</span><br></pre></td></tr></table></figure><h3 id="页面样式"><a href="#页面样式" class="headerlink" title="页面样式"></a>页面样式</h3><p>页面级对应，结构如下：</p><ul><li><code>components</code><ul><li><code>index.less</code></li><li><code>...</code></li></ul></li><li><code>views</code><ul><li><code>home.less</code></li><li><code>index.less</code></li><li><code>...</code></li></ul></li><li><code>common.less</code></li><li><code>reset.less</code></li><li><code>index.less</code></li></ul><p>其中 <code>styles/index.less</code> 为样式入口文件，需要在 <code>main.js</code> 中引入。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"styles/index.less"</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* common.less */</span></span><br><span class="line">*</span><br><span class="line"> * @Overview:   Common style</span><br><span class="line"> * @Author:     Zi_Jun</span><br><span class="line"> * @Email:      zijun2030@163.com</span><br><span class="line"> * @Date:       2020/7/8 14:05</span><br><span class="line"> * @Mark:       //</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">html</span>,</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">overflow-x</span>: hidden;</span><br><span class="line">  <span class="attribute">overflow-y</span>: auto;</span><br><span class="line">  <span class="attribute">background-color</span>: @gray-<span class="number">5</span>;</span><br><span class="line">  <span class="attribute">-webkit-overflow-scrolling</span>: touch;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">input</span>,</span><br><span class="line"><span class="selector-tag">button</span>,</span><br><span class="line"><span class="selector-tag">select</span>,</span><br><span class="line"><span class="selector-tag">textarea</span> &#123;</span><br><span class="line">  <span class="attribute">outline</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#app</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">font</span>: @font;</span><br><span class="line">  <span class="attribute">background-color</span>: @white;</span><br><span class="line">  <span class="attribute">-webkit-font-smoothing</span>: antialiased;</span><br><span class="line">  <span class="attribute">-moz-osx-font-smoothing</span>: grayscale;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.router</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">overflow-x</span>: hidden;</span><br><span class="line">  <span class="attribute">overflow-y</span>: auto;</span><br><span class="line">  <span class="attribute">-webkit-overflow-scrolling</span>: touch;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">user-select</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.nav-router</span> &#123;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">46px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="built_in">calc</span>(<span class="number">100%</span> - <span class="number">46px</span>);</span><br><span class="line">  @supports (bottom: env(safe-area-inset-bottom))&#123;</span><br><span class="line">    <span class="selector-tag">padding-top</span>: <span class="selector-tag">calc</span>(<span class="selector-tag">env</span>(<span class="selector-tag">safe-area-inset-top</span>) + 46<span class="selector-tag">px</span>);</span><br><span class="line">    <span class="selector-tag">padding-bottom</span>: <span class="selector-tag">env</span>(<span class="selector-tag">safe-area-inset-bottom</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">@supports</span> (<span class="attribute">bottom:</span> constant(safe-area-inset-bottom)) &#123;</span><br><span class="line">    <span class="selector-tag">padding-top</span>: <span class="selector-tag">calc</span>(<span class="selector-tag">constant</span>(<span class="selector-tag">safe-area-inset-top</span>) + 46<span class="selector-tag">px</span>);</span><br><span class="line">    <span class="selector-tag">padding-bottom</span>: <span class="selector-tag">constant</span>(<span class="selector-tag">safe-area-inset-bottom</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.common-router</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  @supports (bottom: env(safe-area-inset-bottom))&#123;</span><br><span class="line">    <span class="selector-tag">padding-top</span>: <span class="selector-tag">env</span>(<span class="selector-tag">safe-area-inset-top</span>);</span><br><span class="line">    <span class="selector-tag">padding-bottom</span>: <span class="selector-tag">env</span>(<span class="selector-tag">safe-area-inset-bottom</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">@supports</span> (<span class="attribute">bottom:</span> constant(safe-area-inset-bottom)) &#123;</span><br><span class="line">    <span class="selector-tag">padding-top</span>: <span class="selector-tag">constant</span>(<span class="selector-tag">safe-area-inset-top</span>);</span><br><span class="line">    <span class="selector-tag">padding-bottom</span>: <span class="selector-tag">constant</span>(<span class="selector-tag">safe-area-inset-bottom</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*=====================================</span></span><br><span class="line"><span class="comment"> Iconfont</span></span><br><span class="line"><span class="comment">======================================*/</span></span><br><span class="line"><span class="keyword">@font-face</span> &#123; <span class="comment">/* Unicode  */</span></span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">"iconfont"</span>;</span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">"../assets/iconfont/iconfont.eot"</span>);</span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">"../assets/iconfont/iconfont.eot?#iefix"</span>) <span class="built_in">format</span>(<span class="string">"embedded-opentype"</span>),</span><br><span class="line">  <span class="built_in">url</span>(<span class="string">"../assets/iconfont/iconfont.woff2"</span>) <span class="built_in">format</span>(<span class="string">"woff2"</span>),</span><br><span class="line">  <span class="built_in">url</span>(<span class="string">"../assets/iconfont/iconfont.woff"</span>) <span class="built_in">format</span>(<span class="string">"woff"</span>),</span><br><span class="line">  <span class="built_in">url</span>(<span class="string">"../assets/iconfont/iconfont.ttf"</span>) <span class="built_in">format</span>(<span class="string">"truetype"</span>),</span><br><span class="line">  <span class="built_in">url</span>(<span class="string">"../assets/iconfont/iconfont.svg#iconfont"</span>) <span class="built_in">format</span>(<span class="string">"svg"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.iconfont</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">"iconfont"</span>, serif <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1em</span>;</span><br><span class="line">  <span class="attribute">font-style</span>: normal;</span><br><span class="line">  <span class="attribute">-webkit-font-smoothing</span>: antialiased;</span><br><span class="line">  <span class="attribute">-moz-osx-font-smoothing</span>: grayscale;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.icon</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">1em</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">1em</span>;</span><br><span class="line">  <span class="attribute">vertical-align</span>: -<span class="number">0.15em</span>;</span><br><span class="line">  <span class="attribute">fill</span>: currentColor;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*=====================================</span></span><br><span class="line"><span class="comment"> 取消Iphone浏览器中点击默认样式</span></span><br><span class="line"><span class="comment">======================================*/</span></span><br><span class="line">*&#123;</span><br><span class="line">  <span class="attribute">-webkit-tap-highlight-color</span>: transparent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*=====================================</span></span><br><span class="line"><span class="comment"> 页面切换动画</span></span><br><span class="line"><span class="comment">======================================*/</span></span><br><span class="line"><span class="selector-class">.slide-right-enter-active</span>,</span><br><span class="line"><span class="selector-class">.slide-right-leave-active</span>,</span><br><span class="line"><span class="selector-class">.slide-left-enter-active</span>,</span><br><span class="line"><span class="selector-class">.slide-left-leave-active</span>,</span><br><span class="line"><span class="selector-class">.fade-enter-active</span>,</span><br><span class="line"><span class="selector-class">.fade-leave-active</span>&#123;</span><br><span class="line">  <span class="attribute">will-change</span>: transform;</span><br><span class="line">  <span class="attribute">transition</span>: all @transition-time ease-in-out;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.slide-right-enter</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">100%</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.slide-right-leave-active</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="number">100%</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.slide-left-enter</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="number">100%</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.slide-left-leave-active</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">100%</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fade-enter</span>,</span><br><span class="line"><span class="selector-class">.fade-leave-to</span>&#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fade-enter-tp</span>,</span><br><span class="line"><span class="selector-class">.fade-leave</span>&#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*=====================================</span></span><br><span class="line"><span class="comment"> Iphone安全区域样式兼容</span></span><br><span class="line"><span class="comment">======================================*/</span></span><br><span class="line"><span class="selector-class">.support-safe-area</span> &#123;</span><br><span class="line">  @supports (bottom: env(safe-area-inset-bottom))&#123;</span><br><span class="line">    <span class="selector-tag">padding-top</span>: <span class="selector-tag">env</span>(<span class="selector-tag">safe-area-inset-top</span>);</span><br><span class="line">    <span class="selector-tag">padding-bottom</span>: <span class="selector-tag">env</span>(<span class="selector-tag">safe-area-inset-bottom</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">@supports</span> (<span class="attribute">bottom:</span> constant(safe-area-inset-bottom)) &#123;</span><br><span class="line">    <span class="selector-tag">padding-top</span>: <span class="selector-tag">constant</span>(<span class="selector-tag">safe-area-inset-top</span>);</span><br><span class="line">    <span class="selector-tag">padding-bottom</span>: <span class="selector-tag">constant</span>(<span class="selector-tag">safe-area-inset-bottom</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*=====================================</span></span><br><span class="line"><span class="comment"> 集成常用样式</span></span><br><span class="line"><span class="comment">======================================*/</span></span><br><span class="line"><span class="comment">/* 底部 0.5px */</span></span><br><span class="line"><span class="selector-class">.bottom-line</span> &#123;</span><br><span class="line">  .bottom-line();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 四边 0.5px */</span></span><br><span class="line"><span class="selector-class">.border-line</span> &#123;</span><br><span class="line">  .border-line();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 上、下 padding 10px */</span></span><br><span class="line"><span class="selector-class">.padding-y-10</span> &#123;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 左、右 padding 10px */</span></span><br><span class="line"><span class="selector-class">.padding-x-14</span> &#123;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">padding-right</span>: <span class="number">14px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 元素居中 */</span></span><br><span class="line"><span class="selector-class">.flex-center</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Iphone安全区域兼容"><a href="#Iphone安全区域兼容" class="headerlink" title="Iphone安全区域兼容"></a>Iphone安全区域兼容</h3><p>上面文件已做处理：<code>styles/common.less</code>：</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*=====================================</span></span><br><span class="line"><span class="comment"> Iphone安全区域样式兼容</span></span><br><span class="line"><span class="comment">======================================*/</span></span><br><span class="line"><span class="selector-class">.support-safe-area</span> &#123;</span><br><span class="line">  @supports (bottom: env(safe-area-inset-bottom))&#123;</span><br><span class="line">    <span class="selector-tag">padding-bottom</span>: <span class="selector-tag">env</span>(<span class="selector-tag">safe-area-inset-bottom</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">@supports</span> (<span class="attribute">bottom:</span> constant(safe-area-inset-bottom)) &#123;</span><br><span class="line">    <span class="selector-tag">padding-bottom</span>: <span class="selector-tag">constant</span>(<span class="selector-tag">safe-area-inset-bottom</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="页面切换动画"><a href="#页面切换动画" class="headerlink" title="页面切换动画"></a>页面切换动画</h3><p>上面文件已做处理，包含两种常用效果（slide/fade）：<code>styles/common.less</code>：</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*=====================================</span></span><br><span class="line"><span class="comment"> 页面切换动画</span></span><br><span class="line"><span class="comment">======================================*/</span></span><br><span class="line"><span class="selector-class">.slide-right-enter-active</span>,</span><br><span class="line"><span class="selector-class">.slide-right-leave-active</span>,</span><br><span class="line"><span class="selector-class">.slide-left-enter-active</span>,</span><br><span class="line"><span class="selector-class">.slide-left-leave-active</span>,</span><br><span class="line"><span class="selector-class">.fade-enter-active</span>,</span><br><span class="line"><span class="selector-class">.fade-leave-active</span>&#123;</span><br><span class="line">  <span class="attribute">will-change</span>: transform;</span><br><span class="line">  <span class="attribute">transition</span>: all @transition-time ease-in-out;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.slide-right-enter</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">100%</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.slide-right-leave-active</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="number">100%</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.slide-left-enter</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="number">100%</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.slide-left-leave-active</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">100%</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fade-enter</span>,</span><br><span class="line"><span class="selector-class">.fade-leave-to</span>&#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fade-enter-tp</span>,</span><br><span class="line"><span class="selector-class">.fade-leave</span>&#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="优化Safari浏览器默认点击效果"><a href="#优化Safari浏览器默认点击效果" class="headerlink" title="优化Safari浏览器默认点击效果"></a>优化Safari浏览器默认点击效果</h3><p>上面文件已做处理：<code>styles/common.less</code>：</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*=====================================</span></span><br><span class="line"><span class="comment"> 取消Iphone浏览器中点击默认样式</span></span><br><span class="line"><span class="comment">======================================*/</span></span><br><span class="line">*&#123;</span><br><span class="line">  <span class="attribute">-webkit-tap-highlight-color</span>: transparent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="集成常用样式"><a href="#集成常用样式" class="headerlink" title="集成常用样式"></a>集成常用样式</h3><p>上面文件已做处理：<code>styles/common.less</code>：</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*=====================================</span></span><br><span class="line"><span class="comment"> 集成常用样式</span></span><br><span class="line"><span class="comment">======================================*/</span></span><br><span class="line"><span class="comment">/* 底部 0.5px */</span></span><br><span class="line"><span class="selector-class">.bottom-line</span> &#123;</span><br><span class="line">  .bottom-line();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 四边 0.5px */</span></span><br><span class="line"><span class="selector-class">.border-line</span> &#123;</span><br><span class="line">  .border-line();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 上、下 padding 10px */</span></span><br><span class="line"><span class="selector-class">.padding-y-10</span> &#123;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 左、右 padding 10px */</span></span><br><span class="line"><span class="selector-class">.padding-x-14</span> &#123;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">padding-right</span>: <span class="number">14px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 元素居中 */</span></span><br><span class="line"><span class="selector-class">.flex-center</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="重置样式"><a href="#重置样式" class="headerlink" title="重置样式"></a>重置样式</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* reset.less */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">KISSY CSS Reset</span></span><br><span class="line"><span class="comment">理念：清除和重置是紧密不可分的</span></span><br><span class="line"><span class="comment">特色：1.适应中文 2.基于最新主流浏览器</span></span><br><span class="line"><span class="comment">维护：玉伯(lifesinger@gmail.com), 正淳(ragecarrier@gmail.com)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 清除内外边距 */</span></span><br><span class="line"><span class="selector-tag">body</span>, <span class="selector-tag">h1</span>, <span class="selector-tag">h2</span>, <span class="selector-tag">h3</span>, <span class="selector-tag">h4</span>, <span class="selector-tag">h5</span>, <span class="selector-tag">h6</span>, <span class="selector-tag">hr</span>, <span class="selector-tag">p</span>, <span class="selector-tag">blockquote</span>, <span class="comment">/* structural elements 结构元素 */</span></span><br><span class="line"><span class="selector-tag">dl</span>, <span class="selector-tag">dt</span>, <span class="selector-tag">dd</span>, <span class="selector-tag">ul</span>, <span class="selector-tag">ol</span>, <span class="selector-tag">li</span>, <span class="comment">/* list elements 列表元素 */</span></span><br><span class="line"><span class="selector-tag">pre</span>, <span class="comment">/* text formatting elements 文本格式元素 */</span></span><br><span class="line"><span class="selector-tag">fieldset</span>, <span class="selector-tag">button</span>, <span class="selector-tag">input</span>, <span class="selector-tag">textarea</span>, <span class="comment">/* form elements 表单元素 */</span></span><br><span class="line"><span class="selector-tag">th</span>, <span class="selector-tag">td</span> &#123; <span class="comment">/* table elements 表格元素 */</span></span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">18px</span>; <span class="comment">/* 18px / 12px = 1.5 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h2</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h3</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h4</span>, <span class="selector-tag">h5</span>, <span class="selector-tag">h6</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">address</span>, <span class="selector-tag">cite</span>, <span class="selector-tag">dfn</span>, <span class="selector-tag">em</span>, <span class="selector-tag">var</span> &#123;</span><br><span class="line">  <span class="attribute">font-style</span>: normal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 将斜体扶正 */</span></span><br><span class="line"><span class="selector-tag">code</span>, <span class="selector-tag">kbd</span>, <span class="selector-tag">pre</span>, <span class="selector-tag">samp</span>, <span class="selector-tag">tt</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">"Courier New"</span>, Courier, monospace;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 统一等宽字体 */</span></span><br><span class="line"><span class="selector-tag">small</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 小于 12px 的中文很难阅读，让 small 正常化 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 重置列表元素 */</span></span><br><span class="line"><span class="selector-tag">ul</span>, <span class="selector-tag">ol</span> &#123;</span><br><span class="line">  <span class="attribute">list-style</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 重置文本格式元素 */</span></span><br><span class="line"><span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">text-decoration</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">text-decoration</span>: underline;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">abbr</span><span class="selector-attr">[title]</span>, <span class="selector-tag">acronym</span><span class="selector-attr">[title]</span> &#123; <span class="comment">/* 注：1.ie6 不支持 abbr; 2.这里用了属性选择符，ie6 下无效果 */</span></span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> dotted;</span><br><span class="line">  <span class="attribute">cursor</span>: help;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">q</span><span class="selector-pseudo">:before</span>, <span class="selector-tag">q</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">''</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 重置表单元素 */</span></span><br><span class="line"><span class="selector-tag">legend</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#000</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* for ie6 */</span></span><br><span class="line"><span class="selector-tag">fieldset</span>, <span class="selector-tag">img</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* img 搭车：让链接里的 img 无边框 */</span></span><br><span class="line"><span class="comment">/* 注：optgroup 无法扶正 */</span></span><br><span class="line"><span class="selector-tag">button</span>, <span class="selector-tag">input</span>, <span class="selector-tag">select</span>, <span class="selector-tag">textarea</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">100%</span>; <span class="comment">/* 使得表单元素在 ie 下能继承字体大小 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 重置表格元素 */</span></span><br><span class="line"><span class="selector-tag">table</span> &#123;</span><br><span class="line">  <span class="attribute">border-collapse</span>: collapse;</span><br><span class="line">  <span class="attribute">border-spacing</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 重置 hr */</span></span><br><span class="line"><span class="selector-tag">hr</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">1px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 让非ie浏览器默认也显示垂直滚动条，防止因滚动条引起的闪烁 */</span></span><br><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line">  <span class="attribute">overflow-y</span>: scroll;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Vue</category>
        <category>集成</category>
      </categories>
      <tags>
        <tag>集成</tag>
      </tags>
  </entry>
  <entry>
    <title>前端优化-浏览器解析调试</title>
    <url>/archives/8bab0c48.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录网页性能-浏览器解析HTML、CSS、JavaScript的过程记录。</p><a id="more"></a><h3 id="最简单的页面"><a href="#最简单的页面" class="headerlink" title="最简单的页面"></a>最简单的页面</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"stack.jpg"</span> <span class="attr">alt</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>打开浏览的调试控制台，查看瀑布：</p><p><img data-src="../../assets/20200616153608.png" alt=""></p><p><img data-src="../../assets/20200616154431.png" alt=""></p><p><img data-src="../../assets/20200616154213.png" alt=""></p><ol><li><strong>浅蓝色条</strong>标识浏览器从发起请求到接收服务器返回第一个字节的时间，即 请求等待 时间(TTFB)：46毫秒。</li><li><strong>深蓝色条</strong>标识真正的HTML页面的下载时间，即 内容下载 时间：2毫秒。</li><li><strong>紫色虚线矩形</strong>表示浏览器下载完成HTML之后开始构建DOM，当发现第一个DOM标签（<code>&lt;image&gt;</code>）时所花费的时间。由此可见：DOM的顺序执行的，当发现 <code>&lt;image&gt;</code> 时便立即发起请求。</li><li><strong>绿色（浅绿色+深绿色）</strong>条标识 <code>&lt;image&gt;</code> 发起请求时等待到下载图片所消耗的时间：417毫秒。</li><li><strong>蓝色竖线</strong>所处的时间为DOMContentLoaded，即DOM内容加载完成或者说浏览器解析完文档的时间：170毫秒。它的触发不需要等待图片等其他资源加载完成。</li><li><strong>红色竖线</strong>所处的时间为Load，即页面所有资源加载完成的时间：532毫秒。</li></ol><h3 id="含有CSS的页面"><a href="#含有CSS的页面" class="headerlink" title="含有CSS的页面"></a>含有CSS的页面</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"my-style.css"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"stack.jpg"</span> <span class="attr">alt</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>打开浏览的调试控制台，查看瀑布：</p><p><img data-src="../../assets/20200616162103.png" alt=""></p><ol><li><strong>蓝色竖线</strong>位于<strong>紫色条</strong>之后，说明DOMContentLoaded，即解析完文档必须等待CSS解析完成。也就是构建DOM树必须等待CSS解析完成。</li><li><strong>紫色条</strong>和<strong>绿色条</strong>开始的时间几乎相同，说明 <code>&lt;head&gt;</code> 和 <code>&lt;body&gt;</code> DOM位于相同层级的DOM。</li></ol><h3 id="浏览器解析流程图"><a href="#浏览器解析流程图" class="headerlink" title="浏览器解析流程图"></a>浏览器解析流程图</h3><p><img data-src="../../assets/20200616183434.png" alt=""></p><h3 id="含有JavaScript和CSS的页面"><a href="#含有JavaScript和CSS的页面" class="headerlink" title="含有JavaScript和CSS的页面"></a>含有JavaScript和CSS的页面</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"my-style.css"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"stack.jpg"</span> <span class="attr">alt</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"changeImgSize.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>打开浏览的调试控制台，查看瀑布：</p><p><img data-src="../../assets/20200616165254.png" alt=""></p><ol><li>由于JavaScript代码可能会更改CSS属性或者是DOM的结构，所以在形成Render Tree之前必须等待JavaScript解析完成才能接着构建Render Tree。</li><li>将 Javascript 放在 <code>head</code> 内和 <code>body</code> 底部的区别也在于此，放在 <code>head</code> 里面，由于浏览器发现 <code>head</code> 里面有 Javascript 标签就会暂时停止其他渲染行为，等待 Javascript 下载并执行完成才能接着往下渲染，而这个时候由于在 <code>head</code> 里面这个时候页面是白的，如果将 Javascript 放在页面底部，RenderTree 已经完成大部分，所以此时页面有内容呈现，即使遇到 Javascript 阻塞渲染，也不会有白屏出现。</li></ol><h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>当浏览器从服务器接收到了 HTML 文档，并把 HTML 在内存中转换成 DOM 树，在转换的过程中如果发现某个节点 (node) 上引用了 CSS 或者 IMAGE，就会再发 1 个 request 去请求 CSS 或 image, 然后继续执行下面的转换，而不需要等待 request 的返回，当 request 返回 后，只需要把返回的内容放入到 DOM 树中对应的位置就 OK。但当引用了 JS 的时候，浏览器发送 1 个 js request 就会一直等待该 request 的返回。因为浏览器需要 1 个稳定的 DOM 树结构，而 JS 中很有可能有代码直接改变了 DOM 树结构，浏览器为了防止出现 JS 修改 DOM 树，需要重新构建 DOM 树的情况，所以 就会阻塞其他的下载和呈现。</p><ol><li>在 <code>&lt;head&gt;</code> 里尽量不要引入JavaScript。</li><li>如果要在 <code>&lt;head&gt;</code> 引入JavaScript，尽量将JavaScript内嵌。</li><li>把内嵌 <code>JavaScript</code> 放在所有CSS的前面。</li></ol><!-- rebuild by neat -->]]></content>
      <categories>
        <category>前端</category>
        <category>优化</category>
      </categories>
      <tags>
        <tag>优化</tag>
        <tag>调试</tag>
      </tags>
  </entry>
  <entry>
    <title>Anywhere本地静态服务</title>
    <url>/archives/f1c4558.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录本地服务的开启，anywhere的使用，类似有live-server。</p><a id="more"></a><h2 id="开启本地静态服务"><a href="#开启本地静态服务" class="headerlink" title="开启本地静态服务"></a>开启本地静态服务</h2><ol><li><code>npm install anywhere -g</code> ， 全局安装 <code>anywhere</code></li><li>cmd键入到要启动静态服务的目录</li><li><code>anywhere</code> 或者 <code>anywhere -p 7890</code> 启动静态服务</li></ol><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Windows</category>
        <category>Server</category>
      </categories>
      <tags>
        <tag>Anywhere</tag>
        <tag>静态服务</tag>
      </tags>
  </entry>
  <entry>
    <title>Live-Server本地静态服务</title>
    <url>/archives/eb7f8542.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录本地服务的开启，live-server的使用，类似有anywhere。</p><a id="more"></a><h2 id="开启本地静态服务"><a href="#开启本地静态服务" class="headerlink" title="开启本地静态服务"></a>开启本地静态服务</h2><ol><li><code>npm install live-server -g</code> ， 全局安装 <code>live-server</code></li><li>cmd键入到要启动静态服务的目录</li><li><code>live-server</code> 或者 <code>live-server --port=7876</code> 启动静态服务</li></ol><div class="note info"><p>live-server 对比 anywhere ：live-serve 支持热更新，而anywhere则需要手动刷新。</p></div><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Windows</category>
        <category>Server</category>
      </categories>
      <tags>
        <tag>静态服务</tag>
        <tag>Live-Server</tag>
      </tags>
  </entry>
  <entry>
    <title>7个简单但棘手的面试题</title>
    <url>/archives/5a25d9e0.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本次主要记录整理-<code>JavaScript</code>的一些面试题。</p><p>原链接名：《JS-7个简单但棘手的JavaScript面试问题》</p><a id="more"></a><h3 id="意外全局变量"><a href="#意外全局变量" class="headerlink" title="意外全局变量"></a>意外全局变量</h3><p><strong>问题</strong></p><p>以下代码段中用于运算 <code>typeof a</code> 和 <code>typeof b</code> 的内容：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> a = b = <span class="number">0</span>;</span><br><span class="line">    a++;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo();</span><br><span class="line"><span class="keyword">typeof</span> a;</span><br><span class="line"><span class="keyword">typeof</span> b;</span><br></pre></td></tr></table></figure><details><summary>答案</summary>undefined number<br>这里需要注意的是: <code>let a = b = 0;</code> 和 <code>let a = 0, b = 0;</code> 的区别。<br><ul><li><code>let a = b = 0;</code> 相当于 <code>b = 0;</code> <code>let a = b;</code>。注意, <code>b = 0</code> 的前面是没有 <code>let</code> 声明的,所以这句代码就相当于 <code>window.b = 0;</code>,所以, <code>b</code> 就是一个全局变量。以上代码在浏览器中执行的详情如下：<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> a;</span><br><span class="line"><span class="built_in">window</span>.b = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> a = <span class="built_in">window</span>.b;</span><br><span class="line">a++;</span><br><span class="line"><span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><code>let a = 0, b = 0;</code> 相当于 <code>let a = 0; let b = 0;</code>。</li></ul></details><h3 id="数组的length属性"><a href="#数组的length属性" class="headerlink" title="数组的length属性"></a>数组的length属性</h3><p><strong>问题</strong></p><p>以下代码中<code>clothes[0]</code> 的值是什么？</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> clothes = [<span class="string">'jacket'</span>, <span class="string">'t-shirt'</span>];</span><br><span class="line">clothes.length = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">console</span>.log(clothes[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure><details><summary>答案</summary>undefined<br>数组对象的 `length` 属性具有特殊的行为：减少length属性的值就是删除自己的数组元素。<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">clothes.length = <span class="number">0</span>; <span class="comment">// &lt;=&gt; clothes = [];</span></span><br></pre></td></tr></table></figure></details><h3 id="鹰眼测试"><a href="#鹰眼测试" class="headerlink" title="鹰眼测试"></a>鹰眼测试</h3><p><strong>问题</strong></p><p><code>numbers</code> 数组的内容是什么？</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> length = <span class="number">4</span>;</span><br><span class="line"><span class="keyword">const</span> numbers = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; length; i++); &#123;</span><br><span class="line">    numbers.push(i + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(numbers);</span><br></pre></td></tr></table></figure><details><summary>答案</summary>5<br>注意分号的位置！以上代码等效于：<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> length = <span class="number">4</span>;</span><br><span class="line"><span class="keyword">const</span> numbers = [];</span><br><span class="line"><span class="keyword">var</span> i;</span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">  <span class="comment">// do nothing                    </span></span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">  numbers.push(i + <span class="number">1</span>);                      </span><br><span class="line">&#125;</span><br><span class="line">  <span class="built_in">console</span>.log(numbers);</span><br></pre></td></tr></table></figure></details><h3 id="自动分号插入"><a href="#自动分号插入" class="headerlink" title="自动分号插入"></a>自动分号插入</h3><p><strong>问题</strong></p><p><code>arrayfromValue()</code> 返回什么值？</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">arrayFromValue</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">  [item];</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(arrayFromValue[<span class="number">10</span>]);</span><br></pre></td></tr></table></figure><details><summary>答案</summary>undefined<br>注意 <code>return</code> 和 <code>[item]</code> 表达式之间的换行符。此换行符会使JavaScript自动在 <code>return</code> 和 <code>[item]</code> 表达式之间插入分号。以下是等效代码：<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">arrayFromValue</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">  [item];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></details><h3 id="经典为题：棘手的闭包"><a href="#经典为题：棘手的闭包" class="headerlink" title="经典为题：棘手的闭包"></a>经典为题：棘手的闭包</h3><p><strong>问题</strong></p><p>以下代码将输出什么到控制台？</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> i;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">const</span> log = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i);</span><br><span class="line">  &#125;;</span><br><span class="line">  setTimeout(log, <span class="number">100</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><details><summary>答案</summary>3 3 3<br><code>log()</code>是一个捕获变量 <code>i</code>的闭包，此变量在 <code>for()</code> 循环的外部范围中定义。执行此代码有两个阶段。<br>Phase 1:<br>1. <code>for()</code> 重复3次，在每次迭代过程中，都会创建一个新的函数 <code>log()</code> 来捕获变量 <code>i</code>。然后， <code>setTimeout()</code> 计划执行 <code>log()</code>。<br>2. 当 <code>for()</code> 循环完成时，<code>i</code> 变量的值为3。<br>Phase 2:<br>1. 第二阶段发生在100ms之后， <code>setTimeout()</code> 调用了3次计划的 <code>log()</code>。<code>log()</code> 读取变量 <code>i</code>的当前值为3，并记录到控制台。</details><h3 id="浮点数计算"><a href="#浮点数计算" class="headerlink" title="浮点数计算"></a>浮点数计算</h3><p><strong>问题</strong></p><p>这个等式的结果是什么？</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">0.1</span> + <span class="number">0.2</span> === <span class="number">0.3</span>);</span><br></pre></td></tr></table></figure><details><summary>答案</summary>false<br>由于以二进制方式对浮点数进行编码，因此像浮点数相加之类的操作会产生舍入误差。简而言之，直接比较浮点数并不精确。<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="number">0.1</span> + <span class="number">0.2</span>; <span class="comment">// -&gt; 0.30000000000000004</span></span><br></pre></td></tr></table></figure></details><h3 id="变量提升"><a href="#变量提升" class="headerlink" title="变量提升"></a>变量提升</h3><p><strong>问题</strong></p><p>如果在声明前访问 <code>myVar</code> 和 <code>myConst</code>，会发生什么情况？</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(myVar);</span><br><span class="line"><span class="built_in">console</span>.log(myConst);</span><br><span class="line"><span class="keyword">var</span> myVar = <span class="string">"value"</span>;</span><br><span class="line"><span class="keyword">const</span> myConst = <span class="number">3.14</span>;</span><br></pre></td></tr></table></figure><details><summary>答案</summary>undefined error<br><code>var</code>具有变量提升的属性，所以，在<code>var</code> 声明变量，变量开始初始化为 <code>undefined</code>。</details><!-- rebuild by neat -->]]></content>
      <categories>
        <category>面试</category>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>面试</tag>
      </tags>
  </entry>
  <entry>
    <title>微信小程序-基础整理</title>
    <url>/archives/46a94d18.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录微信小程序的基础整理笔记。</p><a id="more"></a><h3 id="什么是微信开发"><a href="#什么是微信开发" class="headerlink" title="什么是微信开发"></a>什么是微信开发</h3><p>微信对外提供了很多功能（如：聊天，支付，分享，收藏等），同时微信还对外开放了很多的接口与能力。程序员基于这些功能和接口进行的开发，叫做微信开发。</p><h3 id="开放平台和公众平台"><a href="#开放平台和公众平台" class="headerlink" title="开放平台和公众平台"></a>开放平台和公众平台</h3><p><strong>开发平台：</strong></p><ul><li>是微信对外开发<code>API</code>接口的平台</li><li>开发的 <code>API</code>接口，供第三方网站和 <code>App</code> 调用</li><li>后端程序员是开放平台的主力军</li></ul><p><strong>公众平台：</strong></p><ul><li>是基于微信公众号，为微信用户提供服务的平台</li><li>所用公众号，都属于微信内开发</li><li>前端程序员是公众开发的主力军</li></ul><h3 id="小程序出现的目的"><a href="#小程序出现的目的" class="headerlink" title="小程序出现的目的"></a>小程序出现的目的</h3><p>拦截用户流量入口，用户的大多数应用需求，都能够在 微信小程序中得到满足</p><h3 id="小程序的应用场景"><a href="#小程序的应用场景" class="headerlink" title="小程序的应用场景"></a>小程序的应用场景</h3><p>适合做“用完就走”的应用（如：点外卖，打车，代驾，共享单车，购物等）</p><p>不适合做“重度依赖”的应用（如：大型手机游戏，音乐播放器，视频软件，直播软件等）</p><h3 id="小程序与传统App的区别"><a href="#小程序与传统App的区别" class="headerlink" title="小程序与传统App的区别"></a>小程序与传统App的区别</h3><p><strong>App：</strong>基于手机操作系统提供的API进行开发，直接安装并运行在手机操作系统之上</p><p><strong>小程序：</strong>基于微信提供的API进行开发，必须基于手机微信才能安装和运行</p><h3 id="小程序项目结构"><a href="#小程序项目结构" class="headerlink" title="小程序项目结构"></a>小程序项目结构</h3><ul><li><code>minigrogram</code> 【目录】项目目录<ul><li><code>components</code> 【目录】存放组件的目录</li><li><code>images</code> 【目录】存放图片的目录</li><li><code>pages</code> 【目录】存放所有的小程序页面目录<ul><li><code>index</code> 【目录】index页面<ul><li><code>index.wxml</code> 【文件】 index页面的结构</li><li><code>index.js</code> 【文件】index页面的逻辑</li><li><code>index.json</code> 【文件】index页面的配置</li><li><code>index.wxss</code> 【文件】index页面的样式</li></ul></li><li><code>logs</code> 【目录】logs页面<ul><li><code>logs.wxml</code> 【文件】logs页面的结构</li><li><code>logs.js</code> 【文件】logs页面的逻辑</li></ul></li></ul></li><li><code>style</code> 【目录】存放样式的目录</li><li><code>app.js</code> 【文件】小程序逻辑</li><li><code>app.json</code> 【文件】小程序的公共配置</li><li><code>app.wxss</code> 【文件】小程序的公共样式</li><li><code>sitemap.json</code> 【文件】配置小程序是否被微信索引</li></ul></li><li><code>project.config.json</code> 【文件】 开发工具配置文件</li></ul><h3 id="小程序常用的UI组件"><a href="#小程序常用的UI组件" class="headerlink" title="小程序常用的UI组件"></a>小程序常用的UI组件</h3><p><strong>1. icon图标</strong></p><ul><li><code>type</code>：icon的类型，有效值有 <code>success/success_no_circle/info/warn/waiting/cancel/download/search/clear</code> ,String类型。</li><li><code>size</code>: icon的大小，默认值为23，Number/String类型。</li><li><code>color</code>: icon的颜色，String类型。</li></ul><p><strong>2. view视图容器（相当于网页开发中div标签）</strong></p><ul><li><code>hover-class</code>: 指定按下去的样式类。当 <code>hover-class=&quot;none&quot;</code> 时，没有点击态效果。默认为none，类型是String。</li><li><code>hover-stop-propagation</code>: 指定是否阻止本节点的祖先节点出现点击态。默认false，boolean类型。</li><li><code>hover-start-time</code>: 按住后多久出现点击态，单位毫秒。默认值是50，类型是number。</li><li><code>hover-stay-time</code>: 手指松开后点击态保留时间，单位毫秒。默认值400，类型是number。</li></ul><p><strong>3. text文本</strong></p><ul><li><code>selecttable</code>: 文本是否可选择，除了text组件之外，其他组件都无法长按选中，默认false，boolean类型。</li><li><code>space</code>: 显示连续空格，可选择：<code>ensp</code>(英文空格)，<code>emsp</code>(中文空格)，<code>nbsp</code>，默认值false，String类型。</li><li><code>decode</code>: 是否解码，可解析：<code>&amp;nbsp; &amp;lt; &amp;gt; &amp;amp; &amp;apos; &amp;ensp; &amp;emsp;</code></li></ul><p><strong>4. button按钮</strong></p><ul><li><code>size</code>: 按钮的大小。合法值为：<code>default/mini</code>。默认值default，类型String。</li><li><code>type</code>: 按钮的样式类型。合法值为：<code>primary(绿色)/default(白色)/warn(红色)</code>默认值default，类型String。</li><li><code>plain</code>: 按钮是否镂空，背景色透明。默认值default，类型boolean。</li><li><code>disabled</code>: 是否禁用。默认值false，类型boolean。</li><li><code>loading</code>: 名称前是否带loading图标。默认值false，类型boolean。</li></ul><p><strong>5. input输入框</strong></p><ul><li><code>value</code>: 输入款的初始内容。类型String。</li><li><code>type</code>: input的类型。合法值为：<code>text/number/idcard/digit</code>。默认值：‘text’，类型String。</li><li><code>password</code>: 是或否是密码类型。默认值false，Boolean类型。</li><li><code>placeholder</code>: 输入框为空时占位符。类型String。</li><li><code>disabled</code>: 是否禁用。默认值false，类型为boolean。</li><li><code>maxlength</code>: 最大输入长度，设置为-1时不限制最大长度。默认值140，类型Number。</li></ul><p><strong>6. image图片</strong></p><ul><li><code>src</code>: 支持本地和网络上的图片</li><li><code>mode</code>: 指定图片裁剪,合法值为：<code>scaleToFill/aspectFit/aspectFill/widthFix/heightFix</code>等。默认值：’scaleToFill‘缩放的模式</li><li>组件默认宽度为300px,高度为225px，即使写一个空标签：<code>&lt;image&gt;&lt;/image&gt;</code></li></ul><h3 id="WXSS和CSS的区别"><a href="#WXSS和CSS的区别" class="headerlink" title="WXSS和CSS的区别"></a>WXSS和CSS的区别</h3><p>不同点是：wxss扩展的特性有：尺寸单位，样式导入。</p><h3 id="小程序的API"><a href="#小程序的API" class="headerlink" title="小程序的API"></a>小程序的API</h3><p><strong>API概念：</strong></p><p>API应用程序编程接口，是一些预先定义的函数，目的是提供应用程序与开发人员基于某软件或硬件得以访问一组例程的能力。</p><p><strong>API的三种分类：</strong></p><ol><li><p>事件监听API</p><p>以 <code>on</code> 开头的API用来监听某个事件是否触发。</p></li><li><p>同步API</p><p>以 <code>sync</code> 结尾的API都是同步API。</p></li><li><p>异步API（类似网页端的ajax）</p><p>通常需要指定回调函数接受调用的结果。小程序中，大多数的API都是异步API。</p></li></ol><h3 id="组件和API的区别"><a href="#组件和API的区别" class="headerlink" title="组件和API的区别"></a>组件和API的区别</h3><p><strong>相同点：</strong>都是微信官方提供，目的都是为了方便小程序的快速开发</p><p><strong>不同点：</strong>组件以UI结构布局为主，一般不需要处理业务逻辑；API以纯业务逻辑为主，一般没有对应的UI</p><h3 id="小程序成员管理"><a href="#小程序成员管理" class="headerlink" title="小程序成员管理"></a>小程序成员管理</h3><p>登录小程序账号 –&gt; 管理 –&gt; 成员管理 –&gt; 项目成员</p><p><strong>开发者权限：</strong>开发模块权限，可使用体验版小程序，开发者工具</p><p><strong>运营者权限：</strong>管理，推广，设置等模块，可使用体验版小程序</p><p><strong>数据分析者：</strong>统计模块权限，可使用体验版小程序</p><h3 id="小程序的唯一标识"><a href="#小程序的唯一标识" class="headerlink" title="小程序的唯一标识"></a>小程序的唯一标识</h3><p><code>appid</code></p><h3 id="WXML和CSS"><a href="#WXML和CSS" class="headerlink" title="WXML和CSS"></a>WXML和CSS</h3><p><strong>1. WXML结构标签</strong></p><p>结构：<code>text</code> ，<code>view</code> , <code>button</code> , <code>input</code> , <code>image</code> 等。</p><p><strong>2. CSS</strong></p><ol><li><p>选择器</p><p>标签选择器，class选择器，id选择器，伪类伪元素选择器，<strong>data-自定义属性选择器</strong>，nth-child, nth-of-type 子类选择器</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">data-color</span>=<span class="string">"red"</span>&gt;</span>字体颜色为红色<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** wxss **/</span></span><br><span class="line"><span class="selector-attr">[data-color=<span class="string">"red"</span>]</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>组合选择器的优先级</p><p>!important &gt; style &gt; id &gt; class &gt; 标签 &gt; *</p></li><li><p>CSS模块化（模块内部不影响外部：模块独立性，使用导入功能进行相互调用）</p><ul><li>vue: scoped</li><li>小程序: 样式导入</li></ul></li><li><p>适配问题</p><p>网页用rem，小程序用rpx。</p><p>rpx 是微信小程序独有的，解决屏幕自适应的尺寸单位。统一规定： 在横向上屏幕分为750份rpx。</p><p>rpx对最终显示的css单位的对应关系： 1rpx = 0.5px。</p><p>官方建议，开发小程序时，设计师可以用iphone6作为视觉稿的标准。</p></li><li><p>@import样式导入</p><p>可以导入外联样式表，语法格式为：@import “wxss样式表的相对路径”；（！！分号一定要带上）</p></li><li><p>全局样式和局部样式</p><p>全局样式：定义在app.wxss中的样式为全局样式，作用于每一个页面。</p><p>局部样式：定义在page中的样式为局部样式，只作用于对应的页面。</p><p>当局部样式的权重大于或等于全局样式的权重时，才会覆盖全局的样式效果。</p></li></ol><h3 id="app-json配置文件作用"><a href="#app-json配置文件作用" class="headerlink" title="app.json配置文件作用"></a>app.json配置文件作用</h3><p>用来对微信小程序进行全局配置，它决定了页面文件的路径、窗口表现、设置网络超时时间、设置多tab等。</p><p>在<code>app.json</code>配置文件中，最主要的额配置节点（属性）是：<strong>pages数组</strong>、<strong>window对象</strong>、<strong>tabBar对象</strong>。</p><ul><li><p>pages数组</p><p>用来指定小程序由哪些页面组成，每一项都对应一个页面的 <strong>路径 + 文件名</strong> 信息。<strong>文件名不需要写文件后缀</strong>，框架会自动取寻找对应位置的<code>.json</code>,<code>.js</code>,<code>.wxml</code>,<code>.wxss</code>四个文件进行处理。</p><div class="note warning"><ol><li>数组的第一项代码小程序的初始页面（首页）</li><li>小程序中新增/减少页面，都需要对pages数据进行修改</li></ol></div></li><li><p>window对象</p><p>用于设置小程序的状态栏，导航条，标题，窗口背景色。</p><p>window节点常用配置项：</p><ul><li><code>backgroundColor</code>: 窗口的背景色，也是下拉刷新区域的背景色</li><li><code>backgroundTextStyle</code>: 下拉刷新loading样式（3个小圆点的颜色），仅支持 <code>dark/light</code></li><li><code>navigationBarBackgroundColor</code>: 导航栏背景颜色</li><li><code>navigationBarTitleText</code>: 导航栏标题文字内容</li><li><code>enablePullDownRefresh</code>: 是否开启下拉刷新</li><li><code>navigationBarTextStyle</code>: 导航栏标题颜色，仅支持<code>dark/light</code></li></ul></li><li><p>tabBar对象</p><p>是移动端应用常见的页面效果，用于实现多页面的快速切换。小程序中通常将其分为 底部tabBar 和 顶部tabBar。</p><div class="note warning"><p>tabBar中，只能配置最少2个，最多5个tab标签，当渲染顶部tabBar的时候，不显示icon，只显示文本</p></div><p>tabBar节点常用配置项：</p><ul><li><p><code>color</code>: tab上文字默认颜色</p></li><li><p><code>selectedColor</code>: tab上文字选中时的颜色</p></li><li><p><code>list</code>: tab的列表，最少2个，最多5个</p><ul><li><code>pagePath</code>: 页面路径，必须在 <code>pages</code> 中先定义</li></ul></li><li><p><code>text</code>: tab上按钮文字</p><ul><li><code>iconPath</code>: icon图标路径，建议尺寸 81px * 81px，图片大小限制为40KB</li><li><code>selectedIconPath</code>: 选中时的icon图片路径，建议尺寸 81px * 81px</li></ul></li></ul></li></ul><h3 id="页面-全局配置的关系"><a href="#页面-全局配置的关系" class="headerlink" title="页面/全局配置的关系"></a>页面/全局配置的关系</h3><p>app.json中的window节点，可以全局配置小程序中每个页面的窗口表现，如果某些小程序页面想要拥有特殊的窗口表现，此时，页面级别的.json配置文件即可实现这种需求。</p><p><strong>总结：页面级别的配置优先于全局配置生效。</strong></p><h3 id="小程序的生命周期"><a href="#小程序的生命周期" class="headerlink" title="小程序的生命周期"></a>小程序的生命周期</h3><p><strong>生命周期（Life Cycle）</strong>：是指一个对象从 创建 –&gt; 运行 –&gt; 销毁 的整个阶段，强调的是一个时间段。</p><p>在小程序中，包含两种类型的生命周期：</p><ol><li>应用生命周期：特指小程序从 启动 –&gt; 运行 –&gt; 销毁 的过程</li><li>页面生命周期：特指小程序中，每个页面的 加载 –&gt; 渲染 –&gt; 销毁 的过程</li></ol><p>其中，页面的生命周期范围较小，应用程序的生命周期范围较大。</p><p><strong>生命周期函数</strong>：由小程序框架提供的内置函数，会伴随着生命周期，自动按次序执行。它的作用是允许在特定的生命周期的时间点上，执行某些特定的操作。</p><div class="note warning"><p>生命周期强调的是时间段，而生命周期函数强调的是时间点。</p></div><p><strong>生命周期函数分类</strong></p><ol><li><p>应用生命周期函数</p><p><code>app.js</code> 是小程序执行的入口文件，在 <code>app.js</code> 中必须调用 <code>app()</code> 函数，<code>app()</code> 函数是用来注册并执行小程序的。<code>app(Object)</code> 函数接受一个Object参数，通过这个Object参数，指定小程序的生命周期函数。</p><p>Object参数：</p><ul><li><code>onLaunch()</code>: 生命周期回调-监听小程序初始化，全局只触发一次</li><li><code>onShow()</code>: 生命周期回调-监听小程序启动或切前台</li><li><code>onHide()</code>: 生命周期回调-监听小程序切后台</li></ul></li><li><p>页面生命周期函数</p><p>每个小程序页面，必须拥有自己的<code>.js</code>文件，且必须调用 <code>Page()</code> 函数，否则会报错。其中 <code>Page()</code> 函数用来注册小程序页面。<code>Page(Object)</code> 函数接受一个Object参数，通过这个Object参数，指定页面的生命周期函数。</p><p>Object参数：</p><ul><li><code>onLoad()</code>: 生命周期回调-监听页面加载，页面加载时触发，一个页面只会调用一次，可以在<code>onLoad</code>的参数中获取打开当前页面路径中的参数<ul><li><code>query</code>: 打开当前页面路径中的参数</li></ul></li><li><code>onShow()</code>: 生命周期回调-监听页面显示，页面显示/切入前台时触发</li><li><code>onReady()</code>: 生命周期回调-监听页面初次渲染完成，一个页面只会调用一次，代表页面已经准备妥当，可以和视图进行交互。<ul><li><code>wx.setNavigationBarTitle</code>需要在<code>onReady()</code>之后进行</li></ul></li><li><code>onHide()</code>: 生命周期回调-监听页面隐藏，页面隐藏/切入后台时触发，如调用：<code>wx.navigateTo()</code>、<code>wx.switchTab()</code></li><li><code>onUnload()</code>: 生命周期回调-监听页面卸载，如调用：<code>wx.redirectTo()</code>、<code>wx.navigateBack()</code></li></ul></li></ol><h3 id="数据绑定"><a href="#数据绑定" class="headerlink" title="数据绑定"></a>数据绑定</h3><ol><li><p>定义页面的数据</p><p><code>.js</code> 文件内可以定义页面的<strong>数据，生命周期函数，其他业务逻辑</strong>。如果要在 <code>.js</code> 文件内定义数据，只需<strong>把数据定义到data节点下</strong>即可。</p></li><li><p>Mustache词法格式</p><p>把data中的数据绑定到页面中渲染，使用Mustache语法（双花括号）将变量包起来即可。</p><p>Mustache语法的主要应用场景（绑定内容，绑定数据，运算）：</p><ul><li><p>绑定内容</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 页面数据</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    data: &#123;</span><br><span class="line">        message: <span class="string">"hello World"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>绑定属性</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">id</span>=<span class="string">"item-&#123;&#123;id&#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 页面数据</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    data: &#123;</span><br><span class="line">        id: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>运算（三元表达式，算术运算，逻辑判断，字符串运算，数据路径运算）</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;flag ? '条件为真' : '条件为假'&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 页面数据</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    data: &#123;</span><br><span class="line">        flag: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul></li></ol><h3 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h3><p>事件是视图层到逻辑层的通讯方法。</p><p>事件可以将用户的行为反馈到逻辑层进行处理。</p><p>事件可以绑定在组件上，当组件触发事件，就会执行逻辑层中对应的事件处理函数。</p><p>事件可以携带格外信息，例如：id, dataset, touches（有几个手指触碰了组件）</p><p><strong>bindtap绑定触摸事件:</strong></p><p>在小程序中，不存在click点击事件，是通过tap事件来响应触摸行为的。</p><ol><li>通过<code>bindtap</code>，可以为组件绑定触摸事件</li><li>在相应的Page定义中写上相应的事件处理函数，事件参数是<code>event</code>:</li></ol><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">bindtap</span>=<span class="string">"tapName"</span>&gt;</span>点击我<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 页面数据</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    tapName(event) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(event);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>bindinput文本框输入事件：</strong></p><ol><li>通过<code>bindinput</code>， 可以为文本框绑定输入事件</li><li>在相应的Page定义中写上相应的事件处理函数，事件参数是<code>event</code>:</li></ol><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">bindinput</span>=<span class="string">"inputName"</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 页面数据</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    inputName(event) &#123;</span><br><span class="line"> 		<span class="built_in">console</span>.log(event);       </span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>data和文本框之间的数据同步：</strong></p><ol><li><p>第一步：手动监听文本框输入事件，通过时间参数event,能够访问到文本框的最新值</p></li><li><p>第二步：修改data中的数据，通过<code>this.setData()</code> 方法，可以给页面中的data数据重新赋值</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span>&gt;</span>输入的内容为：&#123;&#123;inputText&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">bindtap</span>=<span class="string">"inputName"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123;inputText&#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 页面数据</span></span><br><span class="line">Page(&#123;</span><br><span class="line">	data: &#123;</span><br><span class="line">        inputText: <span class="string">""</span></span><br><span class="line">    &#125;,</span><br><span class="line">    inputName(event) &#123;</span><br><span class="line">    	<span class="keyword">let</span> inputValue = event.detail.value;</span><br><span class="line">    	<span class="keyword">this</span>.setData(&#123;</span><br><span class="line">            inputText: inputValue</span><br><span class="line">        &#125;)</span><br><span class="line">  	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ol><p><strong>事件传参：</strong></p><ol><li><p>第一步：通过data-*自定义属性传参</p></li><li><p>第二步：获取data-*自定义属性中传递的参数</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"btnHandler"</span> <span class="attr">data-parameter</span>=<span class="string">"&#123;&#123;123&#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 页面数据</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    btnHandler(event) &#123;</span><br><span class="line">        <span class="keyword">let</span> query = event.currentTarget.dataset;</span><br><span class="line">        <span class="built_in">console</span>.log(query.parameter); <span class="comment">// &gt; 123</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ol><div class="note warning"><p>不能在绑定事件的同时传递参数，以下方式会报错</p></div><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"primary"</span> <span class="attr">bindtap</span>=<span class="string">"btnHandler(123)"</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="条件渲染"><a href="#条件渲染" class="headerlink" title="条件渲染"></a>条件渲染</h3><p><strong>1. wx:if</strong></p><p>使用 <code>wx:if=&quot;&quot;</code> 来判断是否需要渲染该代码块</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:if</span>=<span class="string">"&#123;&#123;length &gt; 5&#125;&#125;"</span>&gt;</span>5<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:elif</span>=<span class="string">"&#123;&#123;length &gt; 3&#125;&#125;"</span>&gt;</span>3<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:else</span>&gt;</span>0<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>2. block wx:if</strong></p><p>因为 <code>wx:if</code> 是一个控制属性，需要将它添加到一个标签上，如果要一次性判断多个组件标签，可以使用 <code>&lt;block&gt;&lt;/block&gt;</code> 标签将多个组件包装起来，并在上边使用 <code>wx:if</code> 控制属性。</p><p><code>&lt;block&gt;&lt;/block&gt;</code>并不是一个组件，它只是一个包装元素，不会在页面中做任何渲染，只接受控制属性。</p><div class="note warning"><p>在使用控制属性（<code>wx:if/wx:elif/ex:else, wx:for, hidden</code>）的时候，建议都要使用<code>&lt;block&gt;&lt;/block&gt;</code>。</p></div><p><strong>3. hidden</strong></p><p>直接使用 <code>hidden=&quot;&quot;</code> 也能控制元素的额显示和隐藏。</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">block</span> <span class="attr">hidden</span>=<span class="string">"&#123;&#123;condition&#125;&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span>123<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>4. wx:if 和 hidden对比</strong></p><p>类似于VUE中的 <code>v-if</code> 和 <code>v-show</code> ，<code>wx:if</code> 有更高的切换消耗，而 <code>hidden</code> 有更高的初始渲染消耗。因此，如果需要频繁切换的情境下，用 <code>hidden</code> 更好，如果在运行时条件不大可能改变，则 <code>wx:if</code> 较好。</p><h3 id="列表渲染"><a href="#列表渲染" class="headerlink" title="列表渲染"></a>列表渲染</h3><p><strong>1. wx:for</strong></p><p>在组件上使用 <code>wx:for</code> 控制属性绑定一个数组，即可使用数组中各项的数据重复渲染该列表。默认数组的额当前项的下标变量名默认为 <code>index</code> ， 数组当前项的变量名默认为 <code>item</code> 。</p><div class="note warning no-icon"><p><code>wx:key</code> 为必须，<code>wx:key</code>的值以两种形式提供：</p><ol><li>字符串，代表在 for 循环的 array 中 item 的某个属性值（<strong>只需要写属性值</strong>），该属性值需要是列表中唯一的字符串或数字，且不能动态改变。</li><li>保留关键字 <code>*this</code> 代表在 for 循环中 item 本身，这种表示需要 item 本身是一个唯一的字符串或数字。</li></ol></div><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 页面数据</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    data: &#123;</span><br><span class="line">        list: [<span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>, <span class="string">"4"</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:for</span>=<span class="string">"&#123;&#123;list&#125;&#125;"</span> <span class="attr">wx:key</span>=<span class="string">"*this"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span>索引号为：&#123;&#123;index&#125;&#125;, item的值为：&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>2. 手动指定索引和当前项的变量名</strong></p><p>使用 <code>wx:for-item</code> 可以指定数组当前元素的变量名。</p><p>使用 <code>wx:for-index</code> 可以指定数组当前下标的变量名。</p><h3 id="页面渲染"><a href="#页面渲染" class="headerlink" title="页面渲染"></a>页面渲染</h3><p><strong>1. key在列表循环中的作用</strong></p><p>如果列表中项目的位置会动态改变或有新的项目添加到列表中，并且希望列表中的额项目保持自己的特征和状态，需要使用 <code>wx:key</code> 来指定列表中项目的唯一的标识符。</p><p><strong>2. key值得注意点</strong></p><ol><li>key值必须具有唯一性，且不能动态改变</li><li>key的值必须是数字或者字符串</li><li>保留关键字 <code>*this</code> 代表在 for 循环中 item 本身，这种表示需要 item 本身是一个唯一的字符串或数字</li></ol><h3 id="页面事件"><a href="#页面事件" class="headerlink" title="页面事件"></a>页面事件</h3><p><strong>1. 下拉刷新</strong></p><ul><li><p>目前下拉刷新有两种：</p><ul><li>需要在 <code>app.json</code> 的 <code>window</code> 选项中 或者 页面配置 中开启 <code>enablePullDownRefresh</code>。一般情况下，推荐在页面配置中为需要的页面单独开启下拉刷新行为。</li><li>通过 <code>wx.startPullDownRefresh()</code> 触发下拉刷新，调用后触发下拉刷新动画，效果与用户手动下拉刷新一致。处理完下拉刷新时，下拉刷新的loading效果会一直显示，不会主动消失，需要调用 <code>wx.stopPullDownRefresh()</code> 可以停止当前页面的下拉刷新。</li></ul></li><li><p>监听下拉刷新事件</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 页面数据</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    onPullDownRefresh() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'触发了下拉刷新的事件'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul><p><strong>2. 上拉加载</strong></p><ul><li><p>上拉加载的更多的应用场景就是数据的分页加载。在 <code>app.json</code> 的 <code>window</code> 选项中 或者 页面配置 中设置 <code>onReachBottomDistance</code> 。单位为px, 默认50px。</p></li><li><p>监听上拉加载事件</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 页面数据</span></span><br><span class="line">Page(&#123;</span><br><span class="line">   onReachBottom() &#123;</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">'触发了上拉加载事件'</span>)</span><br><span class="line">   &#125; </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul><p><strong>3. 用户滑动</strong></p><ul><li><p>页面在垂直方向已滚动的距离（单位px）</p></li><li><p>监听滑动页面事件：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 页面数据</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    onPageScroll(event) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'页面的滑动距离为：'</span> event.scrollTop)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul><p><strong>4. 转发事件</strong></p><ul><li><p>只有定义了此事件处理函数，右上角菜单才会显示“转发”按钮</p></li><li><p>此事件处理函数需要 return 一个 Object，用于自定义转发内容</p></li><li><p>object参数</p><ul><li><p><code>from</code>: 转发事件来源：<code>button</code>:页面内转发按钮/ <code>menu</code>:右上角转发菜单</p></li><li><p><code>target</code>: 如果 <code>from</code>值是 <code>button</code>，则 <code>target</code> 是触发这次转发事件的 <code>button</code>, 否则为 <code>undefined</code></p></li><li><p><code>webViewUrl</code>: 页面中包含web-view组件时，返回当前web-view的url</p></li><li><p>return自定义转发内容</p><ul><li><code>title</code>: 转发标题</li><li><code>path</code>: 转发路径</li><li><code>imageUrl</code>: 自定义图片路径，显示图片长宽比为5:4</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">   	onShareAppMessage: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">  		<span class="keyword">if</span>(res.from === <span class="string">'button'</span>) &#123;</span><br><span class="line">    	<span class="comment">// 来自页面内转发按钮</span></span><br><span class="line">    	<span class="built_in">console</span>.log(res.target);</span><br><span class="line">  		&#125;</span><br><span class="line">  		<span class="keyword">return</span> &#123;</span><br><span class="line">    		title: <span class="string">'音乐'</span>,</span><br><span class="line">    		path: <span class="string">'pages/playlist/playlist'</span>,</span><br><span class="line">    		imageUrl: <span class="string">'../../images/share_img.jpg'</span></span><br><span class="line">  		&#125;	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul><p><strong>5. tab事件</strong></p><ul><li><p>当前是tab页时，点击tab时触发</p></li><li><p>Object参数</p><ul><li><code>index</code>: 被点击tabItem的序号，从0开始</li><li><code>pagePath</code>: 被点击tabItem的页面路径</li><li><code>text</code>: 被点击tabItem的按钮文字</li></ul></li></ul><h3 id="页面导航"><a href="#页面导航" class="headerlink" title="页面导航"></a>页面导航</h3><p>页面导航就是页面之间的跳转，小程序页面之间的导航有两种方式：</p><ol><li>声明式导航。</li><li>编程式导航。</li></ol><p><strong>1. 声明式导航：</strong>通过点击 navigator 组件实现页面跳转的方式</p><ul><li><p>导航到非tabBar页面。后面可以携带参数。</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">navigator</span> <span class="attr">url</span>=<span class="string">"/pages/logs/logs?name=devin&amp;age=20"</span>&gt;</span>导航到logs页面<span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>导航到tabBar页面指。如果 <code>navigator</code> 单纯使用 <code>url</code> 属性，无法导航到tabBar页面，需要结合 <code>open-type</code> 进行导航</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">navigator</span> <span class="attr">url</span>=<span class="string">"/pages/home/home"</span> <span class="attr">open-type</span>=<span class="string">switchTab</span>&gt;</span>导航到home页面<span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>后退导航。如果要后退到上级页面或多级页面，需要把 <code>open-type</code> 设置为 <code>navigateBack</code> , 同时使用 <code>dalta</code> 属性指定后退的层数</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">navigator</span> <span class="attr">open-type</span>=<span class="string">"navigateBack"</span> <span class="attr">dalta</span>=<span class="string">"1"</span>&gt;</span><span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><p><strong>2. 编程式导航：</strong>通过调用小程序的额API接口实现跳转的方法</p><ul><li><p>导航到非tabBar页面。</p><ul><li><p>通过<code>wx.navigateTo(object)</code>方法，实现跳转，但是不能跳转到tabBar页面。</p></li><li><p>object参数：</p><ul><li><p><code>url</code>: 跳转路径，可以携带参数。</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"goToLogs"</span>&gt;</span>跳转到logs页面<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 页面数据</span></span><br><span class="line">goToLogs() &#123;</span><br><span class="line">    wx.navigateTo(&#123;</span><br><span class="line">        url: <span class="string">"/pages/logs/logs?name=devin&amp;age=20"</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul></li><li><p>导航到tabBar页面。</p><ul><li><p>通过 <code>wx.switchTab(ojbect)</code> 方法，实现跳转到tabBar页面，并关闭其他所有非tabBar页面。</p></li><li><p>object参数：</p><ul><li><p><code>url</code>: 跳转tabBar页面路径，不能携带参数。</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"goToHome"</span>&gt;</span>跳转到home页面<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 页面数据</span></span><br><span class="line">goToHome() &#123;</span><br><span class="line">    wx.switchBar(&#123;</span><br><span class="line">        url: <span class="string">"/pages/home/home"</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul></li><li><p>后退导航。</p><ul><li>通过 <code>wx.navigateBack(object)</code> 方法，关闭当前页面，放回上一页面或多级页面。</li><li>object参数：<ul><li><code>dalta</code>: 返回的页面数，如果dalta大于现有页面数，则返回到首页。</li></ul></li></ul></li></ul><p><strong>3. 页面接受导航传递的参数</strong></p><p>不论是声明式导航还是编程式导航，最终导航到的页面可以在 <code>onLoad</code> 生命周期函数中接收传递过来的参数。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 页面数据</span></span><br><span class="line">Page(&#123;</span><br><span class="line">  onLoad: <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(options) <span class="comment">// options就是导航传递的参数</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>4. 自定义编译模式快速传参</strong></p><p>小程序每次修改编译后，默认从首页进入，但是在开发阶段，经常会针对特定的页面进行开发，为了方便编译后直接进入对应的页面，可以配置自定义编译模式。步骤：</p><ol><li>单击工具栏上的 “普通编辑” 下拉菜单</li><li>单击下拉菜单中的 “添加编译模式” 选项</li><li>在弹出的 “自定义编译条件窗口” ，按需添加 模式名称，启动页面，启动参数，进入场景等。</li></ol><h3 id="网络数据请求"><a href="#网络数据请求" class="headerlink" title="网络数据请求"></a>网络数据请求</h3><p><strong>1. 配置服务器域名</strong></p><p>每个小程序需要事先设置一个通讯域名，小程序只可以跟指定的域名进行网络通信。服务器域名在【小程序后台-开发-开发设置-服务器域名】中进行配置，配置时需要注意：</p><ul><li>域名只支持https和wss协议</li><li>域名不能使用IP地址或者localhost</li><li>域名必须经过ICP备案</li><li>服务器域名一个月内可申请5次修改</li></ul><p><strong>2. 跳过域名校验</strong></p><p>在微信开发者工具中，可以临时开启：【开发环境不校验请求域名，YSL版本及HTTPS证书】选项，跳过服务器域名校验。此时，开始调试模式时，不会进行服务器域名校验。</p><div class="note warning"><p>在服务器域名配置成功后，建议关闭此选项进行开发，并在各平台开发，以确认服务器域名配置正确。</p></div><p><strong>3. 发起get请求</strong></p><p>调用 <code>wx.request(object)</code> 方法发起get请求。</p><p>object参数：</p><ul><li><code>url</code>: 开发者服务器接口地址</li><li><code>data</code>: 请求的参数</li><li><code>success</code>: 接口调用成功的回调函数： <code>result.data</code> 就是服务器返回的真实数据。</li><li><code>fail</code>: 接口调用失败的回调函数。</li></ul><p><strong>4. 发起post请求</strong></p><p>调用 <code>wx.request(object)</code> 方法发起get请求。（多了一个method属性）</p><p>object参数：</p><ul><li><code>method</code>: “POST”</li><li><code>header</code>: 设置请求的header，header中不能设置 Referer。<code>content-type</code> 默认为 <code>application/json</code></li></ul><p><strong>5. 小程序中没有跨域限制</strong></p><p>普通网站开发中，由于浏览器的同源策略限制，存在数据的跨域请求问题，衍生出了 <code>JSONP</code> 和 <code>CORS</code> 两种主流跨域解决方案。小程序的代码并不运行在浏览器中，所以小程序开发中，不存在数据跨域请求问题。</p><h3 id="组件的创建与引用"><a href="#组件的创建与引用" class="headerlink" title="组件的创建与引用"></a>组件的创建与引用</h3><p><strong>1. 创建组件</strong></p><ol><li>在项目的根目录中，鼠标右键，创建 components –&gt; test文件夹</li><li>在新建的 components –&gt; test 文件夹上，鼠标右键，点击 新建Component</li><li>为新建的组件命名之后，会自动生成组件对应的4个文件，后缀名分别为 <code>.js</code> <code>.json</code> <code>.wxml</code> <code>.wxss</code></li></ol><p><strong>2.引用组件</strong></p><ol><li>在需要引用组件的页面中，找到页面的 <code>.json</code> 配置文件，新增 <code>usingComponents</code> 节点</li><li>在 <code>usingComponents</code> 中，通过键值对的形式，注册组件；键为注册的组件名称，值为组件的相对引用路径</li><li>在页面的 <code>.wxml</code> 文件中，把注册的组件名称，以标签形式在页面上使用，即可把组件展示到页面上</li></ol><p><strong>3. 使用样式美化组件</strong></p><p>组件对应的 <code>wxss</code> 文件的样式，只对组件的 <code>wxml</code> 内的节点生效。编写组件样式时，需要注意：</p><ul><li>组件和引用组件的页面不能使用id选择器（<code>#a</code>）,属性选择器（<code>[a]</code>）和标签名选择器，请改用class选择器</li><li>组件和引用组件的页面中建议不使用后代选择器（<code>.a .b</code>）</li><li>子元素选择器（<code>.a &gt; .b</code>）只能用于 view 组件与其子节点之间</li><li>继承样式，如：<code>font</code>, <code>color</code>，会从组件外继承到组件内</li><li>除继承样式外， <code>app.wxss</code> 中的样式、组件所在页面的样式对自定义组件无效</li></ul><h3 id="组件的data与methods"><a href="#组件的data与methods" class="headerlink" title="组件的data与methods"></a>组件的data与methods</h3><p><strong>1. 使用data定义组件的私有属性</strong></p><p>页面的data定义在 <code>Page()</code> 函数中，组件的data定义在 <code>component()</code> 函数中。</p><ul><li>在组件的 <code>.js</code> 中，如果要访问data中的属性，直接使用 <code>this.data.数据名称</code> 即可。若要为data中的数据重新赋值，调用 <code>this.setData({数据名称： 新值})</code> 即可。</li><li>在组件的 <code>.wxml</code> 中，如果要渲染data中的数据，直接使用 <code></code> 即可。</li></ul><p><strong>2. 使用methods定义组件的事件处理函数</strong></p><p>组件的事件处理函数，必须定义在 <code>methods</code> 节点中。</p><h3 id="组件的properties"><a href="#组件的properties" class="headerlink" title="组件的properties"></a>组件的properties</h3><p><strong>1. properties的作用</strong></p><ul><li><p>类似于vue组件中的 <code>props</code> ,小程序组件中的 <code>propereties</code> ，是组件的对外属性，用来接收外界传递到组件中的数据。</p></li><li><p>在小程序中，<code>properties</code> 和 <code>data</code> 的用法类似，他们都是可读可写的。不过， <code>data</code> 更倾向于存储组件的私有数据， <code>properties</code> 更倾向于存储外界传递到组件中的数据</p></li></ul><p><strong>2. 声明properties的两种方法</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    propeerties: &#123;</span><br><span class="line">        <span class="comment">// 完整的定义方式</span></span><br><span class="line">        a: &#123;</span><br><span class="line">            type: <span class="built_in">String</span>,</span><br><span class="line">            value: <span class="string">""</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 简化的定义方式</span></span><br><span class="line">        b: <span class="built_in">String</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>3. 为组件传递properties的值</strong></p><ul><li><p>可以使用数据绑定的形式，向子组件的属性传递动态数据。</p></li><li><p>在定义 <code>properties</code> 时，属性名采用驼峰写法（<code>properCount</code>）</p></li><li><p>在 <code>wxml</code> 中，指定属性值时，则对应使用连字符写法（<code>proper-count=&quot;attr value&quot;</code>）</p></li><li><p>应用数据绑定是，采用驼峰写法（<code>attr=&quot;&quot;</code>）</p></li></ul><p><strong>4. 在组件内修改properties的值</strong></p><p><code>properties</code> 的值是可读可写的，它的用法与 <code>data</code> 几乎一致，因此可以通过 <code>setData</code> 修改 <code>properties</code> 中任何属性的值。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">properties: &#123;</span><br><span class="line">    count: <span class="built_in">Number</span></span><br><span class="line">&#125;,</span><br><span class="line">    </span><br><span class="line">methods: &#123;</span><br><span class="line">    add() &#123;</span><br><span class="line">        <span class="keyword">this</span>.setData(&#123;<span class="attr">count</span>: <span class="keyword">this</span>.properties.count + <span class="number">1</span>&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="数据监听器observers"><a href="#数据监听器observers" class="headerlink" title="数据监听器observers"></a>数据监听器observers</h3><p>数据监听器可以用来监听和响应任何属性和数据字段的变化，从而执行待定的操作。作用类似于 vue 中的 watch。</p><ol><li><p>监听子数据字段的变化</p><ul><li>键： 就是需要被监听的数据</li><li>值：就是数据变化之后会触发的事件函数</li><li>左侧可以监听单个数据，也可以监听多个数据，监听多个数据时，每个字段之间用英文逗号（<code>,</code>）隔开，只要其中有一个字段变化，就会触发值对应的额事件函数</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Component(&#123;</span><br><span class="line">    observers: &#123;</span><br><span class="line">    	<span class="string">'name, propCount'</span>: <span class="function">(<span class="params">newName, newPropCount</span>) =&gt;</span> &#123;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>使用通配符 <code>**</code> 监听所有子数据字段的变化</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Component(&#123;</span><br><span class="line">    data: &#123;</span><br><span class="line">        obj: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    observers: &#123;</span><br><span class="line">        <span class="string">'obj.**'</span>: <span class="function">(<span class="params">newObj</span>) =&gt;</span> &#123;&#125;　</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ol><h3 id="组件的生命周期"><a href="#组件的生命周期" class="headerlink" title="组件的生命周期"></a>组件的生命周期</h3><p><strong>1. 组件的主要生命周期</strong></p><p>组件的生命周期，指的是组件自身的一些函数，这些函数在遇到一些框架事件会被自动触发。其中，最重要的生命周期是 <code>created</code>, <code>attached</code>, <code>detached</code>,包含一个组件实例生命流程的最主要的时间点。</p><ul><li><code>created</code>: 组件实例被创建好时被触发。此时还不能调用 <code>setData()</code>。一般这个生命周期只用来给组件 <code>this</code> 添加一些自定义属性字段</li><li><code>attached</code>: 在组件完全初始化完毕，进入页面节点数后，<code>attached</code> 生命周期会触发。绝大多数初始化工作都可以在这个时机进行</li><li><code>detached</code>: 在组件离开页面节点数后触发。比如，退出一个页面。</li></ul><p><strong>2. 组件可用的全部生命周期函数</strong></p><ul><li><code>created</code>: 组件生命周期函数-在组件实例刚刚被创建时执行，注意此时不能调用 <code>setData()</code></li><li><code>attached</code>: 组件生命周期函数-在组件实例进入页面节点树时执行</li><li><code>ready</code>: 组件生命周期函数-在组件布局完成后执行</li><li><code>moved</code>: 组件生命周期函数-在组件实例被移动到节点树另一个位置时执行</li><li><code>detached</code>: 组件生命周期函数-在组件实例被从页面节点树移除时执行</li></ul><p><strong>3. 定义生命周期函数</strong></p><p>组件的生命周期需要在 <code>lifetimes</code> 字段内进行声明。（这是推荐方式）</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Component(&#123;</span><br><span class="line">    lifetimes: &#123;</span><br><span class="line">        attached() &#123;&#125;,</span><br><span class="line">        detached() &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>4. 组件所在页面的生命周期</strong></p><p>组件所在页面的生命周期在 <code>pageLifetimes</code> 定义段中定义，其可用的生命周期包括：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Component(&#123;</span><br><span class="line">    pageLifetimes: &#123;</span><br><span class="line">        show() &#123;&#125;,</span><br><span class="line">        hide() &#123;&#125;,</span><br><span class="line">        resieze() &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="组件插槽"><a href="#组件插槽" class="headerlink" title="组件插槽"></a>组件插槽</h3><p><strong>1. 默认插槽</strong></p><p>在组件的 <code>wxml</code> 中可以包含 <code>slot</code> 节点，用于承载组件使用者提供的 <code>wxml</code> 结构。默认情况下，一个组件的 <code>wxml</code> 中只能有一个slot。需要使用多 <code>slot</code> 时，可以在组件 <code>js</code> 中声明启用。</p><div class="note warning"><p>小程序中目前只有默认插槽和多个插槽，暂不支持作用于插槽。</p></div><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 组件模板 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">view</span>&gt;</span>这里是组件的内部节点<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引用组件的页面模板 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">component</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 组件内的内容会放置到组件&lt;slot&gt;位置上 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>这里是插入大组件slot中的内容<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>2. 启动多个插槽</strong></p><p>在组件中，需要使用多个 <code>slot</code> 时，可以在组件 <code>js</code> 中声明启用：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Component(&#123;</span><br><span class="line">    options: &#123;</span><br><span class="line">        multipleSlots: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>3. 定义多个插槽</strong></p><p>可以在组件的 <code>wxml</code> 中使用多个 <code>slot</code> 标签，以不同的 <code>name</code> 来区分不同的插槽。</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 组件模板 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">"before"</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">view</span>&gt;</span>这里是组件的内部节点<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">"after"</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>4. 使用多个插槽</strong></p><p>使用时，用 <code>slot</code> 属性来将节点插入到不同的 <code>slot</code> 中。</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引用组件的页面模板 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">component</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">slot</span>=<span class="string">"before"</span>&gt;</span>这里是插入组件slot中before的内容/view&gt;</span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">slot</span>=<span class="string">"after"</span>&gt;</span>这里插入到组件slot中after的内容<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="组件中的通信"><a href="#组件中的通信" class="headerlink" title="组件中的通信"></a>组件中的通信</h3><p><strong>1. 组件之间的三种 基本通信方式</strong></p><ol><li><code>wxml</code> 数据绑定：用于父组件向子组件的指定属性传递数据。</li><li>事件：用于子组件向父组件传递数据，可以传递任何数据。</li><li>父组件通过 <code>this.selectComponent</code> 方法获取子组件实例对象，可以直接访问组件的任意数据和方法。</li></ol><p><strong>2. this.selectComponent(String)</strong></p><p>在小程序的组件中，调用 <code>this.selectComponent(String)</code> ，可以返回指定组件的实例对象。</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">component</span> <span class="attr">id</span>=<span class="string">"cA"</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    onLoad() &#123;</span><br><span class="line">        <span class="keyword">let</span> component = <span class="keyword">this</span>.selectComponent(<span class="string">"#cA"</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(component);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>3. 通过事件监听实现子向父传值</strong></p><p>事件系统是组件间通信的主要方式之一。自定义组件可以触发任意的事件，引用组件的页面可以监听这个事件。</p><p>通过事件监听实现子组件向父组件传值的步骤：</p><ol><li>在父组件的 <code>js</code> 中，定义一个函数（<code>a()</code>），这个函数（<code>a()</code>）即将通过自定义事件的形式，传递给子组件</li><li>在父组件的 <code>wxml</code> 中，通过自定义事件的形式，将步骤1中定义的函数引用（<code>a=&quot;b&quot;</code>），传递给子组件</li><li>在子组件的 <code>js</code> 中，通过调用 <code>this.triggerEvent(&quot;b&quot;, detail)</code>,将数据发送到父组件</li><li>在父组件的 <code>js</code> 中，通过 <code>e.detail</code> 获取到子组件传递过来的数据</li></ol><h3 id="框架函数-APP"><a href="#框架函数-APP" class="headerlink" title="框架函数-APP()"></a>框架函数-APP()</h3><p><code>App(Object object)</code></p><ul><li><p>注册小程序。接受一个<code>Object</code>参数，其指定小程序的生命周期回调等。</p></li><li><p><code>App()</code>必须在 <code>app.js</code>中调用，必须调用且只能调用一次。</p></li><li><p>参数</p><ul><li><p><code>onLaunch()</code>: 生命周期回调-监听小程序初始化，全局只触发一次</p></li><li><p><code>onShow()</code>: 生命周期回调-监听小程序启动或切前台</p></li><li><p><code>onHide()</code>: 生命周期回调-监听小程序切后台</p></li><li><p><code>onError()</code>: 错误监听函数，比如发生脚本错误或API调用报错</p></li><li><p><code>onPageNotFound()</code>: 页面不存在监听函数，比如链接到404页面</p></li><li><p><code>onUnhandledRejection()</code>: 未处理的 Promise 拒绝事件监听函数</p></li><li><p>其他：可以定义任意函数或者变量到<code>Object</code>参数中，用<code>this</code>可以访问</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//app.js</span></span><br><span class="line">App(&#123;</span><br><span class="line">  onLaunch: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"onLaunch 执行"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!wx.cloud) &#123;</span><br><span class="line">      <span class="built_in">console</span>.error(<span class="string">'请使用 2.2.3 或以上的基础库以使用云能力'</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      wx.cloud.init(&#123;</span><br><span class="line">        <span class="comment">// env 参数说明：</span></span><br><span class="line">        <span class="comment">//   env 参数决定接下来小程序发起的云开发调用（wx.cloud.xxx）会默认请求到哪个云环境的资源</span></span><br><span class="line">        <span class="comment">//   此处请填入环境 ID, 环境 ID 可打开云控制台查看</span></span><br><span class="line">        <span class="comment">//   如不填则使用默认环境（第一个创建的环境）</span></span><br><span class="line">        env: <span class="string">'zijun-hv3gt'</span>,</span><br><span class="line">        traceUser: <span class="literal">true</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.globalData = &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  onShow(options) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"onShow 执行"</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(options);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  onHide(options) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"onHide 执行"</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(options)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  onError(msg) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"onError 执行"</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(msg);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  onPageNotFound(res) &#123;</span><br><span class="line">    wx.redirectTo(&#123;</span><br><span class="line">      url: <span class="string">'pages/404/404'</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  globalData: <span class="string">"I am global data"</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="框架函数-Page"><a href="#框架函数-Page" class="headerlink" title="框架函数-Page()"></a>框架函数-Page()</h3><p><code>Page(Object object)</code></p><ul><li><p>注册小程序中的一个页面。接受一个<code>Object</code>类型参数，其指定页面的初始数据、生命周期回调、事件处理函数等</p></li><li><p>参数</p><ul><li><p><code>data()</code>: 页面的初始数据，用于页面第一次渲染</p></li><li><p><code>onLoad()</code>: 生命周期回调-监听页面加载，页面加载时触发，一个页面只会调用一次，可以在<code>onLoad</code>的参数中获取打开当前页面路径中的参数</p><ul><li><code>query</code>: 打开当前页面路径中的参数</li></ul></li><li><p><code>onShow()</code>: 生命周期回调-监听页面显示，页面显示/切入前台时触发</p></li><li><p><code>onReady()</code>: 生命周期回调-监听页面初次渲染完成，一个页面只会调用一次，代表页面已经准备妥当，可以和视图进行交互。</p><ul><li><code>wx.setNavigationBarTitle</code>需要在<code>onReady()</code>之后进行</li></ul></li><li><p><code>onHide()</code>: 生命周期回调-监听页面隐藏，页面隐藏/切入后台时触发，如调用：<code>wx.navigateTo()</code>、<code>wx.switchTab()</code></p></li><li><p><code>onUnload()</code>: 生命周期回调-监听页面卸载，如调用：<code>wx.redirectTo()</code>、<code>wx.navigateBack()</code></p></li><li><p><code>onPullDownRefresh()</code>: 监听用户下拉动作事件（下拉刷新）</p><ul><li>需要在<code>app.json</code>的<code>window</code>选项中，或者在页面配置中开启 <code>enablePullDownRefresh</code></li><li>可以通过 <code>wx.startPullDownRefresh</code>触发下拉刷新，当处理完数据刷新后，<code>wx.stopPullDownRefresh</code>可以停止下拉刷新动作</li></ul></li><li><p><code>onReachBottom()</code>: 监听用户上拉触底动作事件（上拉触底）</p><ul><li>可以在 <code>app.json</code> 的 <code>window</code> 选项中，或者在页面配置中设置触发距离 <code>onReachBottomDistance</code></li><li>在触发距离内滑动期间，本事件只会被触发一次</li></ul></li><li><p><code>onShareAppMessage(object)</code>: 用户点击右上角转发</p><ul><li>只有定义了此事件处理函数，右上角菜单才会显示“转发”按钮</li><li>此事件处理函数需要 return 一个 Object，用于自定义转发内容</li><li>object参数<ul><li><code>from</code>: 转发事件来源：<code>button</code>:页面内转发按钮/ <code>menu</code>:右上角转发菜单</li><li><code>target</code>: 如果 <code>from</code>值是 <code>button</code>，则 <code>target</code> 是触发这次转发事件的 <code>button</code>, 否则为 <code>undefined</code></li><li><code>webViewUrl</code>: 页面中包含web-view组件时，返回当前web-view的url</li></ul></li><li>return自定义转发内容<ul><li><code>title</code>: 转发标题</li><li><code>path</code>: 转发路径</li><li><code>imageUrl</code>: 自定义图片路径，显示图片长宽比为5:4</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户点击右上角分享</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">onShareAppMessage: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(res.from === <span class="string">'button'</span>) &#123;</span><br><span class="line">    <span class="comment">// 来自页面内转发按钮</span></span><br><span class="line">    <span class="built_in">console</span>.log(res.target);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    title: <span class="string">'音乐'</span>,</span><br><span class="line">    path: <span class="string">'pages/playlist/playlist'</span>,</span><br><span class="line">    imageUrl: <span class="string">'../../images/share_img.jpg'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>onPageScroll()</code>: 页面滚动触发事件的函数</p><ul><li><code>scrollTop</code>: 页面在垂直方向已滚动的距离（单位px）</li></ul></li><li><p><code>onResize()</code>: 页面尺寸改变时触发</p></li><li><p><code>onTabItemTap()</code>: 当前是tab页时，点击tab时触发</p><ul><li>Object参数<ul><li><code>index</code>: 被点击tabItem的序号，从0开始</li><li><code>pagePath</code>: 被点击tabItem的页面路径</li><li><code>text</code>: 被点击tabItem的按钮文字</li></ul></li></ul></li><li><p>其他：可以自定义任意函数或数据到 <code>Object</code> 参数中，在页面的函数中用 <code>this</code> 可以访问，比如自定义事件方法</p></li></ul></li><li><p>需要注意的是：Page和Component不同的是，Page自定义事件函数写在Page的参数中，而Component自定义事件函数需写在Component的methods方法中。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Page页面 js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    data: &#123;</span><br><span class="line">      <span class="comment">// 页面初始化数据  </span></span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    </span><br><span class="line">    goTo404 () &#123;</span><br><span class="line">        wx.navigateTo(&#123;</span><br><span class="line">            url: <span class="string">'/pages/404/404'</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Component js</span></span><br><span class="line">Component(&#123;</span><br><span class="line">    properties: &#123;</span><br><span class="line">        <span class="comment">// 组件对外属性</span></span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    </span><br><span class="line">    methods: &#123;</span><br><span class="line">        goTo404 () &#123;</span><br><span class="line">            wx.redirectTo(&#123;</span><br><span class="line">                url: <span class="string">'/pages/404/404'</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p><code>getCurrentPages()</code>: 获取当前页面栈。数组中的第一个元素为首页，最后一个元素为当前页面。</p><ul><li>注意：<ul><li>不要尝试修改页面栈，会导致路由以及页面状态错误</li><li>不要在 <code>App.onlaunch()</code> 的时候调用 <code>getCurrentPages()</code> ，此时 <code>Page</code> 还没有生成</li></ul></li></ul></li></ul><h3 id="框架函数-Component"><a href="#框架函数-Component" class="headerlink" title="框架函数-Component()"></a>框架函数-Component()</h3><p><code>Component(Object object)</code></p><ul><li><p>创建自定义组件，接受一个 <code>Object</code> 类型的参数</p></li><li><p>生成的组件实例可以在组件的方法、生命周期函数和属性 <code>observe</code> 中通过 <code>this</code> 访问。</p></li><li><p>组件通用属性</p><ul><li><code>is</code>: 组件的文件路径</li><li><code>id</code>: 节点id</li><li><code>dataset</code>: 节点dataset</li><li><code>data</code>: 组件数据，包括内容数据和属性值</li><li><code>properties</code>: 组件数据，包括内部数据和属性值</li></ul></li><li><p>组件常用方法</p><ul><li><p><code>setData</code>: 设置data并执行视图层渲染</p></li><li><p><code>triggerEvent</code>: 组件触发事件</p><ul><li><p>父组件向子组件传递数据，可以在WXML上进行数据绑定，设置属性</p></li><li><p>子组件向父组件传递数据，主要通过事件</p><ul><li><p>组件内WXML文件中定义 <strong>引发事件a</strong></p><p><code>&lt;view bindtap: a&gt;&lt;/view&gt;</code></p><p>如果有参数</p><p><code>&lt;view bindtap: a data-id=&quot;&quot; data-name=&quot;&quot;&gt;&lt;/view&gt;</code></p></li><li><p>组件内JS文件中,在设置的 <strong>引发事件a</strong> 中触发 <strong>传递事件b</strong> 传递数据</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">a(e) &#123;</span><br><span class="line">    <span class="keyword">this</span>.triggerEvent(<span class="string">'b'</span>, detail, option)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>父级页面（组件）WXML文件中，在使用组件上定义 <strong>接收事件c</strong> 和设置 <strong>传递事件b</strong></p><p><code>&lt;com bind:c=&quot;b&quot;&gt;&lt;/com&gt;</code></p></li><li><p>父级页面JS文件中，设置 <strong>接收事件c</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">c(e) &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(e);    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Components/playlist/playlist.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"c-playlist-container"</span> <span class="attr">bindtap</span>=<span class="string">"handleTransmit"</span> <span class="attr">data-id</span>=<span class="string">"&#123;&#123;palyData.id&#125;&#125;"</span> <span class="attr">data-name</span>=<span class="string">"&#123;&#123;palyData.name&#125;&#125;"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">"&#123;&#123;palyData.picUrl&#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"c-playlist-img"</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"c-playlist-tag"</span>&gt;</span><span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">"/images/palylist_tag.png"</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span><span class="tag">&lt;<span class="name">text</span>&gt;</span>&#123;&#123;count&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"c-playlist-title"</span>&gt;</span>&#123;&#123;palyData.name&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Components/playlist/playlist.js</span></span><br><span class="line">Component(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    methods: &#123;</span><br><span class="line">        handleTransmit(e) &#123;</span><br><span class="line">            <span class="keyword">let</span> query = e.currentTarget.dataset;</span><br><span class="line">            <span class="keyword">let</span> eventDetail = &#123;</span><br><span class="line">                id: query.id,</span><br><span class="line">                name: query.name</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">let</span> eventOption = &#123;&#125;;</span><br><span class="line">            <span class="keyword">this</span>.triggerEvent(<span class="string">"transmitId"</span>, eventDetail, eventOption);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- pages/playlist/playlist.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"playlist-wrap"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:for</span>=<span class="string">"&#123;&#123;playlist&#125;&#125;"</span> <span class="attr">wx:key</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">z-playlist</span> <span class="attr">paly-data</span>=<span class="string">"&#123;&#123;item&#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"z-playlist"</span> <span class="attr">bind:transmitId</span> = <span class="string">"transmitId"</span>&gt;</span><span class="tag">&lt;/<span class="name">z-playlist</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// pages/playlist/playlist.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    transmitId(e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(e.detail); <span class="comment">// &gt; &#123;id: 102, name: "Chiptune丨探索像素世界"&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul><p>需要注意的是：</p><ul><li><p>Vue中父组件向子组件传递一个对象，子组件改变这个对象，那么父组件也会相应的改变。即数据绑定到子组件是浅拷贝的。而在微信小程序中，经实现，数据绑定则是深拷贝的，子组件修改传递的对象，不会影响到父组件的这个对象。</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--- pages/playlist/playlist.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">z-playlist</span> <span class="attr">transmit-data</span>=<span class="string">"&#123;&#123;transmitData&#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">z-playlist</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// pages/playlist/palylist.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    data: &#123;</span><br><span class="line">        transmitData: &#123;</span><br><span class="line">            a: <span class="number">1</span>,</span><br><span class="line">            b: <span class="number">2</span>,</span><br><span class="line">            c: <span class="number">3</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Components/playlist/playlist.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">bindtap</span>=<span class="string">"handleTransmit"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Components/playlist/playlist.js</span></span><br><span class="line">Component(&#123;</span><br><span class="line">    properties: &#123;</span><br><span class="line">        transmitData: &#123;</span><br><span class="line">            type: <span class="built_in">Object</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    methods: &#123;</span><br><span class="line">        hancleTransmit() &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.data.transmitData);</span><br><span class="line">            <span class="keyword">this</span>.setData(&#123;<span class="string">'transmitData.c'</span>: <span class="number">10</span>&#125;);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.data.transmitData);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul></li></ul><ul><li><p>参数</p><ul><li><p><code>properties</code>: 组件的对外属性对象</p><ul><li>在 <code>properties</code> 定义段中，属性名采用驼峰写法(<code>propertiesName</code>)，在 <code>wxml</code>中，指定属性值时则对应使用连字符写法(<code>properties-name=&quot;valueName&quot;</code>)，应用于数据绑定时采用驼峰写法(<code>valueName</code>)</li><li>定义段<ul><li><code>type</code>: 属性的类型</li><li><code>optionalTypes</code>: 属性的额类型（可以指定多个）</li><li><code>value</code>: 属性的初始值</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Component js</span></span><br><span class="line">Component(&#123;</span><br><span class="line">    properties: &#123;</span><br><span class="line">        min: &#123;</span><br><span class="line">            type: <span class="built_in">Number</span>,</span><br><span class="line">            value: <span class="number">0</span></span><br><span class="line">        &#125;,</span><br><span class="line">        max: &#123;</span><br><span class="line">            <span class="comment">// 这个属性可以是 Number/String/Boolean 三种类型中的一种</span></span><br><span class="line">            type: <span class="built_in">Number</span>,</span><br><span class="line">            optionalTypes: [<span class="built_in">String</span>, <span class="built_in">Boolean</span>]</span><br><span class="line">            value: <span class="number">0</span></span><br><span class="line">        &#125;,</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p><code>data</code>: 组件的内部数据，和 <code>properties</code> 一同用于组件的模板渲染</p></li><li><p><code>observers</code>: 组件数据字段监听器，用于监听 <code>properties</code> 和 <code>data</code> 的变化</p></li><li><p><code>methods</code>: 组件的方法，包括事件响应函数和任意的自定义方法</p></li><li><p><code>behaviors</code>: 用于组件间代码共享的特性，类似于编程语言中的“mixins”,<code>每个behaviors</code>都包含 <code>properties</code>(属性)、<code>data</code>（数据）、<code>methods</code>（方法）、<code>created/attached/ready/moved/detached</code>(生命周期函数)，组件引用时，就会合并到当前组件中</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 第一步：创建behavior.js 提供组件调用</span></span><br><span class="line"><span class="comment">// behavior.js</span></span><br><span class="line"><span class="keyword">let</span> myBehavior = Behavior(&#123;</span><br><span class="line">    properties: &#123;</span><br><span class="line">        myName: &#123;</span><br><span class="line">            type: <span class="built_in">String</span>,</span><br><span class="line">            value: <span class="string">"Devin"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        myType: &#123;</span><br><span class="line">            type: <span class="built_in">String</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    data: &#123;</span><br><span class="line">        myData: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    attached: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"myAttached"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    methods: &#123;</span><br><span class="line">        myMethod: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"myMethod"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; myBehavior &#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 第二步：在组件中引入</span></span><br><span class="line"><span class="comment">// components/playlist/playlist.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; myBehavior &#125; <span class="keyword">from</span> <span class="string">"../../behaviors/hehavior"</span></span><br><span class="line"></span><br><span class="line">Component(&#123;</span><br><span class="line">    hehaviors: [mybehavior],</span><br><span class="line">    </span><br><span class="line">    properties: &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    data: &#123;&#125;,</span><br><span class="line">    </span><br><span class="line">    attached: <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;,</span><br><span class="line">    </span><br><span class="line">    methods: &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- components/playlist/playlist.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;myName&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><code>created</code>: 组件生命周期函数-在组件实例刚刚被创建时执行，注意此时不能调用 <code>setData()</code></p></li><li><p><code>attached</code>: 组件生命周期函数-在组件实例进入页面节点树时执行</p></li><li><p><code>ready</code>: 组件生命周期函数-在组件布局完成后执行</p></li><li><p><code>moved</code>: 组件生命周期函数-在组件实例被移动到节点树另一个位置时执行</p></li><li><p><code>detached</code>: 组件生命周期函数-在组件实例被从页面节点树移除时执行</p></li><li><p><code>relations</code>: 组件间关系定义，比如两个组件是父子节点关系</p></li><li><p><code>externalClasses</code>: 组件接受的外部样式类</p></li><li><p><code>options</code>: 一些选项</p></li><li><p><code>lifetimes</code>： 组件生命周期声明对象，推荐使用</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 组件生命周期书写方式</span></span><br><span class="line">Component(&#123;</span><br><span class="line">    <span class="comment">// 这是旧式的定义方式，可以保持对 &lt; 2.2.3 版本基础库的兼容</span></span><br><span class="line">    attached: <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;,</span><br><span class="line">    detached: <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 新式的定义方式，推荐使用</span></span><br><span class="line">    lifetimes: &#123;</span><br><span class="line">        attached: <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;,</span><br><span class="line">        detached: <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p><code>pageLifetimes</code>: 组件所在页面的生命周期声明对象</p><ul><li><code>show</code>: 组件所在页面被展示时执行</li><li><code>hide</code>: 组件所在页面被隐藏时执行</li><li><code>resize</code>: 组件所在页面尺寸变化时执行</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 组件所在页面的生命周期书写方式</span></span><br><span class="line">Component(&#123;</span><br><span class="line">    pageLifetimes: &#123;</span><br><span class="line">        show: <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;,</span><br><span class="line">        hide: <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;,</span><br><span class="line">        resize: <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p><code>definitionFilter</code>: 定义段过滤器</p></li></ul></li></ul><!-- rebuild by neat -->]]></content>
      <categories>
        <category>小程序</category>
        <category>基础</category>
      </categories>
      <tags>
        <tag>小程序</tag>
        <tag>微信小程序</tag>
      </tags>
  </entry>
  <entry>
    <title>音乐小程序云01-介绍</title>
    <url>/archives/bfbb6328.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录小程序云开发学习 - 介绍。</p><a id="more"></a><h3 id="Serverless"><a href="#Serverless" class="headerlink" title="Serverless"></a>Serverless</h3><ul><li>函数即服务。serverless无服务开发，让开发者不再需要考虑后端基础设施建设和维护（弱化后端和运维的概念），让开发者更多地专注业务逻辑</li><li>SDK操作资源，把云函数、云数据库、云调用、云存储等封装起来，开发者只需要通过SDK调用即可</li></ul><h3 id="云函数"><a href="#云函数" class="headerlink" title="云函数"></a>云函数</h3><ul><li>云端运行，原生支持。无需搭建服务器，无需域名设置，开发工具内一键上传部署即可运行后端代码；小程序内提供专门用于云函数调用的API；平台保证安全和隔离性，简化用户管理，免除运维操作。</li><li>私有协议。可在云函数内获取到小程序运行的上下文（appid、openid等），无需维护复杂的鉴权机制，即可获取天然可信任的用户登录态。</li><li>弹性伸缩。根据请求量实现毫秒级的实时弹性伸缩，函数未执行时不产生任何费用。</li></ul><h3 id="云数据库"><a href="#云数据库" class="headerlink" title="云数据库"></a>云数据库</h3><ul><li>文档型数据库，数据库包含多个集合，集合近似于一个JSON数组，数组中的每个对象就是一条记录，记录的格式是JSON文档。</li><li>简单易用，数据库API包含增删改查，操作简单：获取数据库引用、构造查询/更新条件、发送请求。</li><li>权限控制，API分为小程序和服务端两部分，开发者可以在小程序内直接调用API进行非敏感数据操作，对应高安全要求的数据，可在云函数内通过服务端API进行操作。</li></ul><h3 id="云存储"><a href="#云存储" class="headerlink" title="云存储"></a>云存储</h3><ul><li>快速上传，小程序云提供文件存储空间、上传文件到云端，云开发者可以在小程序端和云函数端通过API使用云文件存储。</li><li>权限管理，基于微信登录态的安全控制，带权限管理的云端下载。</li><li>CDN加速，存储内的文件，天然CDN加速。</li></ul><!-- rebuild by neat -->]]></content>
      <categories>
        <category>小程序</category>
        <category>音乐小程序</category>
      </categories>
      <tags>
        <tag>小程序</tag>
        <tag>微信小程序</tag>
        <tag>音乐小程序</tag>
      </tags>
  </entry>
  <entry>
    <title>音乐小程序云03-实现组件</title>
    <url>/archives/524c5d04.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录小程序云开发学习 - 实现组件。</p><a id="more"></a><h3 id="实现播放页的轮播图"><a href="#实现播放页的轮播图" class="headerlink" title="实现播放页的轮播图"></a>实现播放页的轮播图</h3><p>修改 <code>pages/playlist/playlist.js</code> 文件中 <code>data</code> 属性：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 页面的初始数据</span></span><br><span class="line">data: &#123;</span><br><span class="line">    swiperImgUrls: [</span><br><span class="line">      &#123;</span><br><span class="line">        url: <span class="string">"../../images/swiper_01.jpg"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        url: <span class="string">"../../images/swiper_02.jpg"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        url: <span class="string">"../../images/swiper_03.jpg"</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    swiperOptions: &#123;</span><br><span class="line">      indicatorDots: <span class="literal">true</span>,</span><br><span class="line">      indicatorColor: <span class="string">"rgba(191, 191, 191, 0.3)"</span>,</span><br><span class="line">      indicatorActiveColor: <span class="string">"rgba(216, 30, 6, 1)"</span>,</span><br><span class="line">      autoplay: <span class="literal">true</span>,</span><br><span class="line">      interval: <span class="number">3000</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改 <code>pages/playlist/playlist.wxml</code> 文件：</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">swiper</span> <span class="attr">indicator-dots</span>=<span class="string">"&#123;&#123;swiperOptions.indicatorDots&#125;&#125;"</span> <span class="attr">indicator-color</span>=<span class="string">"&#123;&#123;swiperOptions.indicatorColor&#125;&#125;"</span> <span class="attr">indicator-active-color</span>=<span class="string">"&#123;&#123;swiperOptions.indicatorActiveColor&#125;&#125;"</span> <span class="attr">autoplay</span>=<span class="string">"&#123;&#123;swiperOptions.autoplay&#125;&#125;"</span> <span class="attr">interval</span>=<span class="string">"&#123;&#123;swiperOptions.interval&#125;&#125;"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:for</span>=<span class="string">"&#123;&#123;swiperImgUrls&#125;&#125;"</span> <span class="attr">wx:key</span>=<span class="string">"*this"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">swiper-item</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">"&#123;&#123;item.url&#125;&#125;"</span> <span class="attr">mode</span>=<span class="string">"widthFix"</span> <span class="attr">bindtap</span>=<span class="string">"goTo404"</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">swiper-item</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">swiper</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img data-src="../../assets/20200827101707.png" alt=""></p><h3 id="播放列表组件"><a href="#播放列表组件" class="headerlink" title="播放列表组件"></a>播放列表组件</h3><div class="note warning"><p>组件开发中，是否独立为组件的判断并非实现代码的可复用性，而是是否符合高内聚、低耦合的开发思想。</p></div><ol><li><p>鼠标右键点击 <code>components</code> 文件夹，左键单击文件，输入文件名（<code>playlist-item</code>）</p></li><li><p>鼠标右键点击 <code>playlist-item</code> 文件夹【新建Component】，输入组件名（ <code>playlist-item</code> ），即可生成组件文件</p></li><li><p>先书写组件，定义需要用到的数据(<code>components/playlist-item/playlist-item.js</code> 和 <code>components/playlist-item/playlist-item.wxml</code>)</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// components/play-list-item/play-list-item.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; tranNumberUnit &#125; <span class="keyword">from</span> <span class="string">"../../utils/common"</span></span><br><span class="line"><span class="keyword">import</span> &#123; ICON_HEADSET &#125; <span class="keyword">from</span> <span class="string">"../../utils/base64"</span></span><br><span class="line"></span><br><span class="line">Component(&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 组件的属性列表</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  properties: &#123;</span><br><span class="line">    data: &#123;</span><br><span class="line">      type: <span class="built_in">Object</span>,</span><br><span class="line">      value: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  observers: &#123;</span><br><span class="line">    [<span class="string">'data.playCount'</span>](count) &#123;</span><br><span class="line">      <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">        count: tranNumberUnit(count, <span class="number">2</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 组件的初始数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  data: &#123;</span><br><span class="line">    count: <span class="number">0</span>,</span><br><span class="line">    iconTag: ICON_HEADSET</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 组件的方法列表</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  methods: &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>其中，icon 和常用方法抽离成单独文件（文件目录下）。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils/base64.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ICON_HEADSET = <span class="string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAbwUlEQVR4Xu1dCdy21Zy+rkEjaSxFjWwRylJZUpKSNmVoUFmm0kcyoUWJJhp7C4kWhhaTJZOyRiKVVJJCZI2GyDQayhqhmWt+1+M8n+d7v+d9n/u+z7nX5/x/v+f3fO/3nvM//3Od+3rv+z7nvxBZakNA0v0BPDh87gVgdQB3Dt/+97Sfbc9vJz6/W+TnGwB83x+S19U2iTlXzDmff/T0Ja0RCPCQCTKYFP55legBiin4E4BrxoQJ36OfSd5UTEVuNQ2BTJCS14Uk3wmeBGDr8Fm3pIqmm/8QwOfC51KSNzZtQJ/HywSZsXqS1gxEeAKALQA8ss8LDuDLAC4AcJk/JH/Z8/nUan4myBR4JZkEOwdCmBhNPSrVuthTlP8RwBcAfAnAJ0he1bQBXR8vEySskKT7AXha+Gzb9YWryb7zAZztD8kf1zRGr9TONUEkeRdpTAp/37FXq1efsbeOiRLI4l21uZS5JIikHSeI4ZfuLIsj4O3k8V3l3HkDaq4IIukZAPYGYIJkKY+ACXIKyY+W79rPHnNBEEnPDsTYpp/L1DmrvQtmopzROcsSGzRogkjaE8ALAGyZGLes7i8IXAzgVJLvGyoggySIJD9GmRibDXXhOjavywNRTumYXdHmDIog4eX7XwD47CJL8whcAuBIkoN5mR8EQSStDeAwAPs1f03kEacgcAKAI0j+rO/o9J4gkpYFcqzX98UYmP3XBpL8e5/n1VuCBHcQP07t2ucFmAPbzwqPXb10Y+klQSSZGH6kcmxFlu4j4JgWP3Id2X1TV7SwVwSRtCmANwHo43nGr0PMxs8B/AqAf5727RW6K4C7LPJ9jxBr4t/3TXx+8iqS9ijuhfSGIJL8An5ED+4a48Alfy//d+o4DElrBaKMg7PGAVv+7rL4bnIYSb/Id146TxBJ9w3E+KeOomlXcR+YnU/S3rCti6QnAvBnq/Dduk1TDDg9EOUnXTRubFOnCSLJL+C+a3Rph8qE8MGYv02KTgccSfKjmAO9Jj9duSa90+W7iV/kOymdJIgkByiZGAd3BLVRQFEIKvpeR2yqZIak9UMwmAPCHldJSfpObw1EcWx9p6RzBJH0CADv6MBpuP+6jUnhE+LBiSR7HJgo/rR9lzbGB3QtqrFTBJH0aAAfDNlB2rog3z9BjNvaMqLJcSXdfoIoftf7mybHnxjL7yMv6Mq7nO3qDEEk+XZ/DoC7tbQ4JwE4ieRXWxq/E8NK2jg4etrZc9UWjLoFwPNJntnC2CsN2QmCSPJuy0UtAZKJMQV4SRtMEMXnMk3LXiTf2/SgC8drnSCStgNwXgtAZGIUAF3SAyaI4rOXJmVfku9qcsBOEUTSLgCa3uL7DwBvnfdHqbIXnaR1ABwI4OVl+0a2P5jksZE6Kndv7Q4i6WUAmpz4lQCO6cqzbeUVa7ljOIQ8FMAODZryapJ2MWpcWiGIpFcBeGNDs7W/01v8IfnnhsYc/DDB9cdEaSorzEEk39Y0sI0TRNJBfsRpaKKORfBd4zsNjTdXw4T3E5PkhQ1NfFeSH25orNEwjRJE0j8D+LcGJuiyAIeS/FgDY839EJKeDuCohs6vtifpZNyNSGMEkfQ8AKc1MCunojE5curMBsAeDxFSt5okTrFUtzyRpHMK1y6NEETSbgA+VPNs/i8Qw+8bWVpCQNIh4W5S92n85iTtI1er1E4QSU4E/XEAq9U4k68AeCXJC2scI6suiIAk1085GsBjCnap0sxe1NvVvV1fK0FC3LjJ4ZiOusQHfiaHd6uydAQBST59N0n2qdEkv2vuQvKbdY1RG0GCy7oDiOrMUXUIyWPqAifrjUdA0qsBvCFe06Ia7AW8LclaXOXrJIgv3DrjOfYkac/bLB1HQJJP3+t8N7RnRC0n/LUQJEQC1umNuQPJNvy3On4pdtc8SS8BcGKNFu5WR2RicoKEGHJnr6grAGcjklfXCHRWXRMCkuye8pma1DvAbRuSSWPc6yDIBwDUlWBh7dTZQWparKx2EQQk+Q/nD2oC6HSSu6fUnZQgwT/n+JQGjnWRTGprHTZmncURkKTirUu13D9lSqFkF11I6uZdqzqyHT6IpG+hWQaCQMjrVUdya+fd8q5WkuR0KQlictSR8fDJJD87kOsiT2MCAUkbAvhGDaBcQDJJpeIkBAm5cp2mJ7W8lKQznGQZKAKStgdQxx9A59uKzgUcTZBwWu7MgqkfrfIh4EBJsXBakvYAkLqMmx+1toxNI5SCID7vSF2C4HCSTQVUzcll2O1p1nSYeBZJO8pWliiChOI176k8+vSO7yHplDNZ5gwBSe+uwXfLKYQqF/GpTJBQ9sx+MCkPBJ3W80kk/3vOro08XQDBwdHBUCm9gL37+YSq5eBiCOLzjtQ1ARsPqcxXZrcQCK7yJknKeJITSO5fZaaVCBKqyX66yoBL9HkbScerZ5lzBELQ1ZsTw7BTleq7VQniXauUbuw+1LEfjdNOZskI+HHL+ctShu9eQnLLstCWJoikvQGcXHagGe0bDcRPbHtWVwMCIcbdHtuuoJVKXkjylDLKqhDEccCblRlkRtvXkXxtQn1Z1UAQCNlSPppwOpeTLFUTpRRBJO0JIGVCYe+COUOFEy5kyQishIAkh1SnzLv1PJKFDyXLEsSpVko/xy2x7g6670Rdv3xtdhOBkJzOf0hTZXC8mKSrCRSSwgSR5BcmvzilkqNIut55lozAkgjUEEbxHJLOnzZTyhAkpbfuFeHR6g8zLcwNMgJ/OUR0JGKqhNmFvX0LEUTSMwB8JOFKPZXkpxLqy6oGjkDIKv/5hNN8JsmZGwBFCeJDwR0TGZcPBBMBOW9qJDkzSqrsJeeS3GkWhjMJkvjU/GYAG5O8fpZh+fcZgYUIhCI+riGZqtLVzNP1IgRxNnZnZU8hx5F0laIsGYFKCEhyIZ3DKnVeudO7SO67lK4lCSJpdQD2sE21xfZokl9LNLmsZg4RCNu+voukKCx6A4D1Sf52MShnEcTpe5zGJ4V8kGRd6YBS2Jd19AQBSSmzdu5O8vSqBHHJgqiIrImBdyRZV9KwnixtNjMFAqFEte8iKeq4n0nyWaUJEpzF/Hh1xwSTOp+kyz1nyQgkQUDSCQBemkDZreExa2rBpUUfsRKfXuZE0wlWMqv4KwKSNgbgu0iKwKpFk80tRRBHdaXILfQ9khvkxc0IpEZAkp0OnRElVhZ9wplKkJDKJ9Vu09EkXQk1S0YgKQKSngkgVdXbR01LEbQYQRyf8ZpEs2mkllwiW7OaHiEg6fYAvpsocchrSb5u4fQXI4gz3TnjXaxUCnOMHTT3nx8EEm75TnVgXIkgku4GwGl3/jYBzC8n+dYEerKKjMBUBCQ5N4JzJMSKS7itQ/IXk4qmEeQpAFJ42t4GYIOclT123XL/WQhIugxAqVDaRXSuVKVqGkFS+bp8hOQusyaXf58RiEVA0itDbfZYVSvlz5pGkMsBbBo7EoB89pEAxKxiNgKS1g8v67MbL93iKpKPWvQRK3FREz/P2RksS0agdgQSPmatcN2ucAdJuK98Ecmta0clD5ARCAhIOhbAyxIAsgfJ5Q66CwnyLgAvSjDIG0kenkBPVpERKIRAwtLjK1QXWEiQ/wTwgEIWLd0ol01LAGJWURyBcDzhiNVY+RHJ5RxYThBJawBYYQ84YqQ75zy7EejlrpUQSPgesibJm2zEJEG8j+z95FjJ7x+xCOb+lRCQdBQAb/nGynL3qEmC7AWgciWeCYtyrt3Y5cn9KyEgyd7n9kKPlWUkT1t4B3GV2hSZDrcmeVGshbl/RqAKApJUpd+CPkeSHCWGmLyD2G3Y7sOxcq9cQi0Wwty/KgKSHAX7kKr9Q7/lXiCTBLkawCMiFf+G5F0ideTuGYHKCEg6G8BTKyv4S8dvktxw4R3kjwBWiVT8FZKbROrI3TMClRFIlH3xTyRH3uyjO4ik+wP4UWWr/trxdJK7J9CTVWQEKiGQsALauiSvGxPEwVEOkoqV15B8fayS3D8jUBUBSa5f4zo2sbIDyfPGBHH6FKdRiZVnk3QurSwZgVYQSOhwux/JE8cESbXF+0iSX28FmTxoRiAgIOlXAGI3i0ZbvWOCpErCtRrJ3+eVygi0iYAklxV/bKQNJ5Lcb0wQn6D7JD1Glr/5xyjJfTMCsQhIcsi4Q8dj5DSSy8YESXFImM9AYpYj902GgCTHc8QmSh8dFo4JkiLNz89J3jPZLLOijEBFBCS9A8CLK3YfdzuP5A5jgqTICnE9yftGGpW7ZwSiEUhUZOdLJDcfEySFm8kPSD44enZZQUYgEgFJrwBwdKSakbvJmCA+Rfdpeox8i2SsL1fM+LlvRmCEgKR9ALw7Eo7rSK47JogjCR1RGCPZDysGvdw3GQKSXBDnjEiFN5Fcc0yQFI6Kl5J0GsgsGYFWEZC0A4DYamajY4sxQf4MwJmyYyQTJAa93DcZAokIchvJO4wJ8jsAq0VaeCXJ2NPLSBNy94zA6B3EdTVjfQJvIXnnlO8gy4NM8iJlBNpEIJHL+80k1xgT5L8S1EL/PsnYUMc2cc1jDwQBSQcDcKnoGLmB5DpjgqRIGPcTkveLsSj3zQikQECSK0X9a6SuUQK5MUG+41oekQpvJLl2pI7cPSMQjYCktwM4IFLRqPjsmCAu2PnISIW/JnnXSB0rdZd0OwAm3t+HX7r61c9I/m/qsbK+ehBoeg0lvQfAssjZfIPkxmOCfAnAZpEKbyW5aowOSesA2DF81gukuMciOn8eSsV9H8DHAbjG3M9ixs994xHowhpK+giAZ0TO5sskNxsT5PMAnhipECRXKsgzS6ckFyyx7/52AGIPGs8D4LnYEzNVGetZU5j733dtDSWdD2CbyIW5mORWY4KcBOCFkQrdfX2S1xTRE6oC2SXZHz9GpRQ/fr3TH5JOJJalBgS6uoaSrgMQu2H0fpJ7jgnycgBvSYDh00h+cik9ku4TSPESAKsnGHMpFb8F4NgAE+X6mseaG/VdXkNJvqZ+k2AxDif5xjFBdg7P8bF6DyG56P6zpOcCcFnopne7/G7iCZ8SO8F579/1NZTkd2m/U8fKqOLtmCDe4vVWb6ycQnLqo5ok/78f5dqUN5NMkR6/zTm0NnYf1jDRKbox3ojk1WOC2FHRDouxMnqxWahE0msAvDZWeaL+Hya5ayJdc6OmL2uY6AzE67oqyVsnk1enOE1f6bBQkt2O7X7cJbmQZOwuR5fmU6stfVrDRDtYPyY5CiCcJEiqC/muJH9t5ZLe63rpta5edeW50E8B7Pq2hpJ8kBz7jjtK2LCQIMcD2K8AZrOabEryCkl+pPKjVZdlF5I+VMoyBYG+raGkNQH4ADlWRknjFhLkBQBS7PK4VvWPAXw01sqG+m9J8pKGxurNMJKe3rc1lOTDbh8Ux8o+JE9eSJCHAvh2rOaQJd5uIg9MoKsJFT7Y3JbkT5sYrA9jSLo3AJfR69UaAvDZ2qEJMH4UyatWIIh/kPRLALEOh45vHxUf6ZEcQ/KQHtlbq6mJitDUauMU5T5/exIAuy7FyCiScKxgBd8pSecA2ClGe0/7/gnA47L/1uiPpC8wH7TFVhtr+lLwMcUdEgx6CUnXGBnJQoI4yMTBJvMo7yP5vHmc+OScO75r1cTyHEfywMUI4uKHLoI4r7Ijydh0Mb3FTtKTAZzb2wmkMXxPku9fjCB+OZtnp76RB2canPunRVKKMhj9m/iKFj+U5HenEsT/KSlFnt6+gjTXYcOSvJPnoLV5lVG60cnJrxTgJOnEsF02ryDtRHLuHjMSniH0+br5IMkV6opMI0gq1/e+AnUCyf37anxVuyWlqlNZ1YQu9FtG8rRZd5A7AbDjYqw/SxcmXMWGa0k+qErHPveR5Ofu9fs8h0jbfX633sID46kx5JLeB2CPyAH73H0Nkjf3eQJlbJd0dwA3lekzwLafIuld3BVkMYKYHCbJvMpmJF0pdS5E0qYALp+LyS4+yQNI2mG3EEH8eOXHLD9uzaPsTvL0eZm4JL+YuvDlPMsK27tjIBZN0yPJuab8wj6PMlexIj1xa6/zOpwaCesBlyKIPSO95TuPcjrJ3atOXNIuAB4DYJPw8d34CwDsIXoOSVf06owkKpvcmflUMGSUwWRav6UI4pDDbyWoG1LB3ta7fJak3S5KiSRX+T0KwHOW6OicTUeM4w1KDVBT446G1NY026lqH0vyylIEceM5dj04maQLQRaWCo8pnybpjJKti6RUiQNbn0sFA5ZchyVThUqy67td4OdN/pXkG4pOWtJGAL5etP1Eu71IOm6/VZF0OIDXt2pEe4OvdDg4acrMXLqSrgjP0e1NofmRlwRtoTmSLgXw+IpmbkXy4op9k3STtBcAOyrOm/hx9+Ekb1ls4kUI4ki7N88ZctuQvLDInBPEbn+R5BZFxqqrjSRH4l1Ql/4O630LyVcsZV8Rgszjy/qDSf6gyMJWePdYqLZ1D2JJdq1xGYl5k0VfzsdAzCSIG87hy/odSdo3Z6YkClO+J8kU6Wpm2jutgSTnELi1Uuf+diq0SVKUIPP0sv5tkg8vuu6SfgXgLkXbL9KuddcWSd7Sf1jkPPrUvdB7ZiGChLvIxwD8Y58QqGjrqST3LtpXkoq2XaLd1iSdZqc1keScaM6NNg/yVZI+yJ0pZQiyfch5NVNpzxvsTfLUonMYEEFSJQ4sCl2b7V5EslClgcIECXeRMwA8q82ZNTD2w0gWLgXRNEEkuZjpo4Mri1P02I3FaXquKrqxMA1DSakSBzawRFFDFL57eJSyBHFpg1YfBaKgmd35NyRLvU80SRBJs/zjPkCychyPJCcd/7vZMPW6ReG7R2mChLtIlzO2x65caR+spggi6UwAReqa/E9IpfrNsmDMgU9WqbtHVYKkKnFVdv2aaF/azb0JgkhyCbm1SgJQeus4wZlOSRMbb17q7lGJIOEuMlTntqlRZUstY90EkeSajgdVuJQuIrl1mX6SnKziuDJ9etS29N0jhiB+ofOL4dCeV/cgWSqyrk6ChDy5DoWtmnP2aJKFs51LcgzM8qyCPbr4i5j6fJKl/c1KvaRPWjHQ2/E/kCzlvVwzQWa9lM+6MK4hWThTiSS7339qltIe/v5MkpV2X2MI4rvHZQM7fd2cZKkSwjUTJEUq0DuR/EORi1rS48KaFmnelzaume4iSd+oYnBlgoR3kaEdLm1A8ntlgKyZID8CMComGSGjcsZF+kvy3WZ5XtoifXrQ5lCSR1e1M4oggSTOp+S8SkOQtUh6m7Sw1EyQRt1YJN0TwI2FJ9/9hp8naVf+ypKCIL51bVjZgm51vAPJ28qYNDCC3B6AC9EMRbYjeX7MZFIQxEUTXTxxCFLYzX082YERxO+VoxLeQxCS0dd3tAJJQyLI3Ujafb2wDIwgft/xe88gJBMk/TLei6QL0ReWgRHEzo9fLTz5jjfMBEm/QA8k+cMyagdGkG0BfK7M/LvcNhMk/eo4w0WpWvEDI4gP0xzSMAjJBEm/jJuQ/EoZtQMjyL4A3llm/l1umwmSfnV84npJGbUDI8irAEzNUVsGk660zQRJvxL7kSyVsHtgBLGj5go1+tJD3JzGTJD0WJ9BcqnE0yuNODCC+P3LntqDkEyQ9Mt4PUlnaC8sNROkMV+sIebGygQpfBmXanhfktcX7VEzQRrz5pU0uEjRTJCiV3G5ds8hWXirs2aCNBYPImlQO1he8kyQchd+0dYnktyvaOOaCeKT7UYiCodYIyQTpOhVXK7d10g671QhqZMgNqCpmHRJrur72EKT7kmjTJD6FmoVkoXcvusmSCBJ7VlNEuUYrm9FKmjOBKkAWsEuW5D8YpG2TRAkkKS2vFghW+MNRebbpzaZIPWt1sEkjy2ivimCBJLMemmvlFlRkuN5HLYwKMkEqW85jyV5cBH1TRIkkCR5bt5MkMVXOgdMTcfmNJLLukiQIjaVbZMJkglS9pr5JMmnFenU9B2kiE1l22SC1EuQcwE8ueyidLz9Z0juWMTGRLs/rVaYkuRiMlcWmW+P2vyO5Oqx9qZ4xLL3q18ehyTvIPnSIhMaSI3CdQD8tMh8e9TmWpIuTholKQjyMgCFdnyiLG2280Ek31ZkyAQpWLtQ5fZ2AEqlOyqCTcttLiG5ZawNKQjiZ/VPxBrSsf47kzy7iE1DqJPueUpywrx7FJlzT9qcRXK3WFtTEMSVUV0hdUhSKjZd0qUAHl8RgK1IXlyxb7JukoaUANC4nEDS5RyiJAVBVgXw+ygrute5cMLn8Nd3IwBfrzCNvUi6YlfrIuksALu0bkg6A/YneUKsumiChAvEcdxbxBrTkf5fJunYiFJS4V2kUCH7UkZENJbkUNtStVEihmui64NIXhs7UCqCuAKSKyENQUqXYRtPWpKjEY8CsFTY7nUAjiB5cpfAkrQ2gFJJ87pk/wJbribpu3q0pCLIxi5DHG1NNxREn0lI8qOKzxY2CR+Xav5CwOgckr/oxlRXtELSZwFs30XbStp0DMlDSvaZ2jwJQcJjlp/Bk7A2xcQq6vguycEkLSiLgSSXazuybL8Ott+B5Hkp7EpJEJ8bHJjCqBZ1HE/ygBbHb3XoUBPxCgA+F+mrXEkyWeBXSoI8PISHrtZTZG8B4MeroW1Zl1oOSccDKBxyXEp5M42XkTwt1VDJCBIes94E4LBUxjWsxy/Oziw41xLKsPkuEu3H1AKQpUtfz7IxNUFcwstJBtadNXDHfu/8U757lCq/1rE5JDNHkt9DCpePTjZwvKLdSPo8J5kkJUi4i/gZ/u3JLGxG0YEkj2tmqO6PIuk+AHwX8dZvX6SWc6XkBAkk6dN24dkkd+7LVdCUnZL2BtCps5ol5m5P5KcUreZbBsO6CPKAUG97rTLGtNDWJ62Pz49W05GX5PLJr2hhXcoO6TW8rGynIu1rIUi4i/ShWtEj5n3XatZF0gMfrWRnHtOwqI0ggST7AHj3rEVo6fc7kXQ0ZJYZCEi6AEBUvfGaQC4ct1N1/FoJEkjSxYCqV5P0lnSWgghUcMYsqLlysxeRPKly74IdaydIIIn9e/zi3gV5CcnBlBlrElBJzwTw4SbHnDLWjQB2J3l+E3Y0QpBAks0BfAjAvZuY2JQxbnbsfJnM7S3Z2elhJT0h7G49pAVD7V+1b9lKxDF2NkaQQJINgzPcTjFGV+j7aQCvJ+kEzVkiEZDkP3I+73LE3iqR6op090HucW2cVTVKkDESknYF8GIATnlZp1zkqq2pT1frNLhPuoNzo4myZ0122z/OB7gmRyteDq0QZIIoewWiOG4ipTjHk4mRzGktpXFD0yXJedGeG2JJUpx9OT7euYJPbXsbvlWCTBDFL/HbBYD9GFZF7BrhbVs7rPnOkaUFBCQ54d74s14JE5z44mMALiRZJb6/xFDFm3aCIJPmSjKoBthJv+wL5I8TNo/9glwrw6Gh/vbnGgCO0nMoa5YOISDp7mEdvaZeT3+vAcARlpOfH5L8Q4dMX27K/wOO+xxfyV+d8AAAAABJRU5ErkJggg=="</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils/common.js</span></span><br><span class="line">   <span class="keyword">export</span> <span class="keyword">const</span> tranNumberUnit = <span class="function">(<span class="params">num, point</span>) =&gt;</span> &#123;</span><br><span class="line">     <span class="keyword">let</span> numStr = num.toString().split(<span class="string">'.'</span>)[<span class="number">0</span>]</span><br><span class="line">     <span class="keyword">if</span> (numStr.length &lt; <span class="number">5</span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> numStr</span><br><span class="line">     &#125; <span class="keyword">else</span> <span class="keyword">if</span> (numStr.length &gt;= <span class="number">5</span> &amp;&amp; numStr.length &lt;= <span class="number">8</span>) &#123;</span><br><span class="line">       <span class="keyword">let</span> decimal = numStr.substring(numStr.length - <span class="number">4</span>, numStr.length - <span class="number">4</span> + point)</span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">parseFloat</span>(<span class="built_in">parseInt</span>(num / <span class="number">10000</span>) + <span class="string">'.'</span> + decimal) +</span><br><span class="line">         <span class="string">'万'</span></span><br><span class="line">     &#125; <span class="keyword">else</span> <span class="keyword">if</span> (numStr.length &gt; <span class="number">8</span>) &#123;</span><br><span class="line">       <span class="keyword">let</span> decimal = numStr.substring(numStr.length - <span class="number">8</span>, numStr.length - <span class="number">8</span> + point)</span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">parseFloat</span>(<span class="built_in">parseInt</span>(num / <span class="number">100000000</span>) + <span class="string">'.'</span> + decimal) + <span class="string">'亿'</span></span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--components/play-list-item/play-list-item.wxml--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"c-paly-list-item"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">"&#123;&#123;data.coverImgUrl&#125;&#125;"</span> <span class="attr">mode</span>=<span class="string">"aspectFill"</span> <span class="attr">class</span>=<span class="string">"list-image"</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"tag"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">"&#123;&#123;iconTag&#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span>&gt;</span>&#123;&#123;count&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span>&#123;&#123;data.name&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>在需要使用组件的页面（<code>pages/playlist/playlist.json</code> 和 <code>pages/playlist/playlist.wxml</code> 和 <code>pages/playlist/playlist.js</code>）中引入此组件，js 文件中 <code>data</code> 中 <code>palylistData</code> 为前端模拟（写死）的数据，也可以拉取第三方数据</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"usingComponents"</span>: &#123;</span><br><span class="line">    <span class="attr">"c-palylist-item"</span>: <span class="string">"/components/playlist-item/playlist-item"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- palylist --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"playlist-wrap"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:for</span>=<span class="string">"&#123;&#123;playlistData&#125;&#125;"</span> <span class="attr">wx:key</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">c-palylist-item</span> <span class="attr">data</span>=<span class="string">"&#123;&#123;item&#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"playlist-item"</span>&gt;</span><span class="tag">&lt;/<span class="name">c-palylist-item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&#96;&#96;&#96;javascript</span><br><span class="line">&#x2F;&#x2F; pages&#x2F;playlist&#x2F;playlist.js</span><br><span class="line">data: &#123;</span><br><span class="line">  playlistData: [</span><br><span class="line">      &#123;</span><br><span class="line">        id: 100,</span><br><span class="line">        coverImgUrl: &quot;http:&#x2F;&#x2F;p2.music.126.net&#x2F;dqrKYT-r9IHMxGw4cUWvcg&#x3D;&#x3D;&#x2F;109951164742613163.jpg?param&#x3D;140y140&quot;,</span><br><span class="line">        playCount: 260123,</span><br><span class="line">        name: &quot;暖春 | 总有一首歌 温暖你的世界&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        id: 101,</span><br><span class="line">        coverImgUrl: &quot;http:&#x2F;&#x2F;p2.music.126.net&#x2F;vWuREhx25IYyuYczOiluIg&#x3D;&#x3D;&#x2F;109951164768712730.jpg?param&#x3D;140y140&quot;,</span><br><span class="line">        playCount: 40545,</span><br><span class="line">        name: &quot;『Gentleman』梦境温柔低语&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        id: 102,</span><br><span class="line">        coverImgUrl: &quot;http:&#x2F;&#x2F;p2.music.126.net&#x2F;Ujb1La5f6pxxqqejwSUDVw&#x3D;&#x3D;&#x2F;109951164814383015.jpg?param&#x3D;140y140&quot;,</span><br><span class="line">        playCount: &#39;22078&#39;,</span><br><span class="line">        name: &quot;Chiptune丨探索像素世界&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        id: 103,</span><br><span class="line">        coverImgUrl: &quot;http:&#x2F;&#x2F;p2.music.126.net&#x2F;s0g7wK4IZPDCIAGRPHiuCA&#x3D;&#x3D;&#x2F;109951164844209695.jpg?param&#x3D;140y140&quot;,</span><br><span class="line">        playCount: 1464123.8,</span><br><span class="line">        name: &quot;[放刺一周电音] 晶天狮爷，至尊五金&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        id: 104,</span><br><span class="line">        coverImgUrl: &quot;http:&#x2F;&#x2F;p2.music.126.net&#x2F;i-7ktILRPImJ0NwiH8DABg&#x3D;&#x3D;&#x2F;109951162885959979.jpg?param&#x3D;140y140&quot;,</span><br><span class="line">        playCount: 3398123,</span><br><span class="line">        name: &quot;网易云评论最多的纯音乐TOP50首&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        id: 105,</span><br><span class="line">        coverImgUrl: &quot;http:&#x2F;&#x2F;p1.music.126.net&#x2F;FFv3X-5m13Bi6kO5ObcAOQ&#x3D;&#x3D;&#x2F;109951164774795457.jpg?param&#x3D;140y140&quot;,</span><br><span class="line">        playCount: 2054369,</span><br><span class="line">        name: &quot;冷门亦惊艳｜聆听女声与电音的心动交汇&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        id: 106,</span><br><span class="line">        coverImgUrl: &quot;http:&#x2F;&#x2F;p1.music.126.net&#x2F;pV2fJb8piSRT3Vl-Htdf_g&#x3D;&#x3D;&#x2F;109951164845626742.jpg?param&#x3D;140y140&quot;,</span><br><span class="line">        playCount: 10673652,</span><br><span class="line">        name: &quot;「硬曲 硬不硬听了再说 （蹦迪专用❗）」&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li></ol><!-- rebuild by neat -->]]></content>
      <categories>
        <category>小程序</category>
        <category>音乐小程序</category>
      </categories>
      <tags>
        <tag>小程序</tag>
        <tag>微信小程序</tag>
        <tag>音乐小程序</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa开启本地Vue预览服务</title>
    <url>/archives/e9b7a3f7.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录-Koa开启本地Vue预览服务。</p><a id="more"></a><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>由于Live-server 和 Anywhere 这两种 Node 插件不能满足 Vue Build 之后跳转外链的预览（非router push跳转），所以需要开启Node的静态服务，利用插件来解决跳转外链之后返回请求不到的问题</p><h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><ol><li><p>新建项目目录</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">e:</span><br><span class="line">mkdir Vue<span class="literal">-build</span><span class="literal">-preview</span></span><br><span class="line">cd .\Vue<span class="literal">-build</span><span class="literal">-preview</span>\</span><br><span class="line">npm init <span class="literal">-y</span></span><br><span class="line">npm i koa <span class="literal">-S</span></span><br><span class="line">npm i koa<span class="literal">-static</span> <span class="literal">-D</span></span><br><span class="line">npm i koa2<span class="literal">-connect</span><span class="literal">-history</span><span class="literal">-api</span><span class="literal">-fallback</span> <span class="literal">-D</span></span><br></pre></td></tr></table></figure></li><li><p>此目录下新建a <code>app.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">static</span> = <span class="built_in">require</span>(<span class="string">"koa-static"</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; historyApiFallback &#125; = <span class="built_in">require</span>(<span class="string">"koa2-connect-history-api-fallback"</span>);</span><br><span class="line">app.use(historyApiFallback());</span><br><span class="line">app.use(<span class="keyword">static</span>(<span class="string">"./dist"</span>));</span><br><span class="line">app.listen(<span class="number">8066</span>, () =&gt; &#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">"Koa预览Vue已开启"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><p>启动预览</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">E:\Vue<span class="literal">-build</span><span class="literal">-preview</span>&gt; node app.js</span><br></pre></td></tr></table></figure><p>将Vue build 之后的 dist 目录复制到 <code>E:\Vue-build-preview</code> 目录下即可</p><p>浏览器键入 <code>http:localhost:8066</code> 开启预览</p></li></ol><h3 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h3><p>此项优化非必要！</p><p>为了解决一旦修改 <code>app.js</code> 文件之后，还需重新运行 <code>node app.js</code>，所以引入热更新。</p><ol><li><p>安装插件 <code>nodemon</code></p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">npm i nodemon <span class="literal">-D</span></span><br></pre></td></tr></table></figure></li><li><p>修改 <code>app.js</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.js </span></span><br><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"dev"</span>: <span class="string">"nodemon app.js"</span>,</span><br><span class="line">    <span class="string">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li><li><p>开启服务</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">E:\Vue<span class="literal">-build</span><span class="literal">-preview</span>&gt; npm run dev</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">E:\Vue<span class="literal">-build</span><span class="literal">-preview</span>&gt; yarn dev</span><br></pre></td></tr></table></figure></li></ol><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Windows</category>
        <category>Server</category>
      </categories>
      <tags>
        <tag>静态服务</tag>
        <tag>Koa</tag>
      </tags>
  </entry>
  <entry>
    <title>常用Cmd命令</title>
    <url>/archives/fd31ce3.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录cmd常用的一些命令。</p><a id="more"></a><h2 id="常用Cmd命令"><a href="#常用Cmd命令" class="headerlink" title="常用Cmd命令"></a>常用Cmd命令</h2><ul><li><code>dir</code> 查看当前文件夹下的文件及文件夹</li><li><code>cd</code> 切换目录/文件</li><li><code>cd file</code> 进入当前文件夹下的file文件夹</li><li><code>cd fold1/fold2</code> 或者 <code>cd fold1\fold2</code> 进入多层文件夹</li><li><code>cd ..</code> 进入上一层文件夹</li><li><code>cd ../folder</code> 进入上一层文件夹中的folder文件夹</li><li><code>mkdir myfolder</code> 或 <code>md myfolder</code> 在当前目录下创建myfolder文件夹</li><li><code>type nul &gt; my.txt</code> 创建空白的my.txt文件</li><li><code>echo content &gt; test1.py</code> 创建内容是content的my.txt文件</li><li><code>type test1.py</code> 查看在当前目录下的test1.py文件内容，把内容打印到cmd中</li><li><code>test1.py</code> 直接输入文件名，用默认程序打开此文件（相当于鼠标双击）</li><li><code>ren oldname newname</code> 重命名</li><li><code>del test1.py</code> 删除文件</li><li><code>del myfolder</code> 删除myfolder文件夹中的所有文件（文件夹保留）</li><li><code>rd myfolder</code> 或者 <code>rmdir myfolder</code> 删除myfolder文件夹</li><li><code>tree myfolder</code> 将myfolder文件夹下的所有文件夹展示成树状结构（不展示文件）</li><li><code>tree myfolder /f</code> 展示文件夹及文件树状结构</li><li><code>tree myfolder /f &gt; my.txt</code> 将结果输出到my.txt文件中（新建的文件）</li><li><code>cls</code> 清屏</li></ul><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Windows</category>
        <category>Cmd</category>
      </categories>
      <tags>
        <tag>Cmd</tag>
      </tags>
  </entry>
  <entry>
    <title>音乐小程序云04-数据云化</title>
    <url>/archives/be73b202.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录小程序云开发学习 - 歌单数据插入云数据库。为模拟数据。</p><a id="more"></a><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><p>运用到的API接口为：</p><ul><li>网易云音乐API（<a href="http://musicapi.leanapp.cn/" target="_blank" rel="noopener external nofollow noreferrer">http://musicapi.leanapp.cn/</a>）</li><li>API文档（<a href="https://binaryify.github.io/NeteaseCloudMusicApi/#/?id=neteasecloudmusicapi" target="_blank" rel="noopener external nofollow noreferrer">https://binaryify.github.io/NeteaseCloudMusicApi/#/?id=neteasecloudmusicapi</a>）</li><li>GitHub地址（<a href="https://github.com/Binaryify/NeteaseCloudMusicApi" target="_blank" rel="noopener external nofollow noreferrer">https://github.com/Binaryify/NeteaseCloudMusicApi</a>）【已Fork】</li></ul><p>这里运用到的API有：</p><ol><li>歌单（网友精选碟）：<a href="http://localhost:3000/top/playlist?limit=10&amp;order=new" target="_blank" rel="noopener external nofollow noreferrer">http://localhost:3000/top/playlist?limit=10&amp;order=new</a></li><li>获取歌单详情：<a href="http://localhost:3000/related/playlist?id=1" target="_blank" rel="noopener external nofollow noreferrer">http://localhost:3000/related/playlist?id=1</a></li><li>获取音乐url：<a href="http://localhost:3000/song/url?id=33894312" target="_blank" rel="noopener external nofollow noreferrer">http://localhost:3000/song/url?id=33894312</a></li></ol><h3 id="准备云函数-歌单数据"><a href="#准备云函数-歌单数据" class="headerlink" title="准备云函数 - 歌单数据"></a>准备云函数 - 歌单数据</h3><ol><li><p>新建云函数 <code>postMusicData</code></p></li><li><p>在此云函数下，安装 <code>axios</code>，<code>npm i axios</code>，然后在安装 <code>wx-server-sdk</code>，<code>npm i wx-server-sdk</code></p></li><li><p>编写云函数</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">   <span class="comment">// 云函数入口文件</span></span><br><span class="line">   <span class="keyword">const</span> cloud = <span class="built_in">require</span>(<span class="string">'wx-server-sdk'</span>)</span><br><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">'axios'</span>)</span><br><span class="line">   cloud.init(&#123;</span><br><span class="line">     env: cloud.DYNAMIC_CURRENT_ENV</span><br><span class="line">   &#125;)</span><br><span class="line">   <span class="keyword">const</span> db = cloud.database()</span><br><span class="line">   <span class="keyword">const</span> postUrl = <span class="string">"http://172.16.55.29:3000/top/playlist"</span></span><br><span class="line">   <span class="keyword">const</span> MAX_LIMIT = <span class="number">100</span></span><br><span class="line">   <span class="comment">// 云函数入口函数</span></span><br><span class="line">   exports.main = <span class="keyword">async</span> (event, context) =&gt; &#123;</span><br><span class="line">     <span class="comment">/* 上传 歌单 */</span></span><br><span class="line">     <span class="comment">// 获取歌单</span></span><br><span class="line">     <span class="keyword">let</span> &#123;</span><br><span class="line">       data</span><br><span class="line">     &#125; = <span class="keyword">await</span> axios.post(postUrl, &#123;</span><br><span class="line">       limit: <span class="number">101</span>,</span><br><span class="line">       order: <span class="string">"hot"</span></span><br><span class="line">     &#125;)</span><br><span class="line">     <span class="built_in">console</span>.log(data.playlists)</span><br><span class="line">     <span class="keyword">const</span> &#123;</span><br><span class="line">       playlists</span><br><span class="line">     &#125; = data;</span><br><span class="line">   </span><br><span class="line">     <span class="comment">// 获取数据库已有数据</span></span><br><span class="line">     <span class="keyword">const</span> morkPlaylistColl = db.collection(<span class="string">'mockPlaylist'</span>)</span><br><span class="line">     <span class="keyword">const</span> &#123;</span><br><span class="line">       total</span><br><span class="line">     &#125; = <span class="keyword">await</span> morkPlaylistColl.count()</span><br><span class="line">     <span class="built_in">console</span>.log(&#123;total&#125;)</span><br><span class="line">     <span class="keyword">const</span> batchTimes = <span class="built_in">Math</span>.ceil(total / MAX_LIMIT)</span><br><span class="line">     <span class="keyword">let</span> hasMorkPlaylist = <span class="literal">null</span></span><br><span class="line">     <span class="built_in">console</span>.log(batchTimes)</span><br><span class="line">     <span class="keyword">const</span> tasks = []</span><br><span class="line">     <span class="keyword">if</span> (batchTimes) &#123;</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">let</span> p = <span class="number">0</span>; p &lt; batchTimes; p++) &#123;</span><br><span class="line">         <span class="keyword">const</span> promise = morkPlaylistColl.skip(p * MAX_LIMIT).limit(MAX_LIMIT).get()</span><br><span class="line">         tasks.push(promise)</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="built_in">console</span>.log(&#123;</span><br><span class="line">         tasks</span><br><span class="line">       &#125;)</span><br><span class="line">       <span class="keyword">let</span> resData = <span class="function">(<span class="params"><span class="keyword">await</span> <span class="built_in">Promise</span>.all(tasks</span>)).<span class="params">reduce</span>(<span class="params">(acc, cur</span>) =&gt;</span> &#123;</span><br><span class="line">         <span class="keyword">return</span> &#123;</span><br><span class="line">           data: acc.data.concat(cur.data),</span><br><span class="line">           errMsg: acc.errMsg</span><br><span class="line">         &#125;</span><br><span class="line">       &#125;)</span><br><span class="line">       <span class="built_in">console</span>.log(&#123;resData&#125;)</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">"resData的长度："</span> + resData.data.length)</span><br><span class="line">       hasMorkPlaylist = resData.data</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       hasMorkPlaylist = []</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="built_in">console</span>.log(hasMorkPlaylist)</span><br><span class="line">   </span><br><span class="line">     <span class="comment">// 数据去重</span></span><br><span class="line">     <span class="keyword">let</span> newData = []</span><br><span class="line">     <span class="keyword">if</span> (hasMorkPlaylist.length) &#123;</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = playlists.length; i &lt; len; i++) &#123;</span><br><span class="line">         <span class="keyword">let</span> flag = <span class="literal">true</span></span><br><span class="line">         <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>, length = hasMorkPlaylist.length; j &lt; length; j++) &#123;</span><br><span class="line">           <span class="keyword">if</span> (playlists[i].id === hasMorkPlaylist[i].id) &#123;</span><br><span class="line">             flag = <span class="literal">false</span></span><br><span class="line">             <span class="keyword">break</span></span><br><span class="line">           &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         flag &amp;&amp; (newData.push(playlists[i]))</span><br><span class="line">       &#125;</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       newData = playlists</span><br><span class="line">     &#125;</span><br><span class="line">   </span><br><span class="line">     <span class="comment">// 插入数据库</span></span><br><span class="line">     <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>, len = newData.length; i &lt; len; i++) &#123;</span><br><span class="line">       <span class="keyword">await</span> morkPlaylistColl.add(&#123;</span><br><span class="line">         data: &#123;</span><br><span class="line">           ...newData[i]</span><br><span class="line">         &#125;</span><br><span class="line">       &#125;)</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">'插入成功'</span>)</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="直接数据库写入-轮播图数据"><a href="#直接数据库写入-轮播图数据" class="headerlink" title="直接数据库写入 - 轮播图数据"></a>直接数据库写入 - 轮播图数据</h3><p>在云数据库中，新建集合：<code>swiper</code>，然后手动插入数据</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">swiperImgUrls: [</span><br><span class="line">  &#123;</span><br><span class="line">    id: <span class="number">1000</span>,</span><br><span class="line">    url: https:<span class="comment">//s1.ax1x.com/2020/08/31/dLBCCQ.jpg</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id: <span class="number">1001</span>,</span><br><span class="line">    url: https:<span class="comment">//s1.ax1x.com/2020/08/31/dLBP3j.jpg</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id: <span class="number">1002</span>,</span><br><span class="line">    url: https:<span class="comment">//s1.ax1x.com/2020/08/31/dLBp4g.jpg</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="music云函数"><a href="#music云函数" class="headerlink" title="music云函数"></a>music云函数</h3><p>思路为：因为微信云函数上限为50个，通过不同传参，控制不同返回的结果</p><div class="note warning"><p>云函数如果开启本地调试，需要在对应的文件目录下先安装依赖： <code>npm i</code></p></div><p>新建/编辑 <code>music</code> 云函数：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// cloudfunctions/music/index.js</span></span><br><span class="line"><span class="comment">// 云函数入口文件</span></span><br><span class="line"><span class="keyword">const</span> cloud = <span class="built_in">require</span>(<span class="string">'wx-server-sdk'</span>)</span><br><span class="line">cloud.init()</span><br><span class="line"><span class="keyword">const</span> db = cloud.database()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 云函数入口函数</span></span><br><span class="line">exports.main = <span class="keyword">async</span> (event, context) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> data = &#123;&#125;</span><br><span class="line">  <span class="keyword">const</span> &#123; method, api, page, limit &#125; = event</span><br><span class="line">  <span class="comment">// 获取 首页歌单列表</span></span><br><span class="line">  <span class="keyword">if</span>(method === <span class="string">"get"</span> &amp;&amp; api === <span class="string">"getPlaylist"</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> playlistCol = db.collection(<span class="string">"mockPlaylist"</span>)</span><br><span class="line">    <span class="keyword">const</span> &#123;total&#125; = <span class="keyword">await</span> playlistCol.count()</span><br><span class="line">    <span class="keyword">const</span> &#123;list&#125; = <span class="keyword">await</span> playlistCol.aggregate()</span><br><span class="line">    .skip(page*limit)</span><br><span class="line">    .limit(limit)</span><br><span class="line">    .sort(&#123;</span><br><span class="line">      id: <span class="number">1</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .end()</span><br><span class="line">    data = &#123;</span><br><span class="line">      total,</span><br><span class="line">      currPage: page,</span><br><span class="line">      limit,</span><br><span class="line">      list</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="swiper云函数"><a href="#swiper云函数" class="headerlink" title="swiper云函数"></a>swiper云函数</h3><div class="note warning"><p>云函数如果开启本地调试，需要在对应的文件目录下先安装依赖： <code>npm i</code></p></div><p>新建/编辑swiper云函数：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// cloudfunctions/swiper/index.js</span></span><br><span class="line"><span class="comment">// 云函数入口文件</span></span><br><span class="line"><span class="keyword">const</span> cloud = <span class="built_in">require</span>(<span class="string">'wx-server-sdk'</span>)</span><br><span class="line">cloud.init()</span><br><span class="line"><span class="keyword">const</span> db = cloud.database()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 云函数入口函数</span></span><br><span class="line">exports.main = <span class="keyword">async</span> (event, context) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; method, api, limit &#125; = event</span><br><span class="line">  <span class="keyword">let</span> data = &#123;&#125;</span><br><span class="line">  <span class="keyword">if</span>(method === <span class="string">"get"</span> &amp;&amp; api === <span class="string">"getSwiperList"</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; list&#125; = <span class="keyword">await</span> db.collection(<span class="string">"swiper"</span>).aggregate()</span><br><span class="line">    .limit(limit)</span><br><span class="line">    .sort(&#123;</span><br><span class="line">      id: <span class="number">1</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .end()</span><br><span class="line">    data = list</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
      <categories>
        <category>小程序</category>
        <category>音乐小程序</category>
      </categories>
      <tags>
        <tag>小程序</tag>
        <tag>微信小程序</tag>
        <tag>音乐小程序</tag>
      </tags>
  </entry>
  <entry>
    <title>音乐小程序云05-首页渲染</title>
    <url>/archives/20d61b8c.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录小程序云开发学习 - 首页渲染列表，上拉加载，下拉刷新等。</p><a id="more"></a><h3 id="抽离全局设置"><a href="#抽离全局设置" class="headerlink" title="抽离全局设置"></a>抽离全局设置</h3><p>在 项目根目录下新建文件 <code>settings.js</code>：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// settings.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 首页 轮播图 限制最多展示数量</span></span><br><span class="line">  HOME_SWIPER_LIMIT: <span class="number">3</span>,</span><br><span class="line">  <span class="comment">// 首页 歌单列表 单次加载最大数据量</span></span><br><span class="line">  HOME_MUSIC_LIST_LIMIT: <span class="number">7</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>列表页（<code>pages/playlist/playlist.js</code>）引入</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// pages/playlist/playlist.js</span></span><br><span class="line"><span class="keyword">import</span> settings <span class="keyword">from</span> <span class="string">"../../settings"</span></span><br><span class="line"></span><br><span class="line">Page(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 页面的初始数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  data: &#123;</span><br><span class="line">    swiperOptions: &#123;</span><br><span class="line">      indicatorDots: <span class="literal">true</span>,</span><br><span class="line">      indicatorColor: <span class="string">"rgba(191, 191, 191, 0.3)"</span>,</span><br><span class="line">      indicatorActiveColor: <span class="string">"rgba(216, 30, 6, 1)"</span>,</span><br><span class="line">      autoplay: <span class="literal">true</span>,</span><br><span class="line">      interval: <span class="number">3000</span></span><br><span class="line">    &#125;,</span><br><span class="line">    swiperImgUrls: [],</span><br><span class="line">    playlistData: [],</span><br><span class="line">    page: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 获取音乐歌单列表 */</span></span><br><span class="line">  <span class="keyword">async</span> getMusicList(loadMore) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> &#123;result&#125; = <span class="keyword">await</span> wx.cloud.callFunction(&#123;</span><br><span class="line">        name: <span class="string">"music"</span>,</span><br><span class="line">        data: &#123;</span><br><span class="line">          method: <span class="string">"get"</span>,</span><br><span class="line">          api: <span class="string">"getPlaylist"</span>,</span><br><span class="line">          page: <span class="keyword">this</span>.data.page,</span><br><span class="line">          limit: settings.HOME_MUSIC_LIST_LIMIT</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">        page: <span class="keyword">this</span>.data.page + <span class="number">1</span></span><br><span class="line">      &#125;)</span><br><span class="line">      result = [...this.data.playlistData, ...result.list]</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(result) </span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">      <span class="comment">// do catch</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 获取轮播图片列表 */</span></span><br><span class="line">  <span class="keyword">async</span> getSwiperList() &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> &#123;result&#125; = <span class="keyword">await</span> wx.cloud.callFunction(&#123;</span><br><span class="line">        name: <span class="string">"swiper"</span>,</span><br><span class="line">        data: &#123;</span><br><span class="line">          method: <span class="string">"get"</span>,</span><br><span class="line">          api: <span class="string">"getSwiperList"</span>,</span><br><span class="line">          limit: settings.HOME_MUSIC_LIST_LIMIT</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(result)</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">      <span class="comment">// do catch</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> init() &#123;</span><br><span class="line">    <span class="keyword">const</span> getMusicList = <span class="keyword">this</span>.getMusicList()</span><br><span class="line">    <span class="keyword">const</span> getSwiperList = <span class="keyword">this</span>.getSwiperList()</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">      <span class="keyword">const</span> value = <span class="keyword">await</span> <span class="built_in">Promise</span>.all([getMusicList, getSwiperList])</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125; <span class="keyword">catch</span>&#123;</span><br><span class="line">      <span class="comment">// do catch</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面加载</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> onLoad(options) &#123;</span><br><span class="line">    wx.showLoading(&#123;</span><br><span class="line">      title: <span class="string">'加载中'</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> value = <span class="keyword">await</span> <span class="keyword">this</span>.init()</span><br><span class="line">    wx.hideLoading(&#123;</span><br><span class="line">      success: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">          swiperImgUrls: value[<span class="number">1</span>],</span><br><span class="line">          playlistData: value[<span class="number">0</span>]</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// mock数据</span></span><br><span class="line">    <span class="comment">// let res = await wx.cloud.callFunction(&#123;name: "postMusicData"&#125;)</span></span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 页面相关事件处理函数--监听用户下拉动作</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> onPullDownRefresh() &#123;</span><br><span class="line">    <span class="keyword">this</span>.data.swiperImgUrls = []</span><br><span class="line">    <span class="keyword">this</span>.data.playlistData = []</span><br><span class="line">    <span class="keyword">this</span>.data.page = <span class="number">0</span></span><br><span class="line">    <span class="keyword">const</span> value = <span class="keyword">await</span> <span class="keyword">this</span>.init()</span><br><span class="line">    wx.stopPullDownRefresh(&#123;</span><br><span class="line">      success: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">          swiperImgUrls: value[<span class="number">1</span>],</span><br><span class="line">          playlistData: value[<span class="number">0</span>]</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 页面上拉触底事件的处理函数</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> onReachBottom() &#123;</span><br><span class="line">    wx.showLoading(&#123;</span><br><span class="line">      title: <span class="string">'加载中'</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="keyword">this</span>.getMusicList(<span class="literal">true</span>)</span><br><span class="line">    wx.hideLoading(&#123;</span><br><span class="line">      success: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">          playlistData: result</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="上拉加载-下拉刷新"><a href="#上拉加载-下拉刷新" class="headerlink" title="上拉加载/下拉刷新"></a>上拉加载/下拉刷新</h3><p>在页面基本配置：<code>pages/playlist/playlist.json</code></p><div class="note warning"><p><code>backgroundTextStyle</code>如果不设置将默认为 <code>dark</code> 下拉刷新的效果不明显。影响这里的主要因素有两个：页面中 和 全局中 这个参数。</p></div><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"usingComponents"</span>: &#123;</span><br><span class="line">    <span class="attr">"c-palylist-item"</span>: <span class="string">"/components/playlist-item/playlist-item"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"onReachBottomDistance"</span>: <span class="number">10</span>,</span><br><span class="line">  <span class="attr">"enablePullDownRefresh"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"backgroundTextStyle"</span>: <span class="string">"dark"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
      <categories>
        <category>小程序</category>
        <category>音乐小程序</category>
      </categories>
      <tags>
        <tag>小程序</tag>
        <tag>微信小程序</tag>
        <tag>音乐小程序</tag>
      </tags>
  </entry>
  <entry>
    <title>音乐小程序云08-播放器二</title>
    <url>/archives/de65b958.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录小程序云开发学习 - 播放器。</p><a id="more"></a><h3 id="上传模拟歌曲数据"><a href="#上传模拟歌曲数据" class="headerlink" title="上传模拟歌曲数据"></a>上传模拟歌曲数据</h3><ol><li><p>新建云数据库集合：<code>mockSong</code></p></li><li><p>新建/编写云函数 <code>pstSong</code>，依赖：<code>axios</code>(只模拟一条数据)</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 云函数入口文件</span></span><br><span class="line"><span class="keyword">const</span> cloud = <span class="built_in">require</span>(<span class="string">'wx-server-sdk'</span>)</span><br><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">'axios'</span>)</span><br><span class="line">cloud.init(&#123;</span><br><span class="line">  env: cloud.DYNAMIC_CURRENT_ENV</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> db = cloud.database()</span><br><span class="line"><span class="keyword">const</span> postUrl = <span class="string">"http://172.16.55.29:3000/song/url"</span></span><br><span class="line"><span class="comment">// 云函数入口函数</span></span><br><span class="line">exports.main = <span class="keyword">async</span> (event, context) =&gt; &#123;</span><br><span class="line">  <span class="comment">/* 上传 歌曲信息 */</span></span><br><span class="line">  <span class="comment">// 获取歌曲</span></span><br><span class="line">  <span class="keyword">const</span> &#123;id&#125; = event</span><br><span class="line">  <span class="keyword">const</span> &#123;data&#125; = <span class="keyword">await</span> axios.get(postUrl, &#123;</span><br><span class="line">    params: &#123;</span><br><span class="line">      id: <span class="number">33894312</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">const</span> response = data.data</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 插入数据库</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>, len = response.length; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">await</span> db.collection(<span class="string">'mockSong'</span>).add(&#123;</span><br><span class="line">      data: &#123;</span><br><span class="line">        ...response[i]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'插入成功'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>调用云函数</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// pages/musicPlay/musicPlay.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 页面的初始数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  data: &#123;</span><br><span class="line">    musicData: <span class="string">""</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面加载</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> onLoad(options) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;id&#125; = options</span><br><span class="line">    wx.setNavigationBarTitle(&#123;</span><br><span class="line">      title: <span class="string">'播放器'</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.log(options)</span><br><span class="line">    <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">      musicData: wx.getStorageSync(<span class="string">'musicData'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    wx.cloud.callFunction(&#123;</span><br><span class="line">       name: <span class="string">"postSong"</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ol><h3 id="获取数据"><a href="#获取数据" class="headerlink" title="获取数据"></a>获取数据</h3><ol><li><p>编辑云函数 <code>music</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 云函数入口文件</span></span><br><span class="line"><span class="keyword">const</span> cloud = <span class="built_in">require</span>(<span class="string">'wx-server-sdk'</span>)</span><br><span class="line">cloud.init()</span><br><span class="line"><span class="keyword">const</span> db = cloud.database()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 云函数入口函数</span></span><br><span class="line">exports.main = <span class="keyword">async</span> (event, context) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> data = &#123;&#125;</span><br><span class="line">  <span class="keyword">const</span> &#123; method, api, page, limit, id &#125; = event</span><br><span class="line">  <span class="comment">// 获取 首页歌单列表</span></span><br><span class="line">  <span class="keyword">if</span>(method === <span class="string">"get"</span> &amp;&amp; api === <span class="string">"getPlaylist"</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> playlistCol = db.collection(<span class="string">"mockPlaylist"</span>)</span><br><span class="line">    <span class="keyword">const</span> &#123;total&#125; = <span class="keyword">await</span> playlistCol.count()</span><br><span class="line">    <span class="keyword">const</span> &#123;list&#125; = <span class="keyword">await</span> playlistCol.aggregate()</span><br><span class="line">    .skip(page*limit)</span><br><span class="line">    .limit(limit)</span><br><span class="line">    .sort(&#123;</span><br><span class="line">      id: <span class="number">1</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .end()</span><br><span class="line">    data = &#123;</span><br><span class="line">      total,</span><br><span class="line">      currPage: page,</span><br><span class="line">      limit,</span><br><span class="line">      list</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(method === <span class="string">"get"</span> &amp;&amp; api === <span class="string">"getPlayDetails"</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> playDetailsCol = db.collection(<span class="string">"mockPlayDetails"</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(&#123;id&#125;)</span><br><span class="line">    data = <span class="keyword">await</span> playDetailsCol.where(&#123;<span class="attr">id</span>: id&#125;).get()</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(method === <span class="string">"get"</span> &amp;&amp; api === <span class="string">"getSong"</span>) &#123;</span><br><span class="line">  	<span class="keyword">const</span> songCol = db.collection(<span class="string">"mockSong"</span>)</span><br><span class="line">  	data = <span class="keyword">await</span> songCol.where(&#123;<span class="attr">id</span>: <span class="number">33894312</span>&#125;).get()</span><br><span class="line">	&#125;</span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>音乐播放页调用云函数</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// pages/musicPlay/musicPlay.js</span></span><br><span class="line"><span class="keyword">async</span> init () &#123;</span><br><span class="line">  <span class="keyword">let</span> &#123;result&#125; = <span class="keyword">await</span> wx.cloud.callFunction(&#123;</span><br><span class="line">    name: <span class="string">"music"</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      method: <span class="string">"get"</span>,</span><br><span class="line">      api: <span class="string">"getSong"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">    songData: result.data[<span class="number">0</span>]</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li></ol><h3 id="音乐播放器API"><a href="#音乐播放器API" class="headerlink" title="音乐播放器API"></a>音乐播放器API</h3><ul><li><code>wx.getBackgroundAudioManager()</code>： 获取全局唯一的背景音频管理器<ul><li><code>src</code>：音频的数据源（必填）</li><li><code>title</code>：音频标题（必填）</li><li><code>epname</code>：专辑名</li><li><code>singer</code>：歌手名</li><li><code>coverImgUrl</code>：封面图URL</li><li><code>startTime</code>：音频开始播放的位置（单位：s）</li><li><code>duration</code>：当前音频的长度（单位：s），只读</li><li><code>currentTime</code>：当前音频的播放位置（单位：s），只读</li><li><code>paused</code>：当前是否暂停或停止。（只读）</li><li><code>play()</code>：播放音乐</li><li><code>pause()</code>：暂停音乐</li><li><code>seek(currentTime)</code>：跳转到指定位置</li><li><code>stop()</code>：停止音乐</li></ul></li></ul><ol><li><p>在 <code>app.js</code> 中先配置，后台播放音频的能力</p><figure class="highlight"><table><tr><td class="code"><pre><span class="line">"requiredBackgroundModes": ["audio"]</span><br></pre></td></tr></table></figure></li><li><p>页面中调用api，即可在小程序模拟器下方可见具体音频设置</p></li></ol><h3 id="音乐播放条"><a href="#音乐播放条" class="headerlink" title="音乐播放条"></a>音乐播放条</h3><!-- rebuild by neat -->]]></content>
      <categories>
        <category>小程序</category>
        <category>音乐小程序</category>
      </categories>
      <tags>
        <tag>小程序</tag>
        <tag>微信小程序</tag>
        <tag>音乐小程序</tag>
      </tags>
  </entry>
  <entry>
    <title>音乐小程序云02-基础构建</title>
    <url>/archives/26b23292.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录小程序云开发学习 - 基础构建。</p><a id="more"></a><h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><ol><li>注册小程序：<a href="https://mp.weixin.qq.com/wxamp/home/guide?token=924934298&lang=zh_CN" target="_blank" rel="noopener external nofollow noreferrer">https://mp.weixin.qq.com/wxamp/home/guide?token=924934298&amp;lang=zh_CN</a></li><li>下载小程序开发工具：<a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html" target="_blank" rel="noopener external nofollow noreferrer">https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html</a></li><li>在开发者工具中创建项目，需要填写AppID</li><li>点击【云开发】，填写环境名称，建议使用 <code>test</code> (我这里使用的名称为 <code>zijun</code>)</li><li>正常的话，回到项目中 <code>clooundfunctions</code> 文件夹后面会显示当前环境，否则 console 中会报错（<code>cloud init error</code>）</li></ol><h3 id="配置环境"><a href="#配置环境" class="headerlink" title="配置环境"></a>配置环境</h3><p>修改 <code>app.js</code> 文件中的 <code>wx.cloud.init</code> 函数中的 <code>env</code> 属性：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">wx.cloud.init(&#123;</span><br><span class="line">  <span class="comment">// env 参数说明：</span></span><br><span class="line">  <span class="comment">//   env 参数决定接下来小程序发起的云开发调用（wx.cloud.xxx）会默认请求到哪个云环境的资源</span></span><br><span class="line">  <span class="comment">//   此处请填入环境 ID, 环境 ID 可打开云控制台查看</span></span><br><span class="line">  <span class="comment">//   如不填则使用默认环境（第一个创建的环境）</span></span><br><span class="line">  env: <span class="string">'zijun-hv3gt'</span>,</span><br><span class="line">  traceUser: <span class="literal">true</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="配置页面路径"><a href="#配置页面路径" class="headerlink" title="配置页面路径"></a>配置页面路径</h3><p>修改 <code>app.json</code>文件中 <code>pages</code> 属性：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">"pages"</span>: [</span><br><span class="line">    <span class="string">"pages/playlist/playlist"</span>,</span><br><span class="line">    <span class="string">"pages/blog/blog"</span>,</span><br><span class="line">    <span class="string">"pages/profile/profile"</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="配置tabBar"><a href="#配置tabBar" class="headerlink" title="配置tabBar"></a>配置tabBar</h3><p>提前将 <code>tabBar</code> 需要用到的图片预先放置到 <code>images</code> 目录下，修改 <code>app.json</code> 文件中 <code>tabBar</code> 属性：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">"tabBar"</span>: &#123;</span><br><span class="line">    <span class="string">"color"</span>: <span class="string">"#BFBFBF"</span>,</span><br><span class="line">    <span class="string">"selectedColor"</span>: <span class="string">"#d81e06"</span>,</span><br><span class="line">    <span class="string">"list"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"pagePath"</span>: <span class="string">"pages/playlist/playlist"</span>,</span><br><span class="line">            <span class="string">"text"</span>: <span class="string">"音乐"</span>,</span><br><span class="line">            <span class="string">"iconPath"</span>: <span class="string">"images/playlist.png"</span>,</span><br><span class="line">            <span class="string">"selectedIconPath"</span>: <span class="string">"images/playlist_se.png"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"pagePath"</span>: <span class="string">"pages/blog/blog"</span>,</span><br><span class="line">            <span class="string">"text"</span>: <span class="string">"发现"</span>,</span><br><span class="line">            <span class="string">"iconPath"</span>: <span class="string">"images/blog.png"</span>,</span><br><span class="line">            <span class="string">"selectedIconPath"</span>: <span class="string">"images/blog_se.png"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"pagePath"</span>: <span class="string">"pages/profile/profile"</span>,</span><br><span class="line">            <span class="string">"text"</span>: <span class="string">"我的"</span>,</span><br><span class="line">            <span class="string">"iconPath"</span>: <span class="string">"images/profile.png"</span>,</span><br><span class="line">            <span class="string">"selectedIconPath"</span>: <span class="string">"images/profile_se.png"</span></span><br><span class="line">          &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="配置naviBar"><a href="#配置naviBar" class="headerlink" title="配置naviBar"></a>配置naviBar</h3><p>修改 <code>app.json</code>文件中 <code>window</code> 属性：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">"window"</span>: &#123;</span><br><span class="line">    <span class="string">"backgroundColor"</span>: <span class="string">"#F6F6F6"</span>,</span><br><span class="line">    <span class="string">"backgroundTextStyle"</span>: <span class="string">"light"</span>,</span><br><span class="line">    <span class="string">"navigationBarBackgroundColor"</span>: <span class="string">"#d81e06"</span>,</span><br><span class="line">    <span class="string">"navigationBarTitleText"</span>: <span class="string">"音乐"</span>,</span><br><span class="line">    <span class="string">"navigationBarTextStyle"</span>: <span class="string">"white"</span>  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
      <categories>
        <category>小程序</category>
        <category>音乐小程序</category>
      </categories>
      <tags>
        <tag>小程序</tag>
        <tag>微信小程序</tag>
        <tag>音乐小程序</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa2-API-OPTIONS请求理解和处理</title>
    <url>/archives/a94d8a44.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Node框架开发API - OPTIONS请求理解和处理。</p><a id="more"></a><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>OPTIONS方法就是我们在发送请求时，浏览器会发送一次预检请求，获得服务端返回的信息，看后台是否允许进行访问。</p><p>产生options请求</p><ul><li>跨域请求</li><li>自定义请求头</li><li>请求头中的 <code>content-type</code> 是 <code>application/x-www-form-urlencoded</code> / <code>multipart/form-data</code> / <code>text/plain</code> 之外的格式</li></ul><h3 id="处理"><a href="#处理" class="headerlink" title="处理"></a>处理</h3><ul><li><code>allowedMethods()</code></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"><span class="keyword">const</span> bodyparser = <span class="built_in">require</span>(<span class="string">"koa-bodyparser"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123; <span class="attr">prefix</span>: <span class="string">"/api"</span> &#125;);</span><br><span class="line">router</span><br><span class="line">	.post(<span class="string">"/user"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">		ctx.body = ctx.request.body;</span><br><span class="line">	&#125;)</span><br><span class="line">app.use(bodyparser());</span><br><span class="line">app.use(router.routes());</span><br><span class="line">app.listen(<span class="number">8066</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"服务已开启"</span>);</span><br></pre></td></tr></table></figure><p>上述代码，注意没有使用 <code>app.use(router.allowedMethods())</code>，使用postman的options方法发送请求：<code>http://172.16.55.29:8066/api/user</code>，返回的是 <code>Not Found</code>。</p><p>加上 <code>app.use(router.allowedMethods())</code> 之后，再请求，返回的则为空，并且返回头信息中含有属性：<code>Allow: POST</code></p><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2Api</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>音乐小程序云06-歌单详情</title>
    <url>/archives/9fcc88f4.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录小程序云开发学习 - 歌单详情。</p><a id="more"></a><h3 id="新建页面"><a href="#新建页面" class="headerlink" title="新建页面"></a>新建页面</h3><p>在 <code>app.json</code>中修改 <code>pages</code>属性，添加路径：<code>pages/playDetails/playDetails</code></p><figure class="highlight"><table><tr><td class="code"><pre><span class="line">"pages": [</span><br><span class="line">  "pages/playlist/playlist",</span><br><span class="line">  "pages/blog/blog",</span><br><span class="line">  "pages/profile/profile",</span><br><span class="line">  "pages/playDetails/playDetails",</span><br><span class="line">  <span class="string">"pages/404/404"</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="添加事件"><a href="#添加事件" class="headerlink" title="添加事件"></a>添加事件</h3><p>修改 <code>pages/playlist/playlist.wxml</code> 和 <code>pages/playlist/playlist.js</code></p><div class="note warning"><p>事件不能添加到 <code>block</code>节点上。因为 <code>block</code> 不渲染。</p></div><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- pages/playlist/playlist.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:for</span>=<span class="string">"&#123;&#123;playlistData&#125;&#125;"</span> <span class="attr">wx:key</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">c-palylist-item</span> <span class="attr">data</span>=<span class="string">"&#123;&#123;item&#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"playlist-item"</span> <span class="attr">bindtap</span>=<span class="string">"goToPlayDetails"</span> <span class="attr">data-id</span>=<span class="string">"&#123;&#123;item.id&#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">c-palylist-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 跳转到歌单详情</span></span><br><span class="line">goToPlayDetails(event) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(&#123;event&#125;)</span><br><span class="line">  <span class="keyword">const</span> &#123;dataset&#125; = event.currentTarget</span><br><span class="line">  wx.navigateTo(&#123;</span><br><span class="line">    url: <span class="string">`/pages/playDetails/playDetails?id=<span class="subst">$&#123;dataset.id&#125;</span>`</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h3><p>新建数据库：<code>mockPalyDetails</code>，新建/编辑云函数 <code>postMusicDetails</code>，安装 <code>axios</code>，安装依赖</p><p>这里模拟两条数据</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// cloudfunctions/postMusicDetails/postMusicDetails.js</span></span><br><span class="line"><span class="comment">// 云函数入口文件</span></span><br><span class="line"><span class="keyword">const</span> cloud = <span class="built_in">require</span>(<span class="string">'wx-server-sdk'</span>)</span><br><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">'axios'</span>)</span><br><span class="line">cloud.init(&#123;</span><br><span class="line">  env: cloud.DYNAMIC_CURRENT_ENV</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> db = cloud.database()</span><br><span class="line"><span class="keyword">const</span> postUrl = <span class="string">"http://172.16.55.29:3000/playlist/detail"</span></span><br><span class="line"><span class="keyword">const</span> MAX_LIMIT = <span class="number">100</span></span><br><span class="line"><span class="comment">// 云函数入口函数</span></span><br><span class="line">exports.main = <span class="keyword">async</span> (event, context) =&gt; &#123;</span><br><span class="line">  <span class="comment">/* 上传 歌单详情 */</span></span><br><span class="line">  <span class="comment">// 获取歌单详情 模拟数据</span></span><br><span class="line">  <span class="keyword">const</span> playList = [<span class="number">2829816518</span>, <span class="number">5098037113</span>];</span><br><span class="line">  <span class="keyword">let</span> playtracks = []</span><br><span class="line">  <span class="keyword">let</span> response = []</span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">Array</span>.isArray(playList) &amp;&amp; playList.length) &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>, len = playList.length; i &lt; len; i++) &#123;</span><br><span class="line">      <span class="keyword">let</span> promise = axios.post(postUrl, &#123;</span><br><span class="line">        id: playList[i]</span><br><span class="line">      &#125;)</span><br><span class="line">      playtracks.push(promise)</span><br><span class="line">    &#125;</span><br><span class="line">    (<span class="keyword">await</span> <span class="built_in">Promise</span>.all(playtracks)).forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(item)</span><br><span class="line">      response.push(item.data.playlist)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 插入数据库</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>, len = response.length; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">await</span> db.collection(<span class="string">'mockPlayDetails'</span>).add(&#123;</span><br><span class="line">      data: &#123;</span><br><span class="line">        ...response[i]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'插入成功'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="歌曲组件"><a href="#歌曲组件" class="headerlink" title="歌曲组件"></a>歌曲组件</h3><p>这里预留了高亮显示。由 <code>musicId</code> 控制。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// components/music-item.js</span></span><br><span class="line"></span><br><span class="line">Component(&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 组件的属性列表</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  properties: &#123;</span><br><span class="line">    index: &#123;</span><br><span class="line">      type: <span class="built_in">Number</span>,</span><br><span class="line">      value: <span class="number">-1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    musicInfo: &#123;</span><br><span class="line">      type: <span class="built_in">Object</span>,</span><br><span class="line">      value: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    musicId: &#123;</span><br><span class="line">      type: <span class="built_in">Number</span>,</span><br><span class="line">      value: <span class="number">-1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--components/music-item.wxml--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"c-music-item &#123;&#123;musicInfo.id === musicId ? 'selected' : ''&#125;&#125;"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"number"</span>&gt;</span>&#123;&#123;index&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">"&#123;&#123;musicInfo.picUrl&#125;&#125;"</span> <span class="attr">mode</span>=<span class="string">"aspectFill"</span> <span class="attr">class</span>=<span class="string">"picture"</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"name"</span>&gt;</span>&#123;&#123;musicInfo.name&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* components/music-item.wxss */</span></span><br><span class="line"><span class="selector-class">.c-music-item</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">120</span>rpx;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.selected</span><span class="selector-class">.c-music-item</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: blanchedalmond;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.number</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">80</span>rpx;</span><br><span class="line">  <span class="attribute">justify-content</span>: flex-start;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.selected</span> <span class="selector-class">.number</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.picture</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100</span>rpx;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-shrink</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: aqua;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.name</span> &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">  <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.selected</span> <span class="selector-class">.name</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="歌单详情页面"><a href="#歌单详情页面" class="headerlink" title="歌单详情页面"></a>歌单详情页面</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// pages/playDetails/playDetails.js</span></span><br><span class="line"></span><br><span class="line">Page(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 页面的初始数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  data: &#123;</span><br><span class="line">    id: <span class="number">-1</span>,</span><br><span class="line">    playDetails: &#123;&#125;,</span><br><span class="line">    musicId: <span class="number">-1</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  goToMusicPlay(event) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      dataset</span><br><span class="line">    &#125; = event.currentTarget</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      id</span><br><span class="line">    &#125; = dataset</span><br><span class="line">    wx.setStorageSync(<span class="string">'musicId'</span>, id)</span><br><span class="line">    <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">      musicId: id</span><br><span class="line">    &#125;)</span><br><span class="line">    wx.navigateTo(&#123;</span><br><span class="line">      url: <span class="string">`/pages/musicPlay/musicPlay?id=<span class="subst">$&#123;id&#125;</span>`</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> getPlayDetailsData() &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123;</span><br><span class="line">        result</span><br><span class="line">      &#125; = <span class="keyword">await</span> wx.cloud.callFunction(&#123;</span><br><span class="line">        name: <span class="string">"music"</span>,</span><br><span class="line">        data: &#123;</span><br><span class="line">          method: <span class="string">"get"</span>,</span><br><span class="line">          api: <span class="string">"getPlayDetails"</span>,</span><br><span class="line">          id: <span class="number">2829816518</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">        playDetails: result.data[<span class="number">0</span>]</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">      <span class="comment">// do catch</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 初始化页面</span></span><br><span class="line">  <span class="keyword">async</span> init() &#123;</span><br><span class="line">    wx.setNavigationBarTitle(&#123;</span><br><span class="line">      title: <span class="string">'歌单详情'</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">await</span> <span class="keyword">this</span>.getPlayDetailsData()</span><br><span class="line">    <span class="keyword">let</span> musicId = wx.getStorageSync(<span class="string">'musicId'</span>)</span><br><span class="line">    musicId &amp;&amp; (musicId !== <span class="number">-1</span>) &amp;&amp; <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">      musicId</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面加载</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> onLoad(options) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      id</span><br><span class="line">    &#125; = options</span><br><span class="line">    <span class="keyword">this</span>.data.id = id</span><br><span class="line">    <span class="keyword">await</span> <span class="keyword">this</span>.init()</span><br><span class="line">    <span class="comment">// wx.cloud.callFunction(&#123;</span></span><br><span class="line">    <span class="comment">//   name: "postMusicDetails"</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--pages/playDetails/playDetails.wxml--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"detail-container"</span> <span class="attr">style</span>=<span class="string">"background: url(&#123;&#123;playDetails.coverImgUrl&#125;&#125;) center/cover no-repeat"</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"mask"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"details"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">"&#123;&#123;playDetails.coverImgUrl&#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"details-img"</span> <span class="attr">mode</span>=<span class="string">"aspectFill"</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"details-text"</span>&gt;</span>&#123;&#123;playDetails.name&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"music-list"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:for</span>=<span class="string">"&#123;&#123;playDetails.tracks&#125;&#125;"</span> <span class="attr">wx:key</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">c-music-item</span> <span class="attr">index</span>=<span class="string">"&#123;&#123;index + 1&#125;&#125;"</span> <span class="attr">musicInfo</span>=<span class="string">"&#123;&#123;item.al&#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"music-item"</span> <span class="attr">bindtap</span>=<span class="string">"goToMusicPlay"</span> <span class="attr">musicId</span>=<span class="string">"&#123;&#123;musicId&#125;&#125;"</span> <span class="attr">data-id</span>=<span class="string">"&#123;&#123;item.al.id&#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">c-music-item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* pages/playDetails/playDetails.wxss */</span></span><br><span class="line"><span class="selector-class">.detail-container</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">320</span>rpx;</span><br><span class="line">  <span class="attribute">filter</span>: <span class="built_in">blur</span>(<span class="number">40</span>rpx);</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0.4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.mask</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">320</span>rpx;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#333</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">z-index</span>: -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.details</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">320</span>rpx;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">20</span>rpx</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.details-img</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-shrink</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">280</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">280</span>rpx;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">8</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.details-text</span> &#123;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">display</span>: -webkit-box;</span><br><span class="line">  <span class="attribute">-webkit-line-clamp</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">-webkit-box-orient</span>: vertical;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="高亮显示"><a href="#高亮显示" class="headerlink" title="高亮显示"></a>高亮显示</h3><p>原理：点击过后的 <code>id</code> 保持到 storage 中。然后回显。</p><!-- rebuild by neat -->]]></content>
      <categories>
        <category>小程序</category>
        <category>音乐小程序</category>
      </categories>
      <tags>
        <tag>小程序</tag>
        <tag>微信小程序</tag>
        <tag>音乐小程序</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa2基础-Cookie</title>
    <url>/archives/a016f7f2.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Node框架 - Cookie 和 Session 的使用。</p><a id="more"></a><h3 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h3><p>Cookie是存储在访问者的计算机中的变量。可以让我们用同一个浏览器访问同一个域名的时候共享数据。</p><p>解决的问题是：由于HTTP是无状态的协议，简单的说就是每当浏览了一个页面，然后跳转到同一个网站的另一个页面，服务器无法识别这是同一个浏览器在访问同一个网站，每一次访问，都是无关联的。</p><h3 id="使用Cookie"><a href="#使用Cookie" class="headerlink" title="使用Cookie"></a>使用Cookie</h3><ul><li><code>ctx.cookies.set(name, value, [options])</code><ul><li><code>options</code> 设置的属性<ul><li><code>maxAge</code> 一个数字，表示从 <code>Date.now()</code> 得到的毫秒数，如果为0，可用于清除cookie。优先级大于 <code>expires</code>。例：1小时：<code>maxAge: 1000 * 60 * 60</code></li><li><code>expires</code> 一个 <code>Date</code> 对象，表示cookie的到期日期（默认情况下会在会话结束时过期）。清除cookie：<code>expires: Date.now() - 1</code></li><li><code>path</code> 一个字符串，表示cookie的路径（默认是“/”）</li><li><code>domain</code> 一个字符串，表示cookie的域（无默认值）</li><li><code>secure</code> 一个布尔值，表示cookie是否仅通过HTTPS发送（HTTP下默认为 <code>fasle</code>，HTTPS下默认为 <code>true</code>）</li><li><code>httpOnly</code> 一个布尔值，表示cookie是否仅通过HTTP/HTTPS发送，且不提供给客户端JavaScript（默认为 <code>true</code>）</li><li><code>sameSite</code> 一个布尔值或字符串，表示该cookie是否为相同站点cookie（默认为 <code>false</code>），可以设置为 <code>strict/lax/none/true</code></li><li><code>signed</code> 一个布尔值，表示是否要对cookie进行签名（默认为 <code>false</code>），如果未 <code>true</code>，则还会发送另一个后缀为 <code>.sig</code> 的同名cookie</li><li><code>overwrite</code> 一个布尔值，表示是否覆盖以前设置的同名的cookie（默认是 <code>false</code>）</li></ul></li></ul></li><li><code>ctx.cookie.get(name, [options])</code></li></ul><p>如果没有设置cookie的过期时间，则表示这个cookie生命周期为浏览器会话期间，也就是会话cookie，只要关闭浏览器窗口，cookie就消失了。此外，cookie不会保存在硬盘上而是保存在内存里。</p><p>如果设置了过期时间，浏览器就会把cookie保存在硬盘上，直到cookie到期后，消失。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="comment">// 引入 koa模块及路由</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"><span class="keyword">const</span> views = <span class="built_in">require</span>(<span class="string">"koa-views"</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">static</span> = <span class="built_in">require</span>(<span class="string">"koa-static"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置模板引擎中间件</span></span><br><span class="line">app.use(views(path.join(__dirname, <span class="string">"./views"</span>), &#123;</span><br><span class="line">	extension: <span class="string">"ejs"</span></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置静态资源中间件</span></span><br><span class="line">app.use(<span class="keyword">static</span>(__dirname + <span class="string">"/static"</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置路由</span></span><br><span class="line">router</span><br><span class="line">	.get(<span class="string">"/"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">		ctx.cookies.set(<span class="string">"userInfo"</span>, <span class="built_in">encodeURIComponent</span>(<span class="string">"子俊"</span>), &#123;<span class="attr">maxAge</span>: <span class="number">1000</span>*<span class="number">10</span>&#125;)</span><br><span class="line">		<span class="keyword">await</span> ctx.render(<span class="string">"index"</span>, &#123;&#125;);</span><br><span class="line">		<span class="keyword">await</span> next();</span><br><span class="line">	&#125;)</span><br><span class="line">	.get(<span class="string">"/news"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="built_in">decodeURIComponent</span>(ctx.cookies.get(<span class="string">"userInfo"</span>)));</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启用路由，注册路由中间件</span></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8066</span>, () =&gt; &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"服务器已运行在8066端口上！"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><div class="note warning no-icon"><p>这里还使用到了 <code>encodeURIComponent</code> 和 <code>decodeURIComponent</code></p><ul><li><code>encodeURI</code>：该方法不会对<strong>ASCII字母、数字、~!@#$&amp;*()=:/,;?+’</strong>字符编码，即会对<strong>中文、空格</strong>等进行编码</li><li><code>encodeURIComponent</code>：该方法不会对<strong>ASCII字母、数字、~!*()’</strong>字符编码，即会对<strong>非字母数字</strong>等进行编码，通常对查询字符串编码，也适用于cookie编码</li></ul></div><h3 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h3><p>Session是另一种记录客户状态的机制，不同于Cookie的是，Cookie保存在客户端浏览器中，而session保存在服务器上。</p><p>原理：</p><ol><li>浏览器访问服务器并发送第一次请求，服务器会创建一个session对象，生成一个（key/vlue）键值对</li><li>响应时，将key(键)通过cookie返回到浏览器客户端</li><li>浏览器非第一次访问，携带key（cookie），服务端找到对应的session（value）</li></ol><h3 id="使用Session"><a href="#使用Session" class="headerlink" title="使用Session"></a>使用Session</h3><p>先需要安装 <code>koa-session</code> 中间件</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">npm i koa<span class="literal">-session</span> <span class="literal">-S</span></span><br></pre></td></tr></table></figure><ul><li><code>app.use(session(config, app))</code><ul><li><code>config</code> 配置属性<ul><li><code>key</code> 一个字符串或数字，默认为：<code>koa:sess</code></li><li><code>maxAge</code> 过期时间，以毫秒为单位</li><li><code>rolling</code> 一个布尔值，每次浏览器请求时，是否重新刷新session的过期时间，默认为 <code>false</code></li><li><code>renew</code> 一个布尔值，每次浏览器请求时，是否重新刷新session的过期时间，默认为 <code>false</code></li></ul></li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 引入 koa模块及路由</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"><span class="keyword">const</span> views = <span class="built_in">require</span>(<span class="string">"koa-views"</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">"koa-session"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置模板引擎中间件</span></span><br><span class="line">app.use(views(path.join(__dirname, <span class="string">"./views"</span>), &#123;</span><br><span class="line">	extension: <span class="string">"ejs"</span></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置session中间件</span></span><br><span class="line">app.keys = [<span class="string">"devin session"</span>];</span><br><span class="line"><span class="keyword">const</span> CONFIG = &#123;</span><br><span class="line">	key: <span class="string">"koa:session"</span>,</span><br><span class="line">	maxAge: <span class="number">1000</span> * <span class="number">30</span></span><br><span class="line">&#125;;</span><br><span class="line">app.use(session(CONFIG, app));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置路由</span></span><br><span class="line">router</span><br><span class="line">	.get(<span class="string">"/"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">		ctx.session.userInfo = <span class="string">"子俊2030"</span>;</span><br><span class="line">		<span class="keyword">await</span> ctx.render(<span class="string">"index"</span>, &#123;&#125;);</span><br><span class="line">		<span class="keyword">await</span> next();</span><br><span class="line">	&#125;)</span><br><span class="line">	.get(<span class="string">"/news"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">		<span class="built_in">console</span>.log(ctx.session.userInfo);</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启用路由，注册路由中间件</span></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8066</span>, () =&gt; &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"服务器已运行在8066端口上！"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="Cookie和Session区别"><a href="#Cookie和Session区别" class="headerlink" title="Cookie和Session区别"></a>Cookie和Session区别</h3><ol><li>Cookie数据存在客户端的浏览器上，如果没有设置过期时间，存在内存中，否则存在硬盘上；Session数据则放在服务器上</li><li>Cookie不是很安全，别人可以分析存放在本地的cookie并进行欺骗，考虑到安全性，应当使用session</li><li>Session会在一定时间内保存在服务器上，当访问比较多，会占用服务器性能，考虑到服务器性能优化，应当适当使用cookie</li><li>当个Cookie保存数据大小不能超过4k，并且浏览器对一个站点的cookie有数量限制，一般限制为20或50个cookie</li></ol><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2基础</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa2-API-异常及参数校验</title>
    <url>/archives/d4297975.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Node框架开发API - 异常及参数校验。</p><a id="more"></a><h3 id="Koa自带错误处理"><a href="#Koa自带错误处理" class="headerlink" title="Koa自带错误处理"></a>Koa自带错误处理</h3><ul><li>输入一个不存在的接口路径，自动返回 <code>status</code> 为 <code>404</code>，错误信息为 <code>Not Found</code></li><li><code>console.log(a)</code>，使用一个未定义的变量时，导致 <code>status</code> 为 <code>500</code></li><li>可以通过 <code>ctx.throw(400, &quot;这是错误信息&quot;)</code> 来手动抛出错误，只针对通用的 <code>status</code> 状态码（1xx、2xx、3xx、4xx、5xx）</li></ul><h3 id="koa-json-error"><a href="#koa-json-error" class="headerlink" title="koa-json-error"></a>koa-json-error</h3><p><strong>安装</strong></p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">npm i koa<span class="literal">-json</span><span class="literal">-error</span> <span class="literal">-S</span></span><br><span class="line">npm i cross<span class="literal">-env</span> <span class="literal">-D</span></span><br></pre></td></tr></table></figure><div class="note warning no-icon"><p>window系统下需要下载 <code>cross-env</code>，<code>cross-env</code>是一款运行跨平台设置合使用环境变量的脚本。因为在window中，<code>NODE_ENV=production</code>这样设置环境变量，window命令提示符会阻塞。在Linux下则无此问题。</p></div><p><strong>使用</strong></p><p>注意应该在所有中间件之前挂载。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> routerFun = <span class="built_in">require</span>(<span class="string">"./routes"</span>);</span><br><span class="line"><span class="keyword">const</span> error = <span class="built_in">require</span>(<span class="string">"koa-json-error"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误json中间件</span></span><br><span class="line">app.use(error());</span><br><span class="line"><span class="comment">// 路由注册到app</span></span><br><span class="line">routerFun(app).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;).catch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8066</span>, () =&gt; &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"Node服务器已开启"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>当键入一个不存在的url接口时，返回的错误如下：</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"message"</span>: <span class="string">"Not Found"</span>,</span><br><span class="line">	<span class="attr">"name"</span>: <span class="string">"NotFoundError"</span>,</span><br><span class="line">	<span class="attr">"stack"</span>: <span class="string">"NotFoundError: Not Found\n    at Object.throw (E:\\Node\\node_modules\\koa\\lib\\context.js:97:11)\n    at next.then (E:\\Node\\node_modules\\koa-json-			error\\lib\\middleware.js:52:58)\n    at processTicksAndRejections (internal/process/task_queues.js:86:5)"</span>,</span><br><span class="line">	<span class="attr">"status"</span>: <span class="number">404</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>优化</strong></p><p>当在生产环境时，不需要显示错误堆栈信息（stack），则需要对环境进行区分处理</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> routerFun = <span class="built_in">require</span>(<span class="string">"./routes"</span>);</span><br><span class="line"><span class="keyword">const</span> error = <span class="built_in">require</span>(<span class="string">"koa-json-error"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误json中间件</span></span><br><span class="line">app</span><br><span class="line">	.use(error(&#123;</span><br><span class="line">		postFormat: <span class="function">(<span class="params">e, &#123;stack, ...rest&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">			process.env.NODE_ENV === <span class="string">"production"</span> ? rest : &#123;stack, ...rest&#125;;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line"><span class="comment">// 路由注册到app</span></span><br><span class="line">routerFun(app).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;).catch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8066</span>, () =&gt; &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"Node服务器已开启"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>对应的package.json脚本也需要修改</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"prod"</span>: <span class="string">"cross-env NODE_ENV=production nodemon app.js"</span>,</span><br><span class="line">    <span class="attr">"dev"</span>: <span class="string">"nodemon app.js"</span>,</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="koa-parameter"><a href="#koa-parameter" class="headerlink" title="koa-parameter"></a>koa-parameter</h3><p>这个中间件用于参数校验。</p><p>详细的参数校验规则可参考：<a href="https://github.com/node-modules/parameter" target="_blank" rel="noopener external nofollow noreferrer">parameter</a></p><p><strong>安装</strong></p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">npm i koa<span class="literal">-parameter</span> <span class="literal">-S</span></span><br></pre></td></tr></table></figure><p><strong>使用</strong></p><p>在 <code>app.js</code> 中统一挂载，放在请求体后面，因为是用来校验请求体参数的。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> routerFun = <span class="built_in">require</span>(<span class="string">"./routes"</span>);</span><br><span class="line"><span class="keyword">const</span> error = <span class="built_in">require</span>(<span class="string">"koa-json-error"</span>);</span><br><span class="line"><span class="keyword">const</span> parameter = <span class="built_in">require</span>(<span class="string">"koa-parameter"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误json中间件</span></span><br><span class="line">app</span><br><span class="line">	.use(error(&#123;</span><br><span class="line">		postFormat: <span class="function">(<span class="params">e, &#123;stack, ...rest&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> process.env.NODE_ENV === <span class="string">"production"</span> ? rest : &#123;stack, ...rest&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;));</span><br><span class="line"><span class="comment">// 路由注册到app</span></span><br><span class="line">routerFun(app).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;).catch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;);</span><br><span class="line"><span class="comment">// 参数校验中间件</span></span><br><span class="line">app.use(parameter(app));</span><br><span class="line">app.listen(<span class="number">8066</span>, () =&gt; &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"Node服务器已开启"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>在控制器中，校验参数，会自动抛出错误</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// controllers/user.js	</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">async</span> getUser(ctx) &#123;</span><br><span class="line">		<span class="keyword">const</span> queryParams = ctx.query;</span><br><span class="line">		ctx.verifyParams(&#123;</span><br><span class="line">			id: &#123;</span><br><span class="line">				type: <span class="string">"string"</span>,</span><br><span class="line">				required: <span class="literal">true</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="keyword">if</span> (queryParams.id) &#123;</span><br><span class="line">			ctx.status = <span class="number">200</span>;</span><br><span class="line">			ctx.body = &#123;</span><br><span class="line">				code: <span class="number">0</span>,</span><br><span class="line">				message: <span class="string">"操作成功"</span>,</span><br><span class="line">				data: &#123;</span><br><span class="line">					id: queryParams.id</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			ctx.status = <span class="number">200</span>;</span><br><span class="line">			ctx.body = &#123;</span><br><span class="line">				code: <span class="number">4000</span>,</span><br><span class="line">				message: <span class="string">"参数错误"</span></span><br><span class="line">			&#125;;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = UserController;</span><br></pre></td></tr></table></figure><p>浏览数输入请求：<code>http://172.16.55.29:8066/api/user/get</code>，没有加上 <code>id</code> 参数，返回如下</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"message"</span>: <span class="string">"Validation Failed"</span>,</span><br><span class="line">	<span class="attr">"errors"</span>: [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="attr">"message"</span>: <span class="string">"required"</span>,</span><br><span class="line">			<span class="attr">"field"</span>: <span class="string">"id"</span>,</span><br><span class="line">			<span class="attr">"code"</span>: <span class="string">"missing_field"</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="attr">"params"</span>: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当浏览器输入正确请求：<code>http://172.16.55.29:8066/api/user/get?id=44</code>，返回如下</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">"code"</span>: <span class="number">0</span>,</span><br><span class="line">	<span class="string">"message"</span>: <span class="string">"操作成功"</span>,</span><br><span class="line">	<span class="string">"data"</span>: &#123;</span><br><span class="line">		<span class="string">"id"</span>: <span class="string">"44"</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2Api</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa2-API-接口规范</title>
    <url>/archives/408bb72.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Node框架开发API - 接口规范。</p><a id="more"></a><h3 id="命名规范"><a href="#命名规范" class="headerlink" title="命名规范"></a>命名规范</h3><ol><li>接口命名：统一使用中划线命名法，e.g. <code>user-get</code></li><li>接口参数命名：统一使用下划线命名法，e.g. <code>user_id</code></li></ol><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">/api/user/list?page=<span class="number">1</span>&amp;page_size=<span class="number">10</span></span><br></pre></td></tr></table></figure><h3 id="返回格式"><a href="#返回格式" class="headerlink" title="返回格式"></a>返回格式</h3><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"code"</span>: <span class="number">200</span>,</span><br><span class="line">  <span class="attr">"message"</span>: <span class="string">"success"</span>,</span><br><span class="line">  <span class="attr">"data"</span>: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"code"</span>: <span class="number">404</span>,</span><br><span class="line">  <span class="attr">"message"</span>: <span class="string">"Page not found"</span>,</span><br><span class="line">  <span class="attr">"data"</span>: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="返回状态码"><a href="#返回状态码" class="headerlink" title="返回状态码"></a>返回状态码</h3><ol><li>协议级：<code>200</code>、<code>301</code>、<code>302</code>、<code>401</code>、<code>403</code>、<code>502</code></li><li>系统级：<code>10001</code>、<code>10002</code></li><li>业务级：<code>20001</code>、<code>30001</code>、 <code>50001</code></li><li>异常级：<code>40001</code></li></ol><h3 id="请求标准"><a href="#请求标准" class="headerlink" title="请求标准"></a>请求标准</h3><ul><li><code>GET(SELECT)</code> 从服务器取出资源（一项或多项）</li><li><code>POST(CREATE)</code> 在服务器新建一个资源</li><li><code>PUT(UPDATE)</code> 在服务器更新资源（客户端提供完整资源数据）</li><li><code>PATCH(UPDATE)</code> 在服务器更新资源（客户端提供需要修改的资源数据）</li><li><code>DELETE(DELETE)</code> 从服务器删除资源</li></ul><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><ul><li><code>GET</code> 请求：公开的查询接口（无需鉴权）</li><li><code>POST</code> 请求：增删改接口，私密的查询接口（需要鉴权）</li></ul><h3 id="API-URL规则"><a href="#API-URL规则" class="headerlink" title="API URL规则"></a>API URL规则</h3><ul><li>api/名词/名词 e.g. <code>/api/news/list</code></li><li>api/名词/动词 e.g. <code>/api/news/update</code></li></ul><h3 id="API动词规则"><a href="#API动词规则" class="headerlink" title="API动词规则"></a>API动词规则</h3><ul><li><code>create</code> 添加、新增</li><li><code>delete</code> 删除</li><li><code>update</code> 更新、修改</li><li><code>get</code> 获取</li><li><code>list</code> 列表</li><li><code>count</code> 统计</li><li><code>batch</code> 批量</li><li><code>search</code> 搜索</li><li><code>query</code> 查询</li><li><code>apply</code> 申请</li><li><code>confirm</code> 确认</li><li><code>check</code> 检查</li><li><code>verify</code> 验证</li><li><code>change</code> 更改</li><li><code>fetch</code> 拉取</li><li><code>push</code> 推送</li><li><code>send</code> 发送</li><li><code>notify</code> 通知</li><li><code>sync</code> 同步</li><li><code>bind</code> 绑定</li><li><code>unbind</code> 解绑</li><li><code>open</code> 开启</li><li><code>close</code> 关闭</li><li><code>cancel</code> 取消</li><li><code>done</code> 结束</li><li><code>upload</code> 上传</li><li><code>accept</code> 同意</li><li><code>reply</code> 回复</li><li><code>refresh</code> 刷新 e.g. token</li></ul><h3 id="HTTP状态码"><a href="#HTTP状态码" class="headerlink" title="HTTP状态码"></a>HTTP状态码</h3><ul><li><code>200</code> SUCCESS - GET 获取资源成功</li><li><code>201</code> CREATED - POST 创建数据成功</li><li><code>204</code> No Content - 对不会返回响应体的成功请求进行响应（比如DELETE请求）</li><li><code>301</code> Moved Permanently - 请求的资源已永久移动到新位置</li><li><code>302</code> Move Temporarily - 临时重定向</li><li><code>304</code> Not Modified - 文档的内容并未改变，禁止包含消息体</li><li><code>400</code> Bad Request - 请求异常，比如请求中的body无法解析</li><li><code>401</code> Unauthorized - 没有进行认证或者认证非法</li><li><code>403</code> Forbidden - 当认证成功，但是认证过的用户没有访问资源的权限</li><li><code>404</code> Not Found - 当一个不存在的资源被请求</li><li><code>405</code> Method Not Allowed - 所请求的HTTP方法不允许当前认证用户访问</li><li><code>410</code> Gone - 表示当前请求的资源不再可用，当调用老版本API的时候很有用</li><li><code>415</code> Unsupported Media Type - 请求中的内容类型是错误的</li><li><code>422</code> Unprocessable Entity - 校验错误</li><li><code>429</code> Too Many Requests - 由于请求频次达到上限而被拒绝访问</li><li><code>500</code> Internal Server Error - 服务器遇到了一个未曾预料的状况</li><li><code>502</code> Bad Gateway - 网关或者代理出错</li><li><code>503</code> Service Unabailable - 服务器临时维护或者过载，服务器当前无法处理请求</li><li><code>504</code> Gateway Timeout - 请求超时</li></ul><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2Api</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa2基础-EJS</title>
    <url>/archives/a89f95ce.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Node框架 - EJS模板引擎渲染页面。</p><a id="more"></a><h3 id="EJS"><a href="#EJS" class="headerlink" title="EJS"></a>EJS</h3><p>EJS（Embedded[可嵌入]JavaScript）是一套简单的模板语言，利用普通的JavaScript代码生成HTML页面。</p><p>官网地址：<a href="https://ejs.bootcss.com/" target="_blank" rel="noopener external nofollow noreferrer">https://ejs.bootcss.com/</a></p><h3 id="EJS标签"><a href="#EJS标签" class="headerlink" title="EJS标签"></a>EJS标签</h3><ul><li><code>&lt;%</code> 脚本标签，用于流程控制，无输出</li><li><code>&lt;%_</code> 删除其前面的空格符</li><li><code>&lt;%=</code> 输出数据到模板（输出的是转义HTML标签）</li><li><code>&lt;%-</code> 输出非转义的数据到模板</li><li><code>&lt;%#</code> 注释标签，不执行、不输出内容</li><li><code>&lt;%%</code> 输出字符串“%”</li><li><code>%&gt;</code> 一般结束标签</li><li><code>-%&gt;</code> 删除紧随其后的换行符</li><li><code>—%&gt;</code> 将结束标签后面的空格符删除</li></ul><h3 id="EJS模块引入"><a href="#EJS模块引入" class="headerlink" title="EJS模块引入"></a>EJS模块引入</h3><p>通过 <code>include</code> 指令将相对于模板路径中的模板片段包含进来。</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">%-</span> <span class="attr">include</span>("<span class="attr">components</span>/<span class="attr">header</span>") <span class="attr">-</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>在Koa中使用ejs，需要安装 koa-views 和 ejs 两个模块</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">npm i koa-views -S</span><br><span class="line">npm i ejs -S</span><br></pre></td></tr></table></figure><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><ol><li><p>引入和注册和配置ejs中间件</p><ul><li><code>views(dirname, options)</code> 配置模板引擎中间件</li></ul></li><li><p>传递渲染数据</p><ul><li><p><code>ctx.state</code> 配置全局变量，不仅可以在其他的路由页面使用，还可以在全局模板使用</p></li><li><p><code>ctx.render(filename, data, options)</code> 传递数据渲染指定页面</p></li><li><p><code>options</code> 渲染参数</p><ul><li><code>async</code> 是否使用异步函数进行渲染</li><li><code>cache</code> 缓存编译后的函数，需要指定 <code>filename</code></li><li><code>filename</code> 被 <code>cache</code> 参数用做键值，同时也用于 include 语句</li><li><code>context</code> 函数执行时的上下文环境</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="comment">// 引入 koa模块及路由</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"><span class="keyword">const</span> views = <span class="built_in">require</span>(<span class="string">"koa-views"</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置模板引擎中间件</span></span><br><span class="line">app.use(views(path.join(__dirname, <span class="string">"./views"</span>), &#123;</span><br><span class="line">	extension: <span class="string">"ejs"</span></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置全局变量中间件</span></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="comment">// ctx.state 配置全局变量，其配置的全局变量我们不仅可以在其他的路由页面使用，我们还可以在全局模板使用</span></span><br><span class="line">	ctx.state.commonData = <span class="string">"这是一个公共变量，每个页面都能引用"</span>;</span><br><span class="line">	<span class="keyword">await</span> next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置路由</span></span><br><span class="line">router.get(<span class="string">"/"</span>, <span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">	<span class="keyword">let</span> title = <span class="string">"hello world"</span>;</span><br><span class="line">	<span class="keyword">let</span> list = [<span class="string">"123"</span>, <span class="string">"456"</span>, <span class="string">"789"</span>];</span><br><span class="line">	<span class="keyword">await</span> ctx.render(<span class="string">"index"</span>, &#123;</span><br><span class="line">		title,</span><br><span class="line">		list</span><br><span class="line">	&#125;, &#123;</span><br><span class="line">		<span class="keyword">async</span>: <span class="literal">true</span></span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启用路由，注册路由中间件</span></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8066</span>, () =&gt; &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"服务器已运行在8066端口上！"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- views/index.ejs --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">%-</span> <span class="attr">include</span>("<span class="attr">components</span>/<span class="attr">header</span>") <span class="attr">-</span>%&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">commonData</span> %&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">title</span> %&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">		&lt;% for(var i= 0, len = list.length; i &lt; len; i++) &#123; %&gt;</span><br><span class="line">			<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">list</span>[<span class="attr">i</span>] %&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">--</span> <span class="attr">views</span>/<span class="attr">components</span>/<span class="attr">header.ejs</span> <span class="attr">--</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>这是一个头部模块<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img data-src="../../assets/20200915135044.png" alt=""></p></li></ol><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2基础</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa2-API-文件目录设置</title>
    <url>/archives/214de851.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Node框架开发API - 文件目录设置优化。</p><a id="more"></a><h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><p>在根目录新增constrollers文件夹、routes文件夹、static文件夹、app.js文件夹。</p><ul><li><code>controllers</code> dir 处理逻辑代码</li><li><code>routes</code> dir 处理路由文件</li><li><code>static</code> dir 静态资源文件</li><li><code>app.js</code> file 入口文件</li></ul><h3 id="实例说明"><a href="#实例说明" class="headerlink" title="实例说明"></a>实例说明</h3><p>比如，现需要登录和获取用户信息两个接口，则建立目录规则如下：</p><h4 id="构建文件结构"><a href="#构建文件结构" class="headerlink" title="构建文件结构"></a>构建文件结构</h4><p>参照以上目录结构，建立文件目录及文件：</p><p><img data-src="../../assets/20200916154943.png" alt=""></p><h4 id="修改package-json"><a href="#修改package-json" class="headerlink" title="修改package.json"></a>修改package.json</h4><p>由于入口文件已修改，则需要对应修改：</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"app.js"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>:　&#123;</span><br><span class="line">    <span class="attr">"start"</span>: <span class="string">"nodemon app.js"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="先运行服务"><a href="#先运行服务" class="headerlink" title="先运行服务"></a>先运行服务</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8066</span>, () =&gt; &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"Node服务器已开启"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="编写路由"><a href="#编写路由" class="headerlink" title="编写路由"></a>编写路由</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// routes/login.js</span></span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123; <span class="attr">prefix</span>: <span class="string">"/api"</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> loginController = <span class="built_in">require</span>(<span class="string">"../controllers/login"</span>);</span><br><span class="line"></span><br><span class="line">router</span><br><span class="line">	.post(<span class="string">"/login"</span>, loginController.login)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// routes/user.js</span></span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123; <span class="attr">prefix</span>: <span class="string">"/api"</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> userController = <span class="built_in">require</span>(<span class="string">"../controllers/user"</span>);</span><br><span class="line"></span><br><span class="line">router</span><br><span class="line">	.get(<span class="string">"/user/get"</span>, userController.getUser);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure><h4 id="编写控制器"><a href="#编写控制器" class="headerlink" title="编写控制器"></a>编写控制器</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// controllers/login.js</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginController</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 登录</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param <span class="variable">ctx</span></span></span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return <span class="type">&#123;Promise.&lt;void&gt;&#125;</span></span></span></span><br><span class="line"><span class="comment">	 */</span> </span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">async</span> login(ctx) &#123;</span><br><span class="line">		<span class="keyword">const</span> postParams = ctx.request.body;</span><br><span class="line">		<span class="keyword">if</span> (postParams.username &amp;&amp; postParams.password) &#123;</span><br><span class="line">			ctx.status = <span class="number">200</span>;</span><br><span class="line">			ctx.body = &#123;</span><br><span class="line">				code: <span class="number">0</span>,</span><br><span class="line">				message: <span class="string">"登录成功"</span>,</span><br><span class="line">				data: &#123;</span><br><span class="line">					username: postParams.username,</span><br><span class="line">					password: postParams.password</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			ctx.status = <span class="number">200</span>;</span><br><span class="line">			ctx.body = &#123;</span><br><span class="line">				code: <span class="number">4000</span>,</span><br><span class="line">				message: <span class="string">"参数错误"</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = LoginController;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// controllers/user.js</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取用户信息</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param <span class="variable">ctx</span></span></span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return <span class="type">&#123;Promise.&lt;void&gt;&#125;</span></span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">async</span> getUser(ctx) &#123;</span><br><span class="line">		<span class="keyword">const</span> queryParams = ctx.query;</span><br><span class="line">		<span class="keyword">if</span> (queryParams.id) &#123;</span><br><span class="line">			ctx.status = <span class="number">200</span>;</span><br><span class="line">			ctx.body = &#123;</span><br><span class="line">				code: <span class="number">0</span>,</span><br><span class="line">				message: <span class="string">"操作成功"</span>,</span><br><span class="line">				data: &#123;</span><br><span class="line">					id: queryParams.id</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			ctx.status = <span class="number">200</span>;</span><br><span class="line">			ctx.body = &#123;</span><br><span class="line">				code: <span class="number">4000</span>,</span><br><span class="line">				message: <span class="string">"参数错误"</span></span><br><span class="line">			&#125;;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = UserController;</span><br></pre></td></tr></table></figure><h4 id="路由自动注册中间件"><a href="#路由自动注册中间件" class="headerlink" title="路由自动注册中间件"></a>路由自动注册中间件</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// routes/index.js</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">const</span> bodyparser = <span class="built_in">require</span>(<span class="string">"koa-bodyparser"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册路由并导出</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="keyword">async</span> (app) =&gt; &#123;</span><br><span class="line">	<span class="keyword">const</span> files = <span class="keyword">await</span> fs.promises.readdir(__dirname);</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">const</span> file <span class="keyword">of</span> files) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file === <span class="string">"index.js"</span>) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">`./<span class="subst">$&#123;file&#125;</span>`</span>);</span><br><span class="line">    app.use(bodyparser());</span><br><span class="line">    app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="app导入路由"><a href="#app导入路由" class="headerlink" title="app导入路由"></a>app导入路由</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> routerFun = <span class="built_in">require</span>(<span class="string">"./routes"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由注册到app</span></span><br><span class="line">routerFun(app).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;).catch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8066</span>, () =&gt; &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"Node服务器已开启"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p>浏览器和postman测试地址，和对应结果返回对应如下：</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">http://<span class="number">172.16</span>.<span class="number">55.29</span>:<span class="number">8066</span>/api/user/get?id=<span class="number">44</span> =&gt; &#123;code: <span class="number">0</span>, message: <span class="string">"操作成功"</span>, <span class="keyword">data</span>: &#123;id: <span class="number">44</span>&#125;&#125;</span><br><span class="line">http://<span class="number">172.16</span>.<span class="number">55.29</span>:<span class="number">8066</span>/api/login(username: devin、password: <span class="number">123456</span>) =&gt; &#123;code: <span class="number">0</span>, message: <span class="string">"登录成功"</span>, <span class="keyword">data</span>: &#123;usernem: <span class="string">"devin"</span>, password: <span class="string">"123456"</span>&#125;&#125;</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2Api</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa2基础-跨域</title>
    <url>/archives/75f79f4b.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Node框架 -跨域问题。</p><a id="more"></a><p>正文</p><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2基础</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa2基础-介绍安装</title>
    <url>/archives/60b78ada.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Node框架 - Koa2的介绍和安装。</p><a id="more"></a><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>Koa是一个利用 <code>async/await</code> 函数，可以避免回调嵌套问题的一个Node web框架应用。</p><div class="note warning no-icon"><p>Koa2 的安装与使用对 Node.js 的版本也是有要求的，Node.js 是有要求的，它要求 Node.js 版本高于 V7.6。因为 node.js 7.6 版本 开始完全支持 async/await，所以才能完全支持 Koa2。</p></div><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">npm init / npm init <span class="literal">-y</span></span><br><span class="line">npm install koa -<span class="literal">-save</span></span><br></pre></td></tr></table></figure><h3 id="应用程序"><a href="#应用程序" class="headerlink" title="应用程序"></a>应用程序</h3><p>新建并编辑 <code>app.js</code>：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建中间件</span></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">  <span class="comment">// ctx.body向前端发送数据</span></span><br><span class="line">	ctx.body = <span class="string">"hello world"</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8066</span>);</span><br></pre></td></tr></table></figure><h3 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h3><p>设置属性：</p><ul><li><code>app.env</code> 默认是 <code>NODE_ENV</code> 或 <code>development</code></li><li><code>app.keys</code> 签名的cookie密钥数组</li><li><code>app.proxy</code> 真正的代理头字段被信任</li><li><code>app.proxyIpHeader</code> 代理 ip 消息头, 默认为 <code>X-Forwarded-For</code></li><li><code>app.maxIpsCount</code> 从代理 ip 消息头读取的最大 ips, 默认为 0 (代表无限)</li></ul><p>应用程序设置有两种方式：</p><ul><li><p>设置项传递给构造函数</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">	env: <span class="string">"development"</span>,</span><br><span class="line">	maxIpsCount: <span class="number">0</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa(options);</span><br></pre></td></tr></table></figure></li><li><p>动态设置</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line">app.proxy = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure></li></ul><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2基础</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa2-API-认识RESTfulAPI和Koa</title>
    <url>/archives/df29e4e9.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Node框架开发API - 认识RESTfulAPI和Koa。</p><a id="more"></a><h3 id="RESTful-API设计最佳实践"><a href="#RESTful-API设计最佳实践" class="headerlink" title="RESTful API设计最佳实践"></a>RESTful API设计最佳实践</h3><p><strong>请求规范</strong></p><p>请求应该包含URL、HTTP方法、请求体等</p><ul><li>URL使用名词、尽量使用复数</li><li>URL使用嵌套表示关联关系，如 <code>/users/name/repo/12</code></li><li>使用正确的方法： <code>GET/POST/PUT/DELETE</code></li></ul><p><strong>响应规范</strong></p><ul><li>如果是分页，应该包含当前页和每一页的数量，如 <code>page=2&amp;limit=10</code></li><li>状态码：<code>2xx</code>表示正确、<code>3xx</code>表示重定向、<code>4xx</code>表示客户端错误、<code>5xx</code>表示服务端错误</li><li>错误处理：返回错误信息</li></ul><p><strong>安全</strong></p><ul><li>HTTPS</li><li>鉴权</li></ul><h3 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> middleware = <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"Hello world"</span>);</span><br><span class="line">	<span class="keyword">await</span> next();</span><br><span class="line">&#125;;</span><br><span class="line">app.use(middleware);</span><br><span class="line">app.listen(<span class="number">8066</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"服务已开启"</span>);</span><br></pre></td></tr></table></figure><p>运行 <code>node app.js</code> ，打开 <code>http://localhost:8066/</code>，页面显示 <code>not Found</code>，在终端打印了： <code>服务已开启</code>、 <code>Hello world</code>。</p><p>这里 <code>app.user()</code> 的内容就是中间件，我们可以使用多个中间件，使用多个中间件的时候需要使用 <code>next</code>。 <code>ctx</code>为上下文，可以理解为在多个中间件流转的数据。</p><h3 id="自动更新"><a href="#自动更新" class="headerlink" title="自动更新"></a>自动更新</h3><ol><li><p>安装 <code>nodemon</code> 插件：<code>npm i nodemon -D</code></p></li><li><p>在 <code>package.json</code> 中的 <code>scripts</code> 新增属性：<code>&quot;start&quot;: &quot;nodemon app.js&quot;</code></p><figure class="highlight"><table><tr><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">    "start": "nodemon app.js",</span><br><span class="line">    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1"</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li><li><p>运行 <code>npm start</code>，即可自动更新</p></li></ol><h3 id="洋葱模型"><a href="#洋葱模型" class="headerlink" title="洋葱模型"></a>洋葱模型</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line">app</span><br><span class="line">	.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">"1-before"</span>);</span><br><span class="line">		<span class="keyword">await</span> next();</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">"1-after"</span>);</span><br><span class="line">	&#125;)</span><br><span class="line">	.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">"2-before"</span>);</span><br><span class="line">		<span class="keyword">await</span> next();</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">"2-after"</span>);</span><br><span class="line">	&#125;)</span><br><span class="line">	.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">"3-before"</span>);</span><br><span class="line">		<span class="keyword">await</span> next();</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">"3-after"</span>);</span><br><span class="line">	&#125;)</span><br><span class="line">app.listen(<span class="number">8066</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"服务已开启"</span>);</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">服务已开启</span><br><span class="line"><span class="number">1</span><span class="literal">-before</span></span><br><span class="line"><span class="number">2</span><span class="literal">-before</span></span><br><span class="line"><span class="number">3</span><span class="literal">-before</span></span><br><span class="line"><span class="number">3</span><span class="literal">-after</span></span><br><span class="line"><span class="number">2</span><span class="literal">-after</span></span><br><span class="line"><span class="number">1</span><span class="literal">-after</span></span><br></pre></td></tr></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul><li>在 <code>Koa</code> 实例化之后，会使用 <code>use()</code> 来加载中间件</li><li>每一个中间件都是一个函数，函数的参数分别是：<code>ctx</code> 和 <code>next</code></li><li>每一个中间件函数会调用 <code>next</code> 方法去取下一个中间件函数继续执行，且每一个中间件都会返回一个 <code>promise</code> 对象</li></ul><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2Api</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa2基础-中间件</title>
    <url>/archives/80fb3e00.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Node框架 -中间件。</p><a id="more"></a><h3 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h3><p>中间件就是匹配路由之前或者匹配路由完成之后做的一系列操作。</p><p>中间件的功能包括：</p><ul><li>执行任何代码</li><li>修改请求和响应对象</li><li>终结请求-响应循环</li><li>调用堆栈中的下一个中间件</li></ul><p>如果 <code>get/post</code> 请求方法中，没有 <code>next</code> 参数，那么就匹配第一个路由，就不再匹配了。如果想要往下匹配的话，那么需要写 <code>next()</code>。</p><p>中间件类型：</p><ul><li>应用级中间件</li><li>路由级中间件</li><li>错误处理中间件</li><li>第三方中间件</li></ul><h3 id="应用级中间件"><a href="#应用级中间件" class="headerlink" title="应用级中间件"></a>应用级中间件</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 引入 koa模块及路由</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 应用级中间件，如果不写next,这个中间件被匹配到了就不会继续向下匹配 </span></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"我是一个中间件"</span>);</span><br><span class="line">	<span class="comment">// 当前路由匹配完成以后继续向下匹配</span></span><br><span class="line">	next();</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置路由</span></span><br><span class="line">router.get(<span class="string">"/"</span>, <span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">	ctx.body = <span class="string">`首页`</span>;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启用路由，注册路由中间件</span></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8066</span>);</span><br></pre></td></tr></table></figure><h3 id="路由级中间级"><a href="#路由级中间级" class="headerlink" title="路由级中间级"></a>路由级中间级</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 引入 koa模块及路由</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router();</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">"/"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"这是一个路由中间件"</span>);</span><br><span class="line">	next();</span><br><span class="line">&#125;) </span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置路由</span></span><br><span class="line">router.get(<span class="string">"/"</span>, <span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">	ctx.body = <span class="string">`首页`</span>;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启用路由，注册路由中间件</span></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8066</span>);</span><br></pre></td></tr></table></figure><h3 id="错误处理中间件"><a href="#错误处理中间件" class="headerlink" title="错误处理中间件"></a>错误处理中间件</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 引入 koa模块及路由</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router();</span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">	<span class="keyword">await</span> next();</span><br><span class="line">	<span class="keyword">if</span> (ctx.status == <span class="number">404</span>) &#123;</span><br><span class="line">		ctx.body = <span class="string">"404页面"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置路由</span></span><br><span class="line">router.get(<span class="string">"/"</span>, <span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">	ctx.body = <span class="string">`首页`</span>;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启用路由，注册路由中间件</span></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8066</span>);</span><br></pre></td></tr></table></figure><h3 id="中间件控制流程"><a href="#中间件控制流程" class="headerlink" title="中间件控制流程"></a>中间件控制流程</h3><p>Koa最大的特点就是独特的中间控制流程，是一个典型的洋葱模型。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 引入 koa模块及路由</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router();</span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"1、这是第一个中间件01"</span>);</span><br><span class="line">	<span class="keyword">await</span> next();</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"5、路由匹配完成之后会返回来执行中间件01"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"2、这是第二个中间件02"</span>);</span><br><span class="line">	<span class="keyword">await</span> next();</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"4. 路由匹配完成之后会返回来执行中间件02"</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置路由</span></span><br><span class="line">router.get(<span class="string">"/"</span>, <span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"3、匹配到了路由"</span>);</span><br><span class="line">	ctx.body = <span class="string">`首页`</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启用路由，注册路由中间件</span></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8066</span>);</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>、这是第一个中间件<span class="number">01</span></span><br><span class="line"><span class="number">2</span>、这是第二个中间件<span class="number">02</span></span><br><span class="line"><span class="number">3</span>、匹配到了路由</span><br><span class="line"><span class="number">4</span>、路由匹配完成之后会返回来执行中间件<span class="number">02</span></span><br><span class="line"><span class="number">5</span>、路由匹配完成之后会返回来执行中间件<span class="number">01</span></span><br></pre></td></tr></table></figure><h3 id="中间件链"><a href="#中间件链" class="headerlink" title="中间件链"></a>中间件链</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 引入 koa模块及路由</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置中间件</span></span><br><span class="line">app</span><br><span class="line">	.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;ctx.request.method&#125;</span> <span class="subst">$&#123;ctx.request.url&#125;</span>`</span>);</span><br><span class="line">		<span class="keyword">await</span> next();</span><br><span class="line">	&#125;)</span><br><span class="line">	.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">		<span class="keyword">const</span> start = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime(); <span class="comment">// 当前时间</span></span><br><span class="line">		<span class="keyword">await</span> next();</span><br><span class="line">		<span class="keyword">const</span> ms = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime() - start; <span class="comment">// 耗时</span></span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">`第三个中间件处理耗时：<span class="subst">$&#123;ms&#125;</span>ms`</span>);</span><br><span class="line">	&#125;)</span><br><span class="line">	.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">		<span class="keyword">await</span> next();</span><br><span class="line">		ctx.body = <span class="string">"Hello World"</span>;</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8066</span>, () =&gt; &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"服务器已运行在8066端口上！"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">PS E:\Node&gt; node app.js</span><br><span class="line">服务端已运行在<span class="number">8066</span>端口上！</span><br><span class="line">GET /</span><br><span class="line">第三个中间件处理耗时：<span class="number">2</span>ms</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2基础</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa2-API-Router和获取参数</title>
    <url>/archives/32fb5a7e.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Node框架开发API - 认识RESTfulAPI和Koa。</p><a id="more"></a><h3 id="认识Koa-Router"><a href="#认识Koa-Router" class="headerlink" title="认识Koa-Router"></a>认识Koa-Router</h3><p>koa-router就是根据不同的路由，返回不同的内容。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router();</span><br><span class="line">router</span><br><span class="line">	.get(<span class="string">"/1"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">		ctx.body = <span class="number">1</span>;</span><br><span class="line">	&#125;)</span><br><span class="line">	.get(<span class="string">"/2"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">		ctx.body = <span class="number">2</span>;</span><br><span class="line">	&#125;)</span><br><span class="line">	.get(<span class="string">"/3"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">		ctx.body = <span class="number">3</span>;</span><br><span class="line">	&#125;)</span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line">app.listen(<span class="number">8066</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"服务已开启"</span>);</span><br></pre></td></tr></table></figure><p>根据不同的url，返回不同的内容，对应如下：</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">http://<span class="number">172.16</span>.<span class="number">55.29</span>:<span class="number">8066</span>/<span class="number">1</span> =&gt; <span class="number">1</span></span><br><span class="line">http://<span class="number">172.16</span>.<span class="number">55.29</span>:<span class="number">8066</span>/<span class="number">2</span> =&gt; <span class="number">2</span></span><br><span class="line">http://<span class="number">172.16</span>.<span class="number">55.29</span>:<span class="number">8066</span>/<span class="number">3</span> =&gt; <span class="number">3</span></span><br></pre></td></tr></table></figure><h3 id="加上API的前缀"><a href="#加上API的前缀" class="headerlink" title="加上API的前缀"></a>加上API的前缀</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123; <span class="attr">prefix</span>: <span class="string">"/api"</span> &#125;);</span><br></pre></td></tr></table></figure><p>那么，根据不同的url，返回不同的内容，对应如下：</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">http://<span class="number">172.16</span>.<span class="number">55.29</span>:<span class="number">8066</span>/api/<span class="number">1</span> =&gt; <span class="number">1</span></span><br><span class="line">http://<span class="number">172.16</span>.<span class="number">55.29</span>:<span class="number">8066</span>/api/<span class="number">2</span> =&gt; <span class="number">2</span></span><br><span class="line">http://<span class="number">172.16</span>.<span class="number">55.29</span>:<span class="number">8066</span>/api/<span class="number">3</span> =&gt; <span class="number">3</span></span><br></pre></td></tr></table></figure><h3 id="GET获取路由动态参数"><a href="#GET获取路由动态参数" class="headerlink" title="GET获取路由动态参数"></a>GET获取路由动态参数</h3><ul><li><code>ctx.params</code></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123; <span class="attr">prefix</span>: <span class="string">"/api"</span> &#125;);</span><br><span class="line">router</span><br><span class="line">	.get(<span class="string">"/:id"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">		ctx.body = ctx.params;</span><br><span class="line">	&#125;)</span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line">app.listen(<span class="number">8066</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"服务已开启"</span>);</span><br></pre></td></tr></table></figure><p>访问url: <code>http://172.16.55.29:8066/api/3</code> ,则页面对应会展示：<code>{ id: 3 }</code></p><h3 id="GET获取路由查询参数"><a href="#GET获取路由查询参数" class="headerlink" title="GET获取路由查询参数"></a>GET获取路由查询参数</h3><ul><li><code>ctx.query</code></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123; <span class="attr">prefix</span>: <span class="string">"/api"</span> &#125;);</span><br><span class="line">router</span><br><span class="line">	.get(<span class="string">"/user"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">		ctx.body = ctx.query;</span><br><span class="line">	&#125;)</span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line">app.listen(<span class="number">8066</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"服务已开启"</span>);</span><br></pre></td></tr></table></figure><p>访问url: <code>http://172.16.55.29:8066/api/user?id=2&amp;age=20</code> ,则页面对应会展示：<code>{ id: 2, age: 20 }</code></p><h3 id="GET获取路由中header的参数"><a href="#GET获取路由中header的参数" class="headerlink" title="GET获取路由中header的参数"></a>GET获取路由中header的参数</h3><ul><li><code>ctx.header</code></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123; <span class="attr">prefix</span>: <span class="string">"/api"</span> &#125;);</span><br><span class="line">router</span><br><span class="line">	.get(<span class="string">"/user"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">		ctx.body = ctx.headers;</span><br><span class="line">	&#125;)</span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line">app.listen(<span class="number">8066</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"服务已开启"</span>);</span><br></pre></td></tr></table></figure><p>这里可以使用 postman 模拟，可以展示结果。</p><h3 id="POST获取参数"><a href="#POST获取参数" class="headerlink" title="POST获取参数"></a>POST获取参数</h3><ul><li>使用中间件 <code>koa-bodyparser</code></li><li><code>ctx.request.body</code></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"><span class="keyword">const</span> bodyparser = <span class="built_in">require</span>(<span class="string">"koa-bodyparser"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123; <span class="attr">prefix</span>: <span class="string">"/api"</span> &#125;);</span><br><span class="line">router</span><br><span class="line">	.post(<span class="string">"/user"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">		ctx.body = ctx.request.body;</span><br><span class="line">	&#125;)</span><br><span class="line">app.use(bodyparser());</span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line">app.listen(<span class="number">8066</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"服务已开启"</span>);</span><br></pre></td></tr></table></figure><p>使用 postman 模拟，添加body参数：<code>name: devin</code>、<code>post: coder</code> 可以展示结果为：<code>{name: devin, post: &quot;coder&quot;}</code></p><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2Api</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa2基础-中间件整理</title>
    <url>/archives/598afce6.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要整理常用的Koa2中间件</p><a id="more"></a><h3 id="kao-router"><a href="#kao-router" class="headerlink" title="kao-router"></a>kao-router</h3><ul><li><strong>功能：</strong>基础路由功能</li></ul><h3 id="koa-body"><a href="#koa-body" class="headerlink" title="koa-body"></a>koa-body</h3><ul><li><p><strong>功能：</strong>解析body</p></li><li><p><strong>说明：</strong>不使用 <code>koa-bodyparser</code>的原因是因为在处理图片上传时，需要使用 <code>koa-multer</code>中间件。<code>koa-body</code>可以代替两者。注意：<code>koa-body</code> 和 <code>koa-bodyparser</code> 会存在兼容问题，不能共用。</p></li><li><p><strong>官网：</strong><a href="https://github.com/koajs/body" target="_blank" rel="noopener external nofollow noreferrer">https://github.com/koajs/body</a></p></li><li><p>用法，参照基本集成</p></li><li></li></ul><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2基础</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa框架02-Generator</title>
    <url>/archives/b1128a26.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Koa框架02-Generator、Yield。</p><a id="more"></a><h3 id="generator"><a href="#generator" class="headerlink" title="generator"></a>generator</h3><p>generator（生成器）可以理解一个可以分段执行内部代码的函数。通过 <code>yield</code> 分隔，<code>yield</code> 接一个 <code>promise</code> 异步函数，这个异步函数完成，才能执行下一个代码片段。最大的特点可以总结为：可以交出函数的执行权（即暂停执行）。</p><ul><li><code>next()</code>：返回一个由 <code>yeild</code> 表达式生成的值</li><li><code>return()</code>：返回给定的值并结束生成器</li><li><code>throw()</code>：向生成器抛出一个错误</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> * <span class="title">sayHello</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"hello"</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">"say hello"</span>;</span><br><span class="line">  <span class="keyword">yield</span>;xz</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"world"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> g = sayHello();</span><br><span class="line"><span class="built_in">console</span>.log(g.next()); <span class="comment">// =&gt; "hello" &#123;value: undefined, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(g.next()); <span class="comment">// =&gt; "world" &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure><p>这里，创建了 <code>sayHello</code> 函数，该函数被 <code>yield</code> 分成两段代码。然后运行这个函数，并赋值，因为 generator 不会直接运行里面的函数，所以需要执行一次 <code>next()</code> 才运行代码，所以需要调用两次 <code>next()</code> 才执行完。注意，每一次 <code>yield</code>，都会返回上一阶段异步任务的返回结果。</p><h3 id="yield"><a href="#yield" class="headerlink" title="yield"></a>yield</h3><p>yield实际上的作用是暂停函数执行。<code>next</code> 方法的作用是分阶段执行 <code>Generator</code> 函数。每次调用 <code>next</code> 方法，会返回一个对象，表示当前阶段的信息（<code>value</code> 属性和 <code>done</code> 属性）。<code>value</code> 属性是 <code>yield</code> 语句后面表达式的值，表示当前阶段的值；<code>done</code> 属性是一个布尔值，表示 <code>Generator</code> 函数是否执行完毕，即是否还有下一个阶段。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> * <span class="title">sayHello</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"hello"</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">"say hello"</span>;</span><br><span class="line">  <span class="keyword">yield</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"world"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> g = sayHello();</span><br><span class="line"><span class="built_in">console</span>.log(g.next()); <span class="comment">// =&gt; "hello" &#123;value: "say hello", done: true&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(g.next()); <span class="comment">// =&gt; &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure><p>这里，<code>return</code> 和 <code>yield</code> 一样，也会返回上一个阶段的结果，唯一不同的是，<code>return</code> 会结束生成器，不再向下执行。虽然还可以调用 <code>next()</code>，但是无结果输出。</p><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2框架</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa2基础-路由</title>
    <url>/archives/d486a798.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Node框架 - Koa2的路由、get传值、动态路由等。</p><a id="more"></a><h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><p>路由（Routing）就是根据不同的URL地址，加载不同的页面实现不同的功能。</p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">npm i koa<span class="literal">-router</span> <span class="literal">-S</span></span><br></pre></td></tr></table></figure><div class="note warning no-icon"><p>Koa 中的路由和 Express 有所不同，在 Express 中直接引入 Express 就可以配置路由，但是在 Koa 中我们需要安装对应的 koa-router 路由模块来实现。</p></div><h3 id="简单实例"><a href="#简单实例" class="headerlink" title="简单实例"></a>简单实例</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 引入 koa模块及路由</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置路由</span></span><br><span class="line">router</span><br><span class="line">  .get(<span class="string">"/"</span>, <span class="keyword">async</span>(ctx) =&gt; &#123;</span><br><span class="line">	<span class="comment">// ctx 上下文context,包含了request和response对象</span></span><br><span class="line">	<span class="comment">// ctx.body 相当原生：res.writeHead()+ res.end()</span></span><br><span class="line">	ctx.body = <span class="string">"首页"</span>;</span><br><span class="line">&#125;)</span><br><span class="line">	.get(<span class="string">"/news"</span>, <span class="keyword">async</span>(ctx) =&gt; &#123;</span><br><span class="line">	ctx.body = <span class="string">"新闻"</span>;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 启用路由，注册路由中间件</span></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8066</span>);</span><br></pre></td></tr></table></figure><h3 id="路由属性"><a href="#路由属性" class="headerlink" title="路由属性"></a>路由属性</h3><p>创建路由，选项参数：</p><ul><li>opts 参数对象</li><li>opts.prefix 设置路由的前缀</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 引入 koa模块及路由</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123;<span class="attr">prefix</span>: <span class="string">"/setting"</span>&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 引入 koa模块及路由</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123;</span><br><span class="line">	prefix: <span class="string">"/user"</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置路由</span></span><br><span class="line">router.get(<span class="string">"/"</span>, <span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">	ctx.body = <span class="string">`根路由`</span>;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启用路由，注册路由中间件</span></span><br><span class="line"><span class="comment">// router.routes() 组装匹配好的路由，返回一个合并好的中间件</span></span><br><span class="line"><span class="comment">// router.allowMethods() 获得一个中间件，当发送了不符合的请求时，会返回 `405 Method Not Allowed` 或 `501 Not Implemented`</span></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8066</span>);</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- http://172.16.55.29:8066/ --&gt;</span></span><br><span class="line">Not Found (404)</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- http://172.16.55.29:8066/user/ --&gt;</span></span><br><span class="line">根路由</span><br></pre></td></tr></table></figure><h3 id="请求方法"><a href="#请求方法" class="headerlink" title="请求方法"></a>请求方法</h3><p>路由方法有如下多种，请求中的第一个参数（如 <code>/news</code>）会和URL模式进行匹配，如果匹配成功则让对应的控制器对路由请求进行处理。</p><ul><li><code>router.get</code> 匹配GET方法</li><li><code>router.post</code> 匹配POST方法</li><li><code>router.put</code> P匹配UT方法</li><li><code>router.del</code> 匹配DEL方法</li><li><code>router.all</code> 匹配所有的请求方法</li></ul><h3 id="路由方法"><a href="#路由方法" class="headerlink" title="路由方法"></a>路由方法</h3><ul><li><code>router.use()</code> 注册中间件</li><li><code>router.routes()</code> 组装匹配好的路由，返回一个合并好的中间件</li><li><code>router.allowMethods()</code> 获得一个中间件，当发送了不符合的请求时，会返回 <code>405 Method Not Allowed</code> 或 <code>501 Not Implemented</code><ul><li><code>throw: true</code> 抛出错误，代替设置响应头状态</li><li><code>notImplemented: () =&gt; &quot;不支持当前请求所需要的功能&quot;</code></li><li><code>methodNotAllowed: () =&gt; &quot;不支持的请求方式&quot;</code></li></ul></li></ul><h3 id="获取路由参数"><a href="#获取路由参数" class="headerlink" title="获取路由参数"></a>获取路由参数</h3><p>动态路由</p><ul><li><p><code>ctx.params</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// http://localhost/123</span></span><br><span class="line">router.get(<span class="string">"/:id"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(ctx.params); <span class="comment">// =&gt; &#123;id: "123"&#125;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul><p>请求获取参数</p><ul><li><p><code>ctx.query</code></p></li><li><p><code>ctx.querystring</code></p></li><li><p><code>ctx.url</code></p></li><li><p><code>ctx.request.query</code></p></li><li><p><code>ctx.request.querystring</code></p></li><li><p><code>ctx.request.url</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// http://localhost/?id=123</span></span><br><span class="line">router.get(<span class="string">"/"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 从ctx中获取</span></span><br><span class="line">  <span class="built_in">console</span>.log(ctx.query, ctx.querystring, ctx.url); <span class="comment">// =&gt; &#123;id: "123"&#125;, id=123, /?id=123</span></span><br><span class="line">  <span class="comment">// 从ctx中的request对象里获取</span></span><br><span class="line">  <span class="built_in">console</span>.log(ctx.request.query, ctx.request.querystring, ctx.request.url); <span class="comment">// =&gt; &#123;id: "123"&#125;, id=123, /?id=123</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul><p>综合案例：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 引入 koa模块及路由</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置路由</span></span><br><span class="line">router</span><br><span class="line">  .get(<span class="string">"/:id&amp;:name"</span>, <span class="keyword">async</span>(ctx, next) =&gt; &#123;</span><br><span class="line">	ctx.body = <span class="string">`</span></span><br><span class="line"><span class="string">		参数id: <span class="subst">$&#123;ctx.params.id&#125;</span>,</span></span><br><span class="line"><span class="string">		参数name: <span class="subst">$&#123;ctx.params.name&#125;</span></span></span><br><span class="line"><span class="string">	`</span>;</span><br><span class="line"></span><br><span class="line">	&#125;)</span><br><span class="line">  .get(<span class="string">"/news"</span>,</span><br><span class="line">  	<span class="keyword">async</span>(ctx, next) =&gt; &#123;</span><br><span class="line">  		<span class="keyword">if</span> (ctx.query.id === <span class="string">"1"</span>) &#123;</span><br><span class="line">				next();</span><br><span class="line">  		&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">  			ctx.body = <span class="string">`</span></span><br><span class="line"><span class="string">				参数：<span class="subst">$&#123;ctx.querystring&#125;</span>,</span></span><br><span class="line"><span class="string">				参数：<span class="subst">$&#123;ctx.request.querystring&#125;</span></span></span><br><span class="line"><span class="string">				`</span>;</span><br><span class="line">  		&#125;</span><br><span class="line">		&#125;, </span><br><span class="line">		<span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">  		<span class="comment">// 多个中间件</span></span><br><span class="line">			ctx.body = <span class="string">"拒绝访问"</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 启用路由，注册路由中间件</span></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8066</span>);</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- http://172.16.55.29:8066/123&amp;devin --&gt;</span></span><br><span class="line">参数id: 123,</span><br><span class="line">参数name: devin</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- http://172.16.55.29:8066/news?id=456&amp;name=devin --&gt;</span></span><br><span class="line">参数：id=456&amp;name=devin</span><br><span class="line">参数：id=456&amp;name=devin</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- http://172.16.55.29:8066/news?id=1&amp;name=devin --&gt;</span></span><br><span class="line">拒绝访问</span><br></pre></td></tr></table></figure><h3 id="路由重定向"><a href="#路由重定向" class="headerlink" title="路由重定向"></a>路由重定向</h3><p><code>router.redirect(source, destination)</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 引入 koa模块及路由</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置路由</span></span><br><span class="line">router.get(<span class="string">"/"</span>, <span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">	ctx.body = <span class="string">`根路由`</span>;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 重定向</span></span><br><span class="line">router.redirect(<span class="string">"/abc"</span>, <span class="string">"/"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启用路由，注册路由中间件</span></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8066</span>);</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2基础</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa框架04-模块系统</title>
    <url>/archives/59b810e2.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Koa框架04-模块系统。</p><a id="more"></a><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>Node模块有3个语法:</p><ul><li><code>exports</code></li><li><code>module</code></li><li><code>require</code></li></ul><h3 id="require"><a href="#require" class="headerlink" title="require"></a>require</h3><p><code>require</code>就是引入模块的语法。引入路由有两种情况：</p><ul><li><code>require(&quot;fs&quot;)</code>: 系统模块，直接写模块名，不需要加路径</li><li><code>require(&quot;../my-app&quot;)</code>：自定义模块，需要加路径</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> routerFun = <span class="built_in">require</span>(<span class="string">"../routers"</span>)</span><br></pre></td></tr></table></figure><p>Node的模块都是 <code>js</code> 文件，所以可以省略文件后缀，如果只定位到目录，那么默认引入的文件为该目录下的 <code>index.js</code>。</p><h3 id="module和exports"><a href="#module和exports" class="headerlink" title="module和exports"></a>module和exports</h3><div class="note warning"><p><code>exports</code>是node的语法，<code>export</code>是ES6的语法，注意两者不是一样的。</p></div><p><code>exports</code> 是 <code>module.exports</code> 的引用，<code>exports</code>是一个变量名，它引用了 <code>module.exports</code> 对象，node最终导入模块的是 <code>module.exports</code> 对象。其原理可以理解如下：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(exports === <span class="built_in">module</span>.exports); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> my_module = &#123;</span><br><span class="line">  exports: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> my_exports = my_module.exports;</span><br><span class="line"></span><br><span class="line">exports.a = <span class="number">1</span>;</span><br><span class="line">exports.b = <span class="number">2</span>;</span><br><span class="line"><span class="comment">// 如果这个模块被引入，则引入结果为：&#123;c = 3&#125;</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  c = <span class="number">3</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><div class="note primary"><p>更详细的模块发展历程及模块案例，可查看 <a href="/archives/b92372a3.html">JavaScript进阶-模块化</a></p></div><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2框架</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa框架07-CookieSession</title>
    <url>/archives/11c3e06f.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Koa框架07-Cookie、Session。</p><a id="more"></a><h3 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h3><p>Cookie是存储在访问者的计算机中的变量。可以让我们用同一个浏览器访问同一个域名的时候共享数据。</p><p>解决的问题是：由于HTTP是无状态的协议，简单的说就是每当浏览了一个页面，然后跳转到同一个网站的另一个页面，服务器无法识别这是同一个浏览器在访问同一个网站，每一次访问，都是无关联的。</p><h3 id="使用Cookie"><a href="#使用Cookie" class="headerlink" title="使用Cookie"></a>使用Cookie</h3><ul><li><code>ctx.cookies.set(name, value, [options])</code><ul><li><code>options</code> 设置的属性<ul><li><code>maxAge</code> 一个数字，表示从 <code>Date.now()</code> 得到的毫秒数，如果为0，可用于清除cookie。优先级大于 <code>expires</code>。例：1小时：<code>maxAge: 1000 * 60 * 60</code></li><li><code>expires</code> 一个 <code>Date</code> 对象，表示cookie的到期日期（默认情况下会在会话结束时过期）。清除cookie：<code>expires: Date.now() - 1</code></li><li><code>path</code> 一个字符串，表示cookie的路径（默认是“/”）</li><li><code>domain</code> 一个字符串，表示cookie的域（无默认值）</li><li><code>secure</code> 一个布尔值，表示cookie是否仅通过HTTPS发送（HTTP下默认为 <code>fasle</code>，HTTPS下默认为 <code>true</code>）</li><li><code>httpOnly</code> 一个布尔值，表示cookie是否仅通过HTTP/HTTPS发送，且不提供给客户端JavaScript（默认为 <code>true</code>）</li><li><code>sameSite</code> 一个布尔值或字符串，表示该cookie是否为相同站点cookie（默认为 <code>false</code>），可以设置为 <code>strict/lax/none/true</code></li><li><code>signed</code> 一个布尔值，表示是否要对cookie进行签名（默认为 <code>false</code>），如果未 <code>true</code>，则还会发送另一个后缀为 <code>.sig</code> 的同名cookie</li><li><code>overwrite</code> 一个布尔值，表示是否覆盖以前设置的同名的cookie（默认是 <code>false</code>）</li></ul></li></ul></li><li><code>ctx.cookie.get(name, [options])</code></li></ul><p>如果没有设置cookie的过期时间，则表示这个cookie生命周期为浏览器会话期间，也就是会话cookie，只要关闭浏览器窗口，cookie就消失了。此外，cookie不会保存在硬盘上而是保存在内存里。</p><p>如果设置了过期时间，浏览器就会把cookie保存在硬盘上，直到cookie到期后，消失。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="comment">// 引入 koa模块及路由</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"><span class="keyword">const</span> views = <span class="built_in">require</span>(<span class="string">"koa-views"</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">static</span> = <span class="built_in">require</span>(<span class="string">"koa-static"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置模板引擎中间件</span></span><br><span class="line">app.use(views(path.join(__dirname, <span class="string">"./views"</span>), &#123;</span><br><span class="line">	extension: <span class="string">"ejs"</span></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置静态资源中间件</span></span><br><span class="line">app.use(<span class="keyword">static</span>(__dirname + <span class="string">"/static"</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置路由</span></span><br><span class="line">router</span><br><span class="line">	.get(<span class="string">"/"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">		ctx.cookies.set(<span class="string">"userInfo"</span>, <span class="built_in">encodeURIComponent</span>(<span class="string">"子俊"</span>), &#123;<span class="attr">maxAge</span>: <span class="number">1000</span>*<span class="number">10</span>&#125;)</span><br><span class="line">		<span class="keyword">await</span> ctx.render(<span class="string">"index"</span>, &#123;&#125;);</span><br><span class="line">		<span class="keyword">await</span> next();</span><br><span class="line">	&#125;)</span><br><span class="line">	.get(<span class="string">"/news"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="built_in">decodeURIComponent</span>(ctx.cookies.get(<span class="string">"userInfo"</span>)));</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启用路由，注册路由中间件</span></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8066</span>, () =&gt; &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"服务器已运行在8066端口上！"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><div class="note warning no-icon"><p>这里还使用到了 <code>encodeURIComponent</code> 和 <code>decodeURIComponent</code></p><ul><li><code>encodeURI</code>：该方法不会对<strong>ASCII字母、数字、~!@#$&amp;*()=:/,;?+’</strong>字符编码，即会对<strong>中文、空格</strong>等进行编码</li><li><code>encodeURIComponent</code>：该方法不会对<strong>ASCII字母、数字、~!*()’</strong>字符编码，即会对<strong>非字母数字</strong>等进行编码，通常对查询字符串编码，也适用于cookie编码</li></ul></div><h3 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h3><p>Session是另一种记录客户状态的机制，不同于Cookie的是，Cookie保存在客户端浏览器中，而session保存在服务器上。</p><p>原理：</p><ol><li>浏览器访问服务器并发送第一次请求，服务器会创建一个session对象，生成一个（key/vlue）键值对</li><li>响应时，将key(键)通过cookie返回到浏览器客户端</li><li>浏览器非第一次访问，携带key（cookie），服务端找到对应的session（value）</li></ol><h3 id="使用Session"><a href="#使用Session" class="headerlink" title="使用Session"></a>使用Session</h3><p>先需要安装 <code>koa-session</code> 中间件</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">npm i koa<span class="literal">-session</span> <span class="literal">-S</span></span><br></pre></td></tr></table></figure><ul><li><code>app.use(session(config, app))</code><ul><li><code>config</code> 配置属性<ul><li><code>key</code> 一个字符串或数字，默认为：<code>koa:sess</code></li><li><code>maxAge</code> 过期时间，以毫秒为单位</li><li><code>rolling</code> 一个布尔值，每次浏览器请求时，是否重新刷新session的过期时间，默认为 <code>false</code></li><li><code>renew</code> 一个布尔值，每次浏览器请求时，是否重新刷新session的过期时间，默认为 <code>false</code></li></ul></li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 引入 koa模块及路由</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"><span class="keyword">const</span> views = <span class="built_in">require</span>(<span class="string">"koa-views"</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">"koa-session"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置模板引擎中间件</span></span><br><span class="line">app.use(views(path.join(__dirname, <span class="string">"./views"</span>), &#123;</span><br><span class="line">	extension: <span class="string">"ejs"</span></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置session中间件</span></span><br><span class="line">app.keys = [<span class="string">"devin session"</span>];</span><br><span class="line"><span class="keyword">const</span> CONFIG = &#123;</span><br><span class="line">	key: <span class="string">"koa:session"</span>,</span><br><span class="line">	maxAge: <span class="number">1000</span> * <span class="number">30</span></span><br><span class="line">&#125;;</span><br><span class="line">app.use(session(CONFIG, app));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置路由</span></span><br><span class="line">router</span><br><span class="line">	.get(<span class="string">"/"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">		ctx.session.userInfo = <span class="string">"子俊2030"</span>;</span><br><span class="line">		<span class="keyword">await</span> ctx.render(<span class="string">"index"</span>, &#123;&#125;);</span><br><span class="line">		<span class="keyword">await</span> next();</span><br><span class="line">	&#125;)</span><br><span class="line">	.get(<span class="string">"/news"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">		<span class="built_in">console</span>.log(ctx.session.userInfo);</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启用路由，注册路由中间件</span></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8066</span>, () =&gt; &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"服务器已运行在8066端口上！"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="Cookie和Session区别"><a href="#Cookie和Session区别" class="headerlink" title="Cookie和Session区别"></a>Cookie和Session区别</h3><ol><li>Cookie数据存在客户端的浏览器上，如果没有设置过期时间，存在内存中，否则存在硬盘上；Session数据则放在服务器上</li><li>Cookie不是很安全，别人可以分析存放在本地的cookie并进行欺骗，考虑到安全性，应当使用session</li><li>Session会在一定时间内保存在服务器上，当访问比较多，会占用服务器性能，考虑到服务器性能优化，应当适当使用cookie</li><li>当个Cookie保存数据大小不能超过4k，并且浏览器对一个站点的cookie有数量限制，一般限制为20或50个cookie</li></ol><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2框架</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa2基础-静态资源</title>
    <url>/archives/1e91a300.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Node框架 - 静态资源及 koa-static 中间件。</p><a id="more"></a><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">npm i koa<span class="literal">-static</span> <span class="literal">-S</span></span><br></pre></td></tr></table></figure><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>引入并使用静态资源中间件</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="comment">// 引入 koa模块及路由</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"><span class="keyword">const</span> views = <span class="built_in">require</span>(<span class="string">"koa-views"</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">static</span> = <span class="built_in">require</span>(<span class="string">"koa-static"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置模板引擎中间件</span></span><br><span class="line">app.use(views(path.join(__dirname, <span class="string">"./views"</span>), &#123;</span><br><span class="line">	extension: <span class="string">"ejs"</span></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置静态资源中间件</span></span><br><span class="line">app.use(<span class="keyword">static</span>(__dirname + <span class="string">"/static"</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置路由</span></span><br><span class="line">router</span><br><span class="line">	.get(<span class="string">"/"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">		<span class="keyword">await</span> ctx.render(<span class="string">"index"</span>, &#123;&#125;);</span><br><span class="line">		<span class="keyword">await</span> next();</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启用路由，注册路由中间件</span></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8066</span>, () =&gt; &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"服务器已运行在8066端口上！"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>使用静态文件</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.ejs --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"test.png"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><div class="note warning no-icon"><p>由于中间件配置了静态目录，所以在使用时，直接引入该静态目录下的文件即可。比如静态资源：<code>/static/test.png</code>，使用：<code>&lt;img src=&quot;test.png&quot;&gt;</code></p></div><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2基础</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa框架06-Http</title>
    <url>/archives/902cb571.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Koa框架06-Http。</p><a id="more"></a><h3 id="http协议"><a href="#http协议" class="headerlink" title="http协议"></a>http协议</h3><ul><li><strong>HTTP1.0</strong> 每次发起一个连接，完成后断开连接</li><li><strong>HTTP1.1</strong> 支持持久连接</li><li><strong>HTTPS</strong> 安全，加密传输</li><li><strong>HTTP2.0</strong> 加密，头部压缩，服务端推送，请求管线，多路复用</li></ul><h3 id="http消息结构"><a href="#http消息结构" class="headerlink" title="http消息结构"></a>http消息结构</h3><p>http由两部分组成：</p><ul><li>header头部，大小 &lt;= 32kb</li><li>body内容，大小 &lt;=1g</li></ul><h3 id="http状态码"><a href="#http状态码" class="headerlink" title="http状态码"></a>http状态码</h3><ul><li><code>1xx</code> 消息</li><li><code>2xx</code> 成功</li><li><code>3xx</code> 重定向</li><li><code>4xx</code> 请求错误</li><li><code>5xx</code> 服务器错误</li></ul><h3 id="常见http头"><a href="#常见http头" class="headerlink" title="常见http头"></a>常见http头</h3><ul><li><code>content-type</code> 内容类型</li><li><code>set-cookie</code> 服务器发送给浏览器cookie，<code>cookie</code>是浏览器发送给服务器cookie</li><li><code>cache-control</code> 缓存控制</li></ul><h3 id="常见的请求方法"><a href="#常见的请求方法" class="headerlink" title="常见的请求方法"></a>常见的请求方法</h3><ul><li><code>GET</code> 数据在url上，大小&lt;=32kb</li><li><code>POST</code> 数据在body中，大小&lt;=1g</li></ul><div class="note primary"><p>更详细的HTTP详解，可查看 <a href="/archives/20a052b7.html">Node基础-HTTP</a></p></div><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2框架</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa框架08-Mysql</title>
    <url>/archives/c775a4d5.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Koa框架08-Mysql。</p><a id="more"></a><h3 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h3><p><strong>安装</strong></p><ol><li>下载地址：<a href="https://dev.mysql.com/downloads/installer/" target="_blank" rel="noopener external nofollow noreferrer">https://dev.mysql.com/downloads/installer/</a></li><li>选择 【Only server】一直点击默认项安装即可，密码设置为 123456</li><li>Navicat 新建连接，名为：localhost</li><li>新建数据库，名为：test</li><li>新建表，名为：users，并添加几条数据</li></ol><p><strong>Mysql8.0报错</strong></p><div class="note primary"><p>连接数据库报错：<code>UnhandledPromiseRejectionWarning: Error: ER_NOT_SUPPORTED_AUTH_MODE: Client does not support</code>，mysql8.0加密方式原因。</p><ol><li>win键搜索，打开 MySQL 8.0 Command Line Client</li><li>键入密码：123456</li><li>修改加密规则：<code>ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;password&#39; PASSWORD EXPIRE NEVER;</code></li><li>更新用户密码：<code>ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED WITH mysql_native_password BY &#39;123456&#39;;</code></li><li>刷新权限：<code>FLUSH PRIVILEGES;</code></li></ol></div><p><strong>常用sql语句</strong></p><p>具体可查看 <a href="/archives/1b257343.html">Mysql-常用语句</a></p><p>​</p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>安装中间件promise-mysql：<code>npm i promise-mysql -S</code></p><h3 id="连接池"><a href="#连接池" class="headerlink" title="连接池"></a>连接池</h3><p>连接数据库有两种方式：</p><ul><li><code>mysql.createConnection(connectionOptions)</code></li><li><code>mysql.createPool(connectionOptions)</code><ul><li><code>connectionOptions</code><ul><li><code>host</code> 要连接到的数据库的主机名。（默认：<code>localhost</code>)</li><li><code>user</code> 要进行身份验证的 MySQL 用户</li><li><code>password</code> 该 MySQL 用户的密码</li><li><code>database</code> 用于此连接的数据库名称（可选）</li><li><code>connectionLimit</code> 最大连接数，默认为10个连接</li><li><code>port</code> 要连接到的端口号。（默认：<code>3306</code>)</li><li><code>connectTimeout</code> 在初始连接到 MySQL 服务器期间发生超时前的毫秒。（默认：<code>10000</code>)</li><li><code>stringifyObjects</code> 将对象字符串化，而不是转换为值。（默认：<code>false</code>)</li><li><code>dateStrings</code> 强制将日期类型（TIMESTAMP、日期时间、日期）作为字符串返回，(默认：<code>true</code> <code>false</code> <code>false</code>)</li></ul></li></ul></li></ul><p><code>createConnection</code> 这种连接方法并不是很好，因为它是一个单线程，也就是如果2个用户同时一起获取数据，是不行的，只有等第一个用户连接服务器获取数据之后，才能进行第二个。所以，<code>createPool</code>连接池的这种方法，可以有效的解决多个连接的问题。原理为：连接池一开始就开启了多个连接，如果有连接，就使用，使用完之后再空置出来。这样既能支持多个同时，也能减少用户等待上一位的请求等待时间。</p><p><strong>pool常用方法</strong></p><ul><li><code>pool.getConnection((err, connection) =&gt; {})</code> 使用一个池连接</li><li><code>pool.query(sql, (err, results, fields) =&gt; {})</code> 连接数据库操作，</li><li><code>pool.releaseConnection()</code> 释放连接</li><li><code>pool.end(err =&gt; {})</code> 终止连接，关闭池中的所有连接</li><li><code>pool.on(event, connection =&gt; {})</code> 池事件<ul><li><code>event</code><ul><li><code>acquire</code> 获得</li><li><code>connection</code> 连接</li><li><code>enqueue</code> 回调已排队等待可用连接</li><li><code>release</code> 释放</li></ul></li></ul></li></ul><h3 id="使用promise-mysql"><a href="#使用promise-mysql" class="headerlink" title="使用promise-mysql"></a>使用promise-mysql</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">"promise-mysql"</span>);</span><br><span class="line"><span class="keyword">let</span> result;</span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">	<span class="keyword">let</span> db = <span class="keyword">await</span> mysql.createPool(&#123;</span><br><span class="line">		host: <span class="string">"localhost"</span>,</span><br><span class="line">  	user: <span class="string">"root"</span>,</span><br><span class="line">  	password: <span class="string">"123456"</span>,</span><br><span class="line">  	database: <span class="string">"test"</span></span><br><span class="line">	&#125;)</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">   result = <span class="keyword">await</span> db.query(<span class="string">"SELECT * FROM users"</span>); </span><br><span class="line">  &#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">    <span class="keyword">throw</span> err;</span><br><span class="line">  &#125;</span><br><span class="line">  db.releaseConnection();</span><br><span class="line">&#125;)()</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">	<span class="type">RowDataPacket</span> &#123; <span class="type">name</span>: <span class="string">"devin"</span>, <span class="type">age</span>: <span class="number">20</span>, <span class="type">post</span>: <span class="string">"coder"</span> &#125;,</span><br><span class="line">	<span class="type">RowDataPacket</span> &#123; <span class="type">name</span>: <span class="string">"张三"</span>, <span class="type">age</span>: <span class="number">30</span>, <span class="type">post</span>: <span class="string">"customer"</span> &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2框架</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa框架10-Router和错误处理</title>
    <url>/archives/59b197dc.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Koa框架10-router和错误处理。</p><a id="more"></a><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>用于处理不同的地址，执行不同的函数或调用不同的模块。</p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">npm i koa<span class="literal">-router</span> <span class="literal">-S</span></span><br></pre></td></tr></table></figure><h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123; <span class="attr">prefix</span>: <span class="string">"/api"</span> &#125;);</span><br><span class="line"></span><br><span class="line">router</span><br><span class="line">  .get(<span class="string">"/"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    ctx.body = <span class="string">"get请求"</span>;</span><br><span class="line">  &#125;)</span><br><span class="line">  .post(<span class="string">"/"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    ctx.body = <span class="string">"post请求"</span>;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line">app.listen(<span class="number">8077</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"服务器已开启,端口号8077"</span>);</span><br></pre></td></tr></table></figure><p>router 和 Koa 一样，也是一个构造函数，<code>new</code> 实例化的时候可以配置，<code>prefix</code> 属性指的是路由的前缀。</p><h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123; <span class="attr">prefix</span>: <span class="string">"/api"</span> &#125;);</span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> next();</span><br><span class="line">    <span class="keyword">if</span> (!ctx.body) &#123;</span><br><span class="line">      ctx.status = <span class="number">404</span>;</span><br><span class="line">      ctx.body = <span class="string">"404"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">    ctx.status = <span class="number">500</span>;</span><br><span class="line">    ctx.body = <span class="string">"500"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">router</span><br><span class="line">  .get(<span class="string">"/"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    ctx.body = <span class="string">"get请求"</span>;</span><br><span class="line">  &#125;)</span><br><span class="line">  .post(<span class="string">"/"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    ctx.body = <span class="string">"post请求"</span>;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line">app.listen(<span class="number">8077</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"服务器已开启,端口号8077"</span>);</span><br></pre></td></tr></table></figure><p>全局的错误处理一般放在最上层，因为 <code>next</code> 可以理解为是下面所有要运行的函数的集合。</p><p>错误处理一般必要两个属性：</p><ul><li><code>status</code> 状态码，必须是数字类型</li><li><code>body</code> 消息体<ul><li><code>code</code></li><li><code>message</code></li><li><code>data</code></li></ul></li></ul><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2框架</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa框架05-Npm</title>
    <url>/archives/dfe8fbff.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Koa框架04-Npm、node_modules、package。</p><a id="more"></a><h3 id="node-modules"><a href="#node-modules" class="headerlink" title="node_modules"></a>node_modules</h3><ul><li>node_modules是 npm 安装的模块存放目录</li><li>在 <code>require</code> 引入node_modules目录下的模块，不需要加上模块路径</li></ul><h3 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h3><p>package是node.js的工程文件，里面有一些项目的基本信息，一些快脚本，主要是用来存放依赖的，也就是模块。</p><p>存放模块有两种方式：</p><ul><li><code>-save</code> / <code>-S</code> 表示的是生产环境安装的模块</li><li><code>-save-dev</code> / <code>-D</code> 表示的是开发环境安装的模块</li></ul><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><p>初始化一个node项目：<code>npm init</code></p><p>如果化项目同时默认配置，则可：<code>npm init -y</code></p><div class="note primary"><p>更详细的NPM详解，可查看 <a href="/archives/d21c35f1.html">Node基础-NPM</a></p></div><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2框架</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa框架03-AsyncAwait</title>
    <url>/archives/a506c370.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Koa框架03-Async、Await。</p><a id="more"></a><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p><code>async/await</code> 可以理解为 <code>Generator</code> 的升级，其用法类似。<code>await</code> 后面接异步操作或者同步操作，但是绝对不能为空。异步函数定义，名称之前需要用 <code>async</code> 修饰符修饰。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">sayHello</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"hello"</span>);</span><br><span class="line">  <span class="keyword">await</span> sayName();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"world"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayName</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"devin"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sayHello();</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">hello</span><br><span class="line">devin</span><br><span class="line">world</span><br></pre></td></tr></table></figure><h3 id="await"><a href="#await" class="headerlink" title="await"></a>await</h3><p><code>await</code> 后面可以接什么？</p><ul><li>Promise对象</li><li>另一个async函数</li><li>普通函数</li><li>一个值</li></ul><p>但是不能为空，否则报错。</p><h3 id="错误捕获"><a href="#错误捕获" class="headerlink" title="错误捕获"></a>错误捕获</h3><p>使用了 <code>async/await</code> 后，函数变成了同步操作，没有异步回调了，所以我们可以通过 <code>try/catch</code> 来进行捕获。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">sayHello</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"hello"</span>);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> sayName();</span><br><span class="line">  &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(e);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"world"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayName</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">throw</span>(<span class="string">"error obj"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sayHello();</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">hello</span><br><span class="line">error obj</span><br><span class="line">world</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2框架</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa框架01-Promise</title>
    <url>/archives/2c9ed71a.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Koa框架01-Promise。</p><p>链接地址：<a href="https://www.mulingyuer.com/category/node/" target="_blank" rel="noopener external nofollow noreferrer">https://www.mulingyuer.com/category/node/</a></p><a id="more"></a><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>Promise实际上是一种格式（封装格式），所有的方法按照Promise的要求写，比如jq的ajax方法，es6的fetch、axios方法等，都是使用了Promise标准。在 <a href="/archives/ca2c17c3.html">Node基础-核心基础</a> 中也有对应的详解。这里再做一次记录，以示复习。</p><p>用Promise封装ajax请求的原理大概如下：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// XMLHttpRequest用于在后台与服务器交换数据</span></span><br><span class="line">  <span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">  <span class="comment">// 发送请求</span></span><br><span class="line">  xhr.open(<span class="string">"GET"</span>, <span class="string">"xxx/api/xxx"</span>, <span class="literal">true</span>);</span><br><span class="line">  xhr.send();</span><br><span class="line">  <span class="comment">// 响应事件</span></span><br><span class="line">  xhr.onreadystatechange = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(xhr.readState === <span class="number">4</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt; <span class="number">300</span> || xhr.status == <span class="number">304</span>) &#123;</span><br><span class="line">        resolve(xhr.responseText);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        reject(xhr);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">p.then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 请求成功</span></span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;, xhr =&gt; &#123;</span><br><span class="line">  <span class="comment">// 请求失败</span></span><br><span class="line">  <span class="built_in">console</span>.log(xhr)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>我们将异步的请求放在 <code>Promise</code> 对象里面，成功就调用 <code>resolve</code> 方法，传入获取到的参数；失败的话就调用 <code>reject</code> 方法，将 <code>xhr</code> 对象传入。也就是说，调用 <code>then</code> 中第一个参数为 <code>resolve</code>，第二个参数为 <code>reject</code>。</p><p>当然，对于错误处理，我们除了这样写（<code>reject</code> 作为第二个参数传入 <code>then</code> 函数中），还可以写在 <code>catch</code> 函数中。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">p</span><br><span class="line">  .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  	<span class="comment">// 请求成功</span></span><br><span class="line">  	<span class="built_in">console</span>.log(res);</span><br><span class="line">	&#125;)</span><br><span class="line">	.catch(<span class="function"><span class="params">xhr</span> =&gt;</span> &#123;</span><br><span class="line">  	<span class="comment">// 请求失败</span></span><br><span class="line">  	<span class="built_in">console</span>.log(xhr)</span><br><span class="line">	&#125;)</span><br></pre></td></tr></table></figure><p>通过 <code>catch</code> 也可以捕获错误，但是捕获的是所有的错误，也就是所有的错误调用使用同一个方法。而上面那个的错误处理，是独立的，这是两种的区别。<code>catch</code> 也适合处理对应多个 <code>then</code> 的情况，比避免单独处理错误调用，省事。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">p</span><br><span class="line">	.then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  	<span class="comment">// do resolve 01</span></span><br><span class="line">	&#125;)</span><br><span class="line">	.then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  	<span class="comment">// do resolve 02</span></span><br><span class="line">	&#125;)</span><br><span class="line">	.then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  	<span class="comment">// do resolve 03</span></span><br><span class="line">	&#125;)</span><br><span class="line">	.catch(<span class="function"><span class="params">xhr</span> =&gt;</span> &#123;</span><br><span class="line">  	<span class="comment">// do reject</span></span><br><span class="line">	&#125;)</span><br></pre></td></tr></table></figure><h3 id="ajax请求"><a href="#ajax请求" class="headerlink" title="ajax请求"></a>ajax请求</h3><p>复习下ajax原生实现请求过程：</p><ol><li>创建XHR对象：<code>new XMLHttpRequest()</code></li><li>规定并发送XML请求：<ul><li><code>open(method, url, async)</code><ul><li><code>method</code>：请求的类型（<code>GET/POST</code>）</li><li><code>url</code>：文件在服务器上的位置</li><li><code>async</code>：是否异步处理请求</li></ul></li><li><code>send(string)</code><ul><li><code>string</code>：仅用于 <code>POST</code> 请求</li></ul></li></ul></li><li>XML响应：<ul><li><code>onreadstatechange</code>：响应事件函数</li><li><code>readState</code>：XMLHttpRequest状态<ul><li><code>0</code>：请求未初始化</li><li><code>1</code>：服务器连接已建立</li><li><code>2</code>：服务器已接收</li><li><code>3</code>：请求处理中</li><li><code>4</code>：请求已完成，且响应已就绪</li></ul></li><li><code>status</code>：状态码<ul><li><code>200</code>： ok</li><li><code>404</code>：未找到页面</li></ul></li><li><code>responseText</code>：获得字符串形式的响应数据</li></ul></li></ol><h3 id="all方法"><a href="#all方法" class="headerlink" title="all方法"></a>all方法</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">let</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="number">2</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">Promise</span>.all([p1, p2])</span><br><span class="line">  .then(<span class="function"><span class="params">arr</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(arr);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>]</span><br></pre></td></tr></table></figure><p><code>Promise.all()</code> 方法，接收一个所有异步方法的数组，所有的 <code>then</code> 回调全部用一个参数表示（即这里的 <code>arr</code>)，其内容的数组顺序和请求的异步方法顺序对应。错误则共用方法。</p><h3 id="race方法"><a href="#race方法" class="headerlink" title="race方法"></a>race方法</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  reject(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">let</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="number">2</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">Promise</span>.race([p1, p2])</span><br><span class="line">  .then(<span class="function"><span class="params">arr</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"success:"</span> + arr);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"fail:"</span> + err);</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">fail: <span class="number">1</span></span><br></pre></td></tr></table></figure><p><code>Promise.race()</code> 方法，参数格式与 <code>Promise.all()</code>方法类似，不同的是，只处理第一个完成的异步回调，这个异步回调可以是成功的也可以是失败的，然后结束（即不会继续执行）。</p><h3 id="allSettled方法"><a href="#allSettled方法" class="headerlink" title="allSettled方法"></a>allSettled方法</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  reject(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">let</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="number">2</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">Promise</span>.allSettled([p1, p2])</span><br><span class="line">  .then(<span class="function"><span class="params">arr</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"success:"</span>, arr);</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="code"><pre><span class="line">success: [</span><br><span class="line">	&#123;</span><br><span class="line">		status: "rejected",</span><br><span class="line">		reason: 1</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		status: "fulfilled",</span><br><span class="line">    value: 2</span><br><span class="line">	&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><code>Promise.allSetted()</code> 和 <code>Promise.all()</code> 、 <code>Promise.race()</code> 不同的是，它没有短路运算，不管成功还是失败，都是执行完，然后把结果输出。</p><div class="note warning"><p>经过测试，<code>Promise.allSetted()</code> 目前在微信小程序/公众号和Node环境（version: 12.x）版本中并不支持。使用时，注意版本兼容性！</p></div><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2框架</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa框架14-路由参数重定向嵌套</title>
    <url>/archives/f970ad2.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Koa框架14-路由参数重定向嵌套。</p><a id="more"></a><h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><p>koa-router 的参数和 vue 中的 router 参数一样，格式为：<code>/:id</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">router.get(<span class="string">"/news/:id"</span>, <span class="keyword">async</span> ctx =&gt; &#123;&#125;);</span><br></pre></td></tr></table></figure><p>那么对应的进入这个路径，也需要带上这个参数，否则会报404错误，参数可以多个，但是访问也需要多个，且参数为对应。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">router.get(<span class="string">"/news/:id/:a/:eee"</span>, <span class="keyword">async</span> ctx =&gt; &#123;&#125;);</span><br></pre></td></tr></table></figure><p>获取参数可通过 <code>ctx.params</code> 属性获取。</p><h3 id="命名路由"><a href="#命名路由" class="headerlink" title="命名路由"></a>命名路由</h3><p>这个和 vue 的命名路由差不多，也是给一个名，以后路径发生变化，跳转用 name 也不会受到影响。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">router.get(<span class="string">"news"</span>, <span class="string">"/news/:id"</span>, <span class="keyword">async</span> ctx =&gt; &#123;&#125;);</span><br></pre></td></tr></table></figure><p>使用</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">router.url(<span class="string">"news"</span>, <span class="number">18</span>);</span><br></pre></td></tr></table></figure><h3 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h3><p>路由的重定向默认为 <code>302</code> （永久定向），注意 <code>ctx.redirect()</code> 默认为 <code>301</code> (临时对象)。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">router.redirect(<span class="string">"/a"</span>, <span class="string">"/b"</span>);</span><br></pre></td></tr></table></figure><h3 id="嵌套"><a href="#嵌套" class="headerlink" title="嵌套"></a>嵌套</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123; <span class="attr">prefix</span>: <span class="string">"/api"</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// user路由</span></span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">new</span> Router();</span><br><span class="line">user</span><br><span class="line">  .get(<span class="string">"/login"</span>, <span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">    ctx.body = <span class="string">"登录"</span>;</span><br><span class="line">  &#125;)</span><br><span class="line">  .get(<span class="string">"/sign"</span>, <span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">    ctx.body = <span class="string">"注册"</span>;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// admin路由</span></span><br><span class="line"><span class="keyword">const</span> admin = <span class="keyword">new</span> Router();</span><br><span class="line">admin</span><br><span class="line">  .get(<span class="string">"/list"</span>, <span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">    ctx.body = <span class="string">"数据列表"</span>;</span><br><span class="line">  &#125;)</span><br><span class="line">  .get(<span class="string">"/banner"</span>, <span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">    ctx.body = <span class="string">"轮播数据"</span>;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">router.use(<span class="string">"/user"</span>, user.routes());</span><br><span class="line">router.use(<span class="string">"/admin"</span>, admin.routes());</span><br><span class="line"></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line">app.listen(<span class="number">8077</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"服务器已开启,端口号8077"</span>);</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">http://<span class="number">172.16</span>.<span class="number">55.29</span>:<span class="number">8077</span>/api/user/login =&gt; 登录</span><br><span class="line">http://<span class="number">172.16</span>.<span class="number">55.29</span>:<span class="number">8077</span>/api/user/sign =&gt; 注册</span><br><span class="line">http://<span class="number">172.16</span>.<span class="number">55.29</span>:<span class="number">8077</span>/api/admin/list =&gt; 数据列表</span><br><span class="line">http://<span class="number">172.16</span>.<span class="number">55.29</span>:<span class="number">8077</span>/api/admin/banner =&gt; 轮播数据</span><br></pre></td></tr></table></figure><h3 id="路由模块化"><a href="#路由模块化" class="headerlink" title="路由模块化"></a>路由模块化</h3><p>以下对 <code>user</code> 和 <code>admin</code> 两个路由做模块化处理</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// routes/user.js</span></span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router();</span><br><span class="line">router</span><br><span class="line">  .get(<span class="string">"/login"</span>, <span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  	ctx.body = <span class="string">"登录"</span>;</span><br><span class="line">	&#125;)</span><br><span class="line">	.get(<span class="string">"/sign"</span>, <span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  	ctx.body = <span class="string">"注册"</span>;</span><br><span class="line">	&#125;)</span><br><span class="line"><span class="built_in">module</span>.exports = router.routes();</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// routes/admin.js</span></span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router();</span><br><span class="line">router</span><br><span class="line">  .get(<span class="string">"/list"</span>, <span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  	ctx.body = <span class="string">"数据列表"</span>;</span><br><span class="line">	&#125;)</span><br><span class="line">	.get(<span class="string">"/banner"</span>, <span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  	ctx.body = <span class="string">"轮播数据"</span>;</span><br><span class="line">	&#125;)</span><br><span class="line"><span class="built_in">module</span>.exports = router.routes();</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// routes/index.js</span></span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router();</span><br><span class="line">router</span><br><span class="line">	.use(<span class="string">"/user"</span>, <span class="built_in">require</span>(<span class="string">"./user"</span>))</span><br><span class="line">	.use(<span class="string">"/admin"</span>, <span class="built_in">require</span>(<span class="string">"./admin"</span>))</span><br><span class="line"><span class="built_in">module</span>.exports = router.routes();</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line">app.use(<span class="built_in">require</span>(<span class="string">"./routes"</span>));</span><br><span class="line">app.listen(<span class="number">8080</span>);</span><br></pre></td></tr></table></figure><p>当然如此之外，还可以有另一种处理方式（自动导入）</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// routes/user.js</span></span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123; <span class="attr">prefix</span>: <span class="string">"/api/user"</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> userController = <span class="built_in">require</span>(<span class="string">"../controllers/user"</span>);</span><br><span class="line"></span><br><span class="line">router</span><br><span class="line">	.post(<span class="string">"/login"</span>, userController.login);</span><br><span class="line">	.post(<span class="string">"/sign"</span>, userController.sign)</span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// routes/admin.js</span></span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123; <span class="attr">prefix</span>: <span class="string">"/api/admin"</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> userController = <span class="built_in">require</span>(<span class="string">"../controllers/admin"</span>);</span><br><span class="line"></span><br><span class="line">router</span><br><span class="line">	.get(<span class="string">"/list"</span>, userController.getList);</span><br><span class="line">	.get(<span class="string">"/banner"</span>, userController.getBanner)</span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// routes/index.js</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">const</span> bodyparser = <span class="built_in">require</span>(<span class="string">"koa-bodyparser"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册路由并导出</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="keyword">async</span> (app) =&gt; &#123;</span><br><span class="line">	<span class="keyword">const</span> files = <span class="keyword">await</span> fs.promises.readdir(__dirname);</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">const</span> file <span class="keyword">of</span> files) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file === <span class="string">"index.js"</span>) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">`./<span class="subst">$&#123;file&#125;</span>`</span>);</span><br><span class="line">    app.use(bodyparser());</span><br><span class="line">    app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> routerFun = <span class="built_in">require</span>(<span class="string">"./routes"</span>);</span><br><span class="line">routerFun(app).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;).catch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;)</span><br><span class="line">app.listen(<span class="number">8080</span>);</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2框架</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa框架11-Ctx对象</title>
    <url>/archives/bb191b29.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Koa框架11-Ctx对象。</p><a id="more"></a><h3 id="res和req对象"><a href="#res和req对象" class="headerlink" title="res和req对象"></a>res和req对象</h3><p><code>ctx</code> 有4个类似的对象</p><ul><li><code>ctx.req</code> 原生的request对象</li><li><code>ctx.res</code> 原生的response对象</li><li><code>ctx.request</code> koa自己封装的request对象</li><li><code>ctx.response</code> koa自己封装的response对象</li></ul><p>其中，之前使用的 <code>ctx.body</code> 等价于 <code>ctx.response.body</code>。</p><h3 id="抛出异常"><a href="#抛出异常" class="headerlink" title="抛出异常"></a>抛出异常</h3><p>对应错误处理，之前的处理方式是</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">ctx.status = <span class="number">404</span>;</span><br><span class="line">ctx.body = <span class="string">"地址错误"</span>;</span><br></pre></td></tr></table></figure><p>这样相对比较麻烦，koa提供了一个抛出异常的方法 <code>ctx.throw(status, body, error)</code>，3个参数</p><ul><li><code>status</code> 第一个参数为错误码，number类型</li><li><code>body</code> 第二个参数为错误信息，及body的内容</li><li><code>error</code> 第三个参数为错误对象</li></ul><p>当使用 <code>ctx.throw()</code> 抛出异常时，代码运行到此就会结束，不会再往下执行，直接将错误信息返回给前台。如果我们在最上层使用了 <code>try/catch</code> 捕获错误，那么由于这个方法会产生一个错误对象，<code>catch</code> 也会捕获到，从而无法返回信息给前台，如果需要返回，则需要在 <code>catch</code> 中重新抛出。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> next();</span><br><span class="line">    <span class="keyword">if</span> (!ctx.body) &#123;</span><br><span class="line">      ctx.status = <span class="number">404</span>;</span><br><span class="line">      ctx.body = <span class="string">"404"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">    <span class="keyword">throw</span>(err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="断言"><a href="#断言" class="headerlink" title="断言"></a>断言</h3><p><code>ctx.assert(value, status, body, error)</code> 与抛出异常类似，比 <code>throw</code> 方法前面多了一个变量判断。作用就是判断 <code>value</code> 是否存在，如果不存在就抛出异常。</p><p>使用场景：接口判断必要字段是否传值，否则抛出异常。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取用户信息</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param <span class="variable">ctx</span></span></span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return <span class="type">&#123;Promise.&lt;void&gt;&#125;</span></span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">async</span> getUser(ctx) &#123;</span><br><span class="line">		<span class="keyword">const</span> queryParams = ctx.query;</span><br><span class="line">		<span class="comment">// ctx.verifyParams(&#123;</span></span><br><span class="line">		<span class="comment">// 	id: &#123;</span></span><br><span class="line">		<span class="comment">// 		type: "string",</span></span><br><span class="line">		<span class="comment">// 		required: true</span></span><br><span class="line">		<span class="comment">// 	&#125;</span></span><br><span class="line">		<span class="comment">// &#125;)</span></span><br><span class="line">    ctx.assert(queryParams.id, <span class="number">20001</span>, <span class="string">"参数不完整"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h3><p>重定向分为两种：</p><ul><li><code>301</code> 永久定向。会使浏览器产生缓存，第一次请求发生是301后，下次再请求就会直接跳转到缓存时要跳转的链接，如果进行了修改，用户那边也不会发生变化，因为会优化使用缓存数据。</li><li><code>302</code> 临时定向。没有缓存，每次都要等服务器返回要跳转的链接才进行跳转。koa默认为302重定向。如果需要设置301永久定向，则需要手动设置 <code>status</code></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 默认为302临时定向</span></span><br><span class="line">ctx.redirect(<span class="string">"/login"</span>);</span><br><span class="line"><span class="comment">// 手动设置301永久定向</span></span><br><span class="line">ctx.status = <span class="number">301</span>;</span><br><span class="line">ctx.redirect(<span class="string">"/login"</span>);</span><br></pre></td></tr></table></figure><h3 id="附件下载"><a href="#附件下载" class="headerlink" title="附件下载"></a>附件下载</h3><p>附件下载原理：</p><ol><li>给文件命名，避免下载文件名字乱码 <code>ctx.attachment([filename],[options])</code></li><li>利用 <code>fs</code> 读取文件</li><li>读取完成后，直接将这个二进制文件返回给浏览器，自动触发浏览器下载</li></ol><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123; <span class="attr">prefix</span>: <span class="string">"/api"</span> &#125;);</span><br><span class="line"></span><br><span class="line">router</span><br><span class="line">  .get(<span class="string">"/"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    ctx.attachment(<span class="string">"用户.js"</span>);</span><br><span class="line">    ctx.body = <span class="keyword">await</span> fs.promises.readFile(<span class="string">"../controllers/user.js"</span>);</span><br><span class="line"></span><br><span class="line">  &#125;)</span><br><span class="line">  .post(<span class="string">"/"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    ctx.body = <span class="string">"post请求"</span>;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line">app.listen(<span class="number">8077</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"服务器已开启,端口号8077"</span>);</span><br></pre></td></tr></table></figure><h3 id="同步式下载"><a href="#同步式下载" class="headerlink" title="同步式下载"></a>同步式下载</h3><p>同步式下载就是不同于 <code>fs.readFile()/fs.promises.readFile()</code> 读取完文件之后才把内容返回给浏览器，<code>fs.createReadStream(path[, options])</code> 读取流文件可以实现服务器读多少，就传给浏览器多少，即所谓的同步式下载。同步式下载适用于大文件的读写。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123; <span class="attr">prefix</span>: <span class="string">"/api"</span> &#125;);</span><br><span class="line"></span><br><span class="line">router</span><br><span class="line">  .get(<span class="string">"/"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    ctx.attachment(<span class="string">"用户.js"</span>);</span><br><span class="line">    ctx.body = <span class="keyword">await</span> fs.createReadStream(<span class="string">"../controllers/user.js"</span>);</span><br><span class="line"></span><br><span class="line">  &#125;)</span><br><span class="line">  .post(<span class="string">"/"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    ctx.body = <span class="string">"post请求"</span>;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line">app.listen(<span class="number">8077</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"服务器已开启,端口号8077"</span>);</span><br></pre></td></tr></table></figure><h3 id="内存流"><a href="#内存流" class="headerlink" title="内存流"></a>内存流</h3><p>上述（附件下载 和 同步式下载）都是文件流的读取处理方式。即对一个固定的文件进行读写操作。内存流表示是对内存中的数据流进行读写操作。</p><p>需要使用 <code>memorystream</code> 中间件来操作。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">npm i memorystream <span class="literal">-S</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> MemoryStream = <span class="built_in">require</span>(<span class="string">"memorystream"</span>);</span><br><span class="line">router.get(<span class="string">"/"</span>, <span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  ctx.attachment(<span class="string">"我的文件.txt"</span>);</span><br><span class="line">  <span class="keyword">const</span> ms = <span class="keyword">new</span> MemoryStream();</span><br><span class="line">  ctx.body = ms;</span><br><span class="line">  <span class="comment">// 写入数据</span></span><br><span class="line">  ms.write(<span class="string">"第一条数据"</span>);</span><br><span class="line">  ms.write(<span class="string">"第二条数据"</span>);</span><br><span class="line">  ms.write(<span class="string">"第三条数据"</span>);</span><br><span class="line">  ms.end();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="头操作"><a href="#头操作" class="headerlink" title="头操作"></a>头操作</h3><p>后端对返回的内容设置头信息，除了设置原有的，还可以自定义</p><ul><li><code>ctx.get(field)</code> 不区分大小写获取响应头字段值</li><li><code>ctx.set(field)</code> / <code>ctx.set(field, value)</code> 设置响应头单独字段 / 用一个对象设置多个响应头</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取</span></span><br><span class="line">ctx.headers[<span class="string">"connection"</span>]</span><br><span class="line">ctx.get(<span class="string">"connection"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置</span></span><br><span class="line">ctx.set(<span class="string">"connection"</span>, <span class="string">"xxx"</span>)</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2框架</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa2基础-POST数据</title>
    <url>/archives/d4ef4e4f.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Node框架 - Post提交数据及 koa-bodyparser 中间件。</p><a id="more"></a><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">npm i koa<span class="literal">-bodyparser</span> <span class="literal">-S</span></span><br></pre></td></tr></table></figure><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>先构建表单页面</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.ejs --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/add"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">		用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">		密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>通过使用 <code>ctx.request.body</code> 可以轻易获取post数据。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="comment">// 引入 koa模块及路由</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"><span class="keyword">const</span> views = <span class="built_in">require</span>(<span class="string">"koa-views"</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">"koa-bodyparser"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置模板引擎中间件</span></span><br><span class="line">app.use(views(path.join(__dirname, <span class="string">"./views"</span>), &#123;</span><br><span class="line">	extension: <span class="string">"ejs"</span></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置post数据解析中间件</span></span><br><span class="line">app.use(bodyParser());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置路由</span></span><br><span class="line">router</span><br><span class="line">	.get(<span class="string">"/"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">		<span class="keyword">await</span> ctx.render(<span class="string">"index"</span>, &#123;&#125;, &#123; <span class="attr">async</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">		<span class="keyword">await</span> next();</span><br><span class="line">	&#125;)</span><br><span class="line">	.post(<span class="string">"/add"</span>, <span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">		<span class="keyword">let</span> data = ctx.request.body;</span><br><span class="line">		ctx.body = data;</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启用路由，注册路由中间件</span></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8066</span>, () =&gt; &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"服务器已运行在8066端口上！"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><img data-src="../../assets/20200915142655.png" alt=""></p><p><img data-src="../../assets/20200915142714.png" alt=""></p><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2基础</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa框架17-框架设计</title>
    <url>/archives/37566ca5.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Koa框架17-框架设计。</p><a id="more"></a><h3 id="实现概要"><a href="#实现概要" class="headerlink" title="实现概要"></a>实现概要</h3><ul><li>Koa2搭建服务</li><li>MySQL作为数据库<ul><li>本地环境搭建</li><li>存储普通数据</li><li>存储session登录态数据</li></ul></li><li>渲染<ul><li>服务端渲染：ejs模板引擎</li><li>前端渲染：vue框架</li></ul></li></ul><h3 id="文件目录设计"><a href="#文件目录设计" class="headerlink" title="文件目录设计"></a>文件目录设计</h3><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2框架</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa框架09-框架了解</title>
    <url>/archives/adc719df.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Koa框架09-框架了解。</p><a id="more"></a><h3 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h3><ul><li>1.0 已过气</li><li>2.0 过渡版本，兼容1.0版本的gennerator，兼容3.0的async</li><li>3.0 未发布</li></ul><h3 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">npm i koa <span class="literal">-S</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  ctx.body = <span class="string">"Hello"</span>;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8077</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"服务器已开启"</span>);</span><br></pre></td></tr></table></figure><div class="note warning"><p>需要注意的是，<code>app.use()</code> 监听访问内容，它只支持传入一个函数，不支持判断路径（Express支持）。</p></div><h3 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h3><p>Koa的中间件是按照方法执行顺序执行的，和js的执行顺序一样，谁先写，谁先执行，都是使用 <code>use</code> 方法。</p><p>由于中间件可能会有多个，如何确保我们需要进入下一个，<code>use</code> 的回调函数第二个参数为 <code>next</code> 函数，只有运行了 <code>next</code>，下一个中间件函数才会执行。</p><p>中间件中的 <code>ctx</code> 参数是同一个，这样可以实现通过这个参数传参，省去了书写全局变量。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"></span><br><span class="line">app</span><br><span class="line">  .use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    ctx.text = <span class="string">"Hello World"</span>;</span><br><span class="line">    next();</span><br><span class="line">  &#125;)</span><br><span class="line">  .use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    ctx.color = <span class="string">"red"</span>;</span><br><span class="line">    next();</span><br><span class="line">  &#125;)</span><br><span class="line">  .use(<span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">    ctx.body = <span class="string">`&lt;a style="color: <span class="subst">$&#123;ctx.color&#125;</span>;"&gt;<span class="subst">$&#123;ctx.text&#125;</span>&lt;/a&gt;`</span>;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8077</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"服务器已开启,端口号8077"</span>);</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2框架</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa框架16-GetPost文件上传</title>
    <url>/archives/db1e4b27.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Koa框架16-GetPost文件上传。</p><a id="more"></a><h3 id="GET数据"><a href="#GET数据" class="headerlink" title="GET数据"></a>GET数据</h3><p><code>GET</code>请求是通过 <code>ctx.query</code> 属性来获取到对应的数据</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">router.get(<span class="string">"/"</span>, <span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(ctx.query);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="POST数据"><a href="#POST数据" class="headerlink" title="POST数据"></a>POST数据</h3><p>之前使用的是中间件：<code>koa-bodyparser</code>，但是此插件仅限于 <code>Post</code> 基础数据，如果想要上传文件，则需要厉害另一个中间件： <code>koa-multer</code>。鉴于此，更推荐中间件：<code>koa-body</code>。</p><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2框架</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>Node基础-HTTP</title>
    <url>/archives/20a052b7.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Node.js-HTTP模块。</p><a id="more"></a><h3 id="HTTP服务器"><a href="#HTTP服务器" class="headerlink" title="HTTP服务器"></a>HTTP服务器</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">8066</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(&#123;req&#125;)</span><br><span class="line">	res.statusCode = <span class="number">200</span>;</span><br><span class="line">	res.setHeader(<span class="string">"Content-Type"</span>, <span class="string">"text/plain"</span>);</span><br><span class="line">	res.end(<span class="string">"Hello world!\n"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(port, () =&gt; &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">`服务器运行在端口<span class="subst">$&#123;port&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="HTTP请求-GET"><a href="#HTTP请求-GET" class="headerlink" title="HTTP请求-GET"></a>HTTP请求-GET</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> https = <span class="built_in">require</span>(<span class="string">"https"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">	hostname: <span class="string">"20202030.cc"</span>,</span><br><span class="line">	port: <span class="number">443</span>,</span><br><span class="line">	path: <span class="string">"/todos"</span>,</span><br><span class="line">	method: <span class="string">"GET"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> req = https.request(options, res =&gt; &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">`状态码：<span class="subst">$&#123;res.statusCode&#125;</span>`</span>);</span><br><span class="line">	res.on(<span class="string">"data"</span>, d =&gt; &#123;</span><br><span class="line">		process.stdout.write(d);</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">req.on(<span class="string">"error"</span>, error =&gt; &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(error);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">req.end();</span><br></pre></td></tr></table></figure><h3 id="HTTP请求-POST"><a href="#HTTP请求-POST" class="headerlink" title="HTTP请求-POST"></a>HTTP请求-POST</h3><p>建议使用 <code>axios</code> 库</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">"axios"</span>);</span><br><span class="line"></span><br><span class="line">axios.post(<span class="string">"20202030.cc/todos"</span>, &#123;</span><br><span class="line">	todo: <span class="string">"do something"</span></span><br><span class="line">&#125;)</span><br><span class="line">.then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">`状态码：<span class="subst">$&#123;res.statusCode&#125;</span>`</span>);</span><br><span class="line">&#125;)</span><br><span class="line">.catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="built_in">console</span>.error(error);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Node基础</category>
      </categories>
      <tags>
        <tag>Node</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa框架15-Static静态资源</title>
    <url>/archives/714a6ab5.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Koa框架15-Static静态资源。</p><a id="more"></a><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">npm i koa<span class="literal">-staic</span> <span class="literal">-S</span></span><br></pre></td></tr></table></figure><p><code>static</code> 一般放在最末尾用 <code>use</code> 激活。<code>static</code> 有两个参数，第一个为静态文件的路径，我们指定一个目录，第二个是配置文件</p><p><code>static(path[, options])</code></p><ul><li><code>maxage</code> 缓存周期，数值类型，毫秒单位（协商缓存）</li><li><code>index</code> 默认文件</li></ul><h3 id="缓存优化"><a href="#缓存优化" class="headerlink" title="缓存优化"></a>缓存优化</h3><ul><li>一般图片文件很少变化，所以对图片的缓存时间可以控制的稍微长点</li><li>一般容易变化的文件，如js等，缓存时间可以控制的稍微短点</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 图片资源缓存10天</span></span><br><span class="line"><span class="comment">// js/css/html文件缓存1天</span></span><br><span class="line"><span class="comment">// 通配文件缓存7天</span></span><br><span class="line">router</span><br><span class="line">  .all(<span class="regexp">/\.(jpg|png|gif)$/i</span>, <span class="keyword">static</span>(<span class="string">"./static"</span>, &#123; <span class="attr">maxage</span>: <span class="number">1000</span>*<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>*<span class="number">10</span> &#125;))</span><br><span class="line">	.all(<span class="regexp">/\.(css|js|html)$/i</span>, <span class="keyword">static</span>(<span class="string">"./static"</span>, &#123; <span class="attr">maxage</span>: <span class="number">1000</span>*<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>*<span class="number">1</span> &#125;))</span><br><span class="line">	.all(<span class="string">"/(.*)"</span>, <span class="keyword">static</span>(<span class="string">"./static"</span>, &#123; <span class="attr">maxage</span>: <span class="number">1000</span>*<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>*<span class="number">7</span> &#125;))</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2框架</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>Node基础-核心基础</title>
    <url>/archives/ca2c17c3.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Node.js-核心基础：事件循环、定时器、异步与回调、事件触发器。</p><a id="more"></a><h3 id="事件循环"><a href="#事件循环" class="headerlink" title="事件循环"></a>事件循环</h3><p><strong>阻塞事件循环</strong></p><p>就是只有等待上一个事件完成之后才能执行下一个事件。即同步执行。</p><p><strong>非阻塞事件循环</strong></p><p>JavaScript中几乎所有的I/O基元都是非阻塞的。网络请求、文件系统操作等。即异步执行。</p><p><strong>调用堆栈</strong></p><p>调用堆栈是一个队列（后进先出）的规则。事件循环不断的检查调用堆栈，以查看是否需要运行相关函数。需要注意的是，同级队列的执行规则是先进先出。</p><p><strong>消息队列</strong></p><p>消息队列的事件有：定时器、用户触发的事件、I/O、UI渲染等。即所谓的宏任务。</p><p><strong>作业队列</strong></p><p>作业队列的事件有：<code>process.nextTick</code>、<code>Promise</code>、<code>async/await</code>等。即所谓的微任务。作业队列的优先执行顺序优于消息队列。</p><p><strong>事件循环机制</strong></p><p>Node会不断的检查调用堆栈，根据主线程执行（由于JavaScript是单线程），如果遇到，则会把宏任务放置在整个堆栈的末尾（消息队列），如果遇到微任务，则会继续执行主线程，把其微任务定义好的回调加入相应的作业队列中。然后再先进先出执行作业队列。最后先进先出执行消息队列。</p><p><strong>案例</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> bar = <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">"bar"</span>);</span><br><span class="line"><span class="keyword">const</span> baz = <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">"baz"</span>);</span><br><span class="line"><span class="keyword">const</span> foo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"foo"</span>);</span><br><span class="line">  setTimeout(bar, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"promise"</span>)</span><br><span class="line">    resolve(<span class="string">"应该在baz之后，bar之前"</span>);</span><br><span class="line">  &#125;).then(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">console</span>.log(resolve))</span><br><span class="line">  baz()</span><br><span class="line">&#125;</span><br><span class="line">foo()</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">// foo</span><br><span class="line">// promise</span><br><span class="line">// baz</span><br><span class="line">// <span class="string">"应该在baz之后，bar之前"</span></span><br><span class="line">// bar</span><br></pre></td></tr></table></figure><h3 id="定时器"><a href="#定时器" class="headerlink" title="定时器"></a>定时器</h3><ul><li><code>setTimeout()</code> 延迟调用<ul><li><code>clearTimeout()</code> 清除延迟调用</li></ul></li><li><code>setInterval()</code> 间隔调用<ul><li><code>clearInterval()</code> 清除间隔调用</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> TIME = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 2秒后执行</span></span><br><span class="line">&#125;, <span class="number">2000</span>)；</span><br><span class="line"><span class="comment">// 清除延迟调用</span></span><br><span class="line">clearTimeout(TIME);</span><br></pre></td></tr></table></figure><h3 id="异步与回调"><a href="#异步与回调" class="headerlink" title="异步与回调"></a>异步与回调</h3><p>JavaScript默认情况下是同步、并且是单线程的。代码时依次执行的。那Node.js引入了非阻塞的I/O环境，处理事件程序，便使用的回调。回调也是高阶函数的一种。</p><blockquote><p>高阶函数：参数或者返回值是函数的函数。更多高阶函数，可见 <a href="/archives/af81bd5c.html">高阶函数</a></p></blockquote><p>Node.js中处理回调中的错误采用的是<strong>错误优先</strong>的策略，及任何回调函数中第一个参数为错误对象。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">fs.readFile(<span class="string">"/text.json"</span>, (err, data) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 错误处理</span></span><br><span class="line">  <span class="keyword">if</span>(err !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 没有错误，则处理数据</span></span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>为避免回调过长（回调地狱），Node.js即支持了ES6中的Promise和async/await 写法。</p><p><strong>Promise</strong></p><ul><li>Promise是一种处理异步代码，而不会陷入回调地狱的方式。</li><li>Promise运行原理：当Promise被调用后，它会以处理中状态（Pending）开始，调用的函数会继承执行，直到被创建的Promise最终处理（Settled）完（被解决状态（Resolved/Fulfilled）、被拒绝状态(Rejected)），并在完成时调用相应的回调函数（传给 <code>then</code> 和 <code>catch</code>）。</li><li>创建Promise: <code>new Promise((resolve, reject) =&gt; {})</code></li><li><code>Promise.all([p1, p2])</code> 在所有的Promise都被解决（Fulfilled）后执行操作，但凡其中有一个被拒绝（Rejected），即抛出错误，后面的不执行</li><li><code>Promise.race([p1, p2])</code> 只等待所有的Promise中第一个被处理后（可以是Fulfilled也有可能是Rejected）执行操作，后面的Promise不执行</li><li><code>Promise.allSettled([p1, p2])</code> 等待所有的Promise处理完（不管是Fulfilled还是Rejected）之后执行操作</li></ul><p><strong>Async/Await</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// promise 写法</span></span><br><span class="line"><span class="keyword">const</span> doSomething = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">"start do something"</span>);</span><br><span class="line">		resolve(<span class="string">"something resolved"</span>);</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"before"</span>);</span><br><span class="line">doSomething().then(<span class="function"><span class="params">res</span> =&gt;</span> <span class="built_in">console</span>.log(res));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"after"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// before</span></span><br><span class="line"><span class="comment">// start do something</span></span><br><span class="line"><span class="comment">// after</span></span><br><span class="line"><span class="comment">// something resolved</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// asycn/await 写法</span></span><br><span class="line"><span class="keyword">const</span> doSomethingAsync = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">	<span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">"start do something"</span>);</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"something resolved"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"before"</span>);</span><br><span class="line">doSomethingAsync();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"after"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// before</span></span><br><span class="line"><span class="comment">// start do something</span></span><br><span class="line"><span class="comment">// after</span></span><br><span class="line"><span class="comment">// something resolved</span></span><br></pre></td></tr></table></figure><h3 id="事件触发器"><a href="#事件触发器" class="headerlink" title="事件触发器"></a>事件触发器</h3><p>Node.js中提供了 <code>events</code> 模块，用于处理事件。</p><ul><li><code>on</code> 注册监听器</li><li><code>emit</code> 触发事件</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> EventEmitter = <span class="built_in">require</span>(<span class="string">"events"</span>);</span><br><span class="line"><span class="keyword">const</span> eventEmitter = <span class="keyword">new</span> EventEmitter;</span><br><span class="line"></span><br><span class="line">eventEmitter.on(<span class="string">"start"</span>, (...args) =&gt; &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">`参数为：<span class="subst">$&#123;args&#125;</span>`</span>);</span><br><span class="line">&#125;)</span><br><span class="line">eventEmitter.emit(<span class="string">"start"</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>); </span><br><span class="line"></span><br><span class="line"><span class="comment">// 参数为：1,2,3</span></span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Node基础</category>
      </categories>
      <tags>
        <tag>Node</tag>
      </tags>
  </entry>
  <entry>
    <title>Node基础-NPM</title>
    <url>/archives/d21c35f1.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Node.js-npm包管理。</p><a id="more"></a><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><ul><li><code>npm install</code> 安装 <code>package.json</code>文件中的所有依赖</li><li><code>npm install &lt;package-name&gt;</code> / <code>npm i &lt;package-name&gt;</code> 安装特定的模块包<ul><li><code>--save</code> / <code>-S</code> 安装并添加到dependencies</li><li><code>--save -dev</code> / <code>-D</code> 安装并添加到devDevpendencies</li><li><code>-g</code> 全局安装</li></ul></li><li><code>npm update</code> 升级所有满足版本限制的版本</li><li><code>npm update &lt;package-name&gt;</code> 指定模块包更新</li><li><code>require(&quot;package-name&quot;)</code> 导入并使用模块包</li><li><code>npm list</code> 查看所有已安装的模块包<ul><li><code>--depth=0</code> 获取指定层级的软件包</li></ul></li><li><code>npm list -g</code> 查看全局已安装的模块包</li><li><code>npm view [package-name] verson</code> 查看指定软件包的最新可用版本</li><li><code>npm i &lt;package-name&gt;@&lt;version&gt;</code> 安装软件包的指定版本</li><li><code>npm uninstall &lt;package-name&gt;</code> 卸载指定软件包<ul><li><code>--save</code> / <code>-S</code> 卸载dependencies中</li><li><code>--save -dev</code> / <code>-D</code> 卸载devDevpendencies中</li><li><code>-g</code> 卸载全局中</li></ul></li></ul><h3 id="配置包全局安装位置"><a href="#配置包全局安装位置" class="headerlink" title="配置包全局安装位置"></a>配置包全局安装位置</h3><ol><li><p>限制D盘目录下新建目录 Node.js , 然后再进入此目录，新建两个文件夹，存放全局安装包，例如 <code>node_global</code> 、 <code>node_cache</code></p></li><li><p>修改npm配置</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">npm config set prefix <span class="string">"D:\Node.js\node_global"</span></span><br><span class="line">npm config set cache <span class="string">"D:\Node.js\node_cache"</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h3><ul><li><code>name</code> 软件包名称</li><li><code>author</code> 软件包作者<ul><li><code>name</code> 作者名</li><li><code>email</code> 作者邮箱</li><li><code>url</code> 作者链接地址</li></ul></li><li><code>contributor</code> 贡献者</li><li><code>homepage</code> 软件包的主页</li><li><code>version</code> 软件包的当前版本</li><li><code>license</code> 软件包的许可证</li><li><code>keywords</code> 软件包功能关键字</li><li><code>description</code> 软件包的简短描述</li><li><code>repository</code> 此程序包仓库地址<ul><li><code>type</code> 仓库类型</li><li><code>url</code> 仓库地址</li></ul></li><li><code>main</code> 软件包的入口点</li><li><code>private</code> 是否有私有软件</li><li><code>scripts</code> 定义一组可以运行的node脚本</li><li><code>dependencies</code> 设置作为依赖安装的软件包</li><li><code>devDependencies</code> 设置作为开发依赖安装的软件包</li><li><code>engines</code> 设置此软件包要运行的node.js的版本</li><li><code>browserslist</code> 设置浏览器支持版本</li></ul><h3 id="软件包版本控制"><a href="#软件包版本控制" class="headerlink" title="软件包版本控制"></a>软件包版本控制</h3><p>使用semver(语义版本控制)，所有的版本都有3个数字，第一个是主版本，第二个是次版本，第三个事补丁版本</p><ul><li><code>~</code> 只更新补丁版本</li><li><code>^</code> 更新次版本和补丁版本</li><li><code>*</code> 接受所有版本更新</li><li><code>latest</code> 使用可用的最新版本</li><li><code>无符号</code> 仅接受指定的版本</li></ul><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Node基础</category>
      </categories>
      <tags>
        <tag>Node</tag>
      </tags>
  </entry>
  <entry>
    <title>Node基础-走进NodeJs</title>
    <url>/archives/ccfee0eb.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Node.js-走进Node.js。</p><a id="more"></a><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>Node.js 是一个开源与跨平台的 JavaScript 单线程且非阻塞的运行环境。即Node.js 是一个可以在服务端运行的JavaScript。</p><ul><li>Node.js的本质是一个JavaScipt的解析器</li><li>Node.js是JavaScript的运行环境，注意，Node本身不是web服务器</li><li>Node.js是一个服务器程序</li><li>Node.js本身使用的是V8引擎</li></ul><h3 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h3><ul><li><p>为了提供高性能的Web服务</p></li><li><p>I/O性能强大</p></li><li><p>事件处理机制完善</p></li><li><p>天然能够处理DOM</p></li></ul><h3 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h3><p>Node.js上的应用可以使用JavaScript开发，这样方便前端人员。Node.js的I/O操作时非阻塞式的，比起传统的服务器（e.g. tomcat）这种阻塞式的更有优势，换句话说：最大的优势是借助JavaScript天生的事件驱动机制和V8高性能引擎，是编写高性能Web服务器轻而易举。</p><p>适合场景如下：</p><ul><li>处理大流量数据</li><li>适合实时交互的应用</li><li>完美支持对象数据库</li><li>异步处理大量并发连接</li></ul><h3 id="Node-js与浏览器的差异"><a href="#Node-js与浏览器的差异" class="headerlink" title="Node.js与浏览器的差异"></a>Node.js与浏览器的差异</h3><ol><li>在浏览器中，大多数做的是与DOM或其他Web平台API（e.g. Cookies）进行交互，而在Node.js中是不存在的，因为不存在 <code>document</code>、<code>window</code>等对象，但是通过其模块API,可以做到浏览器做不到的能力（e.g. 文件系统访问等功能）</li><li>在Node.js中，可以控制运行环境，比如使用统一的ES6规范的JavaScript，而不同浏览器需要不同的版本去支持或者使用Babel将代码转换为ES5兼容的代码，才能解析</li></ol><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>中文地址：<a href="http://nodejs.cn/download/" target="_blank" rel="noopener external nofollow noreferrer">http://nodejs.cn/download/</a></p><h3 id="升级"><a href="#升级" class="headerlink" title="升级"></a>升级</h3><p>比如，我windows系统上之前安装过的node的版本号为：v11.14.0，现在想升级到最新，如何处理？</p><p>windows上只能下载最新的安装包，覆盖升级。</p><h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><ul><li><code>node -v</code> 查看node版本</li><li><code>node app.js</code> 运行目录下的 <code>app.js</code> 文件</li><li><code>.exit</code> 或者 2次 <code>ctrl + c</code> 退出</li><li><code>node</code> 进入node环境</li></ul><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">e: <span class="comment"># 进入到E盘根目录</span></span><br><span class="line">md Node <span class="comment"># 新建Node目录</span></span><br><span class="line">cd Node <span class="comment"># 进入到Node目录下</span></span><br><span class="line">echo console.log(<span class="string">"hello world"</span>) &gt; hello.js <span class="comment"># 创建内容为 hello world 的js文件</span></span><br></pre></td></tr></table></figure><p>如果是已有文件再操作：</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">cd e: <span class="comment"># 切换到E盘根目录</span></span><br><span class="line">cd Node <span class="comment"># 进入到Node目录下</span></span><br><span class="line">del hello.js <span class="comment"># 删除hello.js文件</span></span><br><span class="line">dir <span class="comment"># 查看文件列表</span></span><br><span class="line">cd ../</span><br><span class="line">rd Node <span class="comment"># 删除文件目录</span></span><br></pre></td></tr></table></figure><h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// hello.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入http模块</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建http server,并传入回调函数</span></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="comment">// 将HTTP响应200写入response,同时设置Content-Type</span></span><br><span class="line">	response.writeHead(<span class="number">200</span>, &#123; <span class="string">"Content-Type"</span>: <span class="string">"text/html"</span> &#125;);</span><br><span class="line">	<span class="comment">// 将HTTP响应的HTML内容写入response</span></span><br><span class="line">	response.end(<span class="string">"hello world!"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 让让服务监听8086端口</span></span><br><span class="line">server.listen(<span class="number">8086</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"Server is running"</span>);</span><br></pre></td></tr></table></figure><p>cmd中执行</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">node hello.js</span><br></pre></td></tr></table></figure><p>显示：<code>Server is running</code></p><p>浏览器键入 <code>localhost:8086</code> 页面即可显示 <code>hello world!</code></p><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Node基础</category>
      </categories>
      <tags>
        <tag>Node</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa框架13-路由方法</title>
    <url>/archives/93163f1a.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Koa框架13-路由方法。</p><a id="more"></a><h3 id="路由方法"><a href="#路由方法" class="headerlink" title="路由方法"></a>路由方法</h3><table><thead><tr><th>路由方法</th><th>HTTP方法</th><th>含义</th></tr></thead><tbody><tr><td><code>get()</code></td><td>GET</td><td>参数在url上，一般URLEncoding</td></tr><tr><td><code>post()</code></td><td>POST</td><td>参数在body中，可以用koa-bodyparder/koa-body/koa-better-body获取</td></tr><tr><td><code>put()</code></td><td>PUT</td><td>数据在body中，一般用于文件上传</td></tr><tr><td><code>patch()</code></td><td>PATCH</td><td>数据在body中，一般用于数据更新</td></tr><tr><td><code>delete()</code></td><td>DELETE</td><td>数据在body中，一般用于删除</td></tr><tr><td><code>all()</code></td><td></td><td>出来所有的method请求</td></tr><tr><td><code>use()</code></td><td></td><td>挂载中间件</td></tr></tbody></table><h3 id="语法结构"><a href="#语法结构" class="headerlink" title="语法结构"></a>语法结构</h3><ul><li>字符串：<code>router.get(&quot;/xxx&quot;)</code>，常见写法，指定某个路径</li><li>数组：<code>router.get([&quot;/xxx&quot;, &quot;/xxx/xx&quot;, &quot;xx&quot;])</code> 指定多个路径使用同一个路由</li><li>通配符：<code>router.get(*)</code> <code>*</code>表示所有的路径</li><li>正则：<code>router.get(/^(index)?/)</code> 利用正则匹配对应路径</li></ul><h3 id="all和use"><a href="#all和use" class="headerlink" title="all和use"></a>all和use</h3><ul><li><p><code>all()</code> 表示所有的路径都要经过该路由</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">router.all(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="comment">// do somethings</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p><code>use()</code> 一般用于挂载中间件，本身不能输出，即使设置了 <code>ctx.body</code>，所有的路径请求也会经过此路由</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123; <span class="attr">prefix</span>: <span class="string">"/api"</span> &#125;);</span><br><span class="line"></span><br><span class="line">router</span><br><span class="line">  .use(<span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">    ctx.body = <span class="string">"hello"</span>;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line">app.listen(<span class="number">8077</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"服务器已开启,端口号8077"</span>);</span><br></pre></td></tr></table></figure><p>此代码，浏览器会报404错误，因为 <code>ctx.body</code> 中无输出，但是有一种情况需要注意，假如</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123; <span class="attr">prefix</span>: <span class="string">"/api"</span> &#125;);</span><br><span class="line"></span><br><span class="line">router</span><br><span class="line">  .use(<span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">    ctx.body = <span class="string">"hello"</span>;</span><br><span class="line">  &#125;)</span><br><span class="line">  .get(<span class="string">"/"</span>, <span class="keyword">async</span>  ctx =&gt; &#123;&#125;)</span><br><span class="line"></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line">app.listen(<span class="number">8077</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"服务器已开启,端口号8077"</span>);</span><br></pre></td></tr></table></figure><p>这样写是可以有输出的，说明 <code>use()</code> 需要配合其他路由，<code>use()</code> 可以通过 <code>ctx</code> 对象将内容共享给其他路由。实际的应用场景为：<code>use()</code> 作为隐式的路由去计算一些东西，比如判断用户是否登录等。</p></li></ul><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2框架</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>Node-基本模块</title>
    <url>/archives/947d5421.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Node.js-基本模块：url模块、querystring模块、http模块、fs模块、path模块、events模块、global模块。</p><a id="more"></a><h3 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h3><ul><li>node中所使用的模块化标准是Commonjs的规范，即 <code>module.exports/require</code></li><li>ES6中所使用的模块为新一代规范，即 <code>export/import</code></li></ul><p>Commonjs模块与ES6模块的区别：</p><ul><li>Commonjs输出是一个值的拷贝，而ES6输出的是值的引用</li><li>Commonjs是运行时加载，ES6是编译时输出接口</li></ul><h3 id="自定义模块"><a href="#自定义模块" class="headerlink" title="自定义模块"></a>自定义模块</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// mine.js</span></span><br><span class="line"><span class="keyword">const</span> name = <span class="string">"Devin"</span>;</span><br><span class="line"><span class="keyword">const</span> sayHello = <span class="function">(<span class="params">age = <span class="number">20</span></span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">`Hello, my name is <span class="subst">$&#123;name&#125;</span>, now <span class="subst">$&#123;age&#125;</span> years old`</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; name, sayHello &#125;;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">const</span> mine = <span class="built_in">require</span>(<span class="string">'./mine.js'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(mine.name);</span><br><span class="line"><span class="built_in">console</span>.log(mine.sayHello());</span><br></pre></td></tr></table></figure><p>运行 <code>node main.js</code>，结果如下：</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">Devin</span><br><span class="line">Hello, my name is Devin, now <span class="number">20</span> years old</span><br></pre></td></tr></table></figure><h3 id="url模块"><a href="#url模块" class="headerlink" title="url模块"></a>url模块</h3><p><code>url</code> 模块用于处理与解析URL。注意，使用时不需要引入 <code>url</code> 模块。</p><p><code>new URL</code></p><ul><li><code>href</code> 获取及设置序列化的URL</li><li><code>origin</code> 获取URL的源部分（协议（<code>protocal</code>）+ 主机(<code>host</code>) + 路径(<code>pathname</code>) + 查询(<code>search</code>)）</li><li><code>protocal</code> 获取URL的协议</li><li><code>username</code> 获取URL的用户名</li><li><code>password</code> 获取URL的密码</li><li><code>host</code> 获取URL的主机（主机名(<code>hostname</code>) + 端口(<code>port</code>)）</li><li><code>hostname</code> 获取URL的主机名</li><li><code>port</code> 获取URL的端口</li><li><code>pathname</code> 获取URL的路径</li><li><code>search</code> 获取URL的查询</li><li><code>hash</code> 获取URL的片段</li><li><code>searchParams</code> 获取URL查询参数对象<ul><li><code>get(name)</code> 返回键是<code>name</code>的第一个键值对的值。如果没有对应的键值对，则返回<code>null</code>。</li><li><code>tostring()</code> 返回查询参数序列化后的字符串</li></ul></li></ul><p>举例：比如URL <code>http://user:pass@sub.example.com:8080/p/a/t/h?query=string#hash</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// url.js</span></span><br><span class="line"><span class="keyword">const</span> demoUrl = <span class="string">"http://user:pass@sub.example.com:8080/p/a/t/h?query=string#hash"</span>;</span><br><span class="line"><span class="keyword">const</span> urlObj = <span class="keyword">new</span> URL(demoUrl);</span><br><span class="line"><span class="keyword">const</span> params = urlObj.searchParams;</span><br><span class="line"><span class="built_in">console</span>.log(urlObj);</span><br><span class="line"><span class="built_in">console</span>.log(params.get(<span class="string">"query"</span>))</span><br></pre></td></tr></table></figure><p>运行 <code>node url.js</code>，结果如下：</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">URL &#123;</span><br><span class="line">  href: <span class="string">'http://user:pass@sub.example.com:8080/p/a/t/h?query=string#hash'</span>,</span><br><span class="line">  origin: <span class="string">'http://sub.example.com:8080'</span>,</span><br><span class="line">  protocol: <span class="string">'http:'</span>,</span><br><span class="line">  username: <span class="string">'user'</span>,</span><br><span class="line">  password: <span class="string">'pass'</span>,</span><br><span class="line">  host: <span class="string">'sub.example.com:8080'</span>,</span><br><span class="line">  hostname: <span class="string">'sub.example.com'</span>,</span><br><span class="line">  port: <span class="string">'8080'</span>,</span><br><span class="line">  pathname: <span class="string">'/p/a/t/h'</span>,</span><br><span class="line">  search: <span class="string">'?query=string'</span>,</span><br><span class="line">  searchParams: URLSearchParams &#123; <span class="string">'query'</span> =&gt; <span class="string">'string'</span> &#125;,</span><br><span class="line">  hash: <span class="string">'#hash'</span></span><br><span class="line">&#125;</span><br><span class="line">string</span><br></pre></td></tr></table></figure><h3 id="querystring模块"><a href="#querystring模块" class="headerlink" title="querystring模块"></a>querystring模块</h3><ul><li><code>querystring.parse(str)</code> 解析的URL查询字符串</li><li><code>querystring.stringify(ojb)</code> 序列化URL查询字符串的对象</li></ul><p>结合URL模块，获取url的查询参数：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// url.js</span></span><br><span class="line"><span class="keyword">const</span> queryString = <span class="built_in">require</span>(<span class="string">"querystring"</span>);</span><br><span class="line"><span class="keyword">const</span> demoUrl = <span class="string">"http://user:pass@sub.example.com:8080/p/a/t/h?type=string&amp;name=devin&amp;age=20#hash"</span>;</span><br><span class="line"><span class="keyword">const</span> urlObj = <span class="keyword">new</span> URL(demoUrl);</span><br><span class="line"><span class="keyword">const</span> query = urlObj.searchParams.toString()</span><br><span class="line"><span class="built_in">console</span>.log(queryString.parse(query));</span><br></pre></td></tr></table></figure><p>运行 <code>node url.js</code>，结果如下：</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">[<span class="type">Object</span>: <span class="type">null</span> <span class="type">prototype</span>] &#123; type: <span class="string">'string'</span>, name: <span class="string">'devin'</span>, age: <span class="string">'20'</span> &#125;</span><br></pre></td></tr></table></figure><h3 id="http模块"><a href="#http模块" class="headerlink" title="http模块"></a>http模块</h3><ul><li><code>http.createServer([options][, requestListener])</code> 创建一个web服务</li><li><code>http.request(options[, callback])</code> 发送HTTP请求</li><li><code>response</code><ul><li><code>response.writeHead(statusCode[, statusMessage][, headers])</code> 向请求发送响应头</li><li><code>response.end([data[, encoding]][, callback])</code> 向服务器发出信号，表明已发送所有响应头和主体</li><li><code>response.setHeader(name, value)</code> 设置响应头属性</li><li><code>response.setTimeout(msecs[, callback])</code> 设置响应超时时间及事件</li><li><code>response.statusCode</code> 当使用隐式的响应头时（没有显式地调用 <code>response.writeHead()</code>），此属性控制在刷新响应头时将发送到客户端的状态码</li><li><code>response.statusMessage</code> 当使用隐式的响应头时（没有显式地调用 <code>response.writeHead()</code>），此属性控制在刷新响应头时将发送到客户端的状态消息</li></ul></li></ul><h3 id="fs模块"><a href="#fs模块" class="headerlink" title="fs模块"></a>fs模块</h3><ul><li><code>fs.promises.mkdir(path[, options])</code> 异步地创建目录，然后在成功时解决 <code>Promise</code>，且不带参数</li><li><code>fs.promises.opendir(path[, options])</code> 异步地打开目录</li><li><code>fs.promises.open(path[, flags[, mode]])</code> 异步地打开文件并返回一个 <code>Promise</code></li><li><code>fs.promises.readFile(path[, options])</code> 异步地读取文件的全部内容</li><li><code>fs.createReadStream(path[, options])</code></li><li><code>fs.promises.access(path[, mode])</code> 测试用户对 <code>path</code> 指定的文件或目录的权限</li><li><code>fs.promises.writeFile(file, datap[, options])</code> 异步地将数据写入到一个文件，如果文件已存在则覆盖该文件</li><li><code>fs.promises.appendFile(path, data[, options])</code> 异步地追加数据到文件，如果文件尚不存在则创建文件</li><li><code>fs.promises.stats(path[, options])</code> 读取文件信息</li></ul><h3 id="path模块"><a href="#path模块" class="headerlink" title="path模块"></a>path模块</h3><ul><li><code>path.resolve([..paths])</code> 将路径或路径片段的序列解析为绝对路径</li><li><code>path.join([...paths])</code> 将所有给定的 <code>path</code> 片段连接到一起</li><li><code>path.dirname(path)</code> 返回 <code>path</code> 文件的父文件夹</li><li><code>path.basename(path)</code> 返回 <code>path</code> 文件名</li><li><code>path.extname(path)</code> 返回 <code>path</code> 的扩展名</li><li><code>path.parse(path)</code> 返回一个对象，其属性表示 <code>path</code> 的有效元素（<code>dir</code>、<code>root</code>、<code>base</code>、<code>name</code>、<code>ext</code>）</li></ul><h3 id="events模块"><a href="#events模块" class="headerlink" title="events模块"></a>events模块</h3><ul><li><code>eventEmitter.on()</code> 注册监听器</li><li><code>eventEmitter.emit()</code> 触发事件</li><li><code>eventEmitter.once()</code> 注册最多只可调用一次的监听器</li><li><code>eventEmitter.off()</code> 移除监听器</li><li><code>eventEmitter.removeAllListeners()</code> 移除所有监听器</li></ul><h3 id="os模块"><a href="#os模块" class="headerlink" title="os模块"></a>os模块</h3><ul><li><code>os.hostname()</code> 主机名</li><li><code>os.networkInterfaces()</code> 网络接口的详细信息</li></ul><h3 id="global模块"><a href="#global模块" class="headerlink" title="global模块"></a>global模块</h3><ul><li><code>——dirname</code> 当前模块的目录名</li><li><code>——filename</code> 当前模块的文件名</li><li><code>module</code> <code>module.exports</code> 用于指定一个模块所导出的内容，即可以通过 <code>require()</code> 访问的内容</li><li><code>require()</code> 用于引入模块、 <code>JSON</code>、或本地文件。 可以从 <code>node_modules</code> 引入模块</li><li><code>URL</code> 新的URL类</li><li><code>URLSearchParams</code> 新的URL参数解析类</li><li><code>process</code> 进程对象</li><li><code>console</code> 打印</li></ul><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Node基础</category>
      </categories>
      <tags>
        <tag>Node</tag>
      </tags>
  </entry>
  <entry>
    <title>Koa框架12-Ctx属性</title>
    <url>/archives/e56e4cc1.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录Koa框架12-Ctx属性。</p><a id="more"></a><h3 id="request属性"><a href="#request属性" class="headerlink" title="request属性"></a>request属性</h3><table><thead><tr><th>属性</th><th>说明</th><th>可能的值</th></tr></thead><tbody><tr><td>method</td><td>请求方法</td><td><code>GET</code></td></tr><tr><td>url</td><td>完整请求路径</td><td><code>/xxx/xxx/api?xxx=xxx</code></td></tr><tr><td>path</td><td>路径部分</td><td><code>/xxx/xxx</code></td></tr><tr><td>query</td><td>get参数</td><td><code>{type: &quot;a&quot;, p: 12}</code></td></tr><tr><td>querystring</td><td>get参数字符串</td><td><code>?type=a&amp;p=12</code></td></tr><tr><td>host</td><td>域名+端口</td><td><code>localhost:8080</code></td></tr><tr><td>hostname</td><td>域名</td><td><code>localhost</code></td></tr><tr><td>protocol</td><td>协议</td><td><code>http</code></td></tr><tr><td>secure</td><td>是否安全协议</td><td><code>false</code></td></tr><tr><td>ip</td><td>访客ip地址</td><td><code>xx.xx.xx.xx</code></td></tr><tr><td>origin</td><td>域:协议+域名+端口</td><td><code>http://localhost/:8080</code></td></tr></tbody></table><h3 id="koa发起请求"><a href="#koa发起请求" class="headerlink" title="koa发起请求"></a>koa发起请求</h3><p>需求：根据 <code>ip</code> 获取 ip地址信息</p><p>api：<code>http://ip-api.com/json/${ip}</code></p><h4 id="原生版处理"><a href="#原生版处理" class="headerlink" title="原生版处理"></a>原生版处理</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// fetch.js</span></span><br><span class="line"><span class="comment">// 封装请求模块</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fetch = <span class="function">(<span class="params">url</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> req = http.get(url, res =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123;</span><br><span class="line">        statusCode</span><br><span class="line">      &#125; = res;</span><br><span class="line">      res.setEncoding(<span class="string">'utf8'</span>);</span><br><span class="line">      <span class="keyword">let</span> rawData = <span class="string">''</span>;</span><br><span class="line">      res.on(<span class="string">'data'</span>, (chunk) =&gt; &#123;</span><br><span class="line">        rawData += chunk;</span><br><span class="line">      &#125;);</span><br><span class="line">      res.on(<span class="string">'end'</span>, () =&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> parsedData = <span class="built_in">JSON</span>.parse(rawData);</span><br><span class="line">          resolve(parsedData);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">          <span class="built_in">console</span>.error(e.message);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = fetch;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123; <span class="attr">prefix</span>: <span class="string">"/api"</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> fetch = <span class="built_in">require</span>(<span class="string">"../utils/fetch"</span>);</span><br><span class="line"><span class="keyword">const</span> url = <span class="string">`http://ip-api.com/json/218.17.161.131`</span></span><br><span class="line">router</span><br><span class="line">  .get(<span class="string">"/"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    ctx.body = <span class="string">"get请求触发下载"</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> result = <span class="keyword">await</span> fetch(url)</span><br><span class="line">      ctx.body = result</span><br><span class="line">    &#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(&#123;err&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;)</span><br><span class="line">  .post(<span class="string">"/"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    ctx.body = <span class="string">"post请求"</span>;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line">app.listen(<span class="number">8077</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"服务器已开启,端口号8077"</span>);</span><br></pre></td></tr></table></figure><p>请求结果如下：</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"status"</span>: <span class="string">"success"</span>,</span><br><span class="line">  <span class="attr">"country"</span>: <span class="string">"China"</span>,</span><br><span class="line">  <span class="attr">"countryCode"</span>: <span class="string">"CN"</span>,</span><br><span class="line">  <span class="attr">"region"</span>: <span class="string">"GD"</span>,</span><br><span class="line">  <span class="attr">"regionName"</span>: <span class="string">"Guangdong"</span>,</span><br><span class="line">  <span class="attr">"city"</span>: <span class="string">"Shenzhen"</span>,</span><br><span class="line">  <span class="attr">"zip"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"lat"</span>: <span class="number">22.5333</span>,</span><br><span class="line">  <span class="attr">"lon"</span>: <span class="number">114.1333</span>,</span><br><span class="line">  <span class="attr">"timezone"</span>: <span class="string">"Asia/Shanghai"</span>,</span><br><span class="line">  <span class="attr">"isp"</span>: <span class="string">"Chinanet"</span>,</span><br><span class="line">  <span class="attr">"org"</span>: <span class="string">"Chinanet GD"</span>,</span><br><span class="line">  <span class="attr">"as"</span>: <span class="string">"AS4134 CHINANET-BACKBONE"</span>,</span><br><span class="line">	<span class="attr">"query"</span>: <span class="string">"218.17.161.131"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="axios处理"><a href="#axios处理" class="headerlink" title="axios处理"></a>axios处理</h4><p>当然，更好的推荐axios处理请求了。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123; <span class="attr">prefix</span>: <span class="string">"/api"</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">"axios"</span>);</span><br><span class="line"><span class="keyword">const</span> url = <span class="string">`http://ip-api.com/json/218.17.161.131`</span>;</span><br><span class="line"></span><br><span class="line">router</span><br><span class="line">  .get(<span class="string">"/"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> axios.get(url);</span><br><span class="line">      ctx.body = data;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  .post(<span class="string">"/"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    ctx.body = <span class="string">"post请求"</span>;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line">app.listen(<span class="number">8077</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"服务器已开启,端口号8077"</span>);</span><br></pre></td></tr></table></figure><div class="note warning"><p>需要注意的是，不能在 <code>axios</code> 的 <code>then</code> 链中使用 <code>ctx</code> 赋值，亲测无效，推荐使用 <code>async/await</code> 写法。</p></div><h3 id="全局属性"><a href="#全局属性" class="headerlink" title="全局属性"></a>全局属性</h3><p><code>ctx</code> 作为上下文对象，可以用于共享参数，官方提供了2个全局属性：</p><ul><li><code>context</code></li><li><code>state</code></li></ul><h4 id="context"><a href="#context" class="headerlink" title="context"></a>context</h4><p><code>context</code> 是作用在 <code>app</code> 这个对象上属性，即Koa的一个实例，它类似js中对象的 <code>prototype</code> 属性，在 <code>context</code> 上添加的属性，可以通过 <code>ctx</code> 对象调用。</p><ul><li><code>context</code> 上一般添加一些全局的常用方法或属性，如封装的 <code>axios</code> 请求等。</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">"koa-router"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123; <span class="attr">prefix</span>: <span class="string">"/api"</span> &#125;);</span><br><span class="line"></span><br><span class="line">app.context.a = <span class="string">"hello"</span>;</span><br><span class="line">router</span><br><span class="line">  .get(<span class="string">"/"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(ctx.a); <span class="comment">// =&gt; "hello"</span></span><br><span class="line">    ctx.body = <span class="string">"get请求"</span>;</span><br><span class="line">  &#125;)</span><br><span class="line">  .post(<span class="string">"/"</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    ctx.body = <span class="string">"post请求"</span>;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line">app.listen(<span class="number">8077</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"服务器已开启,端口号8077"</span>);</span><br></pre></td></tr></table></figure><h4 id="state"><a href="#state" class="headerlink" title="state"></a>state</h4><p><code>state</code> 是作用在 <code>ctx</code> 对象上的，也就是 <code>ctx</code> 的属性。其不同于 <code>context</code>,<code>state</code> 是一个空对象，不用担心属性覆盖问题。常用与特性检测场景：</p><ul><li><p>语言检测，检测客户端能支持什么样的语言，可以用来做全球化多语言适配</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> lang = ctx.acceptsLanguages([<span class="string">"zh"</span>, <span class="string">"ja"</span>, <span class="string">"en"</span>, <span class="string">"fr"</span>]);</span><br></pre></td></tr></table></figure></li><li><p>数据类型检测，检测浏览器支持的最佳网页类型</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> type = ctx.accepts(<span class="string">"html"</span>, <span class="string">"xhtml"</span>, <span class="string">"jpg"</span>);</span><br></pre></td></tr></table></figure></li><li><p>编码检测，检测浏览器支持什么编码</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> coding = ctx.acceptsEncodings(<span class="string">"gzip"</span>, <span class="string">"deflate"</span>, <span class="string">"bz"</span>);</span><br></pre></td></tr></table></figure></li><li><p>字符集检测，用于检测浏览器支持什么样的字符格式</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> charset = ctx.acceptsCharsets(<span class="string">"utf-8"</span>, <span class="string">"gb2312"</span>, <span class="string">"big5"</span>)</span><br></pre></td></tr></table></figure></li></ul><!-- rebuild by neat -->]]></content>
      <categories>
        <category>服务端</category>
        <category>Node</category>
        <category>Koa2框架</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>HTTP-各版本区别</title>
    <url>/archives/63110c3b.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录HTTP1.0、HTTP1.1、HTTP2.0的区别。</p><a id="more"></a><h3 id="HTTP的基本优化"><a href="#HTTP的基本优化" class="headerlink" title="HTTP的基本优化"></a>HTTP的基本优化</h3><p>影响一个HTTP网络请求的因素主要有两个：带宽和延迟</p><ul><li><strong>带宽</strong>：现在网络基础建设已经使得带宽得到极大的提升，不再担心带宽影响网速</li><li><strong>延迟</strong>：<ul><li><strong>浏览器阻塞</strong>。浏览器因为一些原因阻塞请求。浏览器对于同一域名，同时只能有4个连接（不同浏览器内核可能有差异），超过浏览器最大连接数限制，后续请求就会被阻塞。</li><li><strong>DNS查询</strong>。浏览器需要指定目标服务器的IP才能建立连接。将域名解析为IP的这个系统就是DNS。这个通常可以利用DNS缓存结果来达到减少时间。</li><li><strong>建立连接</strong>。HTTP是基于TCP协议的，浏览器最快也要在第三次握手时才能捎带HTTP请求报文，达到真正的建立连接，但是这个连接无法复用会导致每次请求都经历三次握手和慢启动。三次握手在高延迟的场景下影响比较明显，慢启动则对文件类大请求影响较大。</li></ul></li></ul><h3 id="HTTP1-1和HTTP1-0区别"><a href="#HTTP1-1和HTTP1-0区别" class="headerlink" title="HTTP1.1和HTTP1.0区别"></a>HTTP1.1和HTTP1.0区别</h3><ol><li><strong>缓存处理</strong>。在HTTP1.0中主要使用header里的 <code>If-Modified-Since</code>，<code>Expires</code> 来做为缓存判断的标准，HTTP1.1则引入了更多的缓存控制策略例如 <code>Entity tag</code>，<code>If-Unmodified-Since</code>，<code>If-Match</code>，<code>If-None-Match</code> 等更多可供选择的缓存头来控制缓存策略。</li><li><strong>带宽优化及网络连接的使用</strong>。HTTP1.0中，存在一些浪费带宽的现象，例如客户端只是需要某个对象的一部分，而服务器却将整个对象送过来了，并且不支持断点续传功能，HTTP1.1则在请求头引入了range头域，它允许只请求资源的某个部分，即返回码是206（Partial Content），这样就方便了开发者自由的选择以便于充分利用带宽和连接。</li><li><strong>错误通知的管理</strong>。在HTTP1.1中新增了24个错误状态响应码，如409（Conflict）表示请求的资源与资源的当前状态发生冲突；410（Gone）表示服务器上的某个资源被永久性的删除。</li><li><strong>Host头处理</strong>。在HTTP1.0中认为每台服务器都绑定一个唯一的IP地址，因此，请求消息中的URL并没有传递主机名（hostname）。但随着虚拟主机技术的发展，在一台物理服务器上可以存在多个虚拟主机（Multi-homed Web Servers），并且它们共享一个IP地址。HTTP1.1的请求消息和响应消息都应支持Host头域，且请求消息中如果没有Host头域会报告一个错误（400 Bad Request）。</li><li><strong>长连接</strong>。HTTP 1.1支持长连接（PersistentConnection）和请求的流水线（Pipelining）处理，在一个TCP连接上可以传送多个HTTP请求和响应，减少了建立和关闭连接的消耗和延迟，在HTTP1.1中默认开启 <code>Connection： keep-alive</code>，一定程度上弥补了HTTP1.0每次请求都要创建连接的缺点。</li></ol><h3 id="HTTPS和HTTP区别"><a href="#HTTPS和HTTP区别" class="headerlink" title="HTTPS和HTTP区别"></a>HTTPS和HTTP区别</h3><ul><li>HTTP协议运行在TCP之上，所有传输的内容都是明文，HTTPS运行在SSL/TLS之上，SSL/TLS运行在TCP之上，所有传输的内容都经过加密的。</li><li>HTTP和HTTPS使用的是完全不同的连接方式，用的端口也不一样，前者是80，后者是443。</li></ul><blockquote><p>HTTP: HTTP -&gt; TCP</p><p>HTTPS: HTTP -&gt; SSL/TLS(加密，解密) -&gt; TCP</p></blockquote><h3 id="HTTP2-0和HTTP1-x区别"><a href="#HTTP2-0和HTTP1-x区别" class="headerlink" title="HTTP2.0和HTTP1.x区别"></a>HTTP2.0和HTTP1.x区别</h3><ol><li><strong>新的二进制格式</strong>。HTTP1.x的解析是基于文本。基于文本协议的格式解析存在天然缺陷，文本的表现形式有多样性，要做到健壮性考虑的场景必然很多，二进制则不同，只认0和1的组合。基于这种考虑HTTP2.0的协议解析决定采用二进制格式，实现方便且健壮。</li><li><strong>多路复用</strong>。即连接共享，即每一个request都是是用作连接共享机制的。一个request对应一个id，这样一个连接上可以有多个request，每个连接的request可以随机的混杂在一起，接收方可以根据request的 id将request再归属到各自不同的服务端请求里面。</li><li><strong>header压缩</strong>。HTTP1.x的header带有大量信息，而且每次都要重复发送，HTTP2.0使用encoder来减少需要传输的header大小，通讯双方各自cache一份header fields表，既避免了重复header的传输，又减小了需要传输的大小。</li><li><strong>服务器推送</strong>。还没有收到浏览器的请求，服务器就把各种资源推送给浏览器。例如我的网页有一个sytle.css的请求，在客户端收到sytle.css数据的同时，服务端会将sytle.js的文件推送给客户端，当客户端再次尝试获取sytle.js时就可以直接从缓存中获取到，不用再发请求了。</li></ol><h3 id="HTTP2-0的多路复用"><a href="#HTTP2-0的多路复用" class="headerlink" title="HTTP2.0的多路复用"></a>HTTP2.0的多路复用</h3><ul><li>HTTP/1.0：一次请求-响应，建立一个连接，用完关闭；每一个请求都要建立一个连接</li><li>HTTP/1.1：同步执行，若干个请求排队串行化单线程处理，后面的请求等待前面请求的返回才能执行，一旦有某个请求超时，后续的请求只能被阻塞</li><li>HTTP/2.0：异步执行，多个请求可同时在一个连接上并行执行。某个请求任务超时，不会影响到其他连接的正常执行</li></ul><p><img data-src="../../assets/20200603153700.png" alt=""></p><h3 id="服务器推送是什么"><a href="#服务器推送是什么" class="headerlink" title="服务器推送是什么"></a>服务器推送是什么</h3><p>服务器推送能把客户端所需要的资源伴随着 <code>index.html</code> 一起发送到客户端，省去了客户端重复请求的步骤。正因为没有发起请求，建立连接等操作，所以静态资源通过服务端推送的方式可以极大地提升速度。</p><ul><li><p>普通客户端请求过程</p><p><img data-src="../../assets/20200603155236.png" alt=""></p></li><li><p>服务器推送的过程</p><p><img data-src="../../assets/20200603155342.png" alt=""></p></li></ul><h3 id="为什么要头部压缩"><a href="#为什么要头部压缩" class="headerlink" title="为什么要头部压缩"></a>为什么要头部压缩</h3><p>假定一个页面有100个资源需要加载，而每一次请求都有1kb的消息头，则至少需要消耗100kb来获取这些消息头。HTTP2.0可以维护一个字典，差量更新HTTP头部，大大降低因头部传输产生的流量。</p><h3 id="HTTP2-0多路复用有多好"><a href="#HTTP2-0多路复用有多好" class="headerlink" title="HTTP2.0多路复用有多好"></a>HTTP2.0多路复用有多好</h3><p>HTTP性能优化的关键不在于高带宽，而是低延迟。HTTP/2 通过让所有数据流共用同一个连接，可以更有效地使用TCP连接，让高带宽也能真正地服务于HTTP的性能提升。</p><!-- rebuild by neat -->]]></content>
      <categories>
        <category>HTTP</category>
      </categories>
      <tags>
        <tag>HTTP</tag>
      </tags>
  </entry>
  <entry>
    <title>音乐小程序云07-播放器一</title>
    <url>/archives/b3712307.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录小程序云开发学习 - 播放器。</p><a id="more"></a><h3 id="设置本地数据"><a href="#设置本地数据" class="headerlink" title="设置本地数据"></a>设置本地数据</h3><p>与之前歌单详情列表一致，在点击某一首歌曲时，即把这首歌的信息存储到stroage中。</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--pages/playDetails/playDetails.wxml--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"music-list"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:for</span>=<span class="string">"&#123;&#123;playDetails.tracks&#125;&#125;"</span> <span class="attr">wx:key</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">c-music-item</span> <span class="attr">index</span>=<span class="string">"&#123;&#123;index + 1&#125;&#125;"</span> <span class="attr">musicInfo</span>=<span class="string">"&#123;&#123;item.al&#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"music-item"</span> <span class="attr">bindtap</span>=<span class="string">"goToMusicPlay"</span> <span class="attr">musicId</span>=<span class="string">"&#123;&#123;musicId&#125;&#125;"</span> <span class="attr">data-id</span>=<span class="string">"&#123;&#123;item.al.id&#125;&#125;"</span> <span class="attr">data-data</span>=<span class="string">"&#123;&#123;item.al&#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">c-music-item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// pages/playDetails/playDetails.js</span></span><br><span class="line">goToMusicPlay(event) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      dataset</span><br><span class="line">    &#125; = event.currentTarget</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      id,</span><br><span class="line">      data</span><br><span class="line">    &#125; = dataset</span><br><span class="line">    wx.setStorageSync(<span class="string">'musicId'</span>, id)</span><br><span class="line">    wx.setStorageSync(<span class="string">'musicData'</span>, data)</span><br><span class="line">    <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">      musicId: id</span><br><span class="line">    &#125;)</span><br><span class="line">    wx.navigateTo(&#123;</span><br><span class="line">      url: <span class="string">`/pages/musicPlay/musicPlay?id=<span class="subst">$&#123;id&#125;</span>`</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><p>然后在播放器页面，获取数据</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// pages/musicPlay/musicPlay.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 页面的初始数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  data: &#123;</span><br><span class="line">    musicData: <span class="string">""</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面加载</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> onLoad(options) &#123;</span><br><span class="line">    wx.setNavigationBarTitle(&#123;</span><br><span class="line">      title: <span class="string">'播放器'</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.log(options)</span><br><span class="line">    <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">      musicData: wx.getStorageSync(<span class="string">'musicData'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--pages/musicPlay/musicPlay.wxml--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"music-container"</span> <span class="attr">style</span>=<span class="string">"background: url(&#123;&#123;musicData.picUrl&#125;&#125;) center/cover no-repeat"</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"mask"</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"player-info"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 封面信息 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"play-disc"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">"play-img"</span> <span class="attr">src</span>=<span class="string">"&#123;&#123;musicData.picUrl&#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* pages/musicPlay/musicPlay.wxss */</span></span><br><span class="line"><span class="selector-class">.music-container</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">z-index</span>: -<span class="number">1</span>;</span><br><span class="line">  <span class="attribute">filter</span>: <span class="built_in">blur</span>(<span class="number">40</span>rpx);</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0.5</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.mask</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#222</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">z-index</span>: -<span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.player-info</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.play-disc</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">592</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">592</span>rpx;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">"https://s3.music.126.net/mobile-new/img/disc.png?d3bdd1080a72129346aa0b4b4964b75f="</span>) center/contain no-repeat;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">140</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.play-disc</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">''</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">192</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">274</span>rpx;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: -<span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">340</span>rpx;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">"https://s3.music.126.net/m/s/img/needle.png?702cf6d95f29e2e594f53a3caab50e12"</span>) center/contain no-repeat;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">rotate</span>(-<span class="number">18deg</span>);</span><br><span class="line">  <span class="attribute">transform-origin</span>: <span class="number">24</span>rpx <span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">transition</span>: transform .<span class="number">5s</span> ease;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.play</span><span class="selector-class">.player-disc</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0deg</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.play-img</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">368</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">368</span>rpx;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="引入字体图标"><a href="#引入字体图标" class="headerlink" title="引入字体图标"></a>引入字体图标</h3><ol><li><p>在 <a href="https://www.iconfont.cn/" target="_blank" rel="noopener external nofollow noreferrer">iconfont</a> 中先预先选择好要用到的图标，然后在Font class 中生成代码</p></li><li><p>复制链接在浏览器新标签页打开</p></li><li><p>在 <code>style</code> 目录下新建 <code>iconfont.wxss</code> 文件</p></li><li><p>编辑 <code>iconfont.wxss</code>，将生成的样式复制进去</p></li><li><p>在根目录下的 <code>app.wxss</code> 中全局引入此文件</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**app.wxss**/</span></span><br><span class="line"><span class="keyword">@import</span> <span class="string">"./style/iconfont.wxss"</span></span><br></pre></td></tr></table></figure></li><li><p>在页面中使用</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 播放控制 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"play-control"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">"iconfont musicskip--back"</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">"iconfont musicplay--outline"</span> <span class="attr">wx:if</span>=<span class="string">"&#123;&#123;true&#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">"iconfont musicpause--outline"</span> <span class="attr">wx:else</span> &gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">"iconfont musicskip--forward"</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="静态布局"><a href="#静态布局" class="headerlink" title="静态布局"></a>静态布局</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// pages/musicPlay/musicPlay.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 页面的初始数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  data: &#123;</span><br><span class="line">    musicData: <span class="string">""</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面加载</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> onLoad(options) &#123;</span><br><span class="line">    wx.setNavigationBarTitle(&#123;</span><br><span class="line">      title: <span class="string">'播放器'</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.log(options)</span><br><span class="line">    <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">      musicData: wx.getStorageSync(<span class="string">'musicData'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--pages/musicPlay/musicPlay.wxml--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"music-container"</span> <span class="attr">style</span>=<span class="string">"background: url(&#123;&#123;musicData.picUrl&#125;&#125;) center/cover no-repeat"</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"mask"</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"player-info"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 封面信息 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"play-disc"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">"play-img"</span> <span class="attr">src</span>=<span class="string">"&#123;&#123;musicData.picUrl&#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 播放控制 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"play-control"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">"iconfont musicskip--back"</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">"iconfont musicplay--outline"</span> <span class="attr">wx:if</span>=<span class="string">"&#123;&#123;true&#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">"iconfont musicpause--outline"</span> <span class="attr">wx:else</span> &gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">"iconfont musicskip--forward"</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* pages/musicPlay/musicPlay.wxss */</span></span><br><span class="line"><span class="selector-class">.music-container</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">z-index</span>: -<span class="number">1</span>;</span><br><span class="line">  <span class="attribute">filter</span>: <span class="built_in">blur</span>(<span class="number">40</span>rpx);</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0.5</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.mask</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#222</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">z-index</span>: -<span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.player-info</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.play-disc</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">592</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">592</span>rpx;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">"https://s3.music.126.net/mobile-new/img/disc.png?d3bdd1080a72129346aa0b4b4964b75f="</span>) center/contain no-repeat;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">140</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.play-disc</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">''</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">192</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">274</span>rpx;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: -<span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">340</span>rpx;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">"https://s3.music.126.net/m/s/img/needle.png?702cf6d95f29e2e594f53a3caab50e12"</span>) center/contain no-repeat;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">rotate</span>(-<span class="number">18deg</span>);</span><br><span class="line">  <span class="attribute">transform-origin</span>: <span class="number">24</span>rpx <span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">transition</span>: transform .<span class="number">5s</span> ease;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.play</span><span class="selector-class">.player-disc</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0deg</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.play-img</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">368</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">368</span>rpx;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.play-control</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">8%</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.play-control</span> <span class="selector-class">.iconfont</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fefefe</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.musicskip--forward</span>,</span><br><span class="line"><span class="selector-class">.musicskip--back</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">80</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.musicplay--outline</span>,</span><br><span class="line"><span class="selector-class">.musicpause--outline</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">120</span>rpx;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">50</span>rpx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
      <categories>
        <category>小程序</category>
        <category>音乐小程序</category>
      </categories>
      <tags>
        <tag>小程序</tag>
        <tag>微信小程序</tag>
        <tag>音乐小程序</tag>
      </tags>
  </entry>
  <entry>
    <title>HTTP-缓存机制</title>
    <url>/archives/bff68fd9.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录HTTP协议缓存机制的详解。</p><a id="more"></a><h3 id="缓存的分类"><a href="#缓存的分类" class="headerlink" title="缓存的分类"></a>缓存的分类</h3><ul><li>服务端缓存（Ngnix、Apache）</li><li>客户端缓存（Web browser）</li></ul><p><strong>服务端缓存</strong>又分为代理服务器缓存和反向服务器缓存(也叫网关缓存，比如Nginx反向代理、Squid等)，其实广泛使用的CND也是一种服务器缓存，目的都是让用户的请求走“捷径”，并且都是缓存图片、文件等静态资源。</p><p><strong>客户端缓存</strong>一般指的是浏览器缓存，目的就是加速各种静态资源的访问。浏览器缓存控制机制有两种：HTML Meta标签、HTTP头信息。</p><ul><li>强缓存</li><li>协商缓存</li></ul><p><strong>强缓存</strong>是指从浏览器本地直接获取缓存文件，不发送请求到服务器。服务端第一次响应请求时，告知浏览器是否可以存在浏览器本地，设置时间，时间之内可以从浏览器本地获取该资源。状态码为： <code>200(from cache)</code></p><p><strong>协商缓存</strong>是指浏览器发送请求后，服务器根据请求头部的一些缓存相关参数判断是否命中协商缓存，如果命中则使用浏览器本地缓存。比如，服务器判断请求资源是否有更新，如果决策响应请求状态码为200（有更新），则会进行新数据返回并缓存协商，则返回响应结果；如果决策响应请求状态码为304（无更新，协商缓存），告知浏览器直接使用本地缓存数据。状态码为： <code>304(not modified)</code></p><div class="note warning no-icon"><ul><li><strong>缓存协商</strong> 和 <strong>协商缓存</strong> 需要注意，协商缓存指的是状态码为 <code>304(not modified)</code>，通过服务器来告知缓存是否可用，而缓存协商指的是服务器在响应中通过设置相关HTTP头信息来控制缓存的过程。</li><li><strong>强缓存</strong> 和 <strong>协商缓存</strong> 都是从浏览器本地缓存中获取资源，不同的是，强缓存是直接从缓存中取数据，而协商缓存需要发送请求到服务器，通过服务器来告知缓存是否可用。</li></ul></div><h3 id="HTML-Meta控制缓存"><a href="#HTML-Meta控制缓存" class="headerlink" title="HTML-Meta控制缓存"></a>HTML-Meta控制缓存</h3><p>浏览器缓存机制，其实主要就是HTTP协议定义的缓存机制（如：Expires；Cache-control等）。但是也有非HTTP协议定义的缓存机制，如使用HTML Meta标签，Web开发者可以在HTML页面的 <code>&lt;head&gt;</code> 节点中加入 <code>&lt;meta&gt;</code> 标签，代码如下：</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Pragma"</span> <span class="attr">content</span>=<span class="string">"no-cache"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>上述代码用于设定当前页面不被缓存，每次访问都需要去服务器拉取。 这样设定，访问者将无法脱机浏览。使用上很简单，但只有部分浏览器可以支持，而且所有缓存代理服务器都不支持，因为代理不解析HTML内部本身。所以，Meta标签控制这种方法不会广泛使用。</p><h3 id="HTTP头信息控制缓存"><a href="#HTTP头信息控制缓存" class="headerlink" title="HTTP头信息控制缓存"></a>HTTP头信息控制缓存</h3><p>HTTP协议定义的缓存机制才是被广泛应用的一种客户端缓存机制。</p><p><img data-src="../../assets/20200612113452.png" alt=""></p><p>上面为浏览器第一次、再次请求的流程图。</p><h3 id="Pragma策略-缓存开关"><a href="#Pragma策略-缓存开关" class="headerlink" title="Pragma策略 - 缓存开关"></a>Pragma策略 - 缓存开关</h3><p>HTTP1.0中通过Pragma(编译提示)控制页面缓存，通常设置为 <code>Pragma: no-cache</code>，不过这个值不怎么保险，通常还需要加上 <code>Expires: 0</code> 来达到目的。</p><p>Expires是Web服务器响应消息头字段，在响应Http请求时告诉浏览器在过期时间前浏览器可以直接从浏览器缓存读取数据，而无需再次请求。不过Expires是HTTP1.0的东西，现在默认浏览器均默认使用HTTP1.1，所以它的作用基本忽略。Expires的一个缺点就是，返回的到期时间是服务器端的时间，这样存在一个问题，如果客户端的时间与服务器的时间相差很大，那么误差就很大，所以从HTTP1.1开始，使用 <code>Cache-Control：max-age=XXX</code>替代Expires。</p><h3 id="Cache-control策略"><a href="#Cache-control策略" class="headerlink" title="Cache-control策略"></a>Cache-control策略</h3><p>Cache-Control与Expires的作用一致，都是指明当前资源的有效期，控制浏览器是否直接从浏览器缓存读取数据还是重新发送请求到服务器获取数据。只不过Cache-Control的选择更多，设置更细致，如果同时设置的话，其优先级高于Pragma和Expires。其值有：</p><p>在请求中使用 Cache-Control 时，其常用可选值有：</p><ul><li><code>no-cache</code>：告知（代理）服务器不直接使用缓存，要求向原服务器发起请求</li><li><code>no-store</code>：所有内容都不会保存到缓存或Internet临时文件中</li><li><code>only-if-cached</code>：告知（代理）服务器客户端希望获取缓存的内容（若有），而不用向原服务器发起请求</li></ul><p>在响应中使用 Cache-Control 时，其可选值有（按优先级排序）：</p><ul><li><code>no-store</code>：所有内容都不会保存到缓存或Internet临时文件中</li><li><code>must-revalidate</code>：当前资源一定是向原服务器发起验证请求，若请求失败会返回504（而非代理服务器上的缓存）</li><li><code>no-cache</code>：不使用缓存，要求要原服务器发起请求，并不是不缓存</li><li><code>public</code>：浏览器和缓存服务器都可以缓存资源（即使是需要HTTP认证的资源）</li><li><code>max-age</code>：告知客户端该资源在多少秒内是新鲜的，不需要向服务器发请求</li></ul><div class="note warning no-icon"><p>缓存开关：Pragma，Cache-control。用于标识请求或访问中是否开启了缓存，使用了哪种缓存方式。</p><p>缓存校验：Expires，Last-Modified，Etag。用户定义缓存的有效期，怎么确保缓存是最新的。</p><p>在HTTP1.0中：</p><ul><li>如果想要使用缓存，那么即可设置 <code>Expires</code> 来设置缓存有效时间</li><li>如果想要禁用缓存，那么即可设置 <code>Pragma: no-cache</code>，最好加上 <code>Expires: 0</code> 来禁用缓存，等效于HTTP1.1中的 <code>Cache-Control: no-cache</code></li></ul><p>在HTTP1.1中：</p><ul><li>如果想要使用缓存，即可设置 <code>Cache-Control</code> 来设置相关参数，如果还有 <code>Expires</code> 相关设置，其优先级为：<code>Cache-Control</code> &gt; <code>Expires</code></li><li>如果想要禁用缓存，那么即可设置 <code>Cache-Control: no-cache</code>，如果还有 <code>Pragma</code> 相关设置，其优先级为：<code>Cache-Control</code> &gt; <code>Pragma/Expires</code></li></ul><p>两个容易忽视的地方：</p><ul><li>符合缓存策略时，服务器不会发送新的资源，但不是说客户端和服务器就没有会话了，客户端还是会发请求到服务器的。</li><li>Cache-Control除了在响应中使用，在请求中也可以使用。比如在开发者工具模拟请求时勾选【Disable cache】，则页面请求时，Request Headers中就会自动加入参数 <code>Cache-Control: no-cache</code>。</li></ul></div><h3 id="Etag-If-None-Match"><a href="#Etag-If-None-Match" class="headerlink" title="Etag/If-None-Match"></a>Etag/If-None-Match</h3><p>要配合Cache-Control使用。Etag是服务器自动生成或者由开发者生成的对应资源在服务器端的唯一标识符，能够更多准确地控制缓存。Last-Modified 与 Etag 一起使用时，服务器会优先验证Etag。</p><ul><li><code>Etag</code>：Web服务器响应请求时，告诉浏览器当前资源在服务器的唯一标识（生成规则有服务器决定）。</li><li><code>If-None-Match</code>：当资源过期时（使用Cache-Control标识的 <code>max-age</code>），发现资源具有 <code>Etag</code> 声明，则再次向Web服务器请求时带上头 <code>If-None-Match</code> （Etag的值）。Web服务器收到请求后发现有头 <code>If-None-Match</code> 则与被请求资源的相应校验串进行比较，决定返回200或304。</li></ul><div class="note warning no-icon"><p>既然有了 <code>Last-Modified</code> 为何还需要 <code>Etag</code>?</p><ul><li><code>Last-Modified</code> 标注的最后修改只能精确到秒级，如果某些文件在1秒钟之内，被修改多次的话，它将不能准确标注文件的修改时间</li></ul></div><h3 id="Last-Modified-If-Modified-Since"><a href="#Last-Modified-If-Modified-Since" class="headerlink" title="Last-Modified/If-Modified-Since"></a>Last-Modified/If-Modified-Since</h3><p>要配合Cache-Control使用。</p><ul><li><code>Last-Modified</code>：标识这个响应资源的最后修改时间。Web服务器在响应请求时，告诉浏览器资源的最后修改时间。</li><li><code>If-Modified-Since</code>：当资源过期时（使用Cache-Control标识的 <code>max-age</code>），发现资源具有 <code>Last-Modified</code> 声明，则再次向Web服务器请求时带上头 <code>If-Modified-Since</code>， 表示请求时间。Web服务器收到请求后发现有头 <code>If-Modified-Since</code> 则与被请求资源的最后修改时间进行对比，若最后修改时间较新，说明资源又被改动过，则相应整片资源内容（写在响应消息包体内），HTTP 200；若最后修改时间较旧，说明资源无新修改，则相应HTTP 304 （无需包体，节省浏览），告知浏览器继续使用所保存的Cache。</li></ul><p><img data-src="../../assets/20200612174113.png" alt=""></p><div class="note warning no-icon"><ul><li>200：当浏览器本地没有缓存，或者用户点击了 <code>CLT + F5</code> 时，浏览器直接去服务器下载最新数据</li><li>200（from cache）：由 <code>Expires/Cache-Control</code> 控制，只要没有失效，浏览器就只会访问浏览器本地的缓存</li><li>301：永久重定向</li><li>302：临时重定向</li><li>304：服务器资源未变化。由 <code>Last-Modified/Etag</code> 控制，或者用户点击了 <code>Refresh/F5</code> 时，浏览器就会发送请求到服务器，如果服务器端资源没有变化，则返回304给浏览器</li></ul></div><!-- rebuild by neat -->]]></content>
      <categories>
        <category>HTTP</category>
      </categories>
      <tags>
        <tag>HTTP</tag>
        <tag>缓存</tag>
      </tags>
  </entry>
  <entry>
    <title>TCP-三次握手四次挥手</title>
    <url>/archives/19577025.html</url>
    <content><![CDATA[<!-- build time:Wed Nov 11 2020 15:14:23 GMT+0800 (GMT+08:00) --><p>本篇主要记录TCP建立连接需要三次握手和断开连接需要四次挥手的详解。</p><a id="more"></a><h2 id="TCP-IP"><a href="#TCP-IP" class="headerlink" title="TCP/IP"></a>TCP/IP</h2><ul><li>TCP/IP 不是一个协议，而是一个协议族的统称，里面包含了 IP协议、IMCP协议、TCP协议、HTTP协议、FTP协议、POP3协议等</li><li>IP 用于计算机之间的通信</li><li>TCP 用于应用程序之间的通信，比如客户端与服务端的通信。当应用程序希望通过 TCP 与另一个应用程序通信时，它会发送一个通信请求。这个请求必须被送到一个确切的地址。在双方“握手”之后，TCP 将在两个应用程序之间建立一个全双工（full-duplex）的通信。这个全双工的通信将占用两个计算机之间的通信线路，直到它被一方或双方关闭为止。</li><li>TCP 赋值将数据分割并装入 IP 包，然后在他们到达的时候重新组合它们。</li><li>IP 负责将包发送至接受者。</li></ul><p>由于 TCP 不存在连接的概念，只存在请求和响应，请求和响应都是数据包，它们之间都是经过由 TCP 创建的一个从客户端发起，服务器接收的类似连接通道，这个连接可以一直保持，HTTP 请求就是在这个连接的基础上发送的。在一个 TCP 连接上是可以发送多个 HTTP 请求的，不同的版本这个模式不一样：</p><ol><li>HTTP/1.0中：这个 TCP 连接是在 HTTP 请求创建的时候同步创建的，HTTP 请求发送到服务器端，服务器端响应了之后，这个 TCP 连接就关闭了；（无需握手）</li><li>HTTP/1.1中，这个 TCP 连接可以以某种方式声明这个连接一直保持，一个请求传输完之后，另一个请求可以接着传输。这样的好处是：在创建一个 TCP 连接的过程中需要“三次握手”的消耗，“三次握手”代表有三次网络传输。之后的请求就无需“三次握手”的消耗；</li><li>HTTP/2.0中，除了可以“三次握手”建立长连接，还可以在同一个 TCP 连接里并发地传输 HTTP 请求</li></ol><div class="note primary"><p>更多的HTTP1.0、HTTP1.1、HTTP2.0区别，可查看 <a href="/archives/63110c3b.html">链接</a></p></div><h2 id="TCP报文格式"><a href="#TCP报文格式" class="headerlink" title="TCP报文格式"></a>TCP报文格式</h2><p><img data-src="../../assets/20200603170910.png" alt=""></p><ul><li><strong>端口号：</strong>用来标识同一台计算机的不同的应用进程。</li><li><strong>源端口：</strong>源端口和IP地址的作用是标识报文的返回地址。</li><li><strong>目的端口：</strong>端口指明接收方计算机上的应用程序接口。</li><li><strong>序号：</strong><code>Seq</code>序号，占32位，用来标识从TCP源端向目的端发送的字节流，发起方发送数据时对此进行标记。</li><li><strong>确认号：</strong><code>Ack</code>序号，占32位，只有 <code>ACK</code> 标志位为 <code>1</code> 时，确认序号字段才有效，<code>Ack = Seq + 1</code>。</li><li><strong>标志位：</strong>共6个，每一个标志位表示一个控制功能<ul><li><strong>URG：</strong>紧急指针标志，为1时表示紧急指针有效，为0则忽略紧急指针。</li><li><strong>ACK：</strong>确认序号标志，为1时表示确认号有效，为0表示报文中不含确认信息，忽略确认号字段。<strong>只要有应答连接，就需要置1，并且携带ack确认号。</strong></li><li><strong>PSH：</strong>push标志，为1表示是带有push标志的数据，指示接收方在接收到该报文段以后，应尽快将这个报文段交给应用程序，而不是在缓冲区排队。</li><li><strong>RST：</strong>重置连接标志，用于重置由于主机崩溃或其他原因而出现错误的连接。或者用于拒绝非法的报文段和拒绝连接请求。</li><li><strong>SYN：</strong>同步序号，用于建立连接过程，在连接请求中，SYN=1和ACK=0表示该数据段没有使用捎带的确认域，而连接应答捎带一个确认，即SYN=1和ACK=1。<strong>只要有请求建立连接，就需要置为1，并且携带seq序号。</strong></li><li><strong>FIN：</strong>finish标志，用于释放连接，为1时表示发送方已经没有数据发送了，即关闭本方数据流。</li></ul></li></ul><div class="note warning no-icon"><ol><li>TCP报头中的源端口号和目的端口号同IP数据报中的源IP与目的IP唯一确定一条TCP连接。</li><li>不要将确认序号Ack与标志位中的ACK搞混了。</li><li>对应关系为：<ul><li>SYN（标志位）　＜－＞　seq（序号）</li><li>ACK（标志位）　＜－＞　ack（确认序号）</li></ul></li><li>报文（数据包）在握手和挥手传输中，都不是同一个报文，而是每一次传输都是一个新的报文。</li></ol></div><h2 id="TCP的三次握手"><a href="#TCP的三次握手" class="headerlink" title="TCP的三次握手"></a>TCP的三次握手</h2><p><img data-src="../../assets/20200603173928.png" alt=""></p><ol><li>第一次，客户端将标志位SYN（同步序号）置为1（SYN=1），随机产生一个序号值seq=J，并将该数据包发送给到服务器，然后进入到SYN_SEND状态，等待服务器确认。</li><li>第二次，服务器收到数据包后由标志位SYN=1包可知，客户端请求建立连接，为表示同意客户端的请求，将标志位SYN和ACK都置为1，ack=J+1，并随机产生一个序号值seq=K，发送给客户端，然后进入到SYN_RCVD状态，等待客户端确认。</li><li>第三次，客户端确认收到后，检查ack是否为J+1，ACK是否为1，如果正确则将确认标志位置为1，ack=K+1,并将数据包发送给服务器，服务器检查ack是否为K+1，ACK是否为1，如果正确则连接建立成功，客户端和服务端则进入ESTABLISHED状态，完成了三次握手，可以传输数据了。</li></ol><p>简易理解模式：</p><ol><li>第一步：C: 喂，你听得到吗？C -&gt; SYN_SEND</li><li>第二步：S: 嗯，听得到，我说话你也听得到吗？S -&gt; SYN_RCVD | C -&gt; ESTABLISHED</li><li>第三步：C: 我也听得到。那我们说正事吧… S -&gt; ESTABLISHED</li></ol><h2 id="TCP的四次挥手"><a href="#TCP的四次挥手" class="headerlink" title="TCP的四次挥手"></a>TCP的四次挥手</h2><p><img data-src="../../assets/20200603174518-1591240733035.png" alt=""></p><ol><li>第一次：客户端将TCP报文中的一个释放标志位（FIN）置为1，并随机产生一个序号seq=u，并将该数据包（注意该数据包没有数据）发送给到服务器，这时客户端已关闭发送消息（但仍可以接收消息），然后进入释放等待状态。</li><li>第二次：服务器接收到客户端发送来的数据包，由FIN=1知道客户端想要关闭连接，为了应答，将应答标志位置为1，同时生成确认号ack=u+1,并随机产生一个序号seq=v，发送给客户端，告知客户端已知晓，注意此时服务端并没有将FIN标志位置为1，所以客户端仍旧是等待状态。</li><li>第三次：服务器确认没有数据要给客户端了，就将FIN标志位和ACK标志位置为1，确认号为之前的ack=u+1,随机产生一个序号seq=w，请求释放连接，发给客户端，然后进入等待状态。</li><li>第四次：客户端确认收到后，检查ack是否为u+1，ACK是否为1，如果正确将ACK标志位置1，ack=w+1,序号为seq=u+1，发送给服务端，表示应答，服务端接收到后，关闭连接，此时服务端进入最大报文生存时间，如果在这段时间内，没有接收报文，则关闭连接。</li></ol><p>简易理解模式：</p><ol><li>第一步：C: 喂，我要挂电话了！C -&gt; FIN_WAIT1</li><li>第二步：S: 嗯，好，等下，我刚才那个事还没说完呢… S -&gt; CLOSE_WAIT | C -&gt; FIN_WAIT2</li><li>第三步：S: 好了，说完了，那就挂电话吧 S-&gt; CLOSE</li><li>第四步：C: 好，再见 C -&gt; TIME_WAIT | S -&gt; CLOSED C等待2MSL,保证S收到了消息，否则重说一次“好，再见” C -&gt; CLOSED</li></ol><div class="note warning no-icon"><p>中断连接端可以是Client端，也可以是Server端。</p></div><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p><strong>【问题一】为什么连接的时候是三次握手，关闭的时候却是四次握手？</strong></p><div class="note info no-icon"><p>这是因为服务端在收到建立连接请求的SYN报文后，把ACK好SYN放在一个报文里发送给客户端。而关闭连接时，当服务端收到客户端释放（关闭）连接的FIN报文后，仅仅表示客户端不再发送数据了但是能还能接收数据，服务端也未必全部数据都发送给了客户端，所以服务端需要检查是否还有数据未发送给客户端，等全部数据都给了客户端，再发送服务端的释放（关闭）连接的FIN报文给客户端，表示同意现在关闭连接，因此，服务端的ACK和FIN一般会分开发送。</p></div><p><strong>【问题二】为什么TIME_WAIT状态需要经过2MSL(最大报文段生存时间)才能返回到CLOSE状态？</strong></p><div class="note info no-icon"><p>虽然按道理，四个报文都发送完毕，我们可以直接进入CLOSE状态了，但是我们必须假象网络是不可靠的，有可以最后一个ACK丢失。所以TIME_WAIT状态就是用来重发可能丢失的ACK报文。</p></div><!-- rebuild by neat -->]]></content>
      <categories>
        <category>HTTP</category>
      </categories>
      <tags>
        <tag>HTTP</tag>
        <tag>TCP</tag>
        <tag>三次握手</tag>
        <tag>四次挥手</tag>
      </tags>
  </entry>
</search>
